# 全新採購管理系統

## 概述

我們已經完全重新設計了採購管理系統，實現了您要求的所有功能。新的系統採用由上而下的佈局，提供更直觀的採購體驗。

## 系統架構

### 佈局順序（由上而下）
1. **[採購清單]** - 顯示所有採購單，支援狀態篩選和分頁
2. **[搜尋欄]** - 動態搜尋物料和香精，點擊加入採購車
3. **[採購車]** - 按供應商分組顯示，支援勾選和數量調整

## 主要功能

### 1. 採購清單區域
- **狀態篩選**：支援全部、預報單、已訂購、已入庫四種狀態
- **分頁顯示**：每頁最多顯示10項，超過10項自動分頁
- **即時更新**：建立新採購單後自動刷新列表
- **詳細查看**：點擊採購單行可直接進入詳情頁面
- **採購金額**：顯示採購單總金額（包含其他費用）
- **狀態顏色**：預報單（紫色）、已訂購（綠色）、已入庫（深灰色）

### 2. 搜尋欄區域
- **智能搜尋**：支援物料名稱、代號、香精名稱搜尋
- **供應商搜尋**：可切換搜尋供應商，顯示該供應商的所有物料和香精
- **即時結果**：輸入時即時顯示搜尋結果
- **一鍵加入**：點擊"加入採購車"按鈕直接添加
- **連續操作**：加入採購車後搜尋視窗不消失，可繼續搜尋和加入
- **結果限制**：最多顯示10個搜尋結果，避免頁面過長
- **名稱排序**：搜尋結果依照名稱自動排序
- **清除搜尋**：提供清除按鈕，快速清空搜尋結果

### 3. 採購車區域
- **供應商分組**：自動按供應商分組顯示項目
- **數量調整**：支援 +/- 按鈕和直接輸入數字調整數量
- **勾選功能**：每個項目都有勾選框，可選擇性建立採購單
- **供應商全選**：每個供應商標題都有勾選框，可一鍵全選該供應商所有項目
- **建立採購單**：支援建立全部或勾選項目的採購單
- **確認對話框**：建立前顯示確認對話框，顯示將建立的採購單數量和項目詳情
- **持久化儲存**：使用 localStorage 保存，刷新頁面不丟失
- **總金額計算**：自動計算總金額
- **側邊欄氣泡**：在側邊欄採購管理顯示紅色數量氣泡（顯示項目數量）

### 4. 物料和香精管理整合
- **勾選加入**：在物料和香精管理頁面勾選項目後點擊"加入採購車"
- **統一採購車**：所有項目統一存儲在同一個採購車中
- **智能去重**：相同項目自動合併，增加數量而非重複添加
- **即時反饋**：加入採購車後自動清空勾選狀態，顯示成功訊息

### 5. 供應商搜尋整合
- **供應商搜尋**：可搜尋供應商名稱
- **項目展示**：點擊供應商後顯示該供應商的所有物料和香精
- **快速篩選**：透過供應商快速找到相關的採購項目

### 6. 採購單詳情頁面
- **數量編輯**：支援編輯採購項目數量（已入庫狀態不可編輯）
- **總金額顯示**：自動計算並顯示採購單總金額（包含其他費用）
- **其他費用管理**：支援添加運費、關稅等額外費用項目
- **留言功能**：支援添加留言和上傳圖片
- **圖片壓縮**：自動壓縮上傳圖片至 800x600 解析度，節省儲存空間
- **圖片管理**：使用日期分類儲存圖片，便於維護
- **留言管理**：支援刪除留言，同時刪除相關圖片
- **訂單刪除**：支援刪除整個採購單，同時刪除所有相關資料和圖片
- **狀態顏色**：與採購清單一致的狀態顏色顯示
- **即時儲存**：數量變更後可立即儲存

## 使用流程

### 採購車使用流程

1. **搜尋項目**
   - 在搜尋欄輸入物料名稱、代號、香精名稱或供應商名稱
   - 可切換搜尋類型：物料/香精 或 供應商
   - 從搜尋結果中點擊"加入採購車"或"查看項目"

2. **管理採購車**
   - 項目直接加入採購車，無需勾選
   - 在採購車中調整項目數量（支援直接輸入）
   - 檢查供應商分組和總金額
   - 側邊欄顯示紅色數量氣泡，即時查看採購車狀態

3. **建立採購單**
   - 勾選特定項目後點擊"建立採購單"，只建立勾選的項目
   - 未勾選任何項目時點擊"建立採購單"，建立所有採購車項目
   - 點擊"建立採購單"後會顯示確認對話框，顯示將建立的採購單數量和項目詳情
   - 確認後才會實際建立採購單
   - 建立後已使用的項目自動從採購車移除
   - 未使用的項目繼續留在採購車中

4. **採購車功能**
   - 支援數量調整（+/- 按鈕和直接輸入）
   - 支援項目移除
   - 自動按供應商分組
   - 持久化儲存，刷新頁面不丟失

### 供應商搜尋流程

1. **切換搜尋模式**
   - 點擊"供應商"按鈕切換到供應商搜尋模式

2. **搜尋供應商**
   - 輸入供應商名稱進行搜尋

3. **查看供應商項目**
   - 點擊"查看項目"按鈕
   - 系統自動顯示該供應商的所有物料和香精

4. **批量加入**
   - 可連續點擊多個項目加入採購車
   - 搜尋視窗保持開啟，無需重新搜尋

## 技術特點

### 1. 本地儲存
- 使用 `localStorage` 保存採購車資料
- 登出或刷新頁面後資料不丟失
- 支援跨瀏覽器標籤頁同步

### 2. 響應式設計
- 完全支援桌面版和手機版
- 手機版優化的觸控體驗
- 自適應佈局，各種螢幕尺寸都能正常顯示

### 3. 橘色配色風格
- 維持原有的橘色主題
- 使用漸變色彩增強視覺效果
- 一致的色彩搭配提升用戶體驗

### 4. 性能優化
- 使用 `useMemo` 和 `useCallback` 優化渲染
- 分頁載入避免一次性載入過多資料
- 智能篩選減少不必要的計算

## 新增的 API 整合

### 1. 物料管理頁面
- 在操作下拉選單中添加"加入採購車"選項
- 在手機版卡片中添加"加入採購車"按鈕
- 自動整合到統一採購車系統

### 2. 香精管理頁面
- 在操作下拉選單中添加"加入採購車"選項
- 在手機版卡片中添加"加入採購車"按鈕
- 自動整合到統一採購車系統

### 3. 採購車整合
- 移除採購單建立頁面，簡化流程
- 物料和香精管理頁面的"建立採購單"改為"加入採購車"
- 勾選項目後直接加入採購車，無需額外頁面

## 部署說明

### 1. 前端部署
```bash
npm run build
firebase deploy --only hosting
```

### 2. 後端函數部署（如需要）
```bash
cd functions
npm run build
firebase deploy --only functions
```

### 3. 完整部署
```bash
npm run deploy-full
```

## 測試建議

### 1. 基本功能測試
- [ ] 搜尋物料和香精（檢查名稱排序）
- [ ] 搜尋供應商
- [ ] 切換搜尋類型（物料/香精 vs 供應商）
- [ ] 加入採購車
- [ ] 連續加入多個項目（搜尋視窗不消失）
- [ ] 調整數量（+/- 按鈕和直接輸入）
- [ ] 移除項目
- [ ] 點擊採購單行進入詳情
- [ ] 編輯採購單數量
- [ ] 查看總金額計算（包含其他費用）
- [ ] 添加其他費用項目
- [ ] 移除其他費用項目
- [ ] 添加留言
- [ ] 上傳留言圖片（自動壓縮）
- [ ] 查看留言記錄
- [ ] 刪除留言（連同圖片一起刪除）
- [ ] 刪除整個採購單（連同所有資料和圖片）
- [ ] 側邊欄紅色數量氣泡顯示（項目數量）
- [ ] 物料管理頁面勾選加入採購車
- [ ] 香精管理頁面勾選加入採購車
- [ ] 採購車項目勾選功能
- [ ] 供應商全選功能
- [ ] 建立全部採購車項目
- [ ] 建立勾選的採購車項目
- [ ] 確認對話框顯示
- [ ] 確認對話框顯示採購單數量

### 2. 持久化測試
- [ ] 刷新頁面後採購車資料保持
- [ ] 關閉瀏覽器後重新開啟
- [ ] 跨標籤頁同步

### 3. 整合測試
- [ ] 從物料管理頁面勾選加入採購車
- [ ] 從香精管理頁面勾選加入採購車
- [ ] 混合物料和香精加入採購車
- [ ] 供應商搜尋後顯示相關項目
- [ ] 供應商項目批量加入採購車
- [ ] 側邊欄數量氣泡即時更新
- [ ] 勾選加入後自動清空勾選狀態

### 4. 響應式測試
- [ ] 桌面版功能正常
- [ ] 手機版功能正常
- [ ] 平板版功能正常

### 5. 狀態顏色測試
- [ ] 預報單顯示紫色（篩選按鈕和清單標籤一致）
- [ ] 已訂購顯示綠色（篩選按鈕和清單標籤一致）
- [ ] 已入庫顯示深灰色（篩選按鈕和清單標籤一致）
- [ ] 狀態篩選按鈕與清單標籤顏色完全一致

## 注意事項

1. **瀏覽器相容性**：需要支援 `localStorage` 的現代瀏覽器
2. **資料同步**：採購車資料僅在本地儲存，不同設備間不同步
3. **權限控制**：採購單建立需要相應的權限
4. **網路要求**：搜尋和建立採購單需要網路連接

## 未來改進建議

1. **雲端同步**：將採購車資料同步到雲端
2. **批量操作**：支援批量匯入採購項目
3. **採購歷史**：記錄採購車操作歷史
4. **智能推薦**：基於庫存和使用頻率推薦採購項目
5. **供應商管理**：整合供應商報價和交期資訊

## 支援

如果您在使用過程中遇到任何問題，請檢查：
1. 瀏覽器控制台是否有錯誤訊息
2. 網路連接是否正常
3. Firebase 配置是否正確
4. 權限設定是否適當

---

**版本**：1.0.0  
**更新日期**：2025年1月  
**開發者**：AI Assistant
