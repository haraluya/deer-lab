# ğŸ”’ å¾·ç§‘æ–¯ç‰¹å¯¦é©—å®¤ - å…¨å°ˆæ¡ˆå‚™ä»½èˆ‡å›æ»¾ç³»çµ±è¨­è¨ˆ

## ğŸ“Š ç³»çµ±æ¦‚æ³åˆ†æ

### ç¾æœ‰æ¶æ§‹
- **è³‡æ–™åº«**ï¼šFirebase Firestoreï¼ˆNoSQLï¼‰
- **æª”æ¡ˆå„²å­˜**ï¼šFirebase Storage
- **ç”¨æˆ¶èªè­‰**ï¼šFirebase Auth
- **æ‡‰ç”¨æ¶æ§‹**ï¼šNext.js 14 + Firebase Functions
- **éƒ¨ç½²ç’°å¢ƒ**ï¼šFirebase Hosting + Cloud Functions

### Firestore é›†åˆæ¸…å–®
| é›†åˆåç¨± | ç”¨é€” | é‡è¦æ€§ |
|---------|------|--------|
| materials | åŸç‰©æ–™åº«å­˜ | é«˜ |
| fragrances | é¦™ç²¾åº«å­˜ | é«˜ |
| products | ç”¢å“ç›®éŒ„ | é«˜ |
| suppliers | ä¾›æ‡‰å•†è³‡è¨Š | é«˜ |
| purchase_orders | æ¡è³¼è¨‚å–® | é«˜ |
| work_orders | ç”Ÿç”¢å·¥å–® | é«˜ |
| timeEntries | å·¥æ™‚è¨˜éŒ„ | ä¸­ |
| users | ä½¿ç”¨è€…æª”æ¡ˆ | é«˜ |
| roles | è§’è‰²å®šç¾© | ä¸­ |
| globalCart | å…¨åŸŸè³¼ç‰©è»Š | ä½ |
| inventory_records | åº«å­˜ç•°å‹•è¨˜éŒ„ | ä¸­ |
| material_categories | ç‰©æ–™åˆ†é¡ | ä¸­ |
| product_series | ç”¢å“ç³»åˆ— | ä¸­ |
| fragrance_history | é¦™ç²¾è®Šæ›´æ­·å² | ä½ |
| storage_materials | å„²ä½ç‰©æ–™ | ä¸­ |
| storage_locations | å„²ä½ç®¡ç† | ä¸­ |

## ğŸ¯ å‚™ä»½ç³»çµ±æ¶æ§‹è¨­è¨ˆ

### ç³»çµ±æ¶æ§‹åœ–
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‚™ä»½ç®¡ç†ä»‹é¢ (UI)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å‚™ä»½ API å±¤                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å‰µå»ºå‚™ä»½     â”‚  æ¢å¾©å‚™ä»½      â”‚  å‚™ä»½ç®¡ç†          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    æ ¸å¿ƒå‚™ä»½å¼•æ“                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚Firestore â”‚ Storage  â”‚  Auth    â”‚  Metadata    â”‚    â”‚
â”‚  â”‚  å‚™ä»½    â”‚   å‚™ä»½   â”‚   å‚™ä»½    â”‚    ç®¡ç†      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å„²å­˜å±¤                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Google Cloud â”‚  AWS S3     â”‚  æœ¬åœ°ä¸‹è¼‰         â”‚    â”‚
â”‚  â”‚   Storage    â”‚  (å‚™æ´)     â”‚   (é›¢ç·š)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡çµ„åŒ–è¨­è¨ˆ

#### 1. æ ¸å¿ƒå‚™ä»½å¼•æ“ (`functions/src/api/backup/`)
```typescript
backup-system/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ firestore/
â”‚   â”‚   â”œâ”€â”€ exporter.ts        // Firestore å°å‡ºå™¨
â”‚   â”‚   â”œâ”€â”€ importer.ts        // Firestore å°å…¥å™¨
â”‚   â”‚   â””â”€â”€ validator.ts       // è³‡æ–™é©—è­‰å™¨
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ fileBackup.ts      // Storage æª”æ¡ˆå‚™ä»½
â”‚   â”‚   â””â”€â”€ fileRestore.ts     // Storage æª”æ¡ˆæ¢å¾©
â”‚   â””â”€â”€ auth/
â”‚       â”œâ”€â”€ userExport.ts      // ç”¨æˆ¶è³‡æ–™å°å‡º
â”‚       â””â”€â”€ userImport.ts      // ç”¨æˆ¶è³‡æ–™å°å…¥
â”œâ”€â”€ scheduler/
â”‚   â”œâ”€â”€ cronJobs.ts           // æ’ç¨‹ä»»å‹™
â”‚   â””â”€â”€ scheduler.config.ts   // æ’ç¨‹é…ç½®
â”œâ”€â”€ compression/
â”‚   â”œâ”€â”€ compressor.ts         // å£“ç¸®è™•ç†
â”‚   â””â”€â”€ encryptor.ts          // åŠ å¯†è™•ç†
â””â”€â”€ storage-manager/
    â”œâ”€â”€ gcsManager.ts         // GCS ç®¡ç†
    â”œâ”€â”€ s3Manager.ts          // S3 ç®¡ç†
    â””â”€â”€ localManager.ts       // æœ¬åœ°å„²å­˜ç®¡ç†
```

#### 2. å‚™ä»½è³‡æ–™çµæ§‹
```typescript
// å‚™ä»½å…ƒè³‡æ–™
interface BackupMetadata {
  id: string;                    // å‚™ä»½å”¯ä¸€è­˜åˆ¥ç¢¼
  name: string;                   // å‚™ä»½åç¨±
  description?: string;           // å‚™ä»½æè¿°
  timestamp: Date;                // å‚™ä»½æ™‚é–“
  version: string;                // ç³»çµ±ç‰ˆæœ¬
  type: 'full' | 'incremental' | 'manual' | 'scheduled';
  status: 'pending' | 'in_progress' | 'completed' | 'failed';

  // å‚™ä»½å…§å®¹
  collections: CollectionBackup[];
  storageFiles: StorageBackup[];
  authUsers: AuthBackup[];

  // çµ±è¨ˆè³‡è¨Š
  statistics: {
    documentCount: number;
    fileCount: number;
    userCount: number;
    totalSizeBytes: number;
    compressedSizeBytes: number;
  };

  // å®‰å…¨è³‡è¨Š
  encryption: {
    enabled: boolean;
    algorithm: 'AES-256-GCM';
    keyId?: string;
  };
  checksum: string;              // SHA-256 æ ¡é©—å’Œ

  // æ“ä½œè³‡è¨Š
  createdBy: {
    uid: string;
    email: string;
    role: string;
  };
  restoredCount: number;          // è¢«æ¢å¾©æ¬¡æ•¸
  expiresAt?: Date;               // éæœŸæ™‚é–“
}

// é›†åˆå‚™ä»½çµæ§‹
interface CollectionBackup {
  name: string;                   // é›†åˆåç¨±
  documentCount: number;          // æ–‡æª”æ•¸é‡
  sizeBytes: number;             // å¤§å°
  lastModified: Date;            // æœ€å¾Œä¿®æ”¹æ™‚é–“
  data: any[];                   // å¯¦éš›è³‡æ–™
}
```

### ä¸‰å±¤å‚™ä»½ç­–ç•¥

#### 1. å³æ™‚å‚™ä»½ï¼ˆReal-time Backupï¼‰
- **è§¸ç™¼æ¢ä»¶**ï¼š
  - åˆªé™¤é‡è¦è³‡æ–™å‰ï¼ˆä¾›æ‡‰å•†ã€ç”¢å“ã€å·¥å–®ï¼‰
  - å¤§é‡è³‡æ–™è®Šæ›´å‰
  - ç³»çµ±å‡ç´šå‰
- **å‚™ä»½ç¯„åœ**ï¼šåƒ…å‚™ä»½å³å°‡è®Šæ›´çš„è³‡æ–™
- **ä¿ç•™æ™‚é–“**ï¼š7å¤©

#### 2. å®šæœŸå‚™ä»½ï¼ˆScheduled Backupï¼‰
- **é »ç‡é…ç½®**ï¼š
  - æ¯æ—¥å‚™ä»½ï¼šå‡Œæ™¨ 2:00ï¼ˆå¢é‡ï¼‰
  - æ¯é€±å‚™ä»½ï¼šé€±æ—¥å‡Œæ™¨ 3:00ï¼ˆå®Œæ•´ï¼‰
  - æ¯æœˆå‚™ä»½ï¼šæœˆåˆå‡Œæ™¨ 4:00ï¼ˆå®Œæ•´+æ­¸æª”ï¼‰
- **å‚™ä»½ç¯„åœ**ï¼šå…¨ç³»çµ±è³‡æ–™
- **ä¿ç•™ç­–ç•¥**ï¼š
  - æ¯æ—¥å‚™ä»½ä¿ç•™ 7 å¤©
  - æ¯é€±å‚™ä»½ä¿ç•™ 4 é€±
  - æ¯æœˆå‚™ä»½ä¿ç•™ 12 å€‹æœˆ

#### 3. æ‰‹å‹•å‚™ä»½ï¼ˆManual Backupï¼‰
- **è§¸ç™¼æ–¹å¼**ï¼šç®¡ç†å“¡ä»‹é¢ä¸€éµå‚™ä»½
- **å‚™ä»½é¸é …**ï¼š
  - é¸æ“‡æ€§å‚™ä»½ç‰¹å®šé›†åˆ
  - è‡ªè¨‚å‚™ä»½åç¨±å’Œæè¿°
  - è¨­å®šä¿ç•™æœŸé™
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - é‡å¤§æ›´æ–°å‰
  - è³‡æ–™é·ç§»å‰
  - å¯©è¨ˆéœ€æ±‚

## ğŸ”„ å›æ»¾æ©Ÿåˆ¶è¨­è¨ˆ

### å›æ»¾é¡å‹èˆ‡æµç¨‹

#### 1. å®Œæ•´å›æ»¾ï¼ˆFull Restoreï¼‰
```mermaid
graph TD
    A[é¸æ“‡å‚™ä»½é»] --> B[è¼‰å…¥å‚™ä»½å…ƒè³‡æ–™]
    B --> C[é¡¯ç¤ºå½±éŸ¿é è¦½]
    C --> D{ç¢ºèªåŸ·è¡Œ?}
    D -->|æ˜¯| E[å‰µå»ºç•¶å‰ç‹€æ…‹å‚™ä»½]
    E --> F[æ¸…ç©ºç¾æœ‰è³‡æ–™]
    F --> G[å°å…¥å‚™ä»½è³‡æ–™]
    G --> H[é©—è­‰è³‡æ–™å®Œæ•´æ€§]
    H --> I[æ›´æ–°ç³»çµ±ç‹€æ…‹]
    D -->|å¦| J[å–æ¶ˆæ“ä½œ]
```

#### 2. éƒ¨åˆ†å›æ»¾ï¼ˆPartial Restoreï¼‰
- **é›†åˆç´šå›æ»¾**ï¼šåƒ…æ¢å¾©ç‰¹å®šé›†åˆ
- **æ–‡æª”ç´šå›æ»¾**ï¼šæ¢å¾©ç‰¹å®šæ–‡æª”
- **æ™‚é–“ç¯„åœå›æ»¾**ï¼šæ¢å¾©ç‰¹å®šæ™‚é–“ç¯„åœçš„è³‡æ–™

#### 3. å·®ç•°å›æ»¾ï¼ˆDifferential Restoreï¼‰
- **æ™ºèƒ½æ¯”å°**ï¼šæ¯”è¼ƒç•¶å‰è³‡æ–™èˆ‡å‚™ä»½è³‡æ–™
- **æœ€å°åŒ–å½±éŸ¿**ï¼šåƒ…æ¢å¾©æœ‰å·®ç•°çš„éƒ¨åˆ†
- **è¡çªè™•ç†**ï¼šæä¾›è¡çªè§£æ±ºé¸é …

### å®‰å…¨æ©Ÿåˆ¶

#### 1. é è¦½æ¨¡å¼
```typescript
interface RestorePreview {
  backup: BackupMetadata;
  impact: {
    collectionsToRestore: string[];
    documentsToRestore: number;
    documentsToDelete: number;
    documentsToUpdate: number;
    estimatedTime: number;      // é ä¼°æ™‚é–“ï¼ˆç§’ï¼‰
  };
  warnings: string[];
  conflicts: ConflictItem[];
}
```

#### 2. å¤šé‡é©—è­‰
- **ç¬¬ä¸€å±¤**ï¼šç”¨æˆ¶èº«ä»½é©—è­‰ï¼ˆFirebase Authï¼‰
- **ç¬¬äºŒå±¤**ï¼šè§’è‰²æ¬Šé™æª¢æŸ¥ï¼ˆåƒ…ç®¡ç†å“¡ï¼‰
- **ç¬¬ä¸‰å±¤**ï¼šæ“ä½œå¯†ç¢¼ç¢ºèª
- **ç¬¬å››å±¤**ï¼šå¯©è¨ˆæ—¥èªŒè¨˜éŒ„

#### 3. å›æ»¾ä¿è­·
- **å›æ»¾å‰å‚™ä»½**ï¼šè‡ªå‹•å‚™ä»½ç•¶å‰ç‹€æ…‹
- **å›æ»¾æ­·å²**ï¼šè¨˜éŒ„æ‰€æœ‰å›æ»¾æ“ä½œ
- **å›æ»¾çš„å›æ»¾**ï¼šæ”¯æ´æ’¤éŠ·ä¸Šæ¬¡å›æ»¾

## ğŸ“‹ å¯¦æ–½è¨ˆåŠƒ

### ç¬¬ä¸€éšæ®µï¼šåŸºç¤å»ºè¨­ï¼ˆ5-7å¤©ï¼‰

#### Week 1: æ ¸å¿ƒåŠŸèƒ½é–‹ç™¼

**Day 1-2: API ç«¯é»å»ºç«‹**
```typescript
// å‚™ä»½ API
POST   /api/backup/create         // å‰µå»ºå‚™ä»½
GET    /api/backup/list           // åˆ—å‡ºå‚™ä»½
GET    /api/backup/{id}           // ç²å–å‚™ä»½è©³æƒ…
DELETE /api/backup/{id}           // åˆªé™¤å‚™ä»½
GET    /api/backup/{id}/download  // ä¸‹è¼‰å‚™ä»½

// æ¢å¾© API
POST   /api/restore/preview       // é è¦½æ¢å¾©å½±éŸ¿
POST   /api/restore/execute       // åŸ·è¡Œæ¢å¾©
GET    /api/restore/history       // æ¢å¾©æ­·å²
POST   /api/restore/rollback      // æ’¤éŠ·æ¢å¾©
```

**Day 3-4: Firestore å‚™ä»½æ¨¡çµ„**
- [ ] å¯¦ä½œå…¨é›†åˆå°å‡ºåŠŸèƒ½
- [ ] å¯¦ä½œå¢é‡å‚™ä»½é‚è¼¯
- [ ] å¯¦ä½œè³‡æ–™é©—è­‰æ©Ÿåˆ¶
- [ ] å¯¦ä½œæ‰¹æ¬¡è™•ç†å„ªåŒ–

**Day 5-7: ç®¡ç†ä»‹é¢é–‹ç™¼**
- [ ] å‚™ä»½åˆ—è¡¨é é¢
- [ ] å‚™ä»½å‰µå»ºå°è©±æ¡†
- [ ] å‚™ä»½è©³æƒ…æª¢è¦–
- [ ] æ¢å¾©æ“ä½œä»‹é¢

### ç¬¬äºŒéšæ®µï¼šé€²éšåŠŸèƒ½ï¼ˆ3-4å¤©ï¼‰

#### Week 2: è‡ªå‹•åŒ–èˆ‡å„ªåŒ–

**Day 8-9: Storage å‚™ä»½**
- [ ] ç”¢å“åœ–ç‰‡å‚™ä»½
- [ ] æ–‡ä»¶é™„ä»¶å‚™ä»½
- [ ] æª”æ¡ˆå®Œæ•´æ€§æª¢æŸ¥

**Day 10-11: è‡ªå‹•åŒ–ç³»çµ±**
```typescript
// Cloud Scheduler é…ç½®
const schedules = {
  daily: {
    schedule: '0 2 * * *',      // æ¯æ—¥å‡Œæ™¨ 2:00
    timeZone: 'Asia/Taipei',
    type: 'incremental'
  },
  weekly: {
    schedule: '0 3 * * 0',      // é€±æ—¥å‡Œæ™¨ 3:00
    timeZone: 'Asia/Taipei',
    type: 'full'
  },
  monthly: {
    schedule: '0 4 1 * *',      // æ¯æœˆ1æ—¥å‡Œæ™¨ 4:00
    timeZone: 'Asia/Taipei',
    type: 'full',
    archive: true
  }
};
```

### ç¬¬ä¸‰éšæ®µï¼šå›æ»¾ç³»çµ±ï¼ˆ3-4å¤©ï¼‰

#### Week 2-3: æ¢å¾©åŠŸèƒ½

**Day 12-13: å›æ»¾æ ¸å¿ƒåŠŸèƒ½**
- [ ] é è¦½åŠŸèƒ½å¯¦ä½œ
- [ ] åŸ·è¡Œå›æ»¾é‚è¼¯
- [ ] è¡çªè™•ç†æ©Ÿåˆ¶

**Day 14-15: å®‰å…¨èˆ‡ç›£æ§**
- [ ] é›™å› ç´ èªè­‰æ•´åˆ
- [ ] å¯©è¨ˆæ—¥èªŒç³»çµ±
- [ ] é€²åº¦è¿½è¹¤ä»‹é¢

## ğŸ”§ æŠ€è¡“å¯¦ä½œç´°ç¯€

### å‚™ä»½æª”æ¡ˆæ ¼å¼
```json
{
  "version": "1.0.0",
  "metadata": {
    "id": "backup_20250924_020000",
    "timestamp": "2025-09-24T02:00:00Z",
    "checksum": "sha256:abc123..."
  },
  "data": {
    "firestore": {
      "materials": [...],
      "products": [...],
      "orders": [...]
    },
    "storage": {
      "files": [...]
    },
    "auth": {
      "users": [...]
    }
  }
}
```

### å£“ç¸®èˆ‡åŠ å¯†
```typescript
// å£“ç¸®é…ç½®
const compressionConfig = {
  algorithm: 'gzip',
  level: 9  // æœ€é«˜å£“ç¸®ç‡
};

// åŠ å¯†é…ç½®
const encryptionConfig = {
  algorithm: 'aes-256-gcm',
  keyDerivation: 'pbkdf2',
  iterations: 100000
};
```

### éŒ¯èª¤è™•ç†
```typescript
enum BackupError {
  INSUFFICIENT_PERMISSIONS = 'INSUFFICIENT_PERMISSIONS',
  BACKUP_NOT_FOUND = 'BACKUP_NOT_FOUND',
  CORRUPTION_DETECTED = 'CORRUPTION_DETECTED',
  STORAGE_QUOTA_EXCEEDED = 'STORAGE_QUOTA_EXCEEDED',
  RESTORE_CONFLICT = 'RESTORE_CONFLICT',
  NETWORK_ERROR = 'NETWORK_ERROR'
}
```

## ğŸ’° æˆæœ¬åˆ†æ

### å„²å­˜æˆæœ¬é ä¼°
| é …ç›® | è¦æ ¼ | æœˆè²»ç”¨ |
|-----|------|--------|
| GCS Standard | 100GB | $2.00 |
| GCS Nearlineï¼ˆ30å¤©ä»¥ä¸Šï¼‰ | 500GB | $5.00 |
| ç¶²è·¯æµé‡ | 10GB | $1.20 |
| Firestore æ“ä½œ | 100è¬æ¬¡è®€å¯« | $0.36 |
| **ç¸½è¨ˆ** | - | **~$8.56/æœˆ** |

### æˆæœ¬å„ªåŒ–ç­–ç•¥
1. **ç”Ÿå‘½é€±æœŸç®¡ç†**
   - 30å¤©å¾Œè‡ªå‹•è½‰ç‚º Nearline Storage
   - 365å¤©å¾Œè‡ªå‹•è½‰ç‚º Archive Storage
   - è‡ªå‹•åˆªé™¤éæœŸå‚™ä»½

2. **å¢é‡å‚™ä»½**
   - æ¸›å°‘é‡è¤‡è³‡æ–™å„²å­˜
   - é™ä½ç¶²è·¯å‚³è¼¸æˆæœ¬

3. **å£“ç¸®å„ªåŒ–**
   - å¹³å‡å£“ç¸®ç‡ 70-80%
   - é¡¯è‘—æ¸›å°‘å„²å­˜ç©ºé–“

## âš ï¸ é¢¨éšªç®¡ç†

### é¢¨éšªè­˜åˆ¥èˆ‡å°ç­–

| é¢¨éšªé¡å‹ | å¯èƒ½å½±éŸ¿ | é é˜²æªæ–½ | æ‡‰å°æ–¹æ¡ˆ |
|---------|---------|---------|---------|
| è³‡æ–™æå£ | é«˜ | æ ¡é©—å’Œé©—è­‰ | å¤šç‰ˆæœ¬å‚™ä»½ |
| å‚™ä»½å¤±æ•— | ä¸­ | è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ | å‘Šè­¦é€šçŸ¥ |
| æ¬Šé™æ´©éœ² | é«˜ | åŠ å¯†+å­˜å–æ§åˆ¶ | å®šæœŸå¯©è¨ˆ |
| æ¢å¾©å¤±æ•— | é«˜ | é è¦½+æ¸¬è©¦ | å›æ»¾çš„å›æ»¾ |
| æˆæœ¬è¶…æ”¯ | ä½ | é…é¡é™åˆ¶ | æˆæœ¬å‘Šè­¦ |

### ç½é›£æ¢å¾©è¨ˆåŠƒ
```mermaid
graph LR
    A[ç½é›£ç™¼ç”Ÿ] --> B{è©•ä¼°æå®³}
    B --> C[é¸æ“‡æ¢å¾©é»]
    C --> D[åŸ·è¡Œæ¢å¾©]
    D --> E[é©—è­‰è³‡æ–™]
    E --> F{æ¢å¾©æˆåŠŸ?}
    F -->|æ˜¯| G[æ¢å¾©å®Œæˆ]
    F -->|å¦| H[é¸æ“‡å‚™ç”¨æ–¹æ¡ˆ]
    H --> C
```

## ğŸš€ å¿«é€Ÿé–‹å§‹æŒ‡å—

### ç’°å¢ƒéœ€æ±‚
- Node.js 20+
- Firebase CLI 14.15+
- ç®¡ç†å“¡æ¬Šé™

### åˆå§‹è¨­å®š
```bash
# 1. å®‰è£ä¾è³´
cd functions
npm install @google-cloud/firestore
npm install @google-cloud/storage
npm install node-cron
npm install compression
npm install crypto-js

# 2. è¨­å®šç’°å¢ƒè®Šæ•¸
firebase functions:config:set backup.encryption_key="your-secret-key"
firebase functions:config:set backup.gcs_bucket="your-backup-bucket"
firebase functions:config:set backup.s3_bucket="your-s3-bucket"

# 3. éƒ¨ç½²å‡½æ•¸
npm run build
firebase deploy --only functions:backup,functions:restore
```

### ä½¿ç”¨ç¯„ä¾‹
```typescript
// å‰µå»ºå‚™ä»½
const backup = await createBackup({
  type: 'manual',
  collections: ['materials', 'products'],
  description: 'ç”¢å“æ›´æ–°å‰å‚™ä»½'
});

// é è¦½æ¢å¾©
const preview = await previewRestore(backupId);
console.log(`å°‡æ¢å¾© ${preview.impact.documentsToRestore} å€‹æ–‡æª”`);

// åŸ·è¡Œæ¢å¾©
if (confirm('ç¢ºå®šè¦æ¢å¾©å—ï¼Ÿ')) {
  await executeRestore(backupId, {
    password: adminPassword
  });
}
```

## ğŸ“Š ç›£æ§èˆ‡ç¶­è­·

### é—œéµæŒ‡æ¨™
- **å‚™ä»½æˆåŠŸç‡**ï¼š> 99.9%
- **å¹³å‡å‚™ä»½æ™‚é–“**ï¼š< 5 åˆ†é˜
- **æ¢å¾©æˆåŠŸç‡**ï¼š> 99.5%
- **å„²å­˜ä½¿ç”¨ç‡**ï¼š< 80%

### å®šæœŸç¶­è­·
- [ ] æ¯é€±æª¢æŸ¥å‚™ä»½å®Œæ•´æ€§
- [ ] æ¯æœˆåŸ·è¡Œæ¢å¾©æ¼”ç·´
- [ ] æ¯å­£æ¸…ç†éæœŸå‚™ä»½
- [ ] æ¯å¹´æ›´æ–°ç½é›£æ¢å¾©è¨ˆåŠƒ

## ğŸ“ é™„éŒ„

### A. å‘½ä»¤å¿«é€Ÿåƒè€ƒ
```bash
# æ‰‹å‹•å‚™ä»½
npm run backup:create

# åˆ—å‡ºå‚™ä»½
npm run backup:list

# æ¢å¾©å‚™ä»½
npm run backup:restore <backup-id>

# é©—è­‰å‚™ä»½
npm run backup:verify <backup-id>

# æ¸…ç†éæœŸå‚™ä»½
npm run backup:cleanup
```

### B. æ•…éšœæ’é™¤
| å•é¡Œ | å¯èƒ½åŸå›  | è§£æ±ºæ–¹æ¡ˆ |
|-----|---------|---------|
| å‚™ä»½å¤±æ•— | æ¬Šé™ä¸è¶³ | æª¢æŸ¥æœå‹™å¸³è™Ÿæ¬Šé™ |
| æ¢å¾©ç·©æ…¢ | è³‡æ–™é‡å¤§ | ä½¿ç”¨æ‰¹æ¬¡è™•ç† |
| æ ¡é©—å¤±æ•— | è³‡æ–™æå£ | ä½¿ç”¨å…¶ä»–å‚™ä»½ç‰ˆæœ¬ |

### C. ç›¸é—œæ–‡æª”
- [Firebase å‚™ä»½æœ€ä½³å¯¦è¸](https://firebase.google.com/docs/firestore/manage-data/export-import)
- [Google Cloud Storage æ–‡æª”](https://cloud.google.com/storage/docs)
- [ç½é›£æ¢å¾©è¦åŠƒæŒ‡å—](https://cloud.google.com/architecture/dr-scenarios-planning-guide)

---

**æ–‡æª”ç‰ˆæœ¬**: 1.0.0
**æœ€å¾Œæ›´æ–°**: 2025-09-24
**ä½œè€…**: å¾·ç§‘æ–¯ç‰¹å¯¦é©—å®¤æŠ€è¡“åœ˜éšŠ
**ç‹€æ…‹**: å¾…å¯¦æ–½