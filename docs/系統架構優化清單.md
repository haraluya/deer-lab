# å¾·ç§‘æ–¯ç‰¹çš„å¯¦é©—å®¤ - ç³»çµ±æ¶æ§‹å„ªåŒ–æ¸…å–®

## ğŸ“‹ ç³»çµ±æ¦‚è¦½

**å°ˆæ¡ˆåç¨±**: å¾·ç§‘æ–¯ç‰¹çš„å¯¦é©—å®¤ (Dexter's Lab)
**æŠ€è¡“æ¶æ§‹**: Next.js 14 + Firebase Functions + Firestore + TypeScript
**éƒ¨ç½²æ–¹å¼**: Firebase Functions (Node.js 20) + Firebase Hosting
**è©•ä¼°æ—¥æœŸ**: 2025-09-24

---

## ğŸ› ï¸ **ä¿®å¾©åŸ·è¡ŒåŸå‰‡ï¼ˆå¿…é ˆéµå¾ªï¼‰**

1. **æœ¬åœ°å„ªå…ˆåŸå‰‡**: ä»¥æœ¬åœ°é‹è¡Œæ¸¬è©¦ç‚ºä¸»ï¼Œç¢ºèªåŠŸèƒ½æ­£å¸¸å¾Œå†è€ƒæ…®éƒ¨ç½²
2. **æœ€å°åŒ–éƒ¨ç½²ç­–ç•¥**: æ¯æ¬¡éƒ¨ç½²éƒ½æ¡ç”¨æœ€å°åŒ–æ–¹å¼ï¼Œåªéƒ¨ç½²ä¿®æ”¹çš„éƒ¨åˆ†
3. **ä¿®æ”¹å¾Œæª¢æŸ¥æ©Ÿåˆ¶**: æ¯æ¬¡ä¿®æ”¹å®Œæˆå¾Œéƒ½éœ€è¦é‡æ–°æª¢æŸ¥ä¸€æ¬¡ï¼Œç¢ºä¿æ²’æœ‰å¼•å…¥æ–°å•é¡Œ
4. **éŒ¯èª¤è¨˜éŒ„åŸå‰‡**: å¦‚é‡åˆ°é‡è¤‡å‡ºç¾çš„éŒ¯èª¤ï¼Œå¿…é ˆè¨˜éŒ„åœ¨æ¸…å–®ä¸­ä»¥æ¸›å°‘é‡è¤‡æ€§debug
5. **æ¸¬è©¦é»æä¾›åŸå‰‡**: æ¯æ¬¡ä¿®æ”¹å®Œæˆå¾Œæä¾›å…·é«”æ¸¬è©¦é»çµ¦ç”¨æˆ¶åˆ¤æ–·ä¿®æ”¹æ˜¯å¦æ­£å¸¸é‹è¡Œ
6. **é€²åº¦è¨˜éŒ„åŸå‰‡**: æ›´æ–°è¨˜éŒ„é‡é»è·Ÿé€²åº¦åœ¨è©²ä»»å‹™ä¸‹é¢ï¼Œè®“ä»»å‹™ä¸­æ–·ä¹Ÿå¯ä»¥å¿«é€Ÿé‡æ–°é–‹å§‹

---

## ğŸš¨ **é«˜å„ªå…ˆç´šå•é¡Œ (ç«‹å³ä¿®å¾©)**

### 1. **å‰ç«¯æ€§èƒ½å•é¡Œ**
- **å•é¡Œ**: `StandardDataListPage.tsx` æª”æ¡ˆéæ–¼å·¨å¤§ (1777è¡Œ)ï¼ŒåŒ…å«éå¤šé‚è¼¯
- **å½±éŸ¿**:
  - é¦–æ¬¡è¼‰å…¥æ€§èƒ½å·®
  - ä»£ç¢¼ç¶­è­·å›°é›£
  - åŒ…é«”ç©éå¤§
- **è§£æ±ºæ–¹æ¡ˆ**:
  ```typescript
  // å»ºè­°æ‹†åˆ†ç‚ºå¤šå€‹å­çµ„ä»¶
  src/components/StandardDataListPage/
  â”œâ”€â”€ index.tsx          // ä¸»çµ„ä»¶ (200-300è¡Œ)
  â”œâ”€â”€ Toolbar.tsx        // å·¥å…·æ¬„çµ„ä»¶
  â”œâ”€â”€ DataTable.tsx      // è¡¨æ ¼è¦–åœ–
  â”œâ”€â”€ CardView.tsx       // å¡ç‰‡è¦–åœ–
  â”œâ”€â”€ GridView.tsx       // ç¶²æ ¼è¦–åœ–
  â”œâ”€â”€ Pagination.tsx     // åˆ†é çµ„ä»¶
  â””â”€â”€ hooks/
      â”œâ”€â”€ useViewMode.ts // è¦–åœ–æ¨¡å¼é‚è¼¯
      â”œâ”€â”€ useSorting.ts  // æ’åºé‚è¼¯
      â””â”€â”€ useFiltering.ts // ç¯©é¸é‚è¼¯
  ```
- **é ä¼°å·¥ä½œé‡**: 2-3å¤©

#### ğŸ“ **å¯¦æ–½é€²åº¦è¨˜éŒ„** (2025-09-25)

**âœ… å·²å®Œæˆé …ç›®:**
1. **Hooks æå–** (100% å®Œæˆ)
   - âœ… `useViewMode.ts` - è¦–åœ–æ¨¡å¼å’Œç§»å‹•ç«¯æª¢æ¸¬
   - âœ… `usePagination.ts` - åˆ†é é‚è¼¯ç®¡ç†
   - âœ… `useSorting.ts` - æ’åºåŠŸèƒ½è™•ç†
   - âœ… `useFiltering.ts` - æœå°‹å’Œç¯©é¸é‚è¼¯

2. **çµ„ä»¶åˆ†é›¢** (éƒ¨åˆ†å®Œæˆ)
   - âœ… `Toolbar.tsx` - å·¥å…·åˆ—çµ„ä»¶ (~400è¡Œ)
   - âœ… `types.ts` - çµ±ä¸€é¡å‹å®šç¾©
   - â³ `DataTable.tsx` - å¾…å¯¦ä½œ
   - â³ `CardView.tsx` - å¾…å¯¦ä½œ
   - â³ `Pagination.tsx` - å¾…å¯¦ä½œ

3. **ä¸»çµ„ä»¶é‡æ§‹** (éƒ¨åˆ†å®Œæˆ)
   - âœ… æ–°å»º `index.tsx` (~300è¡Œï¼Œä¸»æ¶æ§‹å®Œæˆ)
   - â³ åŸå§‹ `StandardDataListPage.tsx` å°šæœªæ›¿æ›

**ğŸ”§ ç•¶å‰ç‹€æ…‹:**
- æ–°æ¶æ§‹å·²å»ºç«‹åœ¨ `src/components/StandardDataListPage/` ç›®éŒ„
- æ§‹å»ºæ¸¬è©¦é€šé (`npm run build` æˆåŠŸ)
- åŸå§‹æª”æ¡ˆä¿æŒä¸è®Šï¼Œç¢ºä¿å‘å¾Œç›¸å®¹

**ğŸ“‹ å¾…å®Œæˆäº‹é …:**
1. å¯¦ä½œ DataTable çµ„ä»¶ (è¡¨æ ¼è¦–åœ–)
2. å¯¦ä½œ CardView çµ„ä»¶ (å¡ç‰‡è¦–åœ–)
3. å¯¦ä½œ Pagination çµ„ä»¶ (åˆ†é æ§åˆ¶å™¨)
4. æ•´åˆæ–°çµ„ä»¶å–ä»£åŸå§‹ StandardDataListPage.tsx
5. æ¸¬è©¦æ‰€æœ‰ä½¿ç”¨è©²çµ„ä»¶çš„é é¢ (14å€‹é é¢)

**âš ï¸ å·²çŸ¥å•é¡Œ:**
- StandardStatsCard props é¡å‹å•é¡Œå·²ä¿®å¾©
- StandardFilter é¡å‹ç¼ºå°‘ 'search' é¸é …å·²ä¿®å¾©

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â­â­â˜† (4/5) - é«˜åº¦è¤‡é›œ
- **æŠ€è¡“å‚µå‹™**:
  - 14å€‹é é¢ä½¿ç”¨æ­¤çµ„ä»¶ï¼Œæ›´æ”¹å½±éŸ¿ç¯„åœæ¥µå»£
  - çµ„ä»¶é«˜åº¦è€¦åˆï¼Œç‹€æ…‹ç®¡ç†è¤‡é›œ
  - Props æ¥å£é¾å¤§ (30+ å€‹é…ç½®é¸é …)
  - å¤šé‡è²¬ä»»åŸå‰‡é•ååš´é‡

#### **å½±éŸ¿ç¯„åœåˆ†æ**
```mermaid
graph TD
    A[StandardDataListPage.tsx] --> B[14å€‹é é¢ç›´æ¥ä¾è³´]
    B --> C[Materialç®¡ç†é é¢]
    B --> D[Fragranceç®¡ç†é é¢]
    B --> E[Productç®¡ç†é é¢]
    B --> F[Purchase Orderé é¢]
    B --> G[Work Orderé é¢]
    B --> H[Inventoryé é¢]
    B --> I[Personnelé é¢]
    B --> J[å…¶ä»–æ¥­å‹™é é¢...]

    A --> K[å…±äº«UIå…ƒä»¶]
    K --> L[Toolbar]
    K --> M[Pagination]
    K --> N[FilterSystem]
```

**ç ´å£æ€§æ›´æ”¹é¢¨éšª**:
- **é«˜é¢¨éšª**: æ‰€æœ‰ä½¿ç”¨æ­¤çµ„ä»¶çš„é é¢å¯èƒ½éœ€è¦åŒæ­¥æ›´æ–°
- **ä¸­é¢¨éšª**: TypeScript é¡å‹å®šç¾©é‡å¤§è®Šæ›´
- **ä½é¢¨éšª**: ç´”è¦–è¦ºå±¤é¢çš„æ”¹å‹•

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **æ¼¸é€²å¼é‡æ§‹ç­–ç•¥**
   ```typescript
   // âŒ éŒ¯èª¤ï¼šä¸€æ¬¡æ€§å®Œå…¨é‡å¯«
   // é¢¨éšªï¼šç ´å£ç¾æœ‰åŠŸèƒ½ï¼Œå›æ­¸æ¸¬è©¦å›°é›£

   // âœ… æ­£ç¢ºï¼šæ¼¸é€²å¼åˆ†é›¢
   // Step 1: æå– Hooks é‚è¼¯
   // Step 2: åˆ†é›¢å­çµ„ä»¶
   // Step 3: é‡æ§‹ä¸»çµ„ä»¶
   // Step 4: å„ªåŒ– Props çµæ§‹
   ```

2. **å‘å¾Œç›¸å®¹æ€§ç¶­è­·**
   ```typescript
   // âœ… ä¿æŒèˆŠ API ç›¸å®¹ï¼ŒåŒæ™‚æä¾›æ–° API
   interface StandardDataListPageProps {
     // èˆŠç‰ˆ Props (æ¨™è¨˜ç‚º deprecated)
     /** @deprecated use viewConfig instead */
     legacyMode?: boolean;

     // æ–°ç‰ˆ Props
     viewConfig?: {
       mode: 'legacy' | 'optimized';
       components?: CustomComponents;
     };
   }
   ```

3. **ç‹€æ…‹ç®¡ç†é‡æ§‹**
   ```typescript
   // âŒ é¿å…ï¼šç›´æ¥åœ¨çµ„ä»¶å…§ç®¡ç†éå¤šç‹€æ…‹
   const [viewMode, setViewMode] = useState();
   const [sortBy, setSortBy] = useState();
   const [filters, setFilters] = useState();
   // ... 20+ å€‹ useState

   // âœ… æ¨è–¦ï¼šä½¿ç”¨ useReducer æˆ–è‡ªå®šç¾© hooks
   const { state, dispatch } = useDataListState({
     initialState: defaultConfig
   });
   ```

**ğŸ› ï¸ å¯¦æ–½éšæ®µå»ºè­°**:

**Phase 1: æº–å‚™éšæ®µ (0.5å¤©)**
- å»ºç«‹å®Œæ•´çš„æ¸¬è©¦ç”¨ä¾‹æ¶µè“‹ç¾æœ‰åŠŸèƒ½
- å‰µå»ºçµ„ä»¶ä½¿ç”¨æƒ…æ³åˆ†æå ±å‘Š
- å»ºç«‹ A/B æ¸¬è©¦æ©Ÿåˆ¶ä»¥ç¢ºä¿é‡æ§‹å“è³ª

**Phase 2: Hook æå– (1å¤©)**
- å„ªå…ˆæå–ç„¡ç‹€æ…‹é‚è¼¯ (æ’åºã€ç¯©é¸ã€åˆ†é )
- å»ºç«‹è‡ªå®šç¾© Hook æ¸¬è©¦å¥—ä»¶
- é€æ­¥åœ¨ç¾æœ‰çµ„ä»¶ä¸­å¼•å…¥æ–° Hooks

**Phase 3: çµ„ä»¶åˆ†é›¢ (1-1.5å¤©)**
- ä½¿ç”¨ Compound Component æ¨¡å¼
- å¯¦æ–½ Context API é€²è¡Œç‹€æ…‹å…±äº«
- ä¿æŒèˆŠ Props API å‘å¾Œç›¸å®¹

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **éåº¦å·¥ç¨‹åŒ–**: ä¸è¦å¼•å…¥ä¸å¿…è¦çš„æŠ½è±¡å±¤
- âŒ **ç ´å£æ€§æ›´æ”¹**: ç¢ºä¿æ‰€æœ‰ç¾æœ‰é é¢ç„¡éœ€ä¿®æ”¹å³å¯å·¥ä½œ
- âŒ **æ€§èƒ½å›æ­¸**: æ³¨æ„é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- âŒ **æ¸¬è©¦è¦†è“‹ä¸è¶³**: æ¯å€‹åˆ†é›¢çš„çµ„ä»¶éƒ½éœ€è¦ç¨ç«‹æ¸¬è©¦

### 2. **Firebase Functions éƒ¨ç½²å„ªåŒ–**
- **å•é¡Œ**: éƒ¨ç½²åŒ…å¤§å° (11MB) å¯ä»¥é€²ä¸€æ­¥å„ªåŒ–
- **å½±éŸ¿**:
  - å†·å•Ÿå‹•æ™‚é–“è¼ƒé•·
  - éƒ¨ç½²æ™‚é–“å¢åŠ 
  - æˆæœ¬å¢åŠ 
- **è§£æ±ºæ–¹æ¡ˆ**:
  ```bash
  # å„ªåŒ–æ‰“åŒ…é…ç½®
  # 1. å•Ÿç”¨ Next.js ç”¢å“æ¨¡å¼çš„æ›´æ¿€é€²å„ªåŒ–
  # 2. å¯¦æ–½ Tree Shaking
  # 3. ä½¿ç”¨ SWC ç·¨è­¯å™¨æ›¿ä»£ Babel

  # next.config.js å»ºè­°é…ç½®
  experimental: {
    serverComponentsExternalPackages: ['firebase-admin'],
    optimizeCss: true,
    optimizePackageImports: ['lucide-react', '@radix-ui/react-dialog'],
  }
  ```
- **é ä¼°å·¥ä½œé‡**: 1å¤©

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â˜†â˜†â˜† (2/5) - ä¸­ç­‰è¤‡é›œåº¦
- **æŠ€è¡“å‚µå‹™**:
  - Next.js 14 æ‰“åŒ…å„ªåŒ–é…ç½®ä¸å®Œæ•´
  - æœªå……åˆ†åˆ©ç”¨ SWC ç·¨è­¯å™¨å„ªå‹¢
  - ä¾è³´åº« Tree Shaking æ•ˆæœä¸ä½³
  - éƒ¨ç½²æµç¨‹ç¼ºä¹è‡ªå‹•åŒ–å¤§å°æª¢æŸ¥

#### **å½±éŸ¿ç¯„åœåˆ†æ**
```mermaid
graph TD
    A[éƒ¨ç½²åŒ…å„ªåŒ–] --> B[Cold Start æ€§èƒ½]
    A --> C[éƒ¨ç½²æˆæœ¬]
    A --> D[ç”¨æˆ¶é«”é©—]

    B --> E[Function åˆå§‹åŒ–æ™‚é–“]
    B --> F[è¨˜æ†¶é«”ä½¿ç”¨é‡]

    C --> G[Firebase Functions è¨ˆè²»]
    C --> H[ç¶²è·¯å‚³è¼¸æˆæœ¬]

    D --> I[é¦–æ¬¡è¨ªå•é€Ÿåº¦]
    D --> J[ä¼ºæœå™¨éŸ¿æ‡‰æ™‚é–“]

    A --> K[é–‹ç™¼æµç¨‹]
    K --> L[å»ºæ§‹æ™‚é–“]
    K --> M[éƒ¨ç½²æ™‚é–“]
```

**ç ´å£æ€§æ›´æ”¹é¢¨éšª**:
- **ä½é¢¨éšª**: æ‰“åŒ…é…ç½®æ›´æ”¹ä¸å½±éŸ¿åŠŸèƒ½é‚è¼¯
- **ä¸­é¢¨éšª**: SWC ç·¨è­¯å™¨å¯èƒ½ç”¢ç”Ÿä¸åŒçš„è¼¸å‡ºæ ¼å¼
- **ç›£æ§é»**: éœ€è¦é©—è­‰ SSR/SSG åŠŸèƒ½å®Œæ•´æ€§

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **æ¼¸é€²å¼å„ªåŒ–ç­–ç•¥**
   ```javascript
   // next.config.js éšæ®µæ€§å„ªåŒ–
   // âŒ éŒ¯èª¤ï¼šä¸€æ¬¡æ€§é–‹å•Ÿæ‰€æœ‰å„ªåŒ–é¸é …
   // é¢¨éšªï¼šå¯èƒ½å°è‡´å»ºæ§‹å¤±æ•—æˆ–é‹è¡ŒéŒ¯èª¤

   // âœ… æ­£ç¢ºï¼šåˆ†éšæ®µå•Ÿç”¨å„ªåŒ–
   const optimizations = {
     // Phase 1: åŸºç¤å„ªåŒ– (å®‰å…¨)
     swcMinify: true,
     compress: true,

     // Phase 2: å¯¦é©—æ€§å„ªåŒ– (éœ€æ¸¬è©¦)
     experimental: {
       optimizeCss: true,
       serverComponentsExternalPackages: ['firebase-admin']
     }
   };
   ```

2. **ä¾è³´åˆ†æèˆ‡ Tree Shaking**
   ```json
   // package.json å„ªåŒ–
   {
     "sideEffects": false, // å•Ÿç”¨æ›´å¥½çš„ Tree Shaking
     "exports": {
       ".": {
         "import": "./dist/index.esm.js",
         "require": "./dist/index.cjs.js"
       }
     }
   }
   ```

3. **Bundle åˆ†æå·¥å…·æ•´åˆ**
   ```bash
   # æ–°å¢è‡³ package.json scripts
   "analyze": "ANALYZE=true npm run build",
   "analyze:server": "BUNDLE_ANALYZE=server npm run build",
   "analyze:browser": "BUNDLE_ANALYZE=browser npm run build"
   ```

**ğŸ› ï¸ å¯¦æ–½éšæ®µå»ºè­°**:

**Phase 1: åˆ†æéšæ®µ (0.3å¤©)**
- ä½¿ç”¨ @next/bundle-analyzer åˆ†æç•¶å‰åŒ…é«”ç©åˆ†å¸ƒ
- è­˜åˆ¥æœ€å¤§çš„ä¾è³´åº«å’Œé‡è¤‡æ¨¡çµ„
- å»ºç«‹åŸºæº–æŒ‡æ¨™ (ç•¶å‰ 11MB â†’ ç›®æ¨™ 8MB)

**Phase 2: é…ç½®å„ªåŒ– (0.4å¤©)**
- å•Ÿç”¨ SWC ç·¨è­¯å™¨å’ŒåŸºç¤å„ªåŒ–
- é…ç½® serverComponentsExternalPackages
- å¯¦æ–½å‹•æ…‹å°å…¥ (Dynamic Imports) ç­–ç•¥

**Phase 3: é€²éšå„ªåŒ– (0.3å¤©)**
- å¯¦æ–½ optimizePackageImports é…ç½®
- å„ªåŒ–éœæ…‹è³‡æºè™•ç†
- å»ºç«‹è‡ªå‹•åŒ–å¤§å°ç›£æ§æ©Ÿåˆ¶

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **å¿½ç•¥ SSR ç›¸å®¹æ€§**: SWC å„ªåŒ–å¯èƒ½å½±éŸ¿ä¼ºæœå™¨ç«¯æ¸²æŸ“
- âŒ **éåº¦ Tree Shaking**: å¯èƒ½ç§»é™¤å¿…è¦çš„å‰¯ä½œç”¨ç¨‹å¼ç¢¼
- âŒ **ç¼ºä¹å›æ­¸æ¸¬è©¦**: å„ªåŒ–å¾Œå¿…é ˆæ¸¬è©¦æ‰€æœ‰é—œéµåŠŸèƒ½è·¯å¾‘
- âŒ **å¿½ç•¥å¿«å–ç­–ç•¥**: é…åˆ CDN å¿«å–å„ªåŒ–æ•´é«”è¼‰å…¥æ€§èƒ½

**ç›£æ§æŒ‡æ¨™**:
```typescript
// å»ºè­°æ–°å¢çš„ç›£æ§æŒ‡æ¨™
interface BundleMetrics {
  totalSize: number;        // ç¸½åŒ…å¤§å°
  jsSize: number;          // JavaScript å¤§å°
  cssSize: number;         // CSS å¤§å°
  coldStartTime: number;   // å†·å•Ÿå‹•æ™‚é–“
  buildTime: number;       // å»ºæ§‹æ™‚é–“
  deployTime: number;      // éƒ¨ç½²æ™‚é–“
}
```

### 3. **éŒ¯èª¤è™•ç†ä¸ä¸€è‡´**
- **å•é¡Œ**: éƒ¨åˆ†APIå’Œå‰ç«¯çµ„ä»¶çš„éŒ¯èª¤è™•ç†ä¸çµ±ä¸€
- **å½±éŸ¿**:
  - ç”¨æˆ¶é«”é©—ä¸ä½³
  - èª¿è©¦å›°é›£
  - ç³»çµ±ç©©å®šæ€§å·®
- **è§£æ±ºæ–¹æ¡ˆ**:
  ```typescript
  // å»ºç«‹çµ±ä¸€éŒ¯èª¤è™•ç†ç³»çµ±
  src/lib/errors/
  â”œâ”€â”€ ErrorBoundary.tsx      // ReactéŒ¯èª¤é‚Šç•Œ
  â”œâ”€â”€ errorTypes.ts          // éŒ¯èª¤é¡å‹å®šç¾©
  â”œâ”€â”€ errorHandler.ts        // çµ±ä¸€éŒ¯èª¤è™•ç†
  â””â”€â”€ errorReporting.ts      // éŒ¯èª¤ä¸Šå ±ç³»çµ±
  ```
- **é ä¼°å·¥ä½œé‡**: 2å¤©

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â­â˜†â˜† (3/5) - ä¸­é«˜è¤‡é›œåº¦
- **æŠ€è¡“å‚µå‹™**:
  - 34å€‹æ–‡ä»¶ä½¿ç”¨ä¸åŒçš„éŒ¯èª¤è™•ç†æ¨¡å¼
  - API å±¤ç´šèˆ‡ UI å±¤ç´šéŒ¯èª¤è™•ç†åˆ†é›¢
  - ç¼ºä¹çµ±ä¸€çš„éŒ¯èª¤åˆ†é¡å’Œç¨‹åº¦å®šç¾©
  - ç¾æœ‰ `ErrorBoundary.tsx` åŠŸèƒ½ä¸å®Œæ•´

#### **å½±éŸ¿ç¯„åœåˆ†æ**
```mermaid
graph TD
    A[éŒ¯èª¤è™•ç†çµ±ä¸€] --> B[å‰ç«¯å…ƒä»¶]
    A --> C[API å®¢æˆ¶ç«¯]
    A --> D[Firebase Functions]

    B --> E[34å€‹ä½¿ç”¨ useApiClient çš„æª”æ¡ˆ]
    B --> F[React éŒ¯èª¤é‚Šç•Œè¦†è“‹]
    B --> G[è¡¨å–®é©—è­‰éŒ¯èª¤]

    C --> H[HTTP ç‹€æ…‹ç¢¼è™•ç†]
    C --> I[ç¶²è·¯éŒ¯èª¤è™•ç†]
    C --> J[æ¥­å‹™é‚è¼¯éŒ¯èª¤]

    D --> K[Functions éŒ¯èª¤å›æ‡‰æ ¼å¼]
    D --> L[æ—¥èªŒè¨˜éŒ„æ¨™æº–åŒ–]
    D --> M[éŒ¯èª¤ç›£æ§æ•´åˆ]
```

**ç ´å£æ€§æ›´æ”¹é¢¨éšª**:
- **é«˜é¢¨éšª**: ç¾æœ‰éŒ¯èª¤è™•ç†é‚è¼¯éœ€è¦å¤§å¹…èª¿æ•´
- **ä¸­é¢¨éšª**: ç”¨æˆ¶çœ‹åˆ°çš„éŒ¯èª¤è¨Šæ¯æ ¼å¼è®Šæ›´
- **ä½é¢¨éšª**: å…§éƒ¨éŒ¯èª¤åˆ†é¡å’Œæ—¥èªŒæ ¼å¼èª¿æ•´

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **éŒ¯èª¤åˆ†ç´šèˆ‡åˆ†é¡ç³»çµ±**
   ```typescript
   // âœ… æ­£ç¢ºï¼šå»ºç«‹æ¸…æ™°çš„éŒ¯èª¤å±¤ç´š
   enum ErrorSeverity {
     INFO = 'info',
     WARNING = 'warning',
     ERROR = 'error',
     CRITICAL = 'critical'
   }

   enum ErrorCategory {
     NETWORK = 'network',
     VALIDATION = 'validation',
     BUSINESS = 'business',
     SYSTEM = 'system',
     AUTH = 'auth'
   }

   interface StandardError {
     id: string;
     category: ErrorCategory;
     severity: ErrorSeverity;
     message: string;
     userMessage: string;      // ä½¿ç”¨è€…å‹å–„è¨Šæ¯
     context?: any;            // é™¤éŒ¯è³‡è¨Š
     timestamp: number;
   }
   ```

2. **å‘å¾Œç›¸å®¹çš„éŒ¯èª¤ä»‹é¢**
   ```typescript
   // âŒ éŒ¯èª¤ï¼šç›´æ¥æ›¿æ›æ‰€æœ‰éŒ¯èª¤è™•ç†
   // é¢¨éšªï¼šç ´å£ç¾æœ‰åŠŸèƒ½

   // âœ… æ­£ç¢ºï¼šæ¼¸é€²å¼æ•´åˆ
   interface LegacyErrorSupport {
     // ä¿æŒç¾æœ‰éŒ¯èª¤æ ¼å¼ç›¸å®¹
     success: boolean;
     error?: {
       code: string;
       message: string;
     };

     // æ–°å¢çµ±ä¸€éŒ¯èª¤è™•ç†
     standardError?: StandardError;
   }
   ```

3. **éŒ¯èª¤ä¸Šä¸‹æ–‡ä¿ç•™**
   ```typescript
   // âœ… ç¢ºä¿éŒ¯èª¤è³‡è¨Šå®Œæ•´æ€§
   class ErrorHandler {
     static handle(error: Error, context: ErrorContext) {
       // ä¿ç•™åŸå§‹å †ç–Šè¿½è¹¤
       // è¨˜éŒ„ç”¨æˆ¶æ“ä½œä¸Šä¸‹æ–‡
       // æä¾›é–‹ç™¼è€…é™¤éŒ¯è³‡è¨Š
       // é¡¯ç¤ºç”¨æˆ¶å‹å–„è¨Šæ¯
     }
   }
   ```

**ğŸ› ï¸ å¯¦æ–½éšæ®µå»ºè­°**:

**Phase 1: éŒ¯èª¤é¡å‹ç³»çµ±å»ºç«‹ (0.5å¤©)**
- å®šç¾©æ¨™æº–éŒ¯èª¤ä»‹é¢å’Œåˆ†é¡
- å»ºç«‹éŒ¯èª¤åš´é‡æ€§ç­‰ç´š
- å¯¦ä½œåŸºç¤éŒ¯èª¤è™•ç†å·¥å…·é¡

**Phase 2: React éŒ¯èª¤é‚Šç•Œæ”¹é€² (0.5å¤©)**
- æ“´å±•ç¾æœ‰ ErrorBoundary åŠŸèƒ½
- å¯¦ä½œéŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶
- æ•´åˆéŒ¯èª¤ä¸Šå ±åŠŸèƒ½

**Phase 3: API éŒ¯èª¤è™•ç†çµ±ä¸€ (1å¤©)**
- ä¿®æ”¹ useApiClient éŒ¯èª¤è™•ç†é‚è¼¯
- çµ±ä¸€ Firebase Functions éŒ¯èª¤å›æ‡‰æ ¼å¼
- å¯¦ä½œå®¢æˆ¶ç«¯éŒ¯èª¤é‡è©¦æ©Ÿåˆ¶

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **éŒ¯èª¤è¨Šæ¯éæ–¼æŠ€è¡“æ€§**: ç¢ºä¿æä¾›ç”¨æˆ¶å‹å–„çš„éŒ¯èª¤æè¿°
- âŒ **éºå¤±éŒ¯èª¤ä¸Šä¸‹æ–‡**: ä¿ç•™è¶³å¤ çš„é™¤éŒ¯è³‡è¨Šä¾›é–‹ç™¼è€…åˆ†æ
- âŒ **éŒ¯èª¤è™•ç†éåº¦**: ä¸è¦æ•æ‰æ‰€æœ‰éŒ¯èª¤ï¼Œè®“ç¨‹å¼è‡ªç„¶å¤±æ•—ä»¥ä¾¿ç™¼ç¾å•é¡Œ
- âŒ **å¿½ç•¥éåŒæ­¥éŒ¯èª¤**: ç¢ºä¿ Promise rejection å’Œ async/await éŒ¯èª¤éƒ½è¢«å¦¥å–„è™•ç†

**æ¸¬è©¦ç­–ç•¥**:
```typescript
// å»ºè­°çš„éŒ¯èª¤è™•ç†æ¸¬è©¦è¦†è“‹
describe('Error Handling', () => {
  // ç¶²è·¯éŒ¯èª¤æ¸¬è©¦
  test('handles network failures gracefully');

  // æ¥­å‹™é‚è¼¯éŒ¯èª¤æ¸¬è©¦
  test('displays user-friendly business error messages');

  // ç³»çµ±éŒ¯èª¤æ¸¬è©¦
  test('captures system errors for debugging');

  // éŒ¯èª¤æ¢å¾©æ¸¬è©¦
  test('allows user to recover from errors');
});
```

---

## âš ï¸ **ä¸­å„ªå…ˆç´šå•é¡Œ (è¿‘æœŸæ”¹é€²)**

### 4. **State Management éæ–¼åˆ†æ•£**
- **å•é¡Œ**: ä½¿ç”¨äº† Zustand ä½†ç‹€æ…‹ç®¡ç†ä»éæ–¼åˆ†æ•£
- **å½±éŸ¿**:
  - ç‹€æ…‹åŒæ­¥å›°é›£
  - ä»£ç¢¼è¤‡é›œåº¦é«˜
  - é›£ä»¥èª¿è©¦
- **è§£æ±ºæ–¹æ¡ˆ**:
  ```typescript
  // å»ºè­°å¯¦æ–½çµ±ä¸€ç‹€æ…‹ç®¡ç†æ¶æ§‹
  src/stores/
  â”œâ”€â”€ index.ts              // æ ¹ç‹€æ…‹é…ç½®
  â”œâ”€â”€ slices/
  â”‚   â”œâ”€â”€ authSlice.ts      // èªè­‰ç‹€æ…‹
  â”‚   â”œâ”€â”€ inventorySlice.ts // åº«å­˜ç‹€æ…‹
  â”‚   â”œâ”€â”€ uiSlice.ts        // UIç‹€æ…‹
  â”‚   â””â”€â”€ cacheSlice.ts     // å¿«å–ç‹€æ…‹
  â””â”€â”€ middleware/
      â”œâ”€â”€ persistence.ts    // æŒä¹…åŒ–ä¸­é–“ä»¶
      â””â”€â”€ logger.ts         // ç‹€æ…‹æ—¥èªŒä¸­é–“ä»¶
  ```

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â­â­â˜† (4/5) - é«˜è¤‡é›œåº¦
- **æŠ€è¡“å‚µå‹™**:
  - ç¾æœ‰ Zustand stores åˆ†æ•£åœ¨å¤šå€‹æª”æ¡ˆä¸­
  - ç‹€æ…‹ä¾è³´é—œä¿‚è¤‡é›œä¸”æœªæ˜ç¢ºå®šç¾©
  - ç¼ºä¹çµ±ä¸€çš„ç‹€æ…‹æ›´æ–°æ¨¡å¼
  - éƒ¨åˆ†çµ„ä»¶ç›´æ¥æ“ä½œç‹€æ…‹è€Œéé€šé actions

#### **å½±éŸ¿ç¯„åœåˆ†æ**
```mermaid
graph TD
    A[ç‹€æ…‹ç®¡ç†é‡æ§‹] --> B[æ ¸å¿ƒ Store æª”æ¡ˆ]
    A --> C[ä¾è³´ç‹€æ…‹çš„å…ƒä»¶]
    A --> D[API å¿«å–å±¤]

    B --> E[src/stores/appStore.ts]
    B --> F[src/stores/inventoryStore.ts]
    B --> G[src/stores/uiStore.ts]

    C --> H[Dashboard é é¢ç¾¤çµ„]
    C --> I[è¡¨å–®å…ƒä»¶ç¾¤çµ„]
    C --> J[æ¸…å–®å…ƒä»¶ç¾¤çµ„]

    D --> K[API å®¢æˆ¶ç«¯æ•´åˆ]
    D --> L[æœ¬åœ°å„²å­˜åŒæ­¥]
    D --> M[è·¨é é¢ç‹€æ…‹æŒä¹…åŒ–]
```

**ç ´å£æ€§æ›´æ”¹é¢¨éšª**:
- **é«˜é¢¨éšª**: ç¾æœ‰ç‹€æ…‹è¨ªå•æ¨¡å¼éœ€è¦å…¨é¢èª¿æ•´
- **ä¸­é¢¨éšª**: ç‹€æ…‹æŒä¹…åŒ–æ©Ÿåˆ¶è®Šæ›´å¯èƒ½å½±éŸ¿ç”¨æˆ¶è³‡æ–™
- **ä¸­é¢¨éšª**: è·¨çµ„ä»¶ç‹€æ…‹åŒæ­¥é‚è¼¯éœ€è¦é‡æ–°é©—è­‰

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **æ¼¸é€²å¼ç‹€æ…‹é·ç§»ç­–ç•¥**
   ```typescript
   // âŒ éŒ¯èª¤ï¼šä¸€æ¬¡æ€§æ›¿æ›æ‰€æœ‰ store
   // é¢¨éšªï¼šç ´å£æ‰€æœ‰ä¾è³´ç‹€æ…‹çš„åŠŸèƒ½

   // âœ… æ­£ç¢ºï¼šä¸¦è¡Œé‹è¡Œæ–°èˆŠç‹€æ…‹ç®¡ç†
   interface MigrationStore {
     // ä¿æŒèˆŠçš„ store ç›¸å®¹æ€§
     legacy: {
       appStore: LegacyAppStore;
       inventoryStore: LegacyInventoryStore;
     };

     // æ–°çš„çµ±ä¸€ store
     unified: {
       auth: AuthSlice;
       inventory: InventorySlice;
       ui: UISlice;
     };
   }
   ```

2. **ç‹€æ…‹æ­£è¦åŒ–è¨­è¨ˆ**
   ```typescript
   // âœ… å»ºè­°çš„æ­£è¦åŒ–ç‹€æ…‹çµæ§‹
   interface NormalizedState {
     entities: {
       materials: Record<string, Material>;
       fragrances: Record<string, Fragrance>;
       products: Record<string, Product>;
       users: Record<string, User>;
     };

     ui: {
       selectedIds: string[];
       filters: FilterState;
       viewModes: Record<string, ViewMode>;
     };

     metadata: {
       loading: Record<string, boolean>;
       errors: Record<string, string | null>;
       lastUpdated: Record<string, number>;
     };
   }
   ```

3. **ä¸­é–“ä»¶æ•´åˆç­–ç•¥**
   ```typescript
   // âœ… çµ±ä¸€ä¸­é–“ä»¶é…ç½®
   const storeConfig = {
     middleware: [
       // æŒä¹…åŒ–ä¸­é–“ä»¶
       persist(persistConfig),

       // é–‹ç™¼å·¥å…·æ•´åˆ
       devtools(process.env.NODE_ENV === 'development'),

       // ç‹€æ…‹è®ŠåŒ–æ—¥èªŒ
       logger(loggerConfig),

       // ç‹€æ…‹åŒæ­¥ä¸­é–“ä»¶
       sync(syncConfig)
     ]
   };
   ```

**ğŸ› ï¸ å¯¦æ–½éšæ®µå»ºè­°**:

**Phase 1: æ¶æ§‹è¨­è¨ˆéšæ®µ (1å¤©)**
- åˆ†æç¾æœ‰ç‹€æ…‹ä¾è³´é—œä¿‚
- è¨­è¨ˆçµ±ä¸€ç‹€æ…‹çµæ§‹
- å»ºç«‹é·ç§»æ™‚é–“è¡¨å’Œç›¸å®¹æ€§è¨ˆç•«

**Phase 2: Core Store é‡æ§‹ (1.5å¤©)**
- å¯¦æ–½æ–°çš„ç‹€æ…‹çµæ§‹
- å»ºç«‹ç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶
- æ•´åˆä¸­é–“ä»¶ç³»çµ±

**Phase 3: æ¼¸é€²å¼é·ç§» (1.5å¤©)**
- é€æ­¥é·ç§»é—œéµçµ„ä»¶
- å»ºç«‹é›™è»Œé‹è¡Œæ©Ÿåˆ¶
- é©—è­‰ç‹€æ…‹ä¸€è‡´æ€§

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **éåº¦æ­£è¦åŒ–**: ä¸è¦ç‚ºäº†æ­£è¦åŒ–è€ŒçŠ§ç‰²é–‹ç™¼ä¾¿åˆ©æ€§
- âŒ **å¿½ç•¥æ€§èƒ½å½±éŸ¿**: çµ±ä¸€ç‹€æ…‹å¯èƒ½å°è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- âŒ **é·ç§»è¨ˆç•«ä¸å®Œæ•´**: ç¢ºä¿æ¯å€‹ç‹€æ…‹è¨ªå•é»éƒ½æœ‰é·ç§»è·¯å¾‘
- âŒ **ç¼ºä¹å›æ»¾æ©Ÿåˆ¶**: æº–å‚™ç‹€æ…‹é·ç§»å¤±æ•—çš„å›æ»¾ç­–ç•¥

**ç›£æ§èˆ‡é©—è­‰**:
```typescript
// ç‹€æ…‹ç®¡ç†å¥åº·æª¢æŸ¥
interface StateHealthCheck {
  storeSize: number;           // ç‹€æ…‹å¤§å°ç›£æ§
  updateFrequency: number;     // æ›´æ–°é »ç‡çµ±è¨ˆ
  renderCount: number;         // é‡æ–°æ¸²æŸ“æ¬¡æ•¸
  memoryUsage: number;         // è¨˜æ†¶é«”ä½¿ç”¨é‡
  inconsistencies: string[];   // ç‹€æ…‹ä¸ä¸€è‡´æª¢æ¸¬
}
```

### 5. **APIå®¢æˆ¶ç«¯ç¼ºä¹å¿«å–æ©Ÿåˆ¶**
- **å•é¡Œ**: `useApiClient` æ²’æœ‰å…§å»ºæ™ºèƒ½å¿«å–
- **å½±éŸ¿**:
  - é‡è¤‡è«‹æ±‚æµªè²»è³‡æº
  - ç”¨æˆ¶é«”é©—ä¸ä½³
  - Firebase æˆæœ¬å¢åŠ 
- **è§£æ±ºæ–¹æ¡ˆ**:
  ```typescript
  // å¯¦æ–½å¤šå±¤æ¬¡å¿«å–ç­–ç•¥
  interface CacheConfig {
    memory: boolean;      // è¨˜æ†¶é«”å¿«å–
    localStorage: boolean;// æœ¬åœ°å„²å­˜å¿«å–
    staleTime: number;   // éæœŸæ™‚é–“
    cacheKey: string;    // å¿«å–éµ
  }

  export function useApiClientWithCache(cacheConfig: CacheConfig) {
    // å¯¦æ–½ SWR æˆ– React Query é¡ä¼¼çš„å¿«å–æ©Ÿåˆ¶
  }
  ```

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â­â˜†â˜† (3/5) - ä¸­ç­‰è¤‡é›‚åº¦
- **æŠ€è¡“å‚µå‹™**:
  - ç¾æœ‰ API èª¿ç”¨ç„¡å¿«å–æ©Ÿåˆ¶ï¼Œé‡è¤‡è«‹æ±‚é »ç¹
  - éƒ¨åˆ†é é¢å¯¦æ–½äº†è‡¨æ™‚å¿«å–è§£æ±ºæ–¹æ¡ˆ (useInventoryCache, useLowStockCache)
  - ç¼ºä¹çµ±ä¸€çš„å¿«å–å¤±æ•ˆå’Œæ›´æ–°ç­–ç•¥
  - Firebase æˆæœ¬å› é‡è¤‡è«‹æ±‚è€Œå¢åŠ 

#### **å½±éŸ¿ç¯„åœåˆ†æ**
```mermaid
graph TD
    A[API å¿«å–æ©Ÿåˆ¶] --> B[useApiClient ç³»çµ±]
    A --> C[ç¾æœ‰å¿«å– Hooks]
    A --> D[Firebase æˆæœ¬]

    B --> E[34å€‹ä½¿ç”¨ API çš„æª”æ¡ˆ]
    B --> F[æ‰¹æ¬¡è«‹æ±‚å„ªåŒ–]
    B --> G[èƒŒæ™¯æ›´æ–°æ©Ÿåˆ¶]

    C --> H[useInventoryCache]
    C --> I[useLowStockCache]
    C --> J[useTimeRecordsCache]

    D --> K[Functions èª¿ç”¨æ¬¡æ•¸æ¸›å°‘]
    D --> L[è³‡æ–™å‚³è¼¸é‡å„ªåŒ–]
    D --> M[ä¸¦è¡Œè«‹æ±‚æ§åˆ¶]
```

**ç ´å£æ€§æ›´æ”¹é¢¨éšª**:
- **ä½é¢¨éšª**: å¿«å–å±¤ç‚ºé€æ˜å„ªåŒ–ï¼Œä¸å½±éŸ¿ç¾æœ‰ API ä»‹é¢
- **ä¸­é¢¨éšª**: å¿«å–å¤±æ•ˆç­–ç•¥å¯èƒ½å½±éŸ¿è³‡æ–™ä¸€è‡´æ€§
- **ä½é¢¨éšª**: æ€§èƒ½æ”¹å–„ä¸æœƒç ´å£åŠŸèƒ½é‚è¼¯

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **å¤šå±¤æ¬¡å¿«å–æ¶æ§‹**
   ```typescript
   // âœ… å»ºè­°çš„å¿«å–å±¤ç´šè¨­è¨ˆ
   interface CacheLayer {
     // L1: è¨˜æ†¶é«”å¿«å– (æœ€å¿«é€Ÿ)
     memory: {
       maxSize: number;           // æœ€å¤§å¿«å–é …ç›®æ•¸
       ttl: number;              // ç”Ÿå­˜æ™‚é–“
       strategy: 'LRU' | 'LFU';  // æ·˜æ±°ç­–ç•¥
     };

     // L2: æœ¬åœ°å­˜å‚¨å¿«å– (æŒä¹…åŒ–)
     localStorage: {
       prefix: string;           // å¿«å– key å‰ç¶´
       maxSize: string;         // æœ€å¤§å­˜å‚¨ç©ºé–“
       compression: boolean;     // æ˜¯å¦å£“ç¸®
     };

     // L3: æœå‹™ç«¯å¿«å– (å…±äº«)
     server: {
       headers: CacheHeaders;   // HTTP å¿«å–æ§åˆ¶
       etag: boolean;          // ETag æ”¯æ´
       lastModified: boolean;  // Last-Modified æ”¯æ´
     };
   }
   ```

2. **æ™ºèƒ½å¿«å–å¤±æ•ˆç­–ç•¥**
   ```typescript
   // âœ… å¿«å–å¤±æ•ˆèˆ‡æ›´æ–°æ©Ÿåˆ¶
   interface CacheInvalidation {
     // æ™‚é–“åŸºç¤å¤±æ•ˆ
     timeBasedInvalidation: {
       staleTime: number;       // è³‡æ–™è¦–ç‚ºé™³èˆŠçš„æ™‚é–“
       cacheTime: number;       // å¿«å–ä¿ç•™æ™‚é–“
       backgroundRefetch: boolean; // èƒŒæ™¯æ›´æ–°
     };

     // äº‹ä»¶åŸºç¤å¤±æ•ˆ
     eventBasedInvalidation: {
       tags: string[];          // å¿«å–æ¨™ç±¤
       mutations: string[];     // è§¸ç™¼å¤±æ•ˆçš„è®Šæ›´æ“ä½œ
       dependencies: string[];  // ä¾è³´é—œä¿‚
     };

     // æ‰‹å‹•å¤±æ•ˆ
     manualInvalidation: {
       invalidateAll: () => void;
       invalidateByTag: (tag: string) => void;
       invalidateByKey: (key: string) => void;
     };
   }
   ```

3. **å‘å¾Œç›¸å®¹æ•´åˆ**
   ```typescript
   // âœ… æ¼¸é€²å¼å¿«å–æ•´åˆ
   // ä¿æŒç¾æœ‰ useApiClient API ä¸è®Š
   export function useApiClient(options?: ApiClientOptions) {
     // å…§éƒ¨æ•´åˆå¿«å–å±¤
     const cacheEnabled = options?.cache !== false;

     return {
       ...originalApiClient,
       // æ–°å¢å¿«å–ç›¸é—œæ–¹æ³•
       invalidateCache: (key: string) => void;
       getCacheStatus: (key: string) => CacheStatus;
       prefetch: (key: string, fetcher: () => Promise<any>) => void;
     };
   }
   ```

**ğŸ› ï¸ å¯¦æ–½éšæ®µå»ºè­°**:

**Phase 1: å¿«å–åŸºç¤æ¶æ§‹ (1å¤©)**
- å¯¦æ–½å¤šå±¤æ¬¡å¿«å–ç®¡ç†å™¨
- å»ºç«‹å¿«å– key ç”Ÿæˆç­–ç•¥
- æ•´åˆè¨˜æ†¶é«”å’Œæœ¬åœ°å„²å­˜å¿«å–

**Phase 2: API å®¢æˆ¶ç«¯æ•´åˆ (1å¤©)**
- ä¿®æ”¹ useApiClient ä»¥æ”¯æ´å¿«å–
- å¯¦æ–½æ™ºèƒ½å¿«å–å¤±æ•ˆæ©Ÿåˆ¶
- å»ºç«‹å¿«å–ç‹€æ…‹ç›£æ§

**Phase 3: ç¾æœ‰å¿«å–é·ç§» (0.5å¤©)**
- é·ç§»ç¾æœ‰çš„è‡¨æ™‚å¿«å–è§£æ±ºæ–¹æ¡ˆ
- çµ±ä¸€å¿«å–é…ç½®å’Œç®¡ç†
- æ•ˆèƒ½åŸºæº–æ¸¬è©¦å’Œèª¿å„ª

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **éåº¦å¿«å–**: ä¸è¦å¿«å–æ‰€æœ‰ API è«‹æ±‚ï¼Œè€ƒæ…®è³‡æ–™ç‰¹æ€§
- âŒ **å¿«å–ä¸€è‡´æ€§å•é¡Œ**: ç¢ºä¿ CRUD æ“ä½œå¾Œæ­£ç¢ºå¤±æ•ˆå¿«å–
- âŒ **è¨˜æ†¶é«”æ´©æ¼**: å¯¦æ–½é©ç•¶çš„å¿«å–å¤§å°é™åˆ¶å’Œæ¸…ç†æ©Ÿåˆ¶
- âŒ **å¿½ç•¥é›¢ç·šå ´æ™¯**: è€ƒæ…®ç¶²è·¯ä¸­æ–·æ™‚çš„å¿«å–è¡Œç‚º

**å¿«å–æ•ˆèƒ½æŒ‡æ¨™**:
```typescript
// å¿«å–æ€§èƒ½ç›£æ§ä»‹é¢
interface CacheMetrics {
  hitRate: number;              // å¿«å–å‘½ä¸­ç‡
  missRate: number;             // å¿«å–å¤±æ•ˆç‡
  avgResponseTime: number;      // å¹³å‡éŸ¿æ‡‰æ™‚é–“
  cacheSize: number;            // å¿«å–å ç”¨ç©ºé–“
  evictionCount: number;        // å¿«å–æ·˜æ±°æ¬¡æ•¸
  backgroundRefreshCount: number; // èƒŒæ™¯æ›´æ–°æ¬¡æ•¸
}
```

### 6. **è³‡æ–™åº«ç´¢å¼•å¯ä»¥é€²ä¸€æ­¥å„ªåŒ–**
- **å•é¡Œ**: éƒ¨åˆ†è¤‡åˆæŸ¥è©¢ç¼ºä¹åˆé©ç´¢å¼•
- **å½±éŸ¿**:
  - æŸ¥è©¢æ€§èƒ½å·®
  - Firestore æˆæœ¬é«˜
- **è§£æ±ºæ–¹æ¡ˆ**:
  ```json
  // firestore.indexes.json éœ€è¦æ–°å¢çš„ç´¢å¼•
  {
    "collectionGroup": "materials",
    "fields": [
      {"fieldPath": "category", "order": "ASCENDING"},
      {"fieldPath": "subCategory", "order": "ASCENDING"},
      {"fieldPath": "currentStock", "order": "ASCENDING"}
    ]
  },
  {
    "collectionGroup": "workOrders",
    "fields": [
      {"fieldPath": "status", "order": "ASCENDING"},
      {"fieldPath": "assignedTo", "order": "ASCENDING"},
      {"fieldPath": "createdAt", "order": "DESCENDING"}
    ]
  }
  ```

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â˜†â˜†â˜† (2/5) - ä¸­ä½è¤‡é›œåº¦
- **æŠ€è¡“å‚µå‹™**:
  - ç¾æœ‰ç´¢å¼•é…ç½®ä¸å®Œæ•´ï¼Œéƒ¨åˆ†æŸ¥è©¢ä¾è³´è‡ªå‹•ç´¢å¼•
  - ç¼ºä¹æŸ¥è©¢æ€§èƒ½ç›£æ§å’Œç´¢å¼•ä½¿ç”¨åˆ†æ
  - è¤‡åˆæŸ¥è©¢æœªç¶“å„ªåŒ–ï¼Œå¯èƒ½è§¸ç™¼æ˜‚è²´çš„å…¨è¡¨æƒæ
  - ç´¢å¼•ç¶­è­·ç­–ç•¥ä¸æ˜ç¢º

#### **å½±éŸ¿ç¯„åœåˆ†æ**
```mermaid
graph TD
    A[è³‡æ–™åº«ç´¢å¼•å„ªåŒ–] --> B[æŸ¥è©¢æ€§èƒ½]
    A --> C[Firestore æˆæœ¬]
    A --> D[ç”¨æˆ¶é«”é©—]

    B --> E[è¤‡åˆæŸ¥è©¢éŸ¿æ‡‰æ™‚é–“]
    B --> F[æ’åºæ“ä½œæ•ˆç‡]
    B --> G[ç¯©é¸æ“ä½œé€Ÿåº¦]

    C --> H[è®€å–æ“ä½œè¨ˆè²»]
    C --> I[ç¶²è·¯é »å¯¬ä½¿ç”¨]
    C --> J[ç´¢å¼•å­˜å„²æˆæœ¬]

    D --> K[é é¢è¼‰å…¥é€Ÿåº¦]
    D --> L[æœå°‹éŸ¿æ‡‰é€Ÿåº¦]
    D --> M[å³æ™‚æ›´æ–°æ€§èƒ½]
```

**ç ´å£æ€§æ›´æ”¹é¢¨éšª**:
- **æ¥µä½é¢¨éšª**: ç´¢å¼•å„ªåŒ–ä¸å½±éŸ¿æ‡‰ç”¨é‚è¼¯
- **ä½é¢¨éšª**: ç´¢å¼•å»ºç«‹æœŸé–“å¯èƒ½æœ‰çŸ­æš«æ€§èƒ½å½±éŸ¿
- **ç›£æ§è¦é»**: éœ€è¦ç›£æ§ç´¢å¼•å»ºç«‹é€²åº¦å’Œæˆæœ¬

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **ç´¢å¼•ç­–ç•¥åˆ†æ**
   ```typescript
   // âœ… æŸ¥è©¢æ¨¡å¼åˆ†æ
   interface QueryAnalysis {
     // å¸¸ç”¨æŸ¥è©¢è­˜åˆ¥
     frequentQueries: {
       collection: string;
       filters: string[];
       sortBy: string[];
       frequency: number;
     }[];

     // æ€§èƒ½ç“¶é ¸æŸ¥è©¢
     slowQueries: {
       query: string;
       avgResponseTime: number;
       costPerQuery: number;
     }[];

     // ç´¢å¼•è¦†è“‹ç‡
     indexCoverage: {
       covered: number;
       uncovered: number;
       autoIndexes: number;
     };
   }
   ```

2. **ç´¢å¼•è¨­è¨ˆåŸå‰‡**
   ```json
   // âœ… å„ªåŒ–çš„ç´¢å¼•è¨­è¨ˆ
   {
     "indexes": [
       {
         "comment": "ææ–™ç®¡ç† - åº«å­˜ä¸è¶³æŸ¥è©¢",
         "collectionGroup": "materials",
         "fields": [
           {"fieldPath": "currentStock", "order": "ASCENDING"},
           {"fieldPath": "safetyStockLevel", "order": "ASCENDING"},
           {"fieldPath": "updatedAt", "order": "DESCENDING"}
         ]
       },
       {
         "comment": "å·¥å–®ç®¡ç† - ç‹€æ…‹å’Œè² è²¬äººç¯©é¸",
         "collectionGroup": "workOrders",
         "fields": [
           {"fieldPath": "status", "order": "ASCENDING"},
           {"fieldPath": "assignedTo", "order": "ASCENDING"},
           {"fieldPath": "priority", "order": "DESCENDING"},
           {"fieldPath": "createdAt", "order": "DESCENDING"}
         ]
       }
     ]
   }
   ```

3. **ç´¢å¼•ç¶­è­·ç­–ç•¥**
   ```typescript
   // âœ… ç´¢å¼•ç”Ÿå‘½é€±æœŸç®¡ç†
   interface IndexManagement {
     // ç´¢å¼•ä½¿ç”¨ç›£æ§
     monitor: {
       usageStats: IndexUsageStats[];
       performanceMetrics: IndexPerformance[];
       costAnalysis: IndexCost[];
     };

     // ç´¢å¼•å„ªåŒ–å»ºè­°
     optimization: {
       suggestedIndexes: IndexSuggestion[];
       unusedIndexes: string[];
       consolidationOpportunities: IndexConsolidation[];
     };
   }
   ```

**ğŸ› ï¸ å¯¦æ–½éšæ®µå»ºè­°**:

**Phase 1: æŸ¥è©¢åˆ†æ (0.5å¤©)**
- ä½¿ç”¨ Firestore æŸ¥è©¢åˆ†æå·¥å…·
- è­˜åˆ¥æœ€é »ç¹å’Œæœ€æ˜‚è²´çš„æŸ¥è©¢
- åˆ†æç¾æœ‰ç´¢å¼•ä½¿ç”¨æƒ…æ³

**Phase 2: ç´¢å¼•è¨­è¨ˆå’Œå¯¦æ–½ (1å¤©)**
- æ ¹æ“šæŸ¥è©¢æ¨¡å¼è¨­è¨ˆè¤‡åˆç´¢å¼•
- åˆ†éšæ®µå»ºç«‹ç´¢å¼•ä»¥æ§åˆ¶æˆæœ¬
- å¯¦æ–½ç´¢å¼•ä½¿ç”¨ç›£æ§

**Phase 3: æ€§èƒ½é©—è­‰å’Œèª¿å„ª (0.5å¤©)**
- æ¸¬é‡ç´¢å¼•å„ªåŒ–å‰å¾Œçš„æ€§èƒ½å·®ç•°
- èª¿æ•´æŸ¥è©¢é‚è¼¯ä»¥å……åˆ†åˆ©ç”¨ç´¢å¼•
- å»ºç«‹ç´¢å¼•ç¶­è­·æµç¨‹

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **éåº¦ç´¢å¼•**: é¿å…ç‚ºä¸å¸¸ç”¨çš„æŸ¥è©¢å»ºç«‹ç´¢å¼•
- âŒ **ç´¢å¼•é †åºéŒ¯èª¤**: ç¢ºä¿ç´¢å¼•å­—æ®µé †åºç¬¦åˆæŸ¥è©¢éœ€æ±‚
- âŒ **å¿½ç•¥å¯«å…¥æˆæœ¬**: ç´¢å¼•æœƒå¢åŠ å¯«å…¥æ“ä½œçš„æˆæœ¬
- âŒ **ç¼ºä¹ç›£æ§**: å»ºç«‹ç´¢å¼•æ•ˆæœéœ€è¦æŒçºŒç›£æ§

**ç´¢å¼•ç›£æ§æŒ‡æ¨™**:
```typescript
interface IndexMetrics {
  queryPerformance: {
    avgResponseTime: number;
    p95ResponseTime: number;
    queriesPerSecond: number;
  };

  costMetrics: {
    readsPerQuery: number;
    indexMaintenanceCost: number;
    totalQueryCost: number;
  };

  indexUtilization: {
    indexHitRate: number;
    unusedIndexes: string[];
    autoIndexUsage: number;
  };
}
```

### 7. **TypeScript åš´æ ¼æ€§ä¸è¶³**
- **å•é¡Œ**: éƒ¨åˆ†æ–‡ä»¶ä½¿ç”¨ `any` é¡å‹ï¼Œé¡å‹å®‰å…¨æ€§ä¸è¶³
- **å½±éŸ¿**:
  - é‹è¡Œæ™‚éŒ¯èª¤å¢åŠ 
  - IDE æ”¯æ´ä¸ä½³
  - é‡æ§‹é¢¨éšªé«˜
- **è§£æ±ºæ–¹æ¡ˆ**:
  ```json
  // tsconfig.json åŠ å¼·é…ç½®
  {
    "compilerOptions": {
      "strict": true,
      "noImplicitAny": true,
      "noImplicitReturns": true,
      "noImplicitThis": true,
      "noUncheckedIndexedAccess": true
    }
  }
  ```

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â­â˜†â˜† (3/5) - ä¸­ç­‰è¤‡é›œåº¦
- **æŠ€è¡“å‚µå‹™**:
  - ä»£ç¢¼ä¸­å­˜åœ¨ `any` é¡å‹ä½¿ç”¨ï¼Œé™ä½é¡å‹å®‰å…¨æ€§
  - éƒ¨åˆ†ç¬¬ä¸‰æ–¹åº«ç¼ºä¹å®Œæ•´é¡å‹å®šç¾©
  - è¤‡é›œçš„ Firebase è³‡æ–™çµæ§‹é¡å‹è¦†è“‹ä¸å®Œæ•´
  - ç¾æœ‰ä»£ç¢¼å¯èƒ½å› åš´æ ¼æª¢æŸ¥è€Œç”¢ç”Ÿå¤§é‡é¡å‹éŒ¯èª¤

#### **å½±éŸ¿ç¯„åœåˆ†æ**
```mermaid
graph TD
    A[TypeScript åš´æ ¼æ€§æå‡] --> B[é¡å‹å®‰å…¨]
    A --> C[é–‹ç™¼é«”é©—]
    A --> D[ä»£ç¢¼å“è³ª]

    B --> E[ç·¨è­¯æ™‚éŒ¯èª¤æª¢æ¸¬]
    B --> F[é‹è¡Œæ™‚éŒ¯èª¤æ¸›å°‘]
    B --> G[API å¥‘ç´„å¼·åŒ–]

    C --> H[IDE æ™ºèƒ½æç¤ºæ”¹å–„]
    C --> I[é‡æ§‹å®‰å…¨æ€§æå‡]
    C --> J[ä»£ç¢¼å°èˆªç²¾ç¢ºåº¦]

    D --> K[å¯ç¶­è­·æ€§æå‡]
    D --> L[æ–‡æª”åŒ–ç¨‹åº¦æé«˜]
    D --> M[åœ˜éšŠå”ä½œæ”¹å–„]
```

**ç ´å£æ€§æ›´æ”¹é¢¨éšª**:
- **é«˜é¢¨éšª**: å•Ÿç”¨åš´æ ¼æª¢æŸ¥å¯èƒ½å°è‡´å¤§é‡ç·¨è­¯éŒ¯èª¤
- **ä¸­é¢¨éšª**: éœ€è¦å¤§é‡é¡å‹å®šç¾©å·¥ä½œ
- **ä½é¢¨éšª**: ä¸å½±éŸ¿é‹è¡Œæ™‚è¡Œç‚º

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **æ¼¸é€²å¼åš´æ ¼åŒ–ç­–ç•¥**
   ```json
   // âœ… åˆ†éšæ®µå•Ÿç”¨åš´æ ¼æª¢æŸ¥
   {
     "compilerOptions": {
       // Phase 1: åŸºç¤åš´æ ¼æª¢æŸ¥
       "noImplicitAny": true,
       "strictNullChecks": false, // æš«æ™‚é—œé–‰

       // Phase 2: é€²éšåš´æ ¼æª¢æŸ¥
       "strictNullChecks": true,
       "noImplicitReturns": true,

       // Phase 3: å®Œå…¨åš´æ ¼æ¨¡å¼
       "strict": true,
       "noUncheckedIndexedAccess": true
     }
   }
   ```

2. **é¡å‹å®šç¾©ç­–ç•¥**
   ```typescript
   // âœ… ç³»çµ±åŒ–é¡å‹å®šç¾©
   // æ¥­å‹™å¯¦é«”é¡å‹
   interface Material {
     id: string;
     name: string;
     category: string;
     subCategory: string;
     currentStock: number;
     safetyStockLevel: number;
     costPerUnit: number;
     supplier: {
       id: string;
       name: string;
     } | null;
     updatedAt: Date;
     createdAt: Date;
   }

   // API å›æ‡‰é¡å‹
   interface ApiResponse<T> {
     success: boolean;
     data?: T;
     error?: {
       code: string;
       message: string;
       details?: unknown;
     };
     requestId: string;
   }

   // è¡¨å–®ç‹€æ…‹é¡å‹
   interface FormState<T> {
     data: T;
     errors: Partial<Record<keyof T, string>>;
     touched: Partial<Record<keyof T, boolean>>;
     isSubmitting: boolean;
   }
   ```

3. **ç¬¬ä¸‰æ–¹åº«é¡å‹å¢å¼·**
   ```typescript
   // âœ… è‡ªå®šç¾©é¡å‹è²æ˜
   declare module 'some-untyped-library' {
     interface LibraryConfig {
       apiKey: string;
       endpoint: string;
     }

     export function initialize(config: LibraryConfig): void;
     export function getData<T>(): Promise<T>;
   }

   // Firebase é¡å‹å¢å¼·
   interface FirestoreTimestamp {
     toDate(): Date;
     toMillis(): number;
   }

   type FirestoreData<T> = {
     [K in keyof T]: T[K] extends Date
       ? FirestoreTimestamp
       : T[K];
   };
   ```

**ğŸ› ï¸ å¯¦æ–½éšæ®µå»ºè­°**:

**Phase 1: é¡å‹åŸºç¤å»ºè¨­ (1å¤©)**
- å»ºç«‹æ ¸å¿ƒæ¥­å‹™å¯¦é«”é¡å‹å®šç¾©
- ç‚ºå¸¸ç”¨çš„ Firebase è³‡æ–™çµæ§‹æ·»åŠ é¡å‹
- è­˜åˆ¥å’Œæ¨™è¨˜æ‰€æœ‰ `any` ä½¿ç”¨è™•

**Phase 2: é€æ­¥åš´æ ¼åŒ– (1.5å¤©)**
- å•Ÿç”¨ `noImplicitAny` ä¸¦ä¿®å¾©ç›¸é—œéŒ¯èª¤
- ç‚º API å›æ‡‰å’Œè¡¨å–®ç‹€æ…‹æ·»åŠ é¡å‹
- é€æ­¥å•Ÿç”¨å…¶ä»–åš´æ ¼æª¢æŸ¥é¸é …

**Phase 3: å®Œæ•´é¡å‹è¦†è“‹ (1.5å¤©)**
- ç‚ºæ‰€æœ‰çµ„ä»¶ Props æ·»åŠ å®Œæ•´é¡å‹å®šç¾©
- å¯¦æ–½æ³›å‹é¡å‹ä»¥æé«˜é‡ç”¨æ€§
- å»ºç«‹é¡å‹æ¸¬è©¦ä»¥ç¢ºä¿é¡å‹æ­£ç¢ºæ€§

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **ä¸€æ¬¡æ€§å•Ÿç”¨æ‰€æœ‰åš´æ ¼æª¢æŸ¥**: æœƒç”¢ç”Ÿéå¤šéŒ¯èª¤ï¼Œé›£ä»¥è™•ç†
- âŒ **éåº¦ä½¿ç”¨ `any` ç¹éæª¢æŸ¥**: å¤±å»é¡å‹å®‰å…¨çš„æ„ç¾©
- âŒ **å¿½ç•¥ç¬¬ä¸‰æ–¹åº«é¡å‹**: ç‚ºç„¡é¡å‹åº«å»ºç«‹è²æ˜æ–‡ä»¶
- âŒ **é¡å‹éæ–¼è¤‡é›œ**: å¹³è¡¡é¡å‹å®‰å…¨å’Œä»£ç¢¼å¯è®€æ€§

**é¡å‹å“è³ªç›£æ§**:
```typescript
// å»ºè­°çš„é¡å‹è¦†è“‹ç‡ç›£æ§
interface TypeCoverageMetrics {
  totalLines: number;           // ç¸½ä»£ç¢¼è¡Œæ•¸
  typedLines: number;          // æœ‰é¡å‹è¦†è“‹çš„è¡Œæ•¸
  anyUsageCount: number;       // any é¡å‹ä½¿ç”¨æ¬¡æ•¸
  strictModeViolations: number; // åš´æ ¼æ¨¡å¼é•è¦æ•¸
  uncoveredFiles: string[];    // ç„¡é¡å‹è¦†è“‹çš„æª”æ¡ˆ
}

// ESLint è¦å‰‡é…ç½®
module.exports = {
  extends: [
    '@typescript-eslint/recommended',
    '@typescript-eslint/recommended-requiring-type-checking'
  ],
  rules: {
    '@typescript-eslint/no-explicit-any': 'error',
    '@typescript-eslint/no-unsafe-assignment': 'error',
    '@typescript-eslint/no-unsafe-member-access': 'error'
  }
};
```

---

## ğŸ“ˆ **ä½å„ªå…ˆç´šå„ªåŒ– (é•·æœŸæ”¹é€²)**

### 8. **ç§»å‹•ç«¯å„ªåŒ–**
- **å•é¡Œ**: é›–æœ‰éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œä½†ç§»å‹•ç«¯é«”é©—ä»å¯æ”¹å–„
- **è§£æ±ºæ–¹æ¡ˆ**:
  - PWA åŠŸèƒ½å¢å¼·
  - é›¢ç·šæ¨¡å¼æ”¯æ´
  - æ‰‹å‹¢æ“ä½œå„ªåŒ–
  - æ€§èƒ½ç›£æ§

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â­â˜†â˜† (3/5) - ä¸­ç­‰è¤‡é›œåº¦
- **æŠ€è¡“å‚µå‹™**:
  - ç¾æœ‰éŸ¿æ‡‰å¼è¨­è¨ˆåŸºæ–¼ CSS æ–·é»ï¼Œæœªå……åˆ†è€ƒæ…®ç§»å‹•ç«¯ç‰¹æ®Šéœ€æ±‚
  - ç¼ºä¹ PWA åŠŸèƒ½å¦‚é›¢ç·šæ”¯æ´ã€æ¨é€é€šçŸ¥
  - ç§»å‹•ç«¯æ€§èƒ½æœªå……åˆ†å„ªåŒ–
  - è§¸æ§æ“ä½œå’Œæ‰‹å‹¢æ”¯æ´æœ‰é™

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **PWA æ¼¸é€²å¼å¢å¼·**
   ```typescript
   // Service Worker ç­–ç•¥
   interface PWAStrategy {
     cacheStrategy: 'cache-first' | 'network-first' | 'stale-while-revalidate';
     offlineSupport: {
       pages: string[];
       data: string[];
       assets: string[];
     };
     backgroundSync: boolean;
     pushNotifications: boolean;
   }
   ```

2. **ç§»å‹•ç«¯æ€§èƒ½å„ªåŒ–**
   - åœ–ç‰‡æ‡¶è¼‰å…¥å’Œ WebP æ ¼å¼æ”¯æ´
   - è§¸æ§éŸ¿æ‡‰å„ªåŒ– (æ¸›å°‘å»¶é²)
   - é›»æ± ä½¿ç”¨å„ªåŒ–

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **å¿½ç•¥ä¸åŒè¨­å‚™å·®ç•°**: iOS vs Android è¡Œç‚ºå·®ç•°
- âŒ **éåº¦ä¾è³´ç¶²è·¯**: ç¢ºä¿åŸºæœ¬åŠŸèƒ½é›¢ç·šå¯ç”¨

### 9. **åœ‹éš›åŒ–æ”¯æ´**
- **å»ºè­°**: ç‚ºæœªä¾†æ“´å±•è€ƒæ…®ï¼Œå¯¦æ–½ i18n æ¡†æ¶
- **æŠ€è¡“æ–¹æ¡ˆ**: Next.js i18n + react-i18next

### 10. **è‡ªå‹•åŒ–æ¸¬è©¦**
- **å•é¡Œ**: ç¼ºä¹å®Œæ•´çš„æ¸¬è©¦è¦†è“‹
- **è§£æ±ºæ–¹æ¡ˆ**:
  ```
  tests/
  â”œâ”€â”€ unit/           # å–®å…ƒæ¸¬è©¦ (Jest + Testing Library)
  â”œâ”€â”€ integration/    # æ•´åˆæ¸¬è©¦ (Cypress)
  â”œâ”€â”€ e2e/           # ç«¯åˆ°ç«¯æ¸¬è©¦ (Playwright)
  â””â”€â”€ performance/   # æ€§èƒ½æ¸¬è©¦ (Lighthouse CI)
  ```

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â­â­â˜† (4/5) - é«˜è¤‡é›œåº¦
- **æŠ€è¡“å‚µå‹™**:
  - ç¾æœ‰ä»£ç¢¼ç¼ºä¹æ¸¬è©¦ï¼Œé‡æ§‹é¢¨éšªé«˜
  - è¤‡é›œçš„ Firebase æ•´åˆéœ€è¦ç‰¹æ®Šæ¸¬è©¦ç­–ç•¥
  - UI çµ„ä»¶æ¸¬è©¦è¦†è“‹ä¸è¶³
  - ç¼ºä¹æŒçºŒæ•´åˆçš„è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **æ¸¬è©¦é‡‘å­—å¡”ç­–ç•¥**
   ```typescript
   interface TestPyramid {
     unit: {
       coverage: '70%';
       tools: ['Jest', 'Testing Library'];
       focus: ['ç´”å‡½æ•¸', 'Hooké‚è¼¯', 'Utilityå‡½æ•¸'];
     };
     integration: {
       coverage: '20%';
       tools: ['Cypress', 'MSW'];
       focus: ['APIæ•´åˆ', 'å¤šå…ƒä»¶äº’å‹•'];
     };
     e2e: {
       coverage: '10%';
       tools: ['Playwright'];
       focus: ['é—œéµæ¥­å‹™æµç¨‹'];
     };
   }
   ```

2. **Firebase æ¸¬è©¦ç­–ç•¥**
   - ä½¿ç”¨ Firebase Emulator Suite é€²è¡Œæœ¬åœ°æ¸¬è©¦
   - Mock Firebase æœå‹™ä»¥åŠ é€Ÿæ¸¬è©¦åŸ·è¡Œ
   - å¯¦ä½œæ¸¬è©¦è³‡æ–™æ¸…ç†æ©Ÿåˆ¶

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **æ¸¬è©¦èˆ‡å¯¦ä½œéåº¦è€¦åˆ**: æ¸¬è©¦å…§éƒ¨å¯¦ä½œè€Œéè¡Œç‚º
- âŒ **å¿½ç•¥ç•°æ­¥æ“ä½œ**: Firebase æ“ä½œéœ€è¦æ­£ç¢ºçš„ç•°æ­¥æ¸¬è©¦

### 11. **ç›£æ§å’Œåˆ†æç³»çµ±**
- **å»ºè­°å¯¦æ–½**:
  - Firebase Analytics æ·±åº¦æ•´åˆ
  - éŒ¯èª¤è¿½è¹¤ (Sentry)
  - æ€§èƒ½ç›£æ§ (Firebase Performance)
  - ç”¨æˆ¶è¡Œç‚ºåˆ†æ

#### **æŠ€è¡“å‚µè©•ä¼°**
- **å›°é›£åº¦**: â­â­â­â˜†â˜† (3/5) - ä¸­ç­‰è¤‡é›œåº¦
- **æŠ€è¡“å‚µå‹™**:
  - ç¼ºä¹ç³»çµ±æ€§èƒ½èƒ½ç›£æ§æ©Ÿåˆ¶
  - éŒ¯èª¤è¿½è¹¤å’Œè¨ºæ–·èƒ½åŠ›ä¸è¶³
  - ç”¨æˆ¶è¡Œç‚ºæ•¸æ“šæ”¶é›†ä¸å®Œæ•´
  - ç¼ºä¹æ¥­å‹™æŒ‡æ¨™ç›£æ§å¤§ç›¤

#### **æ–½ä½œé‡é»èˆ‡å¸¸è¦‹éŒ¯èª¤é é˜²**

**âš ï¸ é—œéµè€ƒé‡äº‹é …**:
1. **å¤šç¶­åº¦ç›£æ§é«”ç³»**
   ```typescript
   interface MonitoringStack {
     performance: {
       webVitals: ['FCP', 'LCP', 'CLS', 'FID', 'TTFB'];
       customMetrics: ['APIéŸ¿æ‡‰æ™‚é–“', 'çµ„ä»¶æ¸²æŸ“æ™‚é–“'];
     };
     errors: {
       clientSide: 'Sentry';
       serverSide: 'Firebase Functions Logs';
       businessLogic: 'è‡ªå®šç¾©éŒ¯èª¤è¿½è¹¤';
     };
     analytics: {
       userBehavior: 'Firebase Analytics';
       businessMetrics: 'è‡ªå®šç¾©äº‹ä»¶è¿½è¹¤';
       conversionFunnel: 'è½‰æ›ç‡åˆ†æ';
     };
   }
   ```

2. **éš±ç§æ¬Šåˆè¦è€ƒé‡**
   - GDPR åˆè¦çš„è³‡æ–™æ”¶é›†ç­–ç•¥
   - ç”¨æˆ¶åŒæ„ç®¡ç†æ©Ÿåˆ¶
   - æ•æ„Ÿè³‡æ–™åŒ¿ååŒ–

**å¸¸è¦‹é™·é˜±èˆ‡é é˜²**:
- âŒ **éåº¦ç›£æ§**: é¿å…å½±éŸ¿ç³»çµ±æ€§èƒ½
- âŒ **éš±ç§æ¬Šå•é¡Œ**: ç¢ºä¿ç¬¦åˆè³‡æ–™ä¿è­·æ³•è¦
- âŒ **è­¦å ±ç–²å‹**: è¨­å®šé©ç•¶çš„è­¦å ±é–¾å€¼

---

## ğŸ—ï¸ **æ¶æ§‹æ”¹é€²å»ºè­°**

### 12. **å¾®æœå‹™åŒ–è€ƒæ…®**
```mermaid
graph TB
    A[Frontend Next.js] --> B[API Gateway]
    B --> C[Auth Service]
    B --> D[Inventory Service]
    B --> E[Order Service]
    B --> F[Notification Service]

    C --> G[Firestore Users]
    D --> H[Firestore Inventory]
    E --> I[Firestore Orders]
```

### 13. **å¿«å–å±¤ç´šå„ªåŒ–**
```mermaid
graph LR
    A[Client] --> B[Redis Cache]
    B --> C[Firebase Functions]
    C --> D[Firestore]

    B -.-> E[Cache Miss] -.-> C
```

### 14. **CI/CD æµç¨‹æ”¹é€²**
```yaml
# .github/workflows/deploy.yml
name: Deploy to Firebase
on:
  push:
    branches: [main]
jobs:
  build-and-deploy:
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
      - name: Install dependencies
      - name: Run tests
      - name: Build project
      - name: Deploy to Firebase
      - name: Run smoke tests
```

---

## ğŸ“Š **æ•ˆèƒ½åŸºæº–èˆ‡ç›®æ¨™**

### ç•¶å‰æ•ˆèƒ½æŒ‡æ¨™
- **é¦–æ¬¡å…§å®¹ç¹ªè£½ (FCP)**: ~1.8s
- **æœ€å¤§å…§å®¹ç¹ªè£½ (LCP)**: ~2.5s
- **ç´¯ç©ä½ˆå±€åç§» (CLS)**: ~0.1
- **ç¬¬ä¸€æ¬¡è¼¸å…¥å»¶é² (FID)**: ~50ms
- **éƒ¨ç½²åŒ…å¤§å°**: 11MB

### ç›®æ¨™æ•ˆèƒ½æŒ‡æ¨™
- **FCP**: < 1.2s (-33%)
- **LCP**: < 2.0s (-20%)
- **CLS**: < 0.05 (-50%)
- **FID**: < 25ms (-50%)
- **éƒ¨ç½²åŒ…å¤§å°**: < 8MB (-27%)

---

## ğŸ”§ **å¯¦æ–½å»ºè­°æ™‚é–“è¡¨**

### Phase 1: ç·Šæ€¥ä¿®å¾© (1-2é€±)
- [x] æª¢è¦–ç³»çµ±æ¶æ§‹
- [ ] ä¿®å¾© StandardDataListPage æ€§èƒ½å•é¡Œ
- [ ] å„ªåŒ– Firebase Functions éƒ¨ç½²
- [ ] çµ±ä¸€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

### Phase 2: ä¸­æœŸæ”¹é€² (3-4é€±)
- [ ] é‡æ§‹ç‹€æ…‹ç®¡ç†æ¶æ§‹
- [ ] å¯¦æ–½ API å¿«å–æ©Ÿåˆ¶
- [ ] å„ªåŒ–è³‡æ–™åº«ç´¢å¼•
- [ ] åŠ å¼· TypeScript åš´æ ¼æ€§

### Phase 3: é•·æœŸå„ªåŒ– (2-3æœˆ)
- [ ] å®Œæ•´æ¸¬è©¦è¦†è“‹
- [ ] ç›£æ§å’Œåˆ†æç³»çµ±
- [ ] PWA åŠŸèƒ½å¢å¼·
- [ ] åœ‹éš›åŒ–æº–å‚™

---

## ğŸ’° **æˆæœ¬æ•ˆç›Šåˆ†æ**

### é–‹ç™¼æˆæœ¬ä¼°ç®—
- **Phase 1**: 40å·¥æ™‚ Ã— $50/æ™‚ = $2,000
- **Phase 2**: 80å·¥æ™‚ Ã— $50/æ™‚ = $4,000
- **Phase 3**: 120å·¥æ™‚ Ã— $50/æ™‚ = $6,000
- **ç¸½è¨ˆ**: $12,000

### é æœŸæ•ˆç›Š
- **æ€§èƒ½æå‡**: 25-40% è¼‰å…¥é€Ÿåº¦æ”¹å–„
- **ç¶­è­·æˆæœ¬é™ä½**: 30% é–‹ç™¼æ™‚é–“ç¯€çœ
- **Firebase æˆæœ¬ç¯€ç´„**: 15-20% æœˆåº¦è²»ç”¨æ¸›å°‘
- **ç”¨æˆ¶é«”é©—æå‡**: é¡¯è‘—æ”¹å–„ç”¨æˆ¶æ»¿æ„åº¦

---

## ğŸ¯ **é—œéµæˆåŠŸæŒ‡æ¨™ (KPIs)**

1. **æŠ€è¡“æŒ‡æ¨™**
   - ä»£ç¢¼è¦†è“‹ç‡ > 80%
   - å¹³å‡éŸ¿æ‡‰æ™‚é–“ < 200ms
   - éŒ¯èª¤ç‡ < 0.1%

2. **æ¥­å‹™æŒ‡æ¨™**
   - ç”¨æˆ¶æ´»èºåº¦æå‡ 20%
   - ä»»å‹™å®Œæˆæ™‚é–“æ¸›å°‘ 30%
   - ç³»çµ±åœæ©Ÿæ™‚é–“ < 99.9%

3. **é–‹ç™¼æŒ‡æ¨™**
   - æ–°åŠŸèƒ½äº¤ä»˜é€Ÿåº¦æå‡ 40%
   - Bug ä¿®å¾©æ™‚é–“æ¸›å°‘ 50%
   - ä»£ç¢¼é‡è¤‡ç‡ < 5%

---

## ğŸ“š **åƒè€ƒè³‡æ–™å’Œå·¥å…·**

### æ¨è–¦å·¥å…·
- **æ€§èƒ½åˆ†æ**: Lighthouse, Web Vitals, Firebase Performance
- **ä»£ç¢¼å“è³ª**: ESLint, Prettier, SonarQube
- **æ¸¬è©¦æ¡†æ¶**: Jest, Testing Library, Cypress, Playwright
- **ç›£æ§å·¥å…·**: Sentry, LogRocket, Mixpanel

### å­¸ç¿’è³‡æº
- [Next.js Performance Best Practices](https://nextjs.org/docs/advanced-features/measuring-performance)
- [Firebase Functions Optimization Guide](https://firebase.google.com/docs/functions/manage-functions)
- [React Performance Optimization](https://react.dev/learn/render-and-commit)

---

**å‚™è¨»**: æ­¤å„ªåŒ–æ¸…å–®åŸºæ–¼ 2025-09-24 çš„ä»£ç¢¼å¯©æŸ¥ï¼Œå»ºè­°æ ¹æ“šå¯¦éš›é–‹ç™¼é€²åº¦å’Œæ¥­å‹™éœ€æ±‚èª¿æ•´å„ªå…ˆç´šå’Œæ™‚é–“è¡¨ã€‚

**å¯©æŸ¥è€…**: Claude Code Assistant
**ä¸‹æ¬¡å¯©æŸ¥å»ºè­°**: 1å€‹æœˆå¾Œæˆ–é‡å¤§åŠŸèƒ½æ›´æ–°å¾Œ