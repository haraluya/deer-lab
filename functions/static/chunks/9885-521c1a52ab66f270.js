"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9885],{60044:function(e,r,s){s.d(r,{Z:function(){return t}});let t=(0,s(79205).Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},66927:function(e,r,s){s.d(r,{Z:function(){return t}});let t=(0,s(79205).Z)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]])},74378:function(e,r,s){s.d(r,{$:function(){return v}});var t=s(57437),a=s(2265),l=s(29501),n=s(13590),o=s(67119),c=s(1850),i=s(5978),d=s(46410),m=s(14438),x=s(12381),u=s(74291),g=s(80670),h=s(40279),p=s(15291),b=s(23675),f=s(38220),j=s(62720),y=s(44794),N=s(66927);let w=o.Ry({code:o.Z_().min(1,{message:"香精代號為必填欄位"}),name:o.Z_().min(2,{message:"香精名稱至少需要 2 個字元"}),fragranceType:o.Z_({required_error:"必須選擇香精種類"}),fragranceStatus:o.Z_({required_error:"必須選擇香精狀態"}),supplierId:o.Z_().optional(),currentStock:o.oQ.number().min(0,{message:"現有庫存不能為負數"}).optional(),safetyStockLevel:o.oQ.number().min(0).optional(),costPerUnit:o.oQ.number().min(0).optional(),percentage:o.oQ.number().min(0).max(100,{message:"香精比例不能超過100%"}),pgRatio:o.oQ.number().min(0).max(100,{message:"PG比例不能超過100%"}),vgRatio:o.oQ.number().min(0).max(100,{message:"VG比例不能超過100%"}),remarks:o.Z_().optional()}).refine(e=>(e.percentage||0)+(e.pgRatio||0)+(e.vgRatio||0)<=100,{message:"香精、PG、VG比例總和不能超過100%",path:["percentage"]});function v(e){let{isOpen:r,onOpenChange:s,onFragranceUpdate:o,fragranceData:v}=e,[k,S]=(0,a.useState)(!1),[G,I]=(0,a.useState)([]),[R,z]=(0,a.useState)([]),[V,C]=(0,a.useState)([]),Z=!!v,M=(0,l.cI)({resolver:(0,n.F)(w),defaultValues:{code:"",name:"",fragranceType:"",fragranceStatus:"",supplierId:"",currentStock:0,safetyStockLevel:0,costPerUnit:0,percentage:0,pgRatio:0,vgRatio:0,remarks:""}});(0,a.useEffect)(()=>{r&&(async()=>{try{if(!d.db)throw Error("Firebase 未初始化");let e=(await (0,i.getDocs)((0,i.collection)(d.db,"suppliers"))).docs.map(e=>({id:e.id,name:e.data().name})).filter(e=>e.name&&e.name.includes("生技"));I(e);try{let e=(await (0,i.getDocs)((0,i.collection)(d.db,"fragranceTypes"))).docs.map(e=>e.data().name).filter(Boolean);z(e.length>0?e:["棉芯","陶瓷芯","棉陶芯通用"])}catch(e){console.log("香精種類集合不存在，使用預設值"),z(["棉芯","陶瓷芯","棉陶芯通用"])}try{let e=(await (0,i.getDocs)((0,i.collection)(d.db,"fragranceStatuses"))).docs.map(e=>e.data().name).filter(Boolean);C(e.length>0?e:["啟用","備用","棄用"])}catch(e){console.log("香精狀態集合不存在，使用預設值"),C(["啟用","備用","棄用"])}}catch(e){m.Am.error("讀取資料失敗。")}})()},[r]),(0,a.useEffect)(()=>{if(r&&v){var e;console.log("正在初始化香精編輯表單，原始資料:",v);let r=v.fragranceType||v.status||"",s=v.fragranceStatus||v.status||"",t={code:v.code||"",name:v.name||"",fragranceType:r,fragranceStatus:s,supplierId:(null===(e=v.supplierRef)||void 0===e?void 0:e.id)||"",currentStock:v.currentStock||0,safetyStockLevel:v.safetyStockLevel||0,costPerUnit:v.costPerUnit||0,percentage:v.percentage||0,pgRatio:v.pgRatio||0,vgRatio:v.vgRatio||0,remarks:v.remarks||""};console.log("表單初始化資料:",t),M.reset(t)}else r&&!v&&M.reset()},[r,v,M]);let P=M.watch("percentage")||0;(0,a.useEffect)(()=>{if(P>=0&&!Z){let{pgRatio:e,vgRatio:r}=W(P);M.setValue("pgRatio",e),M.setValue("vgRatio",r)}},[P,M,Z]);let W=e=>{let r=0,s=0;return e<=60?(r=Math.round((60-e)*100)/100,s=40):(r=0,s=Math.round((100-e)*100)/100),{pgRatio:r,vgRatio:s}};async function J(e){S(!0);let r=m.Am.loading(Z?"正在更新香精...":"正在新增香精...");try{let t;let a=(0,c.$C)();if(t={...e,pgRatio:e.pgRatio||0,vgRatio:e.vgRatio||0,unit:"KG"},Z){let s=(0,c.V1)(a,"updateFragrance");await s({fragranceId:v.id,...t}),m.Am.success("香精 ".concat(e.name," 的資料已更新。"),{id:r})}else{let s=(0,c.V1)(a,"createFragrance");await s(t),m.Am.success("香精 ".concat(e.name," 已成功建立。"),{id:r})}o(),s(!1)}catch(s){let e=s instanceof Error?s.message:"發生未知錯誤。";m.Am.error(e,{id:r})}finally{S(!1)}}return(0,t.jsx)(u.Vq,{open:r,onOpenChange:s,children:(0,t.jsxs)(u.cZ,{className:"max-w-4xl max-h-[95vh] overflow-y-auto bg-white sm:max-w-4xl max-w-[calc(100vw-1rem)]",children:[(0,t.jsxs)(u.fK,{className:"pb-4 border-b border-gray-200",children:[(0,t.jsxs)(u.$N,{className:"flex items-center gap-2 sm:gap-3 text-lg sm:text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:[(0,t.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg flex items-center justify-center",children:(0,t.jsx)(f.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"})}),Z?"編輯香精":"新增香精"]}),(0,t.jsx)(u.Be,{className:"text-gray-600 mt-2",children:Z?"修改香精詳細資訊":"建立新的香精資料"})]}),(0,t.jsx)(g.l0,{...M,children:(0,t.jsxs)("form",{onSubmit:M.handleSubmit(J),className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200 shadow-sm",children:[(0,t.jsxs)("h3",{className:"text-lg sm:text-xl font-bold flex items-center gap-2 sm:gap-3 text-purple-800",children:[(0,t.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(j.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 text-purple-600"})}),"基本資料"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[(0,t.jsx)(g.Wi,{control:M.control,name:"code",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"香精代號 *"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(h.I,{placeholder:"例如：HYH-0123M1",className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",...r})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:M.control,name:"name",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"香精名稱 *"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(h.I,{placeholder:"例如：茉莉綠茶",className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",...r})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:M.control,name:"fragranceType",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"香精種類 *"}),(0,t.jsxs)(p.Ph,{onValueChange:r.onChange,value:r.value,children:[(0,t.jsx)(g.NI,{children:(0,t.jsx)(p.i4,{className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",children:(0,t.jsx)(p.ki,{placeholder:"選擇香精種類"})})}),(0,t.jsx)(p.Bw,{children:R.map(e=>(0,t.jsx)(p.Ql,{value:e,children:e},e))})]}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:M.control,name:"fragranceStatus",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"啟用狀態 *"}),(0,t.jsxs)(p.Ph,{onValueChange:r.onChange,value:r.value,children:[(0,t.jsx)(g.NI,{children:(0,t.jsx)(p.i4,{className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",children:(0,t.jsx)(p.ki,{placeholder:"選擇啟用狀態"})})}),(0,t.jsx)(p.Bw,{children:V.map(e=>(0,t.jsx)(p.Ql,{value:e,children:e},e))})]}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:M.control,name:"supplierId",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"供應商"}),(0,t.jsxs)(p.Ph,{onValueChange:r.onChange,value:r.value,children:[(0,t.jsx)(g.NI,{children:(0,t.jsx)(p.i4,{className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",children:(0,t.jsx)(p.ki,{placeholder:"選擇供應商"})})}),(0,t.jsx)(p.Bw,{children:G.map(e=>(0,t.jsx)(p.Ql,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(g.zG,{})]})}})]})]}),(0,t.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200 shadow-sm",children:[(0,t.jsxs)("h3",{className:"text-lg sm:text-xl font-bold flex items-center gap-2 sm:gap-3 text-green-800",children:[(0,t.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-green-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(y.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-600"})}),"庫存與成本"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[(0,t.jsx)(g.Wi,{control:M.control,name:"currentStock",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"現有庫存 (KG)"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(h.I,{type:"number",step:"0.01",placeholder:"0",className:"border-gray-300 focus:border-green-500 focus:ring-green-500",...r})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:M.control,name:"safetyStockLevel",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"安全庫存 (KG)"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(h.I,{type:"number",placeholder:"0",className:"border-gray-300 focus:border-green-500 focus:ring-green-500",...r})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:M.control,name:"costPerUnit",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"單位成本 (元/KG)"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(h.I,{type:"number",placeholder:"0.00",className:"border-gray-300 focus:border-green-500 focus:ring-green-500",...r})}),(0,t.jsx)(g.zG,{})]})}})]})]}),(0,t.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm",children:[(0,t.jsxs)("h3",{className:"text-lg sm:text-xl font-bold flex items-center gap-2 sm:gap-3 text-blue-800",children:[(0,t.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(N.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-600"})}),"香精比例"]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 sm:gap-0",children:[(0,t.jsx)("h4",{className:"text-base sm:text-lg font-semibold text-blue-700",children:"配方比例設定"}),Z&&(0,t.jsx)(x.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{let{pgRatio:e,vgRatio:r}=W(M.getValues("percentage")||0);M.setValue("pgRatio",e),M.setValue("vgRatio",r),m.Am.success("PG和VG比例已重新計算")},className:"text-blue-600 border-blue-300 hover:bg-blue-50 w-full sm:w-auto",children:"重新計算PG/VG"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[(0,t.jsx)(g.Wi,{control:M.control,name:"percentage",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"香精比例 (%)"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(h.I,{type:"number",placeholder:"輸入香精比例，PG和VG將自動計算",className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",...r,onChange:e=>{if(r.onChange(e),Z){let{pgRatio:r,vgRatio:s}=W(parseFloat(e.target.value)||0);M.setValue("pgRatio",r),M.setValue("vgRatio",s)}}})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:M.control,name:"pgRatio",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"PG 比例 (%) - 自動計算"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(h.I,{type:"number",disabled:!0,placeholder:"根據香精比例自動計算",className:"border-gray-300 bg-gray-50",...r})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:M.control,name:"vgRatio",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"VG 比例 (%) - 自動計算"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(h.I,{type:"number",disabled:!0,placeholder:"根據香精比例自動計算",className:"border-gray-300 bg-gray-50",...r})}),(0,t.jsx)(g.zG,{})]})}})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 bg-gradient-to-r from-yellow-50 to-amber-50 rounded-xl border border-yellow-200 shadow-sm",children:[(0,t.jsxs)("h3",{className:"text-lg sm:text-xl font-bold flex items-center gap-2 sm:gap-3 text-yellow-800",children:[(0,t.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(j.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 text-yellow-600"})}),"備註"]}),(0,t.jsx)(g.Wi,{control:M.control,name:"remarks",render:e=>{let{field:r}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.NI,{children:(0,t.jsx)(b.g,{placeholder:"輸入香精備註 (選填)",className:"border-gray-300 focus:border-yellow-500 focus:ring-yellow-500",...r})}),(0,t.jsx)(g.zG,{})]})}})]}),(0,t.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3 pt-4 sm:pt-6 border-t border-gray-200",children:[(0,t.jsx)(x.z,{type:"button",variant:"outline",onClick:()=>s(!1),className:"border-gray-300 text-gray-700 hover:bg-gray-50 w-full sm:w-auto",children:"取消"}),(0,t.jsx)(x.z,{type:"submit",disabled:k,className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 w-full sm:w-auto",children:k?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"處理中..."]}):Z?"儲存更新":"確認新增"})]})]})})]})})}},83112:function(e,r,s){s.d(r,{O:function(){return o}});var t=s(57437),a=s(74291),l=s(69174),n=s(79820);function o(e){let{isOpen:r,onOpenChange:s,title:o,subtitle:c,sections:i,actions:d}=e,m=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(null==e||""===e)return(0,t.jsx)("span",{className:"text-muted-foreground",children:"-"});switch(r){case"date":if(null==e?void 0:e.toDate)return new Date(e.toDate()).toLocaleString("zh-TW");return new Date(e).toLocaleString("zh-TW");case"badge":return(0,t.jsx)(l.C,{variant:(e=>{switch(e.toLowerCase()){case"active":case"啟用":return"default";case"inactive":case"停用":return"secondary";case"discontinued":case"已下架":return"destructive";default:return"outline"}})(e),children:(e=>{switch(e.toLowerCase()){case"active":return"啟用";case"inactive":return"停用";case"discontinued":return"已下架";default:return e}})(e)});case"currency":return"NT$ ".concat(Math.round(Number(e)).toLocaleString());case"percentage":return"".concat(e,"%");case"number":return Number(e).toLocaleString();default:return String(e)}};return(0,t.jsx)(a.Vq,{open:r,onOpenChange:s,children:(0,t.jsxs)(a.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto","aria-describedby":"detail-view-dialog-description",children:[(0,t.jsxs)(a.fK,{children:[(0,t.jsx)(a.$N,{className:"text-xl flex items-center gap-2",children:o}),c&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",id:"detail-view-dialog-description",children:c})]}),(0,t.jsx)("div",{className:"space-y-6",children:i.map((e,r)=>(0,t.jsxs)(n.Zb,{className:(e=>{switch(e){case"blue":return"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200";case"green":return"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200";case"purple":return"bg-gradient-to-r from-purple-50 to-violet-50 border-purple-200";case"yellow":return"bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200";case"red":return"bg-gradient-to-r from-red-50 to-pink-50 border-red-200";case"gray":return"bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200";default:return"bg-white border-gray-200"}})(e.color),children:[(0,t.jsx)(n.Ol,{className:"pb-3",children:(0,t.jsxs)(n.ll,{className:"text-lg font-bold flex items-center gap-3 ".concat((e=>{switch(e){case"blue":return"text-blue-800";case"green":return"text-green-800";case"purple":return"text-purple-800";case"yellow":return"text-yellow-800";case"red":return"text-red-800";default:return"text-foreground"}})(e.color)),children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center ".concat("blue"===e.color?"bg-blue-100":"green"===e.color?"bg-green-100":"purple"===e.color?"bg-purple-100":"yellow"===e.color?"bg-yellow-100":"red"===e.color?"bg-red-100":(e.color,"bg-gray-100")),children:(0,t.jsx)("div",{className:"".concat("blue"===e.color?"text-blue-600":"green"===e.color?"text-green-600":"purple"===e.color?"text-purple-600":"yellow"===e.color?"text-yellow-600":"red"===e.color?"text-red-600":(e.color,"text-gray-600")),children:e.icon})}),e.title]})}),(0,t.jsx)(n.aY,{children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.fields.map((e,r)=>(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[e.icon,(0,t.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:e.label})]}),(0,t.jsx)("div",{className:"text-sm",children:m(e.value,e.type)})]},r))})})]},r))}),d&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("div",{className:"border-t pt-4",children:(0,t.jsx)("div",{className:"flex justify-end gap-2",children:d})})})]})})}}}]);