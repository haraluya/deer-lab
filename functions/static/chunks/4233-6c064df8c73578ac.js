"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4233],{32660:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},91723:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},42208:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},44794:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},15868:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},62720:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]])},3085:function(e,t,a){a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]])},99376:function(e,t,a){var r=a(35475);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},48195:function(e,t,a){a.d(t,{B:function(){return j}});var r=a(57437),s=a(2265),n=a(79820),l=a(69174),i=a(12381),c=a(33804),d=a(70525),o=a(3085),u=a(21047),m=a(44794),x=a(38220),h=a(82431),g=a(91723),f=a(42208),y=a(80719),b=a(4899);function j(e){let{itemId:t,itemType:a,itemCode:j,itemName:p,currentStock:N}=e,[v,k]=(0,s.useState)([]),[w,C]=(0,s.useState)(!1),[Z,q]=(0,s.useState)(null),[D,R]=(0,s.useState)(!1),P=(0,s.useCallback)(async()=>{C(!0);try{let e=(await (0,y.hz)(t,a,20)).map(e=>{let r=(0,y.Q$)(e,t,a);return r?{id:e.id,changeDate:e.changeDate,changeReason:e.changeReason,quantityChange:r.quantityChange,quantityAfter:r.quantityAfter,operatorName:e.operatorName,remarks:e.remarks,relatedDocumentId:e.relatedDocumentId,relatedDocumentType:e.relatedDocumentType,originalRecord:e}:null}).filter(Boolean);k(e)}catch(e){console.error("載入庫存歷史失敗:",e)}finally{C(!1)}},[t,a]);(0,s.useEffect)(()=>{P()},[t,a,P]);let z=e=>new Intl.DateTimeFormat("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e),S=e=>e>0?(0,r.jsx)(d.Z,{className:"h-4 w-4 text-green-600"}):e<0?(0,r.jsx)(o.Z,{className:"h-4 w-4 text-red-600"}):(0,r.jsx)(u.Z,{className:"h-4 w-4 text-gray-600"}),M=e=>e>0?"text-green-600":e<0?"text-red-600":"text-gray-600",A=e=>{q(e.originalRecord),R(!0)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.Zb,{className:"border-l-4 border-l-blue-500",children:[(0,r.jsx)(n.Ol,{className:"pb-3",children:(0,r.jsxs)(n.ll,{className:"text-lg text-gray-800 flex items-center gap-2",children:["material"===a?(0,r.jsx)(m.Z,{className:"h-5 w-5 text-blue-500"}):(0,r.jsx)(x.Z,{className:"h-5 w-5 text-purple-500"}),"庫存歷史"]})}),(0,r.jsxs)(n.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,r.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-blue-700",children:"當前庫存"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:N})]}),(0,r.jsxs)("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-green-700",children:"總增加"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-green-900",children:v.filter(e=>e.quantityChange>0).reduce((e,t)=>e+t.quantityChange,0)})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-red-700",children:"總消耗"}),(0,r.jsx)("div",{className:"text-2xl font-bold text-red-900",children:Math.abs(v.filter(e=>e.quantityChange<0).reduce((e,t)=>e+t.quantityChange,0))})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["顯示最近 ",v.length," 筆庫存變動記錄"]}),(0,r.jsxs)(i.z,{variant:"outline",size:"sm",onClick:P,disabled:w,className:"hover:bg-blue-50 hover:text-blue-600 transition-all duration-200",children:[(0,r.jsx)(h.Z,{className:"h-4 w-4 mr-2 ".concat(w?"animate-spin":"")}),"重新整理"]})]}),w?(0,r.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-4 border-gray-200 rounded-full animate-spin border-t-blue-500"}),(0,r.jsx)("span",{className:"text-sm text-gray-500",children:"載入中..."})]})}):v.length>0?(0,r.jsx)("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:(0,r.jsxs)(c.iA,{children:[(0,r.jsx)(c.xD,{children:(0,r.jsxs)(c.SC,{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:[(0,r.jsx)(c.ss,{className:"text-left font-semibold text-gray-700",children:"變動時間"}),(0,r.jsx)(c.ss,{className:"text-left font-semibold text-gray-700",children:"變動原因"}),(0,r.jsx)(c.ss,{className:"text-right font-semibold text-gray-700",children:"變動數量"}),(0,r.jsx)(c.ss,{className:"text-right font-semibold text-gray-700",children:"變動後數量"}),(0,r.jsx)(c.ss,{className:"text-left font-semibold text-gray-700",children:"操作人員"}),(0,r.jsx)(c.ss,{className:"text-left font-semibold text-gray-700",children:"備註"}),(0,r.jsx)(c.ss,{className:"text-center font-semibold text-gray-700",children:"操作"})]})}),(0,r.jsx)(c.RM,{children:v.map(e=>(0,r.jsxs)(c.SC,{className:"hover:bg-gray-50 transition-colors duration-200",children:[(0,r.jsx)(c.pj,{className:"text-sm text-gray-700",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 text-gray-400"}),z(e.changeDate)]})}),(0,r.jsx)(c.pj,{children:(0,r.jsx)(l.C,{variant:"outline",className:"text-xs ".concat("purchase"===e.changeReason?"border-green-200 text-green-700 bg-green-50":"workorder"===e.changeReason?"border-orange-200 text-orange-700 bg-orange-50":"inventory_check"===e.changeReason?"border-blue-200 text-blue-700 bg-blue-50":"border-gray-200 text-gray-700 bg-gray-50"),children:(0,y.bU)(e.changeReason)})}),(0,r.jsx)(c.pj,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[S(e.quantityChange),(0,r.jsxs)("span",{className:"font-semibold ".concat(M(e.quantityChange)),children:[e.quantityChange>0?"+":"",e.quantityChange]})]})}),(0,r.jsx)(c.pj,{className:"text-right",children:(0,r.jsx)("span",{className:"font-semibold text-gray-800",children:e.quantityAfter})}),(0,r.jsx)(c.pj,{className:"text-sm text-gray-700",children:e.operatorName}),(0,r.jsx)(c.pj,{className:"text-sm text-gray-600 max-w-xs truncate",title:e.remarks,children:e.remarks||"-"}),(0,r.jsx)(c.pj,{className:"text-center",children:(0,r.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>A(e),className:"h-8 w-8 p-0 hover:bg-blue-50 hover:text-blue-600 transition-all duration-200",children:(0,r.jsx)(f.Z,{className:"h-4 w-4"})})})]},e.id))})]})}):(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("div",{className:"text-gray-400 text-4xl mb-4",children:"\uD83D\uDCCA"}),(0,r.jsx)("div",{className:"text-gray-500 font-medium text-lg mb-2",children:"尚無庫存變動記錄"}),(0,r.jsxs)("div",{className:"text-gray-400",children:["此","material"===a?"物料":"香精","尚未有任何庫存變動"]})]})]})]}),(0,r.jsx)(b.w,{record:Z,isOpen:D,onClose:()=>{R(!1),q(null)}})]})}},80670:function(e,t,a){a.d(t,{NI:function(){return f},Wi:function(){return u},l0:function(){return d},lX:function(){return g},xJ:function(){return h},zG:function(){return y}});var r=a(57437),s=a(2265),n=a(37053),l=a(29501),i=a(93448),c=a(75060);let d=l.RV,o=s.createContext({}),u=e=>{let{...t}=e;return(0,r.jsx)(o.Provider,{value:{name:t.name},children:(0,r.jsx)(l.Qr,{...t})})},m=()=>{let e=s.useContext(o),t=s.useContext(x),{getFieldState:a}=(0,l.Gc)(),r=(0,l.cl)({name:e.name}),n=a(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...n}},x=s.createContext({});function h(e){let{className:t,...a}=e,n=s.useId();return(0,r.jsx)(x.Provider,{value:{id:n},children:(0,r.jsx)("div",{"data-slot":"form-item",className:(0,i.cn)("grid gap-2",t),...a})})}function g(e){let{className:t,...a}=e,{error:s,formItemId:n}=m();return(0,r.jsx)(c._,{"data-slot":"form-label","data-error":!!s,className:(0,i.cn)("data-[error=true]:text-destructive",t),htmlFor:n,...a})}function f(e){let{...t}=e,{error:a,formItemId:s,formDescriptionId:l,formMessageId:i}=m();return(0,r.jsx)(n.g7,{"data-slot":"form-control",id:s,"aria-describedby":a?"".concat(l," ").concat(i):"".concat(l),"aria-invalid":!!a,...t})}function y(e){var t;let{className:a,...s}=e,{error:n,formMessageId:l}=m(),c=n?String(null!==(t=null==n?void 0:n.message)&&void 0!==t?t:""):s.children;return c?(0,r.jsx)("p",{"data-slot":"form-message",id:l,className:(0,i.cn)("text-destructive text-sm",a),...s,children:c}):null}},23675:function(e,t,a){a.d(t,{g:function(){return l}});var r=a(57437),s=a(2265),n=a(93448);let l=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...s})});l.displayName="Textarea"}}]);