(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7663],{55522:function(e,t,a){Promise.resolve().then(a.bind(a,81230))},81230:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return W}});var s=a(57437),r=a(27648),l=a(33145),n=a(99376),o=a(2265),i=a(61146),d=a(93448);function c(e){let{className:t,...a}=e;return(0,s.jsx)(i.fC,{"data-slot":"avatar",className:(0,d.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",t),...a})}function u(e){let{className:t,...a}=e;return(0,s.jsx)(i.NY,{"data-slot":"avatar-fallback",className:(0,d.cn)("bg-muted flex size-full items-center justify-center rounded-full",t),...a})}var m=a(12381),f=a(32060),h=a(71245),x=a(5978),p=a(1850),b=a(46410),N=a(14438),E=a(1077),g=a(14938),A=a(49663),y=a(91723),v=a(60044),w=a(16275),R=a(44794),S=a(56454),_=a(93947),j=a(39989),I=a(91927),C=a(43044),M=a(70525),T=a(71837),k=a(40875),O=a(47692);let G=[{href:"/dashboard",label:"工作台",icon:g.Z},{isSeparator:!0,label:"團隊管理"},{href:"/dashboard/personnel",label:"成員管理",icon:A.Z},{href:"/dashboard/time-records",label:"工時統計",icon:y.Z},{isSeparator:!0,label:"供應鏈"},{href:"/dashboard/suppliers",label:"供應商",icon:v.Z},{href:"/dashboard/purchase-orders",label:"採購訂單",icon:w.Z},{isSeparator:!0,label:"生產中心"},{href:"/dashboard/materials",label:"原料庫",icon:R.Z},{href:"/dashboard/fragrances",label:"配方庫",icon:S.Z},{href:"/dashboard/products",label:"產品目錄",icon:_.Z},{href:"/dashboard/work-orders",label:"生產工單",icon:j.Z},{isSeparator:!0,label:"營運分析"},{href:"/dashboard/inventory",label:"庫存監控",icon:I.Z},{href:"/dashboard/inventory-records",label:"庫存歷史",icon:C.Z},{href:"/dashboard/cost-management",label:"成本分析",icon:M.Z},{href:"/dashboard/time-reports",label:"工時報表",icon:T.Z}];function V(){let e=(0,n.usePathname)(),{cartItemCount:t,isLoading:a}=function(){let[e,t]=(0,o.useState)([]),[a,s]=(0,o.useState)(0),[r,l]=(0,o.useState)(!0),[n,i]=(0,o.useState)(!1);(0,o.useEffect)(()=>{if(!b.db){console.error("Firebase 未初始化"),l(!1);return}console.log("useGlobalCart: 開始監聽購物車變化");let e=(0,x.cf)((0,x.doc)(b.db,"globalCart","main"),e=>{if(console.log("useGlobalCart: 收到購物車更新"),e.exists()){let a=e.data(),r=(null==a?void 0:a.items)||[];console.log("useGlobalCart: 購物車項目數量:",r.length),t(r),s(r.length)}else console.log("useGlobalCart: 購物車文檔不存在，設置為空"),t([]),s(0);l(!1)},e=>{console.error("監聽購物車失敗:",e),N.Am.error("無法載入購物車資料"),l(!1)});return()=>e()},[]),(0,o.useEffect)(()=>{let t=async()=>{try{let e=localStorage.getItem("purchaseCart"),t=localStorage.getItem("cartMigrated");if(e&&!t){let t=JSON.parse(e);if(t.length>0){i(!0);let e=(0,p.$C)(),a=(0,p.V1)(e,"syncGlobalCart");(await a({items:t})).data&&(localStorage.setItem("cartMigrated","true"),localStorage.removeItem("purchaseCart"),N.Am.success("已將 ".concat(t.length," 個項目遷移到雲端購物車")))}}}catch(e){console.error("遷移購物車失敗:",e),N.Am.error("遷移購物車資料失敗")}finally{i(!1)}};r||0!==e.length||t()},[r,e.length]);let d=(0,o.useCallback)(async e=>{try{i(!0);let t=(0,p.$C)(),a=(0,p.V1)(t,"addToGlobalCart");if((await a({item:e})).data)return N.Am.success("已加入購物車"),!0;return!1}catch(e){return console.error("加入購物車失敗:",e),N.Am.error("加入購物車失敗"),!1}finally{i(!1)}},[]),c=(0,o.useCallback)(async(e,t)=>{try{i(!0);let a=(0,p.$C)(),s=(0,p.V1)(a,"updateGlobalCartItem");if((await s({itemId:e,updates:t})).data)return N.Am.success("購物車已更新"),!0;return!1}catch(e){return console.error("更新購物車失敗:",e),N.Am.error("更新購物車失敗"),!1}finally{i(!1)}},[]),u=(0,o.useCallback)(async e=>{try{i(!0);let t=(0,p.$C)(),a=(0,p.V1)(t,"removeFromGlobalCart");if((await a({itemId:e})).data)return N.Am.success("已從購物車移除"),!0;return!1}catch(e){return console.error("移除項目失敗:",e),N.Am.error("移除項目失敗"),!1}finally{i(!1)}},[]),m=(0,o.useCallback)(async()=>{try{i(!0);let e=(0,p.$C)(),t=(0,p.V1)(e,"clearGlobalCart");if((await t()).data)return N.Am.success("購物車已清空"),!0;return!1}catch(e){return console.error("清空購物車失敗:",e),N.Am.error("清空購物車失敗"),!1}finally{i(!1)}},[]),f=(0,o.useCallback)(()=>{let t={};return e.forEach(e=>{t[e.supplierId]||(t[e.supplierId]=[]),t[e.supplierId].push(e)}),t},[e]);return{cartItems:e,cartItemCount:a,isLoading:r,isSyncing:n,addToCart:d,updateCartItem:c,removeFromCart:u,clearCart:m,getCartBySupplier:f}}(),{canAccess:l}=(0,E.g)();(0,o.useEffect)(()=>{console.log("SidebarNav: 當前路徑:",e),console.log("SidebarNav: 導航連結:",G.map(e=>e.href)),console.log("SidebarNav: 購物車數量:",t),console.log("SidebarNav: 購物車數量類型:",typeof t),t>0&&console.log("SidebarNav: 購物車有項目，將顯示氣泡")},[e,t]);let i=()=>{let e=document.getElementById("mobile-sidebar"),t=document.getElementById("sidebar-overlay");e&&t&&(e.classList.remove("translate-x-0"),e.classList.add("-translate-x-full"),t.style.opacity="0",setTimeout(()=>{t.style.display="none"},300))},c=(()=>{let e=[],t=!1,a=null;for(let s=0;s<G.length;s++){let r=G[s];r.isSeparator?(a&&t&&e.push(a),a=r,t=!1):("/dashboard"===r.href||l(r.href))&&(a&&!t&&(e.push(a),t=!0),e.push(r))}return e})();return(0,s.jsx)("nav",{className:"flex flex-col gap-1 px-4 py-4",children:c.map((l,n)=>{if(l.isSeparator)return(0,s.jsx)("h2",{className:"px-2 mt-4 mb-1 text-xs font-semibold text-muted-foreground uppercase tracking-wider",children:l.label},"sep-".concat(n));let o=l.icon,c=e===l.href;return c&&console.log("SidebarNav: 當前活動頁面:",l.href),(0,s.jsxs)(r.default,{href:l.href,onClick:i,className:(0,d.cn)("flex items-center gap-3 rounded-lg px-3 py-3 text-sm font-medium transition-all duration-200 relative",c?"bg-gradient-to-r from-primary to-primary/80 text-primary-foreground shadow-lg":"text-muted-foreground hover:bg-muted hover:text-foreground"),children:[(0,s.jsx)(o,{className:(0,d.cn)("h-4 w-4",c?"text-primary-foreground":"text-muted-foreground")}),(0,s.jsx)("span",{className:"truncate",children:l.label}),"/dashboard/purchase-orders"===l.href&&!a&&t>0&&(0,s.jsx)("div",{className:"absolute -top-1 -right-1 bg-gradient-to-r from-red-500 to-red-600 text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold border-2 border-white shadow-lg z-10",children:(0,s.jsx)("span",{className:"animate-pulse",children:t>99?"99+":t})})]},l.href)})})}function P(){let{appUser:e,logout:t}=(0,h.a)(),a=(null==e?void 0:e.name)?e.name.charAt(0).toUpperCase():"U";return(0,s.jsxs)(f.h_,{children:[(0,s.jsx)(f.$F,{asChild:!0,children:(0,s.jsxs)(m.z,{variant:"ghost",className:"relative h-12 w-full justify-start px-4 text-left font-normal hover:bg-muted rounded-lg transition-colors",children:[(0,s.jsx)(c,{className:"h-8 w-8 mr-3 ring-2 ring-border",children:(0,s.jsx)(u,{className:"bg-gradient-to-br from-primary to-primary/80 text-primary-foreground font-medium",children:a})}),(0,s.jsxs)("div",{className:"flex flex-col space-y-1 flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium leading-none text-foreground truncate",children:(null==e?void 0:e.name)||"使用者"}),(0,s.jsxs)("p",{className:"text-xs leading-none text-muted-foreground truncate",children:["工號: ",(null==e?void 0:e.employeeId)||"N/A"]})]}),(0,s.jsx)(k.Z,{className:"h-4 w-4 ml-2 text-muted-foreground flex-shrink-0"})]})}),(0,s.jsxs)(f.AW,{className:"w-56",align:"end",forceMount:!0,children:[(0,s.jsx)(f.Ju,{className:"font-normal",children:(0,s.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium leading-none text-foreground",children:(null==e?void 0:e.name)||"使用者"}),(0,s.jsx)("p",{className:"text-xs leading-none text-muted-foreground",children:null==e?void 0:e.employeeId})]})}),(0,s.jsx)(f.VD,{}),(0,s.jsxs)(f.Xi,{onClick:()=>{t();let e=document.getElementById("mobile-sidebar"),a=document.getElementById("sidebar-overlay");e&&a&&(e.classList.remove("translate-x-0"),e.classList.add("-translate-x-full"),a.style.opacity="0",setTimeout(()=>{a.style.display="none"},300))},className:"text-destructive focus:text-destructive",children:[(0,s.jsx)(O.Z,{className:"mr-2 h-4 w-4"}),(0,s.jsx)("span",{children:"登出"})]})]})]})}function W(e){let{children:t}=e,{isLoading:a,appUser:r}=(0,h.a)(),i=(0,n.useRouter)();return((0,o.useEffect)(()=>{a||r||(console.log("❌ 未認證用戶嘗試訪問 dashboard，重定向到登入頁面"),i.push("/"))},[a,r,i]),a)?(0,s.jsx)("div",{className:"flex h-screen w-full items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"載入中..."})]})}):r?(0,s.jsxs)("div",{className:"flex h-screen w-full bg-gradient-to-br from-gray-50 to-blue-50",children:[(0,s.jsxs)("aside",{className:"hidden lg:flex fixed inset-y-0 left-0 z-20 h-full w-64 flex-col border-r bg-white/95 backdrop-blur-sm shadow-lg",children:[(0,s.jsxs)("div",{className:"flex h-16 shrink-0 items-center border-b px-6 bg-gradient-to-r from-purple-600 to-blue-600",children:[(0,s.jsx)(l.default,{src:"/dexter-lab-logo.svg",alt:"德科斯特的實驗室",width:24,height:24,className:"text-white"}),(0,s.jsx)("span",{className:"ml-2 font-semibold text-white text-sm",children:"德科斯特的實驗室"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)(V,{})}),(0,s.jsx)("div",{className:"mt-auto p-4 border-t bg-gray-50/50",children:(0,s.jsx)(P,{})})]}),(0,s.jsx)("div",{className:"lg:hidden fixed inset-0 z-10 bg-black/50 transition-opacity duration-300",style:{display:"none",opacity:0},id:"sidebar-overlay",onClick:()=>{let e=document.getElementById("mobile-sidebar"),t=document.getElementById("sidebar-overlay");e&&t&&(e.classList.remove("translate-x-0"),e.classList.add("-translate-x-full"),t.style.opacity="0",setTimeout(()=>{t.style.display="none"},300))}}),(0,s.jsxs)("main",{className:"flex flex-1 flex-col lg:ml-64",children:[(0,s.jsx)("header",{className:"lg:hidden flex h-16 items-center justify-between border-b bg-white px-4 shadow-sm",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{className:"p-2 rounded-md hover:bg-gray-100",onClick:()=>{let e=document.getElementById("mobile-sidebar"),t=document.getElementById("sidebar-overlay");e&&t&&(e.classList.contains("-translate-x-full")?(e.classList.remove("-translate-x-full"),e.classList.add("translate-x-0"),t.style.display="block",setTimeout(()=>{t.style.opacity="1"},10)):(e.classList.remove("translate-x-0"),e.classList.add("-translate-x-full"),t.style.opacity="0",setTimeout(()=>{t.style.display="none"},300)))},children:(0,s.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,s.jsx)(l.default,{src:"/dexter-lab-logo.svg",alt:"德科斯特的實驗室",width:24,height:24}),(0,s.jsx)("span",{className:"font-semibold text-gray-900 text-sm",children:"德科斯特的實驗室"})]})}),(0,s.jsxs)("aside",{className:"lg:hidden fixed inset-y-0 left-0 z-20 h-full w-64 flex-col border-r bg-white shadow-xl transform -translate-x-full transition-transform duration-300 flex",id:"mobile-sidebar",children:[(0,s.jsxs)("div",{className:"flex h-16 shrink-0 items-center justify-between border-b px-6 bg-gradient-to-r from-purple-600 to-blue-600",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(l.default,{src:"/dexter-lab-logo.svg",alt:"德科斯特的實驗室",width:24,height:24,className:"text-white"}),(0,s.jsx)("span",{className:"ml-2 font-semibold text-white text-sm",children:"德科斯特的實驗室"})]}),(0,s.jsx)("button",{className:"p-2 rounded-md hover:bg-white/10 text-white",onClick:()=>{let e=document.getElementById("mobile-sidebar"),t=document.getElementById("sidebar-overlay");e&&t&&(e.classList.remove("translate-x-0"),e.classList.add("-translate-x-full"),t.style.opacity="0",setTimeout(()=>{t.style.display="none"},300))},children:(0,s.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,s.jsx)(V,{})}),(0,s.jsx)("div",{className:"mt-auto p-4 border-t bg-gray-50/50",children:(0,s.jsx)(P,{})})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto",children:(0,s.jsx)("div",{className:"p-4 lg:p-6 lg:py-4",children:t})})]})]}):null}},32060:function(e,t,a){"use strict";a.d(t,{$F:function(){return u},AW:function(){return m},Ju:function(){return h},VD:function(){return x},Xi:function(){return f},h_:function(){return c}});var s=a(57437),r=a(2265),l=a(70085),n=a(10407),o=a(30401),i=a(40519),d=a(93448);let c=l.fC,u=l.xz;l.ZA,l.Uv,l.Tr,l.Ee,r.forwardRef((e,t)=>{let{className:a,inset:r,children:o,...i}=e;return(0,s.jsxs)(l.fF,{ref:t,className:(0,d.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-slate-100 data-[state=open]:bg-slate-100 dark:focus:bg-slate-800 dark:data-[state=open]:bg-slate-800",r&&"pl-8",a),...i,children:[o,(0,s.jsx)(n.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=l.fF.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.tu,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 bg-white p-1 text-slate-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50",a),...r})}).displayName=l.tu.displayName;let m=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(l.Uv,{children:(0,s.jsx)(l.VY,{ref:t,sideOffset:r,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 bg-white p-1 text-slate-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50",a),...n})})});m.displayName=l.VY.displayName;let f=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(l.ck,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",r&&"pl-8",a),...n})});f.displayName=l.ck.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...i}=e;return(0,s.jsxs)(l.oC,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",a),checked:n,...i,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.wU,{children:(0,s.jsx)(o.Z,{className:"h-4 w-4"})})}),r]})}).displayName=l.oC.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(l.Rk,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.wU,{children:(0,s.jsx)(i.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=l.Rk.displayName;let h=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(l.__,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...n})});h.displayName=l.__.displayName;let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-slate-100 dark:bg-slate-800",a),...r})});x.displayName=l.Z0.displayName},71245:function(e,t,a){"use strict";a.d(t,{H:function(){return u},a:function(){return m}});var s=a(57437),r=a(2265),l=a(82148),n=a(46410),o=a(5978),i=a(14438),d=a(47903);let c=(0,r.createContext)({user:null,appUser:null,isLoading:!0,login:async()=>!1,logout:async()=>{},hasPermission:()=>!1,hasAnyPermission:()=>!1,hasAllPermissions:()=>!1}),u=e=>{let{children:t}=e,[a,u]=(0,r.useState)(null),[m,f]=(0,r.useState)(null),[h,x]=(0,r.useState)(!0),p=async e=>{(0,d.fF)("loadUserData 開始執行",{uid:e.uid});try{let t=(0,n.T)();if(!t){(0,d.vU)("Firestore 未初始化"),f(null);return}(0,d.fF)("獲取用戶文檔",{uid:e.uid});let a=await (0,o.QT)((0,o.doc)(t,"users",e.uid));if(a.exists()){(0,d.fF)("用戶文檔存在");let e=a.data();if((0,d.fF)("用戶資料",e),e.roleRef){(0,d.fF)("用戶有角色引用，獲取角色資料");try{let t=await (0,o.QT)(e.roleRef);if(t.exists()){let a=t.data();e.roleName=a.displayName||a.name,e.permissions=a.permissions||[],(0,d.fF)("角色資料載入成功",{role:e.roleName,permissions:e.permissions})}else(0,d.ZK)("角色文檔不存在")}catch(e){(0,d.vU)("載入角色資料失敗",e)}}else(0,d.ZK)("用戶沒有角色引用");(0,d.fF)("設置 appUser",e),f(e)}else(0,d.ZK)("用戶文檔不存在"),f(null)}catch(e){(0,d.vU)("載入用戶資料失敗",e),f(null)}},b=async(e,t)=>{try{let a=(0,n.E7)();if(!a)return i.Am.error("系統初始化失敗"),!1;let s=e.includes("@")?e:"".concat(e,"@deer-lab.local"),r=await (0,l.e5)(a,s,t);return await p(r.user),i.Am.success("登入成功！"),!0}catch(e){return(0,d.vU)("登入失敗",e),i.Am.error(e.message||"登入失敗"),!1}},N=async()=>{try{let e=(0,n.E7)();e&&(await (0,l.w7)(e),u(null),f(null),i.Am.success("已成功登出"),window.location.href="/")}catch(e){(0,d.vU)("登出失敗",e),i.Am.error("登出失敗")}};return(0,r.useEffect)(()=>{(0,d.fF)("AuthContext useEffect 開始執行");try{let e=(0,n.E7)();if(!e){(0,d.vU)("Auth 未初始化，設置 isLoading = false"),x(!1);return}(0,d.fF)("設置 onAuthStateChanged 監聽器");let t=(0,l.Aj)(e,async e=>{try{(0,d.fF)("onAuthStateChanged 觸發",{uid:(null==e?void 0:e.uid)||null}),e?(u(e),(0,d.fF)("開始載入用戶資料"),await p(e)):(u(null),f(null),(0,d.fF)("用戶已登出，清除狀態")),x(!1),(0,d.fF)("設置 isLoading = false")}catch(e){(0,d.vU)("onAuthStateChanged 回調執行失敗",e),x(!1)}});return()=>{(0,d.fF)("清理 onAuthStateChanged 監聽器"),"function"==typeof t&&t()}}catch(e){(0,d.vU)("AuthContext useEffect 執行失敗",e),x(!1)}},[]),(0,s.jsx)(c.Provider,{value:{user:a,appUser:m,isLoading:h,login:b,logout:N,hasPermission:e=>null!=m&&!!m.permissions&&m.permissions.includes(e),hasAnyPermission:e=>null!=m&&!!m.permissions&&e.some(e=>m.permissions.includes(e)),hasAllPermissions:e=>null!=m&&!!m.permissions&&e.every(e=>m.permissions.includes(e))},children:t})},m=()=>(0,r.useContext)(c)},1077:function(e,t,a){"use strict";a.d(t,{g:function(){return n}});var s=a(71245);let r={PERSONNEL_VIEW:"personnel.view",PERSONNEL_MANAGE:"personnel.manage",TIME_VIEW:"time.view",TIME_MANAGE:"time.manage",SUPPLIERS_VIEW:"suppliers.view",SUPPLIERS_MANAGE:"suppliers.manage",PURCHASE_VIEW:"purchase.view",PURCHASE_MANAGE:"purchase.manage",MATERIALS_VIEW:"materials.view",MATERIALS_MANAGE:"materials.manage",FRAGRANCES_VIEW:"fragrances.view",FRAGRANCES_MANAGE:"fragrances.manage",PRODUCTS_VIEW:"products.view",PRODUCTS_MANAGE:"products.manage",WORK_ORDERS_VIEW:"workOrders.view",WORK_ORDERS_MANAGE:"workOrders.manage",INVENTORY_VIEW:"inventory.view",INVENTORY_MANAGE:"inventory.manage",INVENTORY_RECORDS_VIEW:"inventoryRecords.view",COST_VIEW:"cost.view",TIME_REPORTS_VIEW:"timeReports.view",ROLES_MANAGE:"roles.manage",SYSTEM_SETTINGS:"system.settings"};Object.values(r);let l={"/dashboard":{view:[]},"/dashboard/personnel":{view:[r.PERSONNEL_VIEW,r.PERSONNEL_MANAGE],manage:[r.PERSONNEL_MANAGE]},"/dashboard/time-records":{view:[r.TIME_VIEW,r.TIME_MANAGE]},"/dashboard/suppliers":{view:[r.SUPPLIERS_VIEW,r.SUPPLIERS_MANAGE],manage:[r.SUPPLIERS_MANAGE]},"/dashboard/purchase-orders":{view:[r.PURCHASE_VIEW,r.PURCHASE_MANAGE],manage:[r.PURCHASE_MANAGE]},"/dashboard/materials":{view:[r.MATERIALS_VIEW,r.MATERIALS_MANAGE],manage:[r.MATERIALS_MANAGE]},"/dashboard/fragrances":{view:[r.FRAGRANCES_VIEW,r.FRAGRANCES_MANAGE],manage:[r.FRAGRANCES_MANAGE]},"/dashboard/products":{view:[r.PRODUCTS_VIEW,r.PRODUCTS_MANAGE],manage:[r.PRODUCTS_MANAGE]},"/dashboard/work-orders":{view:[r.WORK_ORDERS_VIEW,r.WORK_ORDERS_MANAGE],manage:[r.WORK_ORDERS_MANAGE]},"/dashboard/inventory":{view:[r.INVENTORY_VIEW,r.INVENTORY_MANAGE],manage:[r.INVENTORY_MANAGE]},"/dashboard/inventory-records":{view:[r.INVENTORY_RECORDS_VIEW]},"/dashboard/cost-management":{view:[r.COST_VIEW]},"/dashboard/time-reports":{view:[r.TIME_REPORTS_VIEW]}};function n(){let{appUser:e,hasPermission:t,hasAnyPermission:a,hasAllPermissions:r}=(0,s.a)();return{hasPermission:t,hasAnyPermission:a,hasAllPermissions:r,canAccess:t=>null!=e&&!!e.permissions&&function(e,t){let a=l[e];return!a||0===a.view.length||a.view.some(e=>t.includes(e))}(t,e.permissions),canManage:t=>null!=e&&!!e.permissions&&function(e,t){let a=l[e];return null!=a&&!!a.manage&&a.manage.some(e=>t.includes(e))}(t,e.permissions),isAdmin:()=>(null==e?void 0:e.roleName)==="系統管理員",isForeman:()=>(null==e?void 0:e.roleName)==="生產領班",isTimekeeper:()=>(null==e?void 0:e.roleName)==="計時人員",userRole:(null==e?void 0:e.roleName)||"未設定",userPermissions:(null==e?void 0:e.permissions)||[]}}r.PERSONNEL_VIEW,r.PERSONNEL_MANAGE,r.TIME_VIEW,r.TIME_MANAGE,r.SUPPLIERS_VIEW,r.SUPPLIERS_MANAGE,r.PURCHASE_VIEW,r.PURCHASE_MANAGE,r.MATERIALS_VIEW,r.MATERIALS_MANAGE,r.FRAGRANCES_VIEW,r.FRAGRANCES_MANAGE,r.PRODUCTS_VIEW,r.PRODUCTS_MANAGE,r.WORK_ORDERS_VIEW,r.WORK_ORDERS_MANAGE,r.INVENTORY_VIEW,r.INVENTORY_MANAGE,r.INVENTORY_RECORDS_VIEW,r.COST_VIEW,r.TIME_REPORTS_VIEW,r.ROLES_MANAGE,r.SYSTEM_SETTINGS}},function(e){e.O(0,[3609,9015,3676,5569,4438,9436,3909,2696,5184,8236,3145,1096,2365,2971,2117,1744],function(){return e(e.s=55522)}),_N_E=e.O()}]);