(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6473],{48862:function(e,t,s){Promise.resolve().then(s.bind(s,32169))},32169:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return R}});var a=s(57437),r=s(2265),l=s(99376),i=s(5978),n=s(46410),c=s(1850),d=s(14438),o=s(16275),m=s(90740),x=s(60044),u=s(92369),h=s(42208),p=s(31047),b=s(92451),g=s(10407),f=s(73247),j=s(32489),N=s(44794),v=s(66927),y=s(99397),w=s(33804),k=s(12381),C=s(69174),z=s(40279),S=s(68245),Z=s(79820),I=s(74291);function A(){let e=(0,l.useRouter)(),[t,s]=(0,r.useState)([]),[A,R]=(0,r.useState)([]),[O,P]=(0,r.useState)(!0),[D,E]=(0,r.useState)("all"),[L,q]=(0,r.useState)(1),[M]=(0,r.useState)(10),[U,$]=(0,r.useState)(""),[_,T]=(0,r.useState)([]),[V,B]=(0,r.useState)(!1),[F,Y]=(0,r.useState)([]),[W,K]=(0,r.useState)([]),[X,J]=(0,r.useState)([]),[G,H]=(0,r.useState)("items"),[Q,ee]=(0,r.useState)([]),[et,es]=(0,r.useState)(new Set),[ea,er]=(0,r.useState)(!1),[el,ei]=(0,r.useState)(!1),en=(0,r.useCallback)(async()=>{P(!0);try{if(!n.db)throw Error("Firebase 未初始化");let e=new Map,t=new Map;(await (0,i.getDocs)((0,i.collection)(n.db,"suppliers"))).forEach(t=>e.set(t.id,t.data().name)),(await (0,i.getDocs)((0,i.collection)(n.db,"users"))).forEach(e=>t.set(e.id,e.data().name));let a=(await (0,i.getDocs)((0,i.collection)(n.db,"purchaseOrders"))).docs.map(s=>{var a,r,l;let i=s.data(),n=(null===(a=i.createdAt)||void 0===a?void 0:a.toDate().toLocaleDateString("zh-TW",{year:"numeric",month:"long",day:"numeric"}))||"N/A";return{id:s.id,code:i.code,supplierName:e.get(null===(r=i.supplierRef)||void 0===r?void 0:r.id)||"未知供應商",status:i.status,createdByName:t.get(null===(l=i.createdByRef)||void 0===l?void 0:l.id)||"未知人員",createdAt:n}});s(a.sort((e,t)=>t.code.localeCompare(e.code)))}catch(e){console.error("讀取採購單資料失敗:",e),d.Am.error("讀取採購單資料失敗。")}finally{P(!1)}},[]),ec=(0,r.useCallback)(async()=>{try{if(!n.db)throw Error("Firebase 未初始化");let e=await (0,i.getDocs)((0,i.collection)(n.db,"suppliers")),t=e.docs.map(e=>({id:e.id,name:e.data().name}));J(t);let s=new Map;e.forEach(e=>s.set(e.id,e.data().name));let a=(await (0,i.getDocs)((0,i.collection)(n.db,"materials"))).docs.map(e=>{var t,a;let r=e.data();return{id:e.id,name:r.name,code:r.code,type:"material",supplierId:(null===(t=r.supplierRef)||void 0===t?void 0:t.id)||"",supplierName:(null===(a=r.supplierRef)||void 0===a?void 0:a.id)?s.get(r.supplierRef.id)||"未知供應商":"未指定",unit:r.unit||"",costPerUnit:r.costPerUnit||0,currentStock:r.currentStock||0}}),r=(await (0,i.getDocs)((0,i.collection)(n.db,"fragrances"))).docs.map(e=>{var t,a;let r=e.data();return{id:e.id,name:r.name,code:r.code,type:"fragrance",supplierId:(null===(t=r.supplierRef)||void 0===t?void 0:t.id)||"",supplierName:(null===(a=r.supplierRef)||void 0===a?void 0:a.id)?s.get(r.supplierRef.id)||"未知供應商":"未指定",unit:r.unit||"KG",costPerUnit:r.costPerUnit||0,currentStock:r.currentStock||0}});Y(a),K(r)}catch(e){console.error("載入物料和香精資料失敗:",e),d.Am.error("載入物料和香精資料失敗。")}},[]),ed=(0,r.useCallback)(()=>{try{let e=localStorage.getItem("purchaseCart");e&&ee(JSON.parse(e))}catch(e){console.error("載入採購車失敗:",e)}},[]),eo=(0,r.useCallback)(e=>{try{localStorage.setItem("purchaseCart",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("purchaseCartUpdated"))}catch(e){console.error("保存採購車失敗:",e)}},[]),em=(0,r.useCallback)(e=>{if($(e),!e.trim()){T([]);return}"suppliers"===G?T(X.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())).sort((e,t)=>e.name.localeCompare(t.name,"zh-TW")).slice(0,10).map(e=>({id:e.id,name:e.name,code:"",type:"supplier",supplierId:e.id,supplierName:e.name,unit:"",costPerUnit:0,currentStock:0}))):T([...F,...W].filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.code.toLowerCase().includes(e.toLowerCase())||t.supplierName.toLowerCase().includes(e.toLowerCase())).sort((e,t)=>e.name.localeCompare(t.name,"zh-TW")).slice(0,10))},[F,W,X,G]),ex=(0,r.useCallback)(e=>{if("supplier"===e.type){let t=[...F,...W].filter(t=>t.supplierId===e.supplierId);if(t.length>0){T(t.slice(0,10)),H("items"),d.Am.success("顯示 ".concat(e.name," 供應商的所有項目"));return}d.Am.info("供應商 ".concat(e.name," 目前沒有物料或香精"));return}if("material"===e.type||"fragrance"===e.type){if(Q.find(t=>t.id===e.id&&t.type===e.type)){let t=Q.map(t=>t.id===e.id&&t.type===e.type?{...t,quantity:t.quantity+1}:t);ee(t),eo(t),d.Am.success("已增加 ".concat(e.name," 的數量"))}else{let t=[...Q,{id:e.id,name:e.name,code:e.code,type:e.type,supplierId:e.supplierId,supplierName:e.supplierName,unit:e.unit,costPerUnit:e.costPerUnit,quantity:1}];ee(t),eo(t),d.Am.success("已將 ".concat(e.name," 加入採購車"))}}},[Q,eo,F,W]),eu=(0,r.useCallback)((e,t)=>{let s=Q.filter(s=>!(s.id===e&&s.type===t));ee(s),eo(s),d.Am.success("已從採購車移除")},[Q,eo]),eh=(0,r.useCallback)((e,t,s)=>{if(s<=0){eu(e,t);return}let a=Q.map(a=>a.id===e&&a.type===t?{...a,quantity:s}:a);ee(a),eo(a)},[Q,eu,eo]),ep=(0,r.useCallback)((e,t)=>{let s="".concat(e,"-").concat(t);es(e=>{let t=new Set(e);return t.has(s)?t.delete(s):t.add(s),t})},[]),eb=(0,r.useCallback)(e=>{let t=Q.filter(t=>t.supplierId===e).map(e=>"".concat(e.id,"-").concat(e.type));es(e=>{let s=new Set(e);return t.every(e=>s.has(e))?t.forEach(e=>s.delete(e)):t.forEach(e=>s.add(e)),s})},[Q]),eg=(0,r.useCallback)(()=>{ei(!0)},[]),ef=(0,r.useCallback)(async()=>{er(!0);let e=d.Am.loading("正在建立採購單...");try{let t;let s=(0,c.$C)(),a=(0,c.V1)(s,"createPurchaseOrders");if(t=0===et.size?Q:Q.filter(e=>et.has("".concat(e.id,"-").concat(e.type))),0===t.length){d.Am.error("沒有項目可以建立採購單",{id:e});return}let r=t.reduce((e,t)=>(e[t.supplierId]||(e[t.supplierId]={supplierId:t.supplierId,items:[]}),e[t.supplierId].items.push({id:t.id,name:t.name,code:t.code,quantity:t.quantity,unit:t.unit,itemRefPath:"".concat("material"===t.type?"materials":"fragrances","/").concat(t.id)}),e),{}),l={suppliers:Object.values(r)};await a(l),d.Am.success("成功建立 ".concat(Object.keys(r).length," 張採購單"),{id:e});let i=Q.filter(e=>!t.some(t=>t.id===e.id&&t.type===e.type));ee(i),eo(i),es(new Set),ei(!1),en()}catch(t){console.error("建立採購單失敗:",t),d.Am.error("建立採購單失敗",{id:e})}finally{er(!1)}},[et,Q,en,eo]),ej=(0,r.useMemo)(()=>{let e="all"===D?t:t.filter(e=>e.status===D),s=(L-1)*M;return e.slice(s,s+M)},[t,D,L,M]),eN=(0,r.useMemo)(()=>Math.ceil(("all"===D?t:t.filter(e=>e.status===D)).length/M),[t,D,M]),ev=(0,r.useMemo)(()=>{let e={};return Q.forEach(t=>{e[t.supplierId]||(e[t.supplierId]={supplierId:t.supplierId,supplierName:t.supplierName||"未指定供應商",items:[]}),e[t.supplierId].items.push(t)}),Object.values(e)},[Q]),ey=(0,r.useMemo)(()=>Q.reduce((e,t)=>e+t.costPerUnit*t.quantity,0),[Q]);return(0,r.useEffect)(()=>{en(),ec(),ed()},[en,ec,ed]),(0,r.useEffect)(()=>{q(1)},[D]),(0,a.jsxs)("div",{className:"container mx-auto py-10 purchase-orders-page",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent",children:"採購管理"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"管理採購訂單與供應商交易"})]}),(0,a.jsxs)(Z.Zb,{className:"mb-6",children:[(0,a.jsx)(Z.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 text-amber-600"}),(0,a.jsx)(Z.ll,{children:"採購清單"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["共 ",t.length," 張採購單"]})]})}),(0,a.jsxs)(Z.aY,{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 text-gray-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"狀態篩選："}),(0,a.jsx)(k.z,{variant:"all"===D?"default":"outline",size:"sm",onClick:()=>E("all"),className:"bg-amber-600 hover:bg-amber-700",children:"全部"}),(0,a.jsx)(k.z,{variant:"預報單"===D?"default":"outline",size:"sm",onClick:()=>E("預報單"),className:"預報單"===D?"bg-purple-600 hover:bg-purple-700":"border-purple-200 text-purple-600 hover:bg-purple-50",children:"預報單"}),(0,a.jsx)(k.z,{variant:"已訂購"===D?"default":"outline",size:"sm",onClick:()=>E("已訂購"),className:"已訂購"===D?"bg-green-600 hover:bg-green-700":"border-green-200 text-green-600 hover:bg-green-50",children:"已訂購"}),(0,a.jsx)(k.z,{variant:"已收貨"===D?"default":"outline",size:"sm",onClick:()=>E("已收貨"),className:"已收貨"===D?"bg-gray-600 hover:bg-gray-700":"border-gray-200 text-gray-600 hover:bg-gray-50",children:"已入庫"})]}),(0,a.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,a.jsxs)(w.iA,{children:[(0,a.jsx)(w.xD,{children:(0,a.jsxs)(w.SC,{children:[(0,a.jsx)(w.ss,{children:"採購單資訊"}),(0,a.jsx)(w.ss,{children:"供應商"}),(0,a.jsx)(w.ss,{children:"建立人員"}),(0,a.jsx)(w.ss,{children:"狀態"}),(0,a.jsx)(w.ss,{children:"採購金額"}),(0,a.jsx)(w.ss,{children:"操作"})]})}),(0,a.jsx)(w.RM,{children:O?(0,a.jsx)(w.SC,{children:(0,a.jsx)(w.pj,{colSpan:5,className:"text-center py-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-amber-200 border-t-amber-600 rounded-full animate-spin mr-2"}),"載入中..."]})})}):ej.length>0?ej.map(t=>(0,a.jsxs)(w.SC,{className:"hover:bg-amber-50/50 cursor-pointer",onClick:()=>e.push("/dashboard/purchase-orders/".concat(t.id)),children:[(0,a.jsx)(w.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(o.Z,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:t.code}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["ID: ",t.id]})]})]})}),(0,a.jsx)(w.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:t.supplierName})]})}),(0,a.jsx)(w.pj,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:t.createdByName})]})}),(0,a.jsx)(w.pj,{children:(0,a.jsx)(C.C,{className:"".concat("預報單"===t.status?"bg-purple-100 text-purple-800":"已訂購"===t.status?"bg-green-100 text-green-800":"已收貨"===t.status?"bg-gray-600 text-white":"已取消"===t.status?"bg-red-100 text-red-800":"bg-gray-600 text-white"),children:t.status})}),(0,a.jsx)(w.pj,{children:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm font-semibold text-amber-600",children:["NT$ ",t.totalAmount?t.totalAmount.toLocaleString():"0"]})})}),(0,a.jsx)(w.pj,{onClick:e=>e.stopPropagation(),children:(0,a.jsxs)(k.z,{variant:"ghost",size:"sm",onClick:()=>e.push("/dashboard/purchase-orders/".concat(t.id)),className:"text-amber-600 hover:text-amber-700",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-1"}),"查看"]})})]},t.id)):(0,a.jsx)(w.SC,{children:(0,a.jsx)(w.pj,{colSpan:5,className:"text-center py-8",children:(0,a.jsx)("div",{className:"text-gray-500",children:"all"===D?"沒有採購單資料":"沒有".concat(D,"狀態的採購單")})})})})]})}),(0,a.jsx)("div",{className:"md:hidden",children:O?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 border-2 border-amber-200 border-t-amber-600 rounded-full animate-spin"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"載入中..."})]})}):ej.length>0?(0,a.jsx)("div",{className:"space-y-4",children:ej.map(t=>(0,a.jsxs)("div",{onClick:()=>e.push("/dashboard/purchase-orders/".concat(t.id)),className:"bg-white border border-amber-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-all duration-200 cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-600 rounded-lg flex items-center justify-center shrink-0",children:(0,a.jsx)(o.Z,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900 text-lg mb-1 truncate",children:t.code}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,a.jsx)(p.Z,{className:"inline h-3 w-3 mr-1"}),t.createdAt]})]})]}),(0,a.jsx)(C.C,{className:"shrink-0 ml-2 ".concat("預報單"===t.status?"bg-purple-100 text-purple-800":"已訂購"===t.status?"bg-green-100 text-green-800":"已收貨"===t.status?"bg-gray-600 text-white":"已取消"===t.status?"bg-red-100 text-red-800":"bg-gray-600 text-white"),children:t.status})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-blue-50 rounded-lg",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-blue-600 shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"text-xs text-blue-600 font-medium mb-1",children:"供應商"}),(0,a.jsx)("div",{className:"text-sm font-semibold text-blue-800 truncate",children:t.supplierName})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(u.Z,{className:"h-3 w-3 text-gray-500"}),(0,a.jsx)("span",{className:"text-xs text-gray-600 font-medium",children:"建立人員"})]}),(0,a.jsx)("div",{className:"text-sm font-semibold text-gray-800 truncate",children:t.createdByName})]}),(0,a.jsxs)("div",{className:"p-3 bg-amber-50 rounded-lg",children:[(0,a.jsx)("div",{className:"text-xs text-amber-600 font-medium mb-1",children:"採購金額"}),(0,a.jsxs)("div",{className:"text-sm font-bold text-amber-800",children:["NT$ ",t.totalAmount?t.totalAmount.toLocaleString():"0"]})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end mt-4 pt-3 border-t border-gray-100",children:(0,a.jsxs)(k.z,{onClick:s=>{s.stopPropagation(),e.push("/dashboard/purchase-orders/".concat(t.id))},className:"bg-gradient-to-r from-amber-500 to-orange-600 hover:from-amber-600 hover:to-orange-700 text-white px-4 py-2 rounded-lg font-medium shadow-sm hover:shadow transition-all duration-200 min-h-[44px]",children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"檢視採購單"]})})]},t.id))}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(o.Z,{className:"h-8 w-8 text-amber-500"})}),(0,a.jsx)("div",{className:"text-lg font-medium text-gray-800 mb-2",children:"all"===D?"沒有採購單資料":"沒有".concat(D,"狀態的採購單")}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"建立第一個採購單開始管理採購流程"})]})}),eN>1&&(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-4",children:[(0,a.jsx)(k.z,{variant:"outline",size:"sm",onClick:()=>q(e=>Math.max(1,e-1)),disabled:1===L,className:"border-amber-200 text-amber-600 hover:bg-amber-50",children:(0,a.jsx)(b.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["第 ",L," 頁，共 ",eN," 頁"]}),(0,a.jsx)(k.z,{variant:"outline",size:"sm",onClick:()=>q(e=>Math.min(eN,e+1)),disabled:L===eN,className:"border-amber-200 text-amber-600 hover:bg-amber-50",children:(0,a.jsx)(g.Z,{className:"h-4 w-4"})})]})]})]}),(0,a.jsxs)(Z.Zb,{className:"mb-6",children:[(0,a.jsx)(Z.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.Z,{className:"h-5 w-5 text-amber-600"}),(0,a.jsx)(Z.ll,{children:"搜尋物料與香精"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.z,{variant:"items"===G?"default":"outline",size:"sm",onClick:()=>{H("items"),T([]),$("")},className:"items"===G?"bg-amber-600 hover:bg-amber-700":"border-amber-200 text-amber-600 hover:bg-amber-50",children:"物料/香精"}),(0,a.jsx)(k.z,{variant:"suppliers"===G?"default":"outline",size:"sm",onClick:()=>{H("suppliers"),T([]),$("")},className:"suppliers"===G?"bg-amber-600 hover:bg-amber-700":"border-amber-200 text-amber-600 hover:bg-amber-50",children:"供應商"})]})]})}),(0,a.jsxs)(Z.aY,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(f.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(z.I,{placeholder:"suppliers"===G?"輸入供應商名稱搜尋...":"輸入物料名稱、代號、香精名稱或供應商名稱搜尋...",value:U,onChange:e=>em(e.target.value),className:"pl-10 pr-4 py-3 border-amber-200 focus:border-amber-500 focus:ring-amber-500"}),_.length>0&&(0,a.jsx)(k.z,{variant:"ghost",size:"sm",onClick:()=>{T([]),$("")},className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-8 w-8 p-0 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(j.Z,{className:"h-4 w-4"})})]}),_.length>0&&(0,a.jsxs)("div",{className:"mt-4 border border-amber-200 rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-amber-50 px-4 py-2 border-b border-amber-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-amber-800",children:["搜尋結果 (",_.length,")"]}),(0,a.jsx)("span",{className:"text-xs text-amber-600",children:"suppliers"===G?"供應商搜尋":"物料/香精搜尋"})]})}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto",children:_.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-amber-50/50 border-b border-amber-100 last:border-b-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center ".concat("material"===e.type?"bg-blue-100 text-blue-600":"fragrance"===e.type?"bg-pink-100 text-pink-600":"bg-green-100 text-green-600"),children:"material"===e.type?(0,a.jsx)(N.Z,{className:"h-4 w-4"}):"fragrance"===e.type?(0,a.jsx)(v.Z,{className:"h-4 w-4"}):(0,a.jsx)(x.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"supplier"===e.type?"供應商":"".concat(e.code," • ").concat(e.supplierName," • 庫存: ").concat(e.currentStock," ").concat(e.unit)})]})]}),(0,a.jsx)(k.z,{size:"sm",onClick:()=>ex(e),className:"supplier"===e.type?"bg-green-600 hover:bg-green-700 text-white":"bg-amber-600 hover:bg-amber-700 text-white",children:"supplier"===e.type?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.Z,{className:"h-4 w-4 mr-1"}),"查看項目"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.Z,{className:"h-4 w-4 mr-1"}),"加入採購車"]})})]},"".concat(e.id,"-").concat(e.type)))})]})]})]}),(0,a.jsxs)(Z.Zb,{children:[(0,a.jsx)(Z.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 text-amber-600"}),(0,a.jsx)(Z.ll,{children:"採購車"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["(",Q.length," 個項目，總計 NT$ ",ey.toLocaleString(),")"]})]}),Q.length>0&&(0,a.jsxs)(k.z,{onClick:eg,disabled:ea,className:"bg-amber-600 hover:bg-amber-700 text-white",children:[(0,a.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"建立採購單"]})]})}),(0,a.jsx)(Z.aY,{children:0===Q.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(o.Z,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),(0,a.jsx)("p",{children:"採購車是空的"}),(0,a.jsx)("p",{className:"text-sm",children:"使用上方的搜尋欄來添加物料或香精"})]}):(0,a.jsx)("div",{className:"space-y-6",children:ev.map(e=>(0,a.jsxs)("div",{className:"border border-amber-200 rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-amber-50 px-4 py-3 border-b border-amber-200",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(S.X,{checked:e.items.every(e=>et.has("".concat(e.id,"-").concat(e.type))),onCheckedChange:()=>eb(e.supplierId),className:"border-amber-300 data-[state=checked]:bg-amber-600 data-[state=checked]:border-amber-600"}),(0,a.jsx)(x.Z,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"font-medium text-amber-800",children:e.supplierName}),(0,a.jsxs)("span",{className:"text-sm text-amber-600",children:["(",e.items.length," 項)"]})]})}),(0,a.jsx)("div",{className:"divide-y divide-amber-100",children:e.items.map(e=>(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(S.X,{checked:et.has("".concat(e.id,"-").concat(e.type)),onCheckedChange:()=>ep(e.id,e.type),className:"border-amber-300 data-[state=checked]:bg-amber-600 data-[state=checked]:border-amber-600"}),(0,a.jsx)("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center ".concat("material"===e.type?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"),children:"material"===e.type?(0,a.jsx)(N.Z,{className:"h-4 w-4"}):(0,a.jsx)(v.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.code," • NT$ ",e.costPerUnit.toLocaleString(),"/",e.unit]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(k.z,{variant:"outline",size:"sm",onClick:()=>eh(e.id,e.type,e.quantity-1),className:"h-8 w-8 p-0 border-amber-200 text-amber-600 hover:bg-amber-50",children:"-"}),(0,a.jsx)(z.I,{type:"number",min:"1",value:e.quantity,onChange:t=>{let s=parseInt(t.target.value)||1;eh(e.id,e.type,s)},className:"w-16 h-8 text-center text-sm border-amber-200 focus:border-amber-500 focus:ring-amber-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:e.unit}),(0,a.jsx)(k.z,{variant:"outline",size:"sm",onClick:()=>eh(e.id,e.type,e.quantity+1),className:"h-8 w-8 p-0 border-amber-200 text-amber-600 hover:bg-amber-50",children:"+"})]}),(0,a.jsx)(k.z,{variant:"ghost",size:"sm",onClick:()=>eu(e.id,e.type),className:"h-8 w-8 p-0 text-red-500 hover:text-red-700 hover:bg-red-50",children:(0,a.jsx)(j.Z,{className:"h-4 w-4"})})]})]})},"".concat(e.id,"-").concat(e.type)))})]},e.supplierId))})})]}),(0,a.jsx)(I.Vq,{open:el,onOpenChange:ei,children:(0,a.jsxs)(I.cZ,{className:"max-w-2xl",children:[(0,a.jsxs)(I.fK,{children:[(0,a.jsx)(I.$N,{children:"確認建立採購單"}),(0,a.jsx)(I.Be,{children:"請確認以下項目將建立採購單"})]}),(0,a.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-3",children:(()=>{let e=(0===et.size?Q:Q.filter(e=>et.has("".concat(e.id,"-").concat(e.type)))).reduce((e,t)=>(e[t.supplierId]||(e[t.supplierId]={supplierName:t.supplierName,items:[]}),e[t.supplierId].items.push(t),e),{});return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["將建立 ",(0,a.jsx)("span",{className:"font-semibold text-amber-600",children:Object.keys(e).length})," 張採購單"]}),Object.entries(e).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{className:"border border-amber-200 rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-amber-50 px-3 py-2 border-b border-amber-200",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x.Z,{className:"h-4 w-4 text-blue-600"}),(0,a.jsx)("span",{className:"font-medium text-amber-800",children:s.supplierName}),(0,a.jsxs)("span",{className:"text-sm text-amber-600",children:["(",s.items.length," 項)"]})]})}),(0,a.jsx)("div",{className:"divide-y divide-amber-100",children:s.items.map(e=>(0,a.jsx)("div",{className:"p-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-lg flex items-center justify-center ".concat("material"===e.type?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600"),children:"material"===e.type?(0,a.jsx)(N.Z,{className:"h-3 w-3"}):(0,a.jsx)(v.Z,{className:"h-3 w-3"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[e.code," • NT$ ",e.costPerUnit.toLocaleString(),"/",e.unit]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"font-medium text-gray-900",children:[e.quantity," ",e.unit]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["NT$ ",(e.costPerUnit*e.quantity).toLocaleString()]})]})]})},"".concat(e.id,"-").concat(e.type)))})]},t)})]})})()}),(0,a.jsxs)(I.cN,{children:[(0,a.jsx)(k.z,{variant:"outline",onClick:()=>ei(!1),disabled:ea,children:"取消"}),(0,a.jsx)(k.z,{onClick:ef,disabled:ea,className:"bg-amber-600 hover:bg-amber-700 text-white",children:ea?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"建立中..."]}):"確認建立採購單"})]})]})})]})}function R(){return(0,a.jsx)(A,{})}},69174:function(e,t,s){"use strict";s.d(t,{C:function(){return c}});var a=s(57437);s(2265);var r=s(37053),l=s(90535),i=s(93448);let n=(0,l.j)("inline-flex items-center justify-center rounded-full px-2 py-1 text-xs font-medium focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"bg-blue-100 text-blue-700",secondary:"bg-muted text-muted-foreground",destructive:"bg-red-100 text-red-700",outline:"text-foreground border border-border",success:"bg-green-100 text-green-700",warning:"bg-yellow-100 text-yellow-700",purple:"bg-purple-100 text-purple-700"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:s,asChild:l=!1,...c}=e,d=l?r.g7:"span";return(0,a.jsx)(d,{"data-slot":"badge",className:(0,i.cn)(n({variant:s}),t),...c})}},79820:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return l},aY:function(){return d},eW:function(){return o},ll:function(){return n}});var a=s(57437);s(2265);var r=s(93448);function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-lg border-2 p-6 shadow-md",t),...s})}function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 has-data-[slot=card-action]:grid-cols-[1fr_auto]",t),...s})}function n(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...s})}function c(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}function d(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("",t),...s})}function o(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center",t),...s})}},68245:function(e,t,s){"use strict";s.d(t,{X:function(){return n}});var a=s(57437);s(2265);var r=s(9270),l=s(30401),i=s(93448);function n(e){let{className:t,...s}=e;return(0,a.jsx)(r.fC,{"data-slot":"checkbox",className:(0,i.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(r.z$,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(l.Z,{className:"size-3.5"})})})}},74291:function(e,t,s){"use strict";s.d(t,{$N:function(){return h},Be:function(){return p},Vq:function(){return c},cN:function(){return u},cZ:function(){return m},fK:function(){return x}});var a=s(57437),r=s(2265),l=s(49027),i=s(32489),n=s(93448);let c=l.fC;l.xz;let d=l.h_;l.x8;let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.aV,{ref:t,className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});o.displayName=l.aV.displayName;let m=r.forwardRef((e,t)=>{let{className:s,children:r,...c}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(o,{}),(0,a.jsxs)(l.VY,{ref:t,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-2xl translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-lg max-h-[90vh] overflow-y-auto","p-4 sm:p-6 mx-2 sm:mx-0","max-w-[calc(100vw-1rem)] sm:max-w-lg md:max-w-xl lg:max-w-2xl","max-h-[95vh] sm:max-h-[90vh]",s),...c,children:[r,(0,a.jsxs)(l.x8,{className:"absolute right-3 top-3 sm:right-4 sm:top-4 z-10 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground p-1",children:[(0,a.jsx)(i.Z,{className:"h-5 w-5 sm:h-4 sm:w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"關閉"})]})]})]})});m.displayName=l.VY.displayName;let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-1.5 text-center sm:text-left pb-4 border-b border-border",t),...s})};x.displayName="DialogHeader";let u=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end gap-2 sm:gap-0 sm:space-x-2 pt-4 border-t border-border","[&>*]:w-full sm:[&>*]:w-auto",t),...s})};u.displayName="DialogFooter";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.Dx,{ref:t,className:(0,n.cn)("text-xl sm:text-2xl font-bold flex items-center gap-2 sm:gap-3 leading-tight",s),...r})});h.displayName=l.Dx.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.dk,{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});p.displayName=l.dk.displayName},40279:function(e,t,s){"use strict";s.d(t,{I:function(){return i}});var a=s(57437),r=s(2265),l=s(93448);let i=r.forwardRef((e,t)=>{let{className:s,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex w-full rounded-md border border-slate-200 bg-white px-3 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-800 dark:bg-slate-950 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus-visible:ring-slate-300","h-11 sm:h-10 py-3 sm:py-2","text-base sm:text-sm","min-h-[44px]",s),ref:t,...i})});i.displayName="Input"},33804:function(e,t,s){"use strict";s.d(t,{RM:function(){return n},SC:function(){return c},iA:function(){return l},pj:function(){return o},ss:function(){return d},xD:function(){return i}});var a=s(57437);s(2265);var r=s(93448);function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,r.cn)("w-full caption-bottom text-sm",t),...s})})}function i(e){let{className:t,...s}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,r.cn)("",t),...s})}function n(e){let{className:t,...s}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,r.cn)("[&_tr:last-child]:border-0",t),...s})}function c(e){let{className:t,...s}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,r.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b border-border transition-colors",t),...s})}function d(e){let{className:t,...s}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,r.cn)("bg-muted text-foreground font-semibold border-b border-border p-3 text-left align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function o(e){let{className:t,...s}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,r.cn)("p-3 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}}},function(e){e.O(0,[3609,9015,3676,5569,4438,9436,4116,5532,2365,2971,2117,1744],function(){return e(e.s=48862)}),_N_E=e.O()}]);