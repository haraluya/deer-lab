(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2240],{62696:function(e,s,a){Promise.resolve().then(a.bind(a,34296))},67782:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]])},42208:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},90740:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},66337:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},99397:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},73247:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},98728:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},88906:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},15868:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},18930:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},92369:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},95805:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(79205).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},34296:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return U}});var t=a(57437),r=a(2265),l=a(5978),n=a(1850),i=a(46410),o=a(29501),d=a(13590),c=a(67119),u=a(71245),m=a(14438),x=a(92369),h=a(66337),f=a(12381),p=a(74291),g=a(80670),j=a(40279),N=a(15291);let v=c.Ry({name:c.Z_().min(2,{message:"姓名至少需要 2 個字元"}),employeeId:c.Z_().min(1,{message:"員工編號為必填欄位"}),phone:c.Z_().min(1,{message:"電話為必填欄位"}),role:c.Z_({required_error:"必須選擇一個角色"}),password:c.Z_().optional(),confirmPassword:c.Z_().optional(),status:c.Km(["active","inactive"])}).refine(e=>!e.password||!(e.password.length>0)||e.password===e.confirmPassword,{message:"密碼確認不匹配",path:["confirmPassword"]});function b(e){let{isOpen:s,onOpenChange:a,onPersonnelUpdate:c,personnelData:b}=e,{appUser:y,isLoading:w}=(0,u.a)(),[E,A]=(0,r.useState)(!1),[R,_]=(0,r.useState)([]),[S,I]=(0,r.useState)(!1),[C,k]=(0,r.useState)(!1),D=!!b,Z=(0,o.cI)({resolver:(0,d.F)(v),defaultValues:{name:"",employeeId:"",phone:"",role:"",password:"",confirmPassword:"",status:"active"}}),O=(0,r.useCallback)(async()=>{I(!0);try{if(!i.db)throw Error("Firebase 未初始化");let e=(0,l.collection)(i.db,"roles"),s=(await (0,l.getDocs)(e)).docs.map(e=>({id:e.id,name:e.data().name||"未知角色",description:e.data().description}));_(s),console.log("✅ 角色資料載入成功:",s)}catch(e){console.error("載入角色資料失敗:",e),m.Am.error("載入角色資料失敗，請重新整理頁面")}finally{I(!1)}},[]);(0,r.useEffect)(()=>{s&&O()},[s,O]),(0,r.useEffect)(()=>{if(s){if(b){var e;let s={name:b.name||"",employeeId:b.employeeId||"",phone:b.phone||"",role:(null===(e=b.roleRef)||void 0===e?void 0:e.id)||"",password:"",confirmPassword:"",status:b.status||"active"};console.log("\uD83D\uDCDD 載入編輯資料:",s),Z.reset(s)}else{let e={name:"",employeeId:"",phone:"",role:"",password:"",confirmPassword:"",status:"active"};console.log("\uD83D\uDCDD 重置為新增模式:",e),Z.reset(e)}}},[s,b,Z]);let M=async e=>{if(!D&&(!e.password||e.password.length<6)){m.Am.error("新增人員時密碼為必填欄位，且至少需要 6 個字元");return}A(!0);let s=m.Am.loading(D?"正在更新人員資料...":"正在建立新人員...");try{let t=(0,n.$C)();if(console.log("\uD83D\uDD27 準備調用 Firebase Functions..."),console.log("\uD83D\uDCCB 提交資料:",e),console.log("\uD83C\uDFAD 模式:",D?"編輯":"新增"),D&&b){console.log("\uD83D\uDCDD 調用 updatePersonnel...");let a=(0,n.V1)(t,"updatePersonnel"),r={personnelId:b.id,name:e.name,employeeId:e.employeeId,phone:e.phone,roleId:e.role,password:e.password||"",status:e.status};console.log("\uD83D\uDCE4 更新資料:",r);let l=await a(r);console.log("✅ updatePersonnel 成功:",l.data),m.Am.success("人員資料更新成功",{id:s})}else{console.log("\uD83D\uDCDD 調用 createPersonnel...");let a=(0,n.V1)(t,"createPersonnel"),r={name:e.name,employeeId:e.employeeId,phone:e.phone,roleId:e.role,password:e.password,status:e.status};console.log("\uD83D\uDCE4 建立資料:",r);let l=await a(r);console.log("✅ createPersonnel 成功:",l.data),m.Am.success("人員建立成功",{id:s})}c(),a(!1)}catch(a){console.error("操作失敗:",a);let e="操作失敗，請稍後再試。";(null==a?void 0:a.code)==="functions/unavailable"?e="服務暫時不可用，請稍後再試。":(null==a?void 0:a.code)==="functions/permission-denied"?e="權限不足，無法執行此操作。":(null==a?void 0:a.code)==="functions/unauthenticated"?e="請重新登入後再試。":(null==a?void 0:a.code)==="functions/invalid-argument"?e="輸入資料有誤，請檢查後再試。":(null==a?void 0:a.code)==="functions/not-found"?e="找不到指定的資料。":(null==a?void 0:a.code)==="functions/already-exists"?e="資料已存在，請使用其他資料。":(null==a?void 0:a.code)==="functions/resource-exhausted"?e="系統資源不足，請稍後再試。":(null==a?void 0:a.code)==="functions/failed-precondition"?e="操作條件不滿足，請檢查資料後再試。":(null==a?void 0:a.code)==="functions/aborted"?e="操作被中止，請稍後再試。":(null==a?void 0:a.code)==="functions/out-of-range"?e="輸入資料超出範圍，請檢查後再試。":(null==a?void 0:a.code)==="functions/unimplemented"?e="此功能尚未實作。":(null==a?void 0:a.code)==="functions/internal"?e="系統內部錯誤，請稍後再試。":(null==a?void 0:a.code)==="functions/data-loss"?e="資料遺失，請重新輸入。":(null==a?void 0:a.code)==="functions/unknown"?e="發生未知錯誤，請稍後再試。":(null==a?void 0:a.message)&&(e=a.message),m.Am.error(e,{id:s})}finally{A(!1)}};return w||S?(0,t.jsx)(p.Vq,{open:s,onOpenChange:a,children:(0,t.jsx)(p.cZ,{className:"max-w-2xl","aria-describedby":"loading-dialog-description",children:(0,t.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{id:"loading-dialog-description",className:"text-gray-600",children:"正在載入資料..."})]})})})}):(0,t.jsx)(p.Vq,{open:s,onOpenChange:a,children:(0,t.jsxs)(p.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto","aria-describedby":"personnel-dialog-description",children:[(0,t.jsxs)(p.fK,{children:[(0,t.jsxs)(p.$N,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Z,{className:"h-5 w-5"}),D?"編輯人員":"新增人員"]}),(0,t.jsx)(p.Be,{id:"personnel-dialog-description",children:D?"修改人員資料":"建立新的人員帳號"})]}),(0,t.jsx)(g.l0,{...Z,children:(0,t.jsxs)("form",{onSubmit:Z.handleSubmit(M),className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 text-blue-800",children:[(0,t.jsx)(x.Z,{className:"h-4 w-4"}),"基本資料"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(g.Wi,{control:Z.control,name:"name",render:e=>{let{field:s}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{children:"姓名 *"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(j.I,{placeholder:"請輸入姓名",...s})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:Z.control,name:"employeeId",render:e=>{let{field:s}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{children:"員工編號 *"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(j.I,{placeholder:"請輸入員工編號",...s})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:Z.control,name:"phone",render:e=>{let{field:s}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{className:"text-red-600 font-semibold",children:"電話 *"}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(j.I,{placeholder:"請輸入電話號碼",...s,className:"border-blue-300 focus:border-blue-500 focus:ring-blue-500"})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:Z.control,name:"role",render:e=>{let{field:s}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{children:"角色 *"}),(0,t.jsxs)(N.Ph,{onValueChange:s.onChange,value:s.value,disabled:S,children:[(0,t.jsx)(g.NI,{children:(0,t.jsx)(N.i4,{children:(0,t.jsx)(N.ki,{placeholder:S?"載入中...":"選擇角色"})})}),(0,t.jsx)(N.Bw,{children:R.map(e=>(0,t.jsx)(N.Ql,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:Z.control,name:"status",render:e=>{let{field:s}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsx)(g.lX,{children:"狀態"}),(0,t.jsxs)(N.Ph,{onValueChange:s.onChange,value:s.value,children:[(0,t.jsx)(g.NI,{children:(0,t.jsx)(N.i4,{children:(0,t.jsx)(N.ki,{placeholder:"選擇狀態"})})}),(0,t.jsxs)(N.Bw,{children:[(0,t.jsx)(N.Ql,{value:"active",children:"啟用"}),(0,t.jsx)(N.Ql,{value:"inactive",children:"停用"})]})]}),(0,t.jsx)(g.zG,{})]})}})]})]}),(0,t.jsxs)("div",{className:"space-y-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2 text-green-800",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4"}),"密碼設定"]}),D&&(0,t.jsx)(f.z,{type:"button",variant:"outline",size:"sm",onClick:()=>k(!C),children:C?"隱藏密碼欄位":"修改密碼"})]}),(!D||C)&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(g.Wi,{control:Z.control,name:"password",render:e=>{let{field:s}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsxs)(g.lX,{children:["密碼 ",D?"":"*"]}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(j.I,{type:"password",placeholder:D?"留空表示不修改":"請輸入密碼",...s})}),(0,t.jsx)(g.zG,{})]})}}),(0,t.jsx)(g.Wi,{control:Z.control,name:"confirmPassword",render:e=>{let{field:s}=e;return(0,t.jsxs)(g.xJ,{children:[(0,t.jsxs)(g.lX,{children:["確認密碼 ",D?"":"*"]}),(0,t.jsx)(g.NI,{children:(0,t.jsx)(j.I,{type:"password",placeholder:"請再次輸入密碼",...s})}),(0,t.jsx)(g.zG,{})]})}})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(f.z,{type:"button",variant:"outline",onClick:()=>a(!1),children:"取消"}),(0,t.jsx)(f.z,{type:"submit",disabled:E,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white",children:E?"處理中...":D?"更新":"新增"})]})]})})]})})}var y=a(25751),w=a(98728),E=a(99397),A=a(95805),R=a(49663);let _=(0,a(79205).Z)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);var S=a(88906),I=a(90740),C=a(73247),k=a(67782),D=a(42208),Z=a(15868),O=a(18930),M=a(1077),V=a(27648),P=a(33804),G=a(69174),T=a(79820),W=a(32060);function z(){let[e,s]=(0,r.useState)([]),[a,o]=(0,r.useState)([]),[d,c]=(0,r.useState)(!0),[u,h]=(0,r.useState)(""),[g,v]=(0,r.useState)("all"),[z,U]=(0,r.useState)("all"),{isAdmin:F}=(0,M.g)(),[L,Y]=(0,r.useState)(!1),[Q,X]=(0,r.useState)(!1),[H,K]=(0,r.useState)(!1),[q,J]=(0,r.useState)(null),[$,B]=(0,r.useState)(!1),[ee,es]=(0,r.useState)(null),[ea,et]=(0,r.useState)("add"),er=(0,r.useCallback)(async()=>{c(!0);try{if(!i.db)throw Error("Firebase 未初始化");let e=(0,l.collection)(i.db,"users"),a=await (0,l.getDocs)(e),t=await Promise.all(a.docs.map(async e=>{let s=e.data(),a=e.id,t="未設定",r=s.roleRef;if(r&&r instanceof l.my)try{let e=await (0,l.QT)(r);if(e.exists()){var n;t=(null===(n=e.data())||void 0===n?void 0:n.name)||"未知角色"}}catch(e){console.error("無法讀取角色資料 for user ".concat(a,":"),e),t="讀取失敗"}return{...s,id:a,uid:a,roleName:t}}));s(t),o(t)}catch(e){console.error("讀取人員資料失敗:",e),m.Am.error("讀取人員資料失敗，請檢查網路連線或聯絡管理員。")}finally{c(!1)}},[]);(0,r.useEffect)(()=>{let s=e;u&&(s=s.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())||e.employeeId.toLowerCase().includes(u.toLowerCase())||e.phone.includes(u))),"all"!==g&&(s=s.filter(e=>e.status===g)),"all"!==z&&(s=s.filter(e=>e.roleName===z)),o(s)},[e,u,g,z]);let el={total:e.length,active:e.filter(e=>"active"===e.status).length,inactive:e.filter(e=>"inactive"===e.status).length,roles:[...new Set(e.map(e=>e.roleName))].length};(0,r.useEffect)(()=>{er()},[er]);let en=e=>{et("edit"),es(e),Y(!0)},ei=e=>{es(e),X(!0)},eo=e=>{es(e),K(!0)},ed=e=>{J(e),B(!0)},ec=async()=>{if(!ee)return;let e="active"===ee.status?"inactive":"active",s=m.Am.loading("正在更新狀態...");try{let a=(0,n.$C)(),t=(0,n.V1)(a,"setUserStatus");await t({uid:ee.uid,status:e}),m.Am.success("員工狀態已成功更新。",{id:s}),er()}catch(a){console.error("變更狀態失敗:",a);let e="變更狀態時發生錯誤。";a instanceof Error&&(e=a.message),m.Am.error(e,{id:s})}finally{X(!1),es(null)}},eu=[...new Set(e.map(e=>e.roleName).filter(e=>"未設定"!==e))],em=async()=>{if(!ee)return;let e=m.Am.loading("正在刪除員工...");try{let s=(0,n.$C)(),a=(0,n.V1)(s,"deletePersonnel");await a({personnelId:ee.uid}),m.Am.success("員工已成功刪除。",{id:e}),er()}catch(a){console.error("刪除員工失敗:",a);let s="刪除員工時發生錯誤。";a instanceof Error&&(s=a.message),m.Am.error(s,{id:e})}finally{K(!1),es(null)}};return(0,t.jsxs)("div",{className:"container mx-auto py-6",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent",children:"成員管理"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2 text-lg",children:"管理團隊成員資訊與權限設定"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[F()&&(0,t.jsx)(V.default,{href:"/dashboard/personnel/permissions",children:(0,t.jsxs)(f.z,{variant:"outline",className:"gap-2 border-purple-200 text-purple-600 hover:bg-purple-50 hover:border-purple-300 shadow-sm hover:shadow-md transition-all duration-200",size:"lg",children:[(0,t.jsx)(w.Z,{className:"h-5 w-5"}),"權限管理"]})}),(0,t.jsxs)(f.z,{onClick:()=>{et("add"),es(null),Y(!0)},className:"gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 shadow-lg hover:shadow-xl transition-all duration-200",size:"lg",children:[(0,t.jsx)(E.Z,{className:"h-5 w-5"}),"新增成員"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,t.jsxs)(T.Zb,{className:"relative overflow-hidden bg-gradient-to-br from-blue-50 to-indigo-100 border-2 border-blue-200 hover:shadow-lg transition-all duration-300",children:[(0,t.jsx)(T.Ol,{className:"pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(T.ll,{className:"text-sm font-bold text-blue-800",children:"總成員"}),(0,t.jsx)("div",{className:"p-2 bg-blue-500 rounded-lg",children:(0,t.jsx)(A.Z,{className:"h-4 w-4 text-white"})})]})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-blue-900",children:el.total}),(0,t.jsx)("p",{className:"text-xs text-blue-600 font-medium",children:"位團隊成員"})]})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent to-blue-600/10 pointer-events-none"})]}),(0,t.jsxs)(T.Zb,{className:"relative overflow-hidden bg-gradient-to-br from-green-50 to-emerald-100 border-2 border-green-200 hover:shadow-lg transition-all duration-300",children:[(0,t.jsx)(T.Ol,{className:"pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(T.ll,{className:"text-sm font-bold text-green-800",children:"活躍成員"}),(0,t.jsx)("div",{className:"p-2 bg-green-500 rounded-lg",children:(0,t.jsx)(R.Z,{className:"h-4 w-4 text-white"})})]})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-green-900",children:el.active}),(0,t.jsx)("p",{className:"text-xs text-green-600 font-medium",children:"位在職成員"})]})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent to-green-600/10 pointer-events-none"})]}),(0,t.jsxs)(T.Zb,{className:"relative overflow-hidden bg-gradient-to-br from-red-50 to-pink-100 border-2 border-red-200 hover:shadow-lg transition-all duration-300",children:[(0,t.jsx)(T.Ol,{className:"pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(T.ll,{className:"text-sm font-bold text-red-800",children:"停用帳號"}),(0,t.jsx)("div",{className:"p-2 bg-red-500 rounded-lg",children:(0,t.jsx)(_,{className:"h-4 w-4 text-white"})})]})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-red-900",children:el.inactive}),(0,t.jsx)("p",{className:"text-xs text-red-600 font-medium",children:"位停用帳號"})]})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent to-red-600/10 pointer-events-none"})]}),(0,t.jsxs)(T.Zb,{className:"relative overflow-hidden bg-gradient-to-br from-purple-50 to-violet-100 border-2 border-purple-200 hover:shadow-lg transition-all duration-300",children:[(0,t.jsx)(T.Ol,{className:"pb-2",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(T.ll,{className:"text-sm font-bold text-purple-800",children:"角色類型"}),(0,t.jsx)("div",{className:"p-2 bg-purple-500 rounded-lg",children:(0,t.jsx)(S.Z,{className:"h-4 w-4 text-white"})})]})}),(0,t.jsx)(T.aY,{children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"text-3xl font-bold text-purple-900",children:el.roles}),(0,t.jsx)("p",{className:"text-xs text-purple-600 font-medium",children:"種權限角色"})]})}),(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent to-purple-600/10 pointer-events-none"})]})]}),(0,t.jsxs)(T.Zb,{className:"mb-6",children:[(0,t.jsx)(T.Ol,{children:(0,t.jsxs)(T.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(I.Z,{className:"h-5 w-5"}),"搜尋與篩選"]})}),(0,t.jsxs)(T.aY,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"搜尋成員"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(j.I,{placeholder:"姓名、工號、電話...",value:u,onChange:e=>h(e.target.value),className:"pl-10 bg-white border-2 border-gray-200 focus:border-blue-500"}),(0,t.jsx)(C.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"帳號狀態"}),(0,t.jsxs)(N.Ph,{value:g,onValueChange:v,children:[(0,t.jsx)(N.i4,{className:"bg-white border-2 border-gray-200 focus:border-blue-500",children:(0,t.jsx)(N.ki,{})}),(0,t.jsxs)(N.Bw,{children:[(0,t.jsx)(N.Ql,{value:"all",children:"全部狀態"}),(0,t.jsx)(N.Ql,{value:"active",children:"活躍"}),(0,t.jsx)(N.Ql,{value:"inactive",children:"停用"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"角色權限"}),(0,t.jsxs)(N.Ph,{value:z,onValueChange:U,children:[(0,t.jsx)(N.i4,{className:"bg-white border-2 border-gray-200 focus:border-blue-500",children:(0,t.jsx)(N.ki,{})}),(0,t.jsxs)(N.Bw,{children:[(0,t.jsx)(N.Ql,{value:"all",children:"全部角色"}),eu.map(e=>(0,t.jsx)(N.Ql,{value:e,children:e},e))]})]})]})]}),(u||"all"!==g||"all"!==z)&&(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["顯示 ",a.length," 位成員，共 ",e.length," 位"]}),(0,t.jsx)(f.z,{variant:"ghost",size:"sm",onClick:()=>{h(""),v("all"),U("all")},className:"text-gray-500 hover:text-gray-700",children:"清除篩選"})]})]})]}),(0,t.jsxs)(T.Zb,{children:[(0,t.jsx)(T.Ol,{children:(0,t.jsxs)(T.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(A.Z,{className:"h-5 w-5"}),"成員列表"]})}),(0,t.jsx)(T.aY,{children:d?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("div",{className:"w-10 h-10 border-4 border-blue-200 rounded-full animate-spin"}),(0,t.jsx)("div",{className:"absolute top-0 left-0 w-10 h-10 border-4 border-transparent border-t-blue-600 rounded-full animate-spin"})]}),(0,t.jsx)("span",{className:"mt-3 text-sm text-gray-600 font-medium",children:"載入中..."})]}):0===a.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(A.Z,{className:"h-12 w-12 mx-auto text-gray-300 mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:u||"all"!==g||"all"!==z?"找不到符合條件的成員":"尚無成員資料"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,t.jsxs)(P.iA,{children:[(0,t.jsx)(P.xD,{children:(0,t.jsxs)(P.SC,{className:"bg-gray-50",children:[(0,t.jsx)(P.ss,{className:"font-semibold text-gray-700",children:"成員資訊"}),(0,t.jsx)(P.ss,{className:"font-semibold text-gray-700",children:"工號"}),(0,t.jsx)(P.ss,{className:"font-semibold text-gray-700",children:"角色"}),(0,t.jsx)(P.ss,{className:"font-semibold text-gray-700",children:"狀態"}),(0,t.jsx)(P.ss,{className:"font-semibold text-gray-700",children:"聯絡方式"}),(0,t.jsx)(P.ss,{className:"text-right font-semibold text-gray-700",children:"操作"})]})}),(0,t.jsx)(P.RM,{children:a.map(e=>(0,t.jsxs)(P.SC,{className:"hover:bg-blue-50/50 transition-colors",children:[(0,t.jsx)(P.pj,{children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold",children:e.name.charAt(0).toUpperCase()}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:e.name}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"系統用戶"})]})]})}),(0,t.jsx)(P.pj,{children:(0,t.jsx)(G.C,{variant:"outline",className:"bg-gray-50",children:e.employeeId})}),(0,t.jsx)(P.pj,{children:(0,t.jsx)(G.C,{variant:"outline",className:"".concat("管理員"===e.roleName?"bg-purple-50 text-purple-700 border-purple-200":"主管"===e.roleName?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"),children:e.roleName})}),(0,t.jsx)(P.pj,{children:(0,t.jsx)(G.C,{variant:"active"===e.status?"default":"destructive",className:"active"===e.status?"bg-green-100 text-green-800 border-green-200":"bg-red-100 text-red-800 border-red-200",children:"active"===e.status?"活躍":"停用"})}),(0,t.jsx)(P.pj,{children:(0,t.jsx)("div",{className:"text-sm text-gray-600",children:e.phone||"未設定"})}),(0,t.jsx)(P.pj,{className:"text-right",children:(0,t.jsxs)(W.h_,{children:[(0,t.jsx)(W.$F,{asChild:!0,children:(0,t.jsxs)(f.z,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-gray-100",children:[(0,t.jsx)("span",{className:"sr-only",children:"開啟選單"}),(0,t.jsx)(k.Z,{className:"h-4 w-4"})]})}),(0,t.jsxs)(W.AW,{align:"end",className:"w-48",children:[(0,t.jsx)(W.Ju,{children:"操作選單"}),(0,t.jsx)(W.VD,{}),(0,t.jsxs)(W.Xi,{onClick:()=>ed(e),className:"gap-2",children:[(0,t.jsx)(D.Z,{className:"h-4 w-4"}),"查看詳情"]}),(0,t.jsxs)(W.Xi,{onClick:()=>en(e),className:"gap-2",children:[(0,t.jsx)(Z.Z,{className:"h-4 w-4"}),"編輯資訊"]}),(0,t.jsxs)(W.Xi,{onClick:()=>ei(e),className:"gap-2",children:["active"===e.status?(0,t.jsx)(_,{className:"h-4 w-4"}):(0,t.jsx)(R.Z,{className:"h-4 w-4"}),"active"===e.status?"停用帳號":"啟用帳號"]}),(0,t.jsx)(W.VD,{}),(0,t.jsxs)(W.Xi,{onClick:()=>eo(e),className:"gap-2 text-red-600 focus:text-red-600 focus:bg-red-50",children:[(0,t.jsx)(O.Z,{className:"h-4 w-4"}),"刪除成員"]})]})]})})]},e.uid))})]})}),(0,t.jsx)("div",{className:"md:hidden space-y-3",children:a.map(e=>(0,t.jsx)(T.Zb,{className:"overflow-hidden hover:shadow-md transition-shadow",children:(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-bold",children:e.name.charAt(0).toUpperCase()}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["工號: ",e.employeeId]})]})]})}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)(G.C,{variant:"active"===e.status?"default":"destructive",className:"text-xs mb-1 ".concat("active"===e.status?"bg-green-100 text-green-800 border-green-200":"bg-red-100 text-red-800 border-red-200"),children:"active"===e.status?"活躍":"停用"})})]}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"角色："}),(0,t.jsx)(G.C,{variant:"outline",className:"text-xs ".concat("管理員"===e.roleName?"bg-purple-50 text-purple-700 border-purple-200":"主管"===e.roleName?"bg-blue-50 text-blue-700 border-blue-200":"bg-gray-50 text-gray-700 border-gray-200"),children:e.roleName})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"聯絡："}),(0,t.jsx)("span",{className:"text-gray-900 font-medium",children:e.phone||"未設定"})]})]}),(0,t.jsxs)("div",{className:"flex gap-2 mt-4 pt-3 border-t border-gray-100",children:[(0,t.jsxs)(f.z,{variant:"outline",size:"sm",onClick:()=>ed(e),className:"flex-1 gap-1 text-xs hover:bg-blue-50 hover:border-blue-200",children:[(0,t.jsx)(D.Z,{className:"h-3 w-3"}),"查看"]}),(0,t.jsxs)(f.z,{variant:"outline",size:"sm",onClick:()=>en(e),className:"flex-1 gap-1 text-xs hover:bg-green-50 hover:border-green-200",children:[(0,t.jsx)(Z.Z,{className:"h-3 w-3"}),"編輯"]}),(0,t.jsxs)(W.h_,{children:[(0,t.jsx)(W.$F,{asChild:!0,children:(0,t.jsx)(f.z,{variant:"outline",size:"sm",className:"px-2 hover:bg-gray-100",children:(0,t.jsx)(k.Z,{className:"h-3 w-3"})})}),(0,t.jsxs)(W.AW,{align:"end",className:"w-48",children:[(0,t.jsx)(W.Ju,{children:"更多操作"}),(0,t.jsx)(W.VD,{}),(0,t.jsxs)(W.Xi,{onClick:()=>ei(e),className:"gap-2",children:["active"===e.status?(0,t.jsx)(_,{className:"h-4 w-4"}):(0,t.jsx)(R.Z,{className:"h-4 w-4"}),"active"===e.status?"停用帳號":"啟用帳號"]}),(0,t.jsx)(W.VD,{}),(0,t.jsxs)(W.Xi,{onClick:()=>eo(e),className:"gap-2 text-red-600 focus:text-red-600 focus:bg-red-50",children:[(0,t.jsx)(O.Z,{className:"h-4 w-4"}),"刪除成員"]})]})]})]})]})},e.uid))})]})})]}),(0,t.jsx)(b,{isOpen:L,onOpenChange:Y,onPersonnelUpdate:er,personnelData:"edit"===ea?ee:null}),ee&&(0,t.jsx)(y.Q,{isOpen:Q,onOpenChange:X,onConfirm:ec,title:"確認變更狀態",description:"您確定要將員工「".concat(ee.name||"N/A","」的狀態變更為「").concat("active"===ee.status?"停用":"在職","」嗎？此操作將會影響該員工的登入權限。")}),ee&&(0,t.jsx)(y.Q,{isOpen:H,onOpenChange:K,onConfirm:em,title:"確認刪除員工",description:"您確定要永久刪除員工「".concat(ee.name||"N/A","」嗎？此操作無法復原，將會刪除所有相關資料。")}),q&&(0,t.jsx)(p.Vq,{open:$,onOpenChange:B,children:(0,t.jsxs)(p.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-white",children:[(0,t.jsxs)(p.fK,{className:"pb-4 border-b border-gray-200",children:[(0,t.jsxs)(p.$N,{className:"flex items-center gap-3 text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:(0,t.jsx)(x.Z,{className:"h-5 w-5 text-white"})}),"員工詳情"]}),(0,t.jsxs)("p",{className:"text-gray-600 mt-2",children:["工號: ",q.employeeId]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-6 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold flex items-center gap-3 text-blue-800",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(x.Z,{className:"h-4 w-4 text-blue-600"})}),"基本資訊"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-gray-700",children:"姓名"}),(0,t.jsx)("div",{className:"text-lg font-medium text-gray-900",children:q.name||"-"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-gray-700",children:"工號"}),(0,t.jsx)("div",{className:"text-lg font-medium text-gray-900",children:q.employeeId||"-"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-gray-700",children:"電話"}),(0,t.jsx)("div",{className:"text-lg font-medium text-gray-900",children:q.phone||"-"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-gray-700",children:"狀態"}),(0,t.jsx)("div",{className:"text-lg",children:(0,t.jsx)(G.C,{variant:"active"===q.status?"default":"secondary",children:"active"===q.status?"啟用":"停用"})})]})]})]}),(0,t.jsxs)("div",{className:"space-y-6 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200 shadow-sm",children:[(0,t.jsxs)("h3",{className:"text-xl font-bold flex items-center gap-3 text-purple-800",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(S.Z,{className:"h-4 w-4 text-purple-600"})}),"權限資訊"]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-gray-700",children:"角色"}),(0,t.jsx)("div",{className:"text-lg font-medium text-gray-900",children:q.roleName||"未設定"})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[(0,t.jsx)(f.z,{variant:"outline",onClick:()=>B(!1),className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"關閉"}),(0,t.jsxs)(f.z,{onClick:()=>{B(!1),en(q)},className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[(0,t.jsx)(Z.Z,{className:"mr-2 h-4 w-4"}),"編輯"]})]})]})})]})}function U(){return(0,t.jsx)(z,{})}},79820:function(e,s,a){"use strict";a.d(s,{Ol:function(){return n},SZ:function(){return o},Zb:function(){return l},aY:function(){return d},eW:function(){return c},ll:function(){return i}});var t=a(57437);a(2265);var r=a(93448);function l(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-lg border-2 p-6 shadow-md",s),...a})}function n(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 has-data-[slot=card-action]:grid-cols-[1fr_auto]",s),...a})}function i(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",s),...a})}function o(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("",s),...a})}function c(e){let{className:s,...a}=e;return(0,t.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center",s),...a})}},15291:function(e,s,a){"use strict";a.d(s,{Bw:function(){return f},Ph:function(){return c},Ql:function(){return p},i4:function(){return m},ki:function(){return u}});var t=a(57437),r=a(2265),l=a(33911),n=a(40875),i=a(22135),o=a(30401),d=a(93448);let c=l.fC;l.ZA;let u=l.B4,m=r.forwardRef((e,s)=>{let{className:a,children:r,...i}=e;return(0,t.jsxs)(l.xz,{ref:s,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-slate-800 dark:bg-slate-950 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus:ring-slate-300",a),...i,children:[r,(0,t.jsx)(l.JO,{asChild:!0,children:(0,t.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=l.xz.displayName;let x=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.u_,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,t.jsx)(i.Z,{className:"h-4 w-4"})})});x.displayName=l.u_.displayName;let h=r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.$G,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",a),...r,children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})})});h.displayName=l.$G.displayName;let f=r.forwardRef((e,s)=>{let{className:a,children:r,position:n="popper",...i}=e;return(0,t.jsx)(l.h_,{children:(0,t.jsxs)(l.VY,{ref:s,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 bg-white text-slate-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:n,...i,children:[(0,t.jsx)(x,{}),(0,t.jsx)(l.l_,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,t.jsx)(h,{})]})})});f.displayName=l.VY.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.__,{ref:s,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...r})}).displayName=l.__.displayName;let p=r.forwardRef((e,s)=>{let{className:a,children:r,...n}=e;return(0,t.jsxs)(l.ck,{ref:s,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",a),...n,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(l.wU,{children:(0,t.jsx)(o.Z,{className:"h-4 w-4"})})}),(0,t.jsx)(l.eT,{children:r})]})});p.displayName=l.ck.displayName,r.forwardRef((e,s)=>{let{className:a,...r}=e;return(0,t.jsx)(l.Z0,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-slate-100 dark:bg-slate-800",a),...r})}).displayName=l.Z0.displayName},71245:function(e,s,a){"use strict";a.d(s,{H:function(){return u},a:function(){return m}});var t=a(57437),r=a(2265),l=a(82148),n=a(46410),i=a(5978),o=a(14438),d=a(47903);let c=(0,r.createContext)({user:null,appUser:null,isLoading:!0,login:async()=>!1,logout:async()=>{},hasPermission:()=>!1,hasAnyPermission:()=>!1,hasAllPermissions:()=>!1}),u=e=>{let{children:s}=e,[a,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[h,f]=(0,r.useState)(!0),p=async e=>{(0,d.fF)("loadUserData 開始執行",{uid:e.uid});try{let s=(0,n.T)();if(!s){(0,d.vU)("Firestore 未初始化"),x(null);return}(0,d.fF)("獲取用戶文檔",{uid:e.uid});let a=await (0,i.QT)((0,i.doc)(s,"users",e.uid));if(a.exists()){(0,d.fF)("用戶文檔存在");let e=a.data();if((0,d.fF)("用戶資料",e),e.roleRef){(0,d.fF)("用戶有角色引用，獲取角色資料");try{let s=await (0,i.QT)(e.roleRef);if(s.exists()){let a=s.data();e.roleName=a.displayName||a.name,e.permissions=a.permissions||[],(0,d.fF)("角色資料載入成功",{role:e.roleName,permissions:e.permissions})}else(0,d.ZK)("角色文檔不存在")}catch(e){(0,d.vU)("載入角色資料失敗",e)}}else(0,d.ZK)("用戶沒有角色引用");(0,d.fF)("設置 appUser",e),x(e)}else(0,d.ZK)("用戶文檔不存在"),x(null)}catch(e){(0,d.vU)("載入用戶資料失敗",e),x(null)}},g=async(e,s)=>{try{let a=(0,n.E7)();if(!a)return o.Am.error("系統初始化失敗"),!1;let t=e.includes("@")?e:"".concat(e,"@deer-lab.local"),r=await (0,l.e5)(a,t,s);return await p(r.user),o.Am.success("登入成功！"),!0}catch(e){return(0,d.vU)("登入失敗",e),o.Am.error(e.message||"登入失敗"),!1}},j=async()=>{try{let e=(0,n.E7)();e&&(await (0,l.w7)(e),u(null),x(null),o.Am.success("已成功登出"),window.location.href="/")}catch(e){(0,d.vU)("登出失敗",e),o.Am.error("登出失敗")}};return(0,r.useEffect)(()=>{(0,d.fF)("AuthContext useEffect 開始執行");try{let e=(0,n.E7)();if(!e){(0,d.vU)("Auth 未初始化，設置 isLoading = false"),f(!1);return}(0,d.fF)("設置 onAuthStateChanged 監聽器");let s=(0,l.Aj)(e,async e=>{try{(0,d.fF)("onAuthStateChanged 觸發",{uid:(null==e?void 0:e.uid)||null}),e?(u(e),(0,d.fF)("開始載入用戶資料"),await p(e)):(u(null),x(null),(0,d.fF)("用戶已登出，清除狀態")),f(!1),(0,d.fF)("設置 isLoading = false")}catch(e){(0,d.vU)("onAuthStateChanged 回調執行失敗",e),f(!1)}});return()=>{(0,d.fF)("清理 onAuthStateChanged 監聽器"),"function"==typeof s&&s()}}catch(e){(0,d.vU)("AuthContext useEffect 執行失敗",e),f(!1)}},[]),(0,t.jsx)(c.Provider,{value:{user:a,appUser:m,isLoading:h,login:g,logout:j,hasPermission:e=>null!=m&&!!m.permissions&&m.permissions.includes(e),hasAnyPermission:e=>null!=m&&!!m.permissions&&e.some(e=>m.permissions.includes(e)),hasAllPermissions:e=>null!=m&&!!m.permissions&&e.every(e=>m.permissions.includes(e))},children:s})},m=()=>(0,r.useContext)(c)},1077:function(e,s,a){"use strict";a.d(s,{g:function(){return n}});var t=a(71245);let r={PERSONNEL_VIEW:"personnel.view",PERSONNEL_MANAGE:"personnel.manage",TIME_VIEW:"time.view",TIME_MANAGE:"time.manage",SUPPLIERS_VIEW:"suppliers.view",SUPPLIERS_MANAGE:"suppliers.manage",PURCHASE_VIEW:"purchase.view",PURCHASE_MANAGE:"purchase.manage",MATERIALS_VIEW:"materials.view",MATERIALS_MANAGE:"materials.manage",FRAGRANCES_VIEW:"fragrances.view",FRAGRANCES_MANAGE:"fragrances.manage",PRODUCTS_VIEW:"products.view",PRODUCTS_MANAGE:"products.manage",WORK_ORDERS_VIEW:"workOrders.view",WORK_ORDERS_MANAGE:"workOrders.manage",INVENTORY_VIEW:"inventory.view",INVENTORY_MANAGE:"inventory.manage",INVENTORY_RECORDS_VIEW:"inventoryRecords.view",COST_VIEW:"cost.view",TIME_REPORTS_VIEW:"timeReports.view",ROLES_MANAGE:"roles.manage",SYSTEM_SETTINGS:"system.settings"};Object.values(r);let l={"/dashboard":{view:[]},"/dashboard/personnel":{view:[r.PERSONNEL_VIEW,r.PERSONNEL_MANAGE],manage:[r.PERSONNEL_MANAGE]},"/dashboard/time-records":{view:[r.TIME_VIEW,r.TIME_MANAGE]},"/dashboard/suppliers":{view:[r.SUPPLIERS_VIEW,r.SUPPLIERS_MANAGE],manage:[r.SUPPLIERS_MANAGE]},"/dashboard/purchase-orders":{view:[r.PURCHASE_VIEW,r.PURCHASE_MANAGE],manage:[r.PURCHASE_MANAGE]},"/dashboard/materials":{view:[r.MATERIALS_VIEW,r.MATERIALS_MANAGE],manage:[r.MATERIALS_MANAGE]},"/dashboard/fragrances":{view:[r.FRAGRANCES_VIEW,r.FRAGRANCES_MANAGE],manage:[r.FRAGRANCES_MANAGE]},"/dashboard/products":{view:[r.PRODUCTS_VIEW,r.PRODUCTS_MANAGE],manage:[r.PRODUCTS_MANAGE]},"/dashboard/work-orders":{view:[r.WORK_ORDERS_VIEW,r.WORK_ORDERS_MANAGE],manage:[r.WORK_ORDERS_MANAGE]},"/dashboard/inventory":{view:[r.INVENTORY_VIEW,r.INVENTORY_MANAGE],manage:[r.INVENTORY_MANAGE]},"/dashboard/inventory-records":{view:[r.INVENTORY_RECORDS_VIEW]},"/dashboard/cost-management":{view:[r.COST_VIEW]},"/dashboard/time-reports":{view:[r.TIME_REPORTS_VIEW]}};function n(){let{appUser:e,hasPermission:s,hasAnyPermission:a,hasAllPermissions:r}=(0,t.a)();return{hasPermission:s,hasAnyPermission:a,hasAllPermissions:r,canAccess:s=>null!=e&&!!e.permissions&&function(e,s){let a=l[e];return!a||0===a.view.length||a.view.some(e=>s.includes(e))}(s,e.permissions),canManage:s=>null!=e&&!!e.permissions&&function(e,s){let a=l[e];return null!=a&&!!a.manage&&a.manage.some(e=>s.includes(e))}(s,e.permissions),isAdmin:()=>(null==e?void 0:e.roleName)==="系統管理員",isForeman:()=>(null==e?void 0:e.roleName)==="生產領班",isTimekeeper:()=>(null==e?void 0:e.roleName)==="計時人員",userRole:(null==e?void 0:e.roleName)||"未設定",userPermissions:(null==e?void 0:e.permissions)||[]}}r.PERSONNEL_VIEW,r.PERSONNEL_MANAGE,r.TIME_VIEW,r.TIME_MANAGE,r.SUPPLIERS_VIEW,r.SUPPLIERS_MANAGE,r.PURCHASE_VIEW,r.PURCHASE_MANAGE,r.MATERIALS_VIEW,r.MATERIALS_MANAGE,r.FRAGRANCES_VIEW,r.FRAGRANCES_MANAGE,r.PRODUCTS_VIEW,r.PRODUCTS_MANAGE,r.WORK_ORDERS_VIEW,r.WORK_ORDERS_MANAGE,r.INVENTORY_VIEW,r.INVENTORY_MANAGE,r.INVENTORY_RECORDS_VIEW,r.COST_VIEW,r.TIME_REPORTS_VIEW,r.ROLES_MANAGE,r.SYSTEM_SETTINGS},90277:function(e,s,a){"use strict";a.d(s,{$j:function(){return P},Dx:function(){return G},VY:function(){return M},aU:function(){return V},aV:function(){return O},dk:function(){return T},fC:function(){return k},h_:function(){return Z},xz:function(){return D}});var t=a(2265),r=a(73966),l=a(98575),n=a(49027),i=a(6741),o=a(37053),d=a(57437),c="AlertDialog",[u,m]=(0,r.b)(c,[n.p8]),x=(0,n.p8)(),h=e=>{let{__scopeAlertDialog:s,...a}=e,t=x(s);return(0,d.jsx)(n.fC,{...t,...a,modal:!0})};h.displayName=c;var f=t.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...t}=e,r=x(a);return(0,d.jsx)(n.xz,{...r,...t,ref:s})});f.displayName="AlertDialogTrigger";var p=e=>{let{__scopeAlertDialog:s,...a}=e,t=x(s);return(0,d.jsx)(n.h_,{...t,...a})};p.displayName="AlertDialogPortal";var g=t.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...t}=e,r=x(a);return(0,d.jsx)(n.aV,{...r,...t,ref:s})});g.displayName="AlertDialogOverlay";var j="AlertDialogContent",[N,v]=u(j),b=(0,o.sA)("AlertDialogContent"),y=t.forwardRef((e,s)=>{let{__scopeAlertDialog:a,children:r,...o}=e,c=x(a),u=t.useRef(null),m=(0,l.e)(s,u),h=t.useRef(null);return(0,d.jsx)(n.jm,{contentName:j,titleName:w,docsSlug:"alert-dialog",children:(0,d.jsx)(N,{scope:a,cancelRef:h,children:(0,d.jsxs)(n.VY,{role:"alertdialog",...c,...o,ref:m,onOpenAutoFocus:(0,i.Mj)(o.onOpenAutoFocus,e=>{var s;e.preventDefault(),null===(s=h.current)||void 0===s||s.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[(0,d.jsx)(b,{children:r}),(0,d.jsx)(C,{contentRef:u})]})})})});y.displayName=j;var w="AlertDialogTitle",E=t.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...t}=e,r=x(a);return(0,d.jsx)(n.Dx,{...r,...t,ref:s})});E.displayName=w;var A="AlertDialogDescription",R=t.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...t}=e,r=x(a);return(0,d.jsx)(n.dk,{...r,...t,ref:s})});R.displayName=A;var _=t.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...t}=e,r=x(a);return(0,d.jsx)(n.x8,{...r,...t,ref:s})});_.displayName="AlertDialogAction";var S="AlertDialogCancel",I=t.forwardRef((e,s)=>{let{__scopeAlertDialog:a,...t}=e,{cancelRef:r}=v(S,a),i=x(a),o=(0,l.e)(s,r);return(0,d.jsx)(n.x8,{...i,...t,ref:o})});I.displayName=S;var C=e=>{let{contentRef:s}=e,a="`".concat(j,"` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the `").concat(j,"` by passing a `").concat(A,"` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an `id` and passing the same value to the `aria-describedby` prop in `").concat(j,"`. If the description is confusing or duplicative for sighted users, you can use the `@radix-ui/react-visually-hidden` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog");return t.useEffect(()=>{var e;document.getElementById(null===(e=s.current)||void 0===e?void 0:e.getAttribute("aria-describedby"))||console.warn(a)},[a,s]),null},k=h,D=f,Z=p,O=g,M=y,V=_,P=I,G=E,T=R}},function(e){e.O(0,[3609,9015,3676,5569,4438,9436,3909,2696,4116,4200,6818,5184,8236,2365,2313,2971,2117,1744],function(){return e(e.s=62696)}),_N_E=e.O()}]);