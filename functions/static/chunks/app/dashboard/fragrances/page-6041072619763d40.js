(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[881],{49942:function(e,t,a){Promise.resolve().then(a.bind(a,79724))},73618:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},38220:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]])},16275:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},76865:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},37683:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]])},79724:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return U}});var r=a(57437),s=a(2265),n=a(99376),c=a(5978),l=a(1850),i=a(46410),o=a(74378),d=a(25751),u=a(44794),m=a(61649),g=a(16275),p=a(73618),h=a(99397),x=a(73247),f=a(32489),j=a(66927),y=a(67782),v=a(42208),b=a(15868),N=a(60044),k=a(37683),S=a(76865),w=a(14438),C=a(33804),Z=a(12381),z=a(32060),T=a(69174),L=a(68245),R=a(40279),A=a(79820),P=a(64853),E=a(83112);function M(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),[a,M]=(0,s.useState)([]),[U,F]=(0,s.useState)([]),[O,q]=(0,s.useState)(!0),[G,I]=(0,s.useState)(!1),[V,K]=(0,s.useState)(!1),[X,D]=(0,s.useState)(null),[_,$]=(0,s.useState)(new Set),[J,W]=(0,s.useState)(""),[B,H]=(0,s.useState)(!1),[Q,Y]=(0,s.useState)({}),[ee,et]=(0,s.useState)(!1),[ea,er]=(0,s.useState)(null),[es,en]=(0,s.useState)(!1),[ec,el]=(0,s.useState)(new Set),[ei,eo]=(0,s.useState)(new Set),[ed,eu]=(0,s.useState)(!1),[em,eg]=(0,s.useState)(!1),ep=(0,s.useCallback)(async()=>{q(!0);try{if(!i.db)throw Error("Firebase 未初始化");let e=await (0,c.getDocs)((0,c.collection)(i.db,"suppliers")),t=new Map;e.docs.forEach(e=>{t.set(e.id,e.data().name)});let a=(await (0,c.getDocs)((0,c.collection)(i.db,"fragrances"))).docs.map(e=>{let a=e.data(),r=a.supplierRef,s=r?t.get(r.id)||"N/A":"未指定";console.log("=== 香精 ".concat(a.name," (").concat(a.code,") 的詳細資料 ===")),console.log("原始資料庫資料:",a),console.log("fragranceType 原始值:",a.fragranceType,"類型:",typeof a.fragranceType),console.log("fragranceStatus 原始值:",a.fragranceStatus,"類型:",typeof a.fragranceStatus),console.log("status 原始值:",a.status,"類型:",typeof a.status),console.log("所有欄位名稱:",Object.keys(a));let n=a.fragranceType||"未指定",c=a.fragranceStatus||"未指定";return console.log("處理後的 fragranceType:",n),console.log("處理後的 fragranceStatus:",c),console.log("====================================="),{id:e.id,code:a.code,name:a.name,status:a.status,fragranceType:n,fragranceStatus:c,supplierRef:a.supplierRef,safetyStockLevel:a.safetyStockLevel,costPerUnit:a.costPerUnit,percentage:a.percentage,pgRatio:a.pgRatio,vgRatio:a.vgRatio,currentStock:a.currentStock,supplierName:s,createdAt:a.createdAt,updatedAt:a.updatedAt}});M(a),F(a)}catch(e){console.error("讀取香精資料失敗:",e),w.Am.error("讀取香精資料失敗。")}finally{q(!1)}},[]);(0,s.useEffect)(()=>{ep()},[ep]),(0,s.useEffect)(()=>{let r=t.get("edit");if(r&&a.length>0){let t=a.find(e=>e.id===r);t&&(D(t),I(!0),e.replace("/dashboard/fragrances"))}},[t,a,e]),(0,s.useEffect)(()=>{if(!J.trim()&&0===ec.size&&0===ei.size&&!ed){F(a);return}F(a.filter(e=>{if(J.trim()){var t,a,r,s,n,c,l;let i=J.toLowerCase();if(!((null===(t=e.code)||void 0===t?void 0:t.toLowerCase().includes(i))||(null===(a=e.name)||void 0===a?void 0:a.toLowerCase().includes(i))||(null===(r=e.supplierName)||void 0===r?void 0:r.toLowerCase().includes(i))||(null===(s=e.fragranceType)||void 0===s?void 0:s.toLowerCase().includes(i))||(null===(n=e.currentStock)||void 0===n?void 0:n.toString().includes(i))||(null===(c=e.costPerUnit)||void 0===c?void 0:c.toString().includes(i))||(null===(l=e.percentage)||void 0===l?void 0:l.toString().includes(i))))return!1}return(!(ec.size>0)||!!ec.has(e.supplierName))&&(!(ei.size>0)||!!ei.has(e.fragranceType||""))&&(!ed||!!("number"==typeof e.safetyStockLevel&&e.currentStock<e.safetyStockLevel))}).sort((e,t)=>{let a={啟用:1,備用:2,棄用:3},r=a[e.fragranceStatus]||4,s=a[t.fragranceStatus]||4;if(r!==s)return r-s;let n={棉芯:1,陶瓷芯:2,棉陶芯通用:3},c=n[e.fragranceType]||4,l=n[t.fragranceType]||4;return c!==l?c-l:(e.name||"").localeCompare(t.name||"","zh-TW")}))},[a,J,ec,ei,ed]);let{availableSuppliers:eh,availableFragranceTypes:ex}=(0,s.useMemo)(()=>{let e=a;if(J.trim()){let t=J.toLowerCase();e=a.filter(e=>{var a,r,s,n,c,l,i;return(null===(a=e.code)||void 0===a?void 0:a.toLowerCase().includes(t))||(null===(r=e.name)||void 0===r?void 0:r.toLowerCase().includes(t))||(null===(s=e.supplierName)||void 0===s?void 0:s.toLowerCase().includes(t))||(null===(n=e.fragranceType)||void 0===n?void 0:n.toLowerCase().includes(t))||(null===(c=e.currentStock)||void 0===c?void 0:c.toString().includes(t))||(null===(l=e.costPerUnit)||void 0===l?void 0:l.toString().includes(t))||(null===(i=e.percentage)||void 0===i?void 0:i.toString().includes(t))})}let t=new Set,r=new Set;e.forEach(e=>{e.supplierName&&t.add(e.supplierName),e.fragranceType&&r.add(e.fragranceType)});let s=new Set,n=new Set;return ec.size>0&&ei.size>0?(s=new Set(ec),n=new Set(ei)):ec.size>0?(s=new Set(ec),e.forEach(e=>{ec.has(e.supplierName||"")&&e.fragranceType&&n.add(e.fragranceType)})):ei.size>0?(n=new Set(ei),e.forEach(e=>{ei.has(e.fragranceType||"")&&e.supplierName&&s.add(e.supplierName)})):(s=t,n=r),{availableSuppliers:Array.from(s).sort(),availableFragranceTypes:Array.from(n).sort()}},[a,J,ec,ei]),ef=e=>{$(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},ej=e=>{try{var t;let a={id:e.id,name:e.name,code:e.code,type:"fragrance",supplierId:(null===(t=e.supplierRef)||void 0===t?void 0:t.id)||"",supplierName:e.supplierName||"未指定",unit:e.unit||"KG",quantity:1,costPerUnit:e.costPerUnit||0},r=localStorage.getItem("purchaseCart"),s=[];if(r)try{s=JSON.parse(r)}catch(e){console.error("解析採購車資料失敗:",e)}let n=s.findIndex(t=>t.id===e.id&&"fragrance"===t.type);n>=0?(s[n].quantity+=1,w.Am.success("已增加 ".concat(e.name," 的數量"))):(s.push(a),w.Am.success("已將 ".concat(e.name," 加入採購車"))),localStorage.setItem("purchaseCart",JSON.stringify(s))}catch(e){console.error("添加到採購車失敗:",e),w.Am.error("添加到採購車失敗")}},ey=()=>{if(0===_.size){w.Am.info("請至少選擇一個香精加入採購車。");return}try{let e=localStorage.getItem("purchaseCart"),t=e?JSON.parse(e):[],r=a.filter(e=>_.has(e.id));r.forEach(e=>{let a=t.find(t=>t.id===e.id&&"fragrance"===t.type);if(a)a.quantity+=1;else{var r;t.push({id:e.id,name:e.name,code:e.code,type:"fragrance",supplierId:(null===(r=e.supplierRef)||void 0===r?void 0:r.id)||"",supplierName:e.supplierName,unit:"KG",quantity:1,costPerUnit:e.costPerUnit||0})}}),localStorage.setItem("purchaseCart",JSON.stringify(t)),window.dispatchEvent(new CustomEvent("purchaseCartUpdated")),w.Am.success("已將 ".concat(r.length," 個香精加入採購車")),$(new Set)}catch(e){console.error("加入採購車失敗:",e),w.Am.error("加入採購車失敗")}},ev=async()=>{let e=Array.from(_);if(0===e.length)return;let t=w.Am.loading("正在刪除 ".concat(e.length," 個香精..."));try{let a=(0,l.$C)(),r=(0,l.V1)(a,"deleteFragrance");for(let t of e)await r({fragranceId:t});w.Am.success("成功刪除 ".concat(e.length," 個香精。"),{id:t}),$(new Set),ep()}catch(a){console.error("批量刪除香精失敗:",a);let e="批量刪除香精時發生錯誤。";a instanceof Error&&(e=a.message),w.Am.error(e,{id:t})}finally{eg(!1)}},eb=()=>{D(null),I(!0)},eN=e=>{D(e),I(!0)},ek=e=>{D(e),K(!0)},eS=e=>{er(e),en(!0)},ew=async()=>{if(!X)return;let e=w.Am.loading("正在刪除香精...");try{let t=(0,l.$C)(),a=(0,l.V1)(t,"deleteFragrance");await a({fragranceId:X.id}),w.Am.success("香精 ".concat(X.name," 已成功刪除。"),{id:e}),ep()}catch(a){console.error("刪除香精失敗:",a);let t="刪除香精時發生錯誤。";a instanceof Error&&(t=a.message),w.Am.error(t,{id:e})}finally{K(!1),D(null)}},eC=(e,t)=>{Y(a=>({...a,[e]:t}))},eZ=async()=>{let e=a.filter(e=>void 0!==Q[e.id]&&Q[e.id]!==e.currentStock).map(e=>({itemRefPath:"fragrances/".concat(e.id),currentStock:e.currentStock,newStock:Q[e.id]}));if(0===e.length){w.Am.info("庫存數量沒有變更，無需儲存。"),H(!1),Y({});return}let t=w.Am.loading("正在儲存盤點結果...");try{let a=(0,l.$C)(),r=(0,l.V1)(a,"performStocktake");await r({items:e}),w.Am.success("盤點結果儲存成功，庫存已更新。",{id:t}),Y({}),H(!1),ep()}catch(a){let e=a instanceof Error?a.message:"儲存盤點失敗";w.Am.error(e,{id:t})}},ez=()=>{Y({}),H(!1)},eT=e=>Math.round(100*e)/100,eL=e=>{let t=100-e;return{pgRatio:eT(.7*t),vgRatio:eT(.3*t)}},eR=async(e,t,a)=>{let r=(0,l.$C)();try{console.log("開始匯入香精資料:",{totalRecords:e.length,sampleData:e.slice(0,3).map(e=>({name:e.name,code:e.code,supplierName:e.supplierName,fragranceType:e.fragranceType,fragranceStatus:e.fragranceStatus,currentStock:e.currentStock,safetyStockLevel:e.safetyStockLevel,costPerUnit:e.costPerUnit,percentage:e.percentage,hasSupplierName:!!e.supplierName}))});let t=new Map;if(!i.db)throw Error("Firebase 未初始化");(await (0,c.getDocs)((0,c.collection)(i.db,"suppliers"))).forEach(e=>{let a=e.data();t.set(a.name,e.id),console.log("供應商映射: ".concat(a.name," -> ").concat(e.id))}),console.log("供應商映射表:",Array.from(t.entries()));let o=new Map;(await (0,c.getDocs)((0,c.collection)(i.db,"fragrances"))).forEach(e=>{let t=e.data();t.code&&o.set(t.code,e.id)});let d=Math.ceil(e.length/20),u=0,m=0,g=0;for(let c=0;c<d;c++){let i=20*c,p=Math.min(i+20,e.length),h=e.slice(i,p);for(let e of h)try{var s,n;let a;if(e.supplierName&&""!==e.supplierName.trim()){let r=e.supplierName.trim();a=t.get(r),console.log('尋找供應商: "'.concat(r,'" -> ').concat(a||"未找到")),a||console.warn('找不到供應商: "'.concat(r,'"'))}let c=e.fragranceType;if(null!=c&&""!==c)switch(c){case"cotton":c="棉芯";break;case"ceramic":c="陶瓷芯";break;case"universal":c="棉陶芯通用"}else c="";let i=e.fragranceStatus;if(null!=i&&""!==i)switch(i){case"active":i="啟用";break;case"standby":i="備用";break;case"discontinued":i="棄用"}else i="";let d=void 0!==e.percentage&&null!==e.percentage&&""!==e.percentage?eT(Number(e.percentage)):0,u=void 0!==e.pgRatio&&null!==e.pgRatio&&""!==e.pgRatio?eT(Number(e.pgRatio)):0,p=void 0!==e.vgRatio&&null!==e.vgRatio&&""!==e.vgRatio?eT(Number(e.vgRatio)):0,h=void 0!==e.currentStock&&null!==e.currentStock&&""!==e.currentStock?Number(e.currentStock):0,x=void 0!==e.safetyStockLevel&&null!==e.safetyStockLevel&&""!==e.safetyStockLevel?Number(e.safetyStockLevel):0,f=void 0!==e.costPerUnit&&null!==e.costPerUnit&&""!==e.costPerUnit?Number(e.costPerUnit):0;if(d>0&&(0===u||0===p)){let t=eL(d);u=t.pgRatio,p=t.vgRatio,console.log("自動計算香精 ".concat(e.name," 的比例:"),{fragrancePercentage:d,calculatedPgRatio:u,calculatedVgRatio:p})}let j={code:e.code,name:e.name,supplierId:a,percentage:d,pgRatio:u,vgRatio:p,currentStock:h,safetyStockLevel:x,costPerUnit:f,unit:"KG"};if(j.fragranceType=c,j.fragranceStatus=i,console.log("處理香精 ".concat(e.name," 的完整資料:"),{code:j.code,name:j.name,supplierId:j.supplierId,fragranceType:j.fragranceType,fragranceStatus:j.fragranceStatus,percentage:j.percentage,pgRatio:j.pgRatio,vgRatio:j.vgRatio,currentStock:j.currentStock,safetyStockLevel:j.safetyStockLevel,costPerUnit:j.costPerUnit,unit:j.unit}),console.log("處理香精 ".concat(e.name," 的資料對比:"),{originalFragranceType:e.fragranceType,processedFragranceType:c,originalFragranceStatus:e.fragranceStatus,processedFragranceStatus:i,originalSupplierName:e.supplierName,processedSupplierId:a,hasSupplierId:!!a,originalCurrentStock:e.currentStock,processedCurrentStock:h,originalPercentage:e.percentage,processedPercentage:d,fragranceTypeExists:!!e.fragranceType,fragranceStatusExists:!!e.fragranceStatus,fragranceTypeLength:(null===(s=e.fragranceType)||void 0===s?void 0:s.length)||0,fragranceStatusLength:(null===(n=e.fragranceStatus)||void 0===n?void 0:n.length)||0}),o.get(e.code)){console.log("香精代號 ".concat(e.code," 已存在，執行更新操作"));let t=(0,l.V1)(r,"updateFragranceByCode");await t(j),g++}else{console.log("香精代號 ".concat(e.code," 不存在，執行新增操作"));let t=(0,l.V1)(r,"createFragrance");await t(j),m++}}catch(e){throw console.error("處理香精資料失敗:",e),e}u+=h.length,null==a||a(u,e.length),c<d-1&&await new Promise(e=>setTimeout(e,500))}console.log("香精匯入結果:","成功處理 ".concat(u," 筆資料 (新增: ").concat(m,", 更新: ").concat(g,")")),ep()}catch(e){throw console.error("匯入香精失敗:",e),e}},eA=async()=>a.map(e=>({code:e.code,name:e.name,fragranceType:(e=>{switch(e){case"cotton":return"棉芯";case"ceramic":return"陶瓷芯";case"universal":return"棉陶芯通用";default:return e}})(e.fragranceType||e.status),fragranceStatus:(e=>{switch(e){case"active":return"啟用";case"standby":return"備用";case"discontinued":return"棄用";default:return e}})(e.fragranceStatus||e.status||"active"),supplierName:e.supplierName,safetyStockLevel:e.safetyStockLevel,costPerUnit:e.costPerUnit,percentage:e.percentage,pgRatio:e.pgRatio,vgRatio:e.vgRatio,currentStock:e.currentStock,unit:"KG"}));return(0,r.jsxs)("div",{className:"container mx-auto py-10 fragrances-page",children:[(0,r.jsx)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-pink-600 to-rose-600 bg-clip-text text-transparent",children:"香精管理"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"管理香精配方與庫存"})]})}),(0,r.jsx)("div",{className:"lg:hidden mb-6",children:(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3",children:B?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Z.z,{onClick:eZ,className:"w-full",children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"儲存盤點"]}),(0,r.jsx)(Z.z,{variant:"outline",onClick:ez,className:"w-full",children:"取消"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Z.z,{variant:"outline",onClick:()=>et(!0),className:"w-full",children:[(0,r.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"匯入/匯出"]}),(0,r.jsxs)(Z.z,{onClick:ey,disabled:0===_.size,variant:"outline",className:"w-full",children:[(0,r.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"加入採購車 (",_.size,")"]}),(0,r.jsxs)(Z.z,{variant:"outline",onClick:()=>H(!0),className:"w-full",children:[(0,r.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"盤點模式"]}),(0,r.jsxs)(Z.z,{onClick:eb,className:"w-full bg-gradient-to-r from-pink-600 to-rose-600 hover:from-pink-700 hover:to-rose-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[(0,r.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"新增香精"]})]})})}),(0,r.jsx)("div",{className:"hidden lg:block mb-6",children:(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:B?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Z.z,{onClick:eZ,children:[(0,r.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"儲存盤點"]}),(0,r.jsx)(Z.z,{variant:"outline",onClick:ez,children:"取消"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(Z.z,{variant:"outline",onClick:()=>et(!0),children:[(0,r.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),"匯入/匯出"]}),(0,r.jsxs)(Z.z,{onClick:ey,disabled:0===_.size,variant:"outline",children:[(0,r.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"加入採購車 (",_.size,")"]}),(0,r.jsxs)(Z.z,{variant:"outline",onClick:()=>H(!0),children:[(0,r.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),"盤點模式"]}),(0,r.jsxs)(Z.z,{onClick:eb,className:"bg-gradient-to-r from-pink-600 to-rose-600 hover:from-pink-700 hover:to-rose-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[(0,r.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"新增香精"]})]})})}),(0,r.jsx)(A.Zb,{className:"mb-6 border-0 shadow-lg bg-gradient-to-r from-gray-50 to-pink-50",children:(0,r.jsx)(A.aY,{className:"pt-6",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(x.Z,{className:"absolute left-3 top-3 h-4 w-4 text-pink-600"}),(0,r.jsx)(R.I,{placeholder:"搜尋香精代號、名稱、供應商、香精種類、庫存等...",value:J,onChange:e=>W(e.target.value),className:"pl-10 border-pink-200 focus:border-pink-500 focus:ring-pink-500"})]})})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[a.filter(e=>"number"==typeof e.safetyStockLevel&&e.currentStock<e.safetyStockLevel).length>0&&(0,r.jsxs)(T.C,{variant:ed?"default":"secondary",className:"cursor-pointer transition-colors ".concat(ed?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-800 border-red-300"),onClick:()=>eu(!ed),children:["安全庫存 (",a.filter(e=>"number"==typeof e.safetyStockLevel&&e.currentStock<e.safetyStockLevel).length,")"]}),eh.map(e=>(0,r.jsx)(T.C,{variant:ec.has(e)?"default":"secondary",className:"cursor-pointer transition-colors ".concat(ec.has(e)?"bg-orange-600 hover:bg-orange-700 text-white":"bg-orange-100 hover:bg-orange-200 text-orange-800 border-orange-300"),onClick:()=>{el(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},children:e},e)),ex.map(e=>{let t=ei.has(e);return(0,r.jsx)(T.C,{variant:t?"default":"secondary",className:"cursor-pointer transition-colors ".concat((e=>{switch(e){case"棉芯":return t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-800 border-blue-300";case"陶瓷芯":return t?"bg-green-600 hover:bg-green-700 text-white":"bg-green-100 hover:bg-green-200 text-green-800 border-green-300";case"棉陶芯通用":return t?"bg-purple-600 hover:bg-purple-700 text-white":"bg-purple-100 hover:bg-purple-200 text-purple-800 border-purple-300";default:return t?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-800 border-gray-300"}})(e)),onClick:()=>{eo(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},children:e},e)})]})}),_.size>0&&!B&&(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(Z.z,{variant:"outline",size:"sm",onClick:ey,className:"flex items-center gap-2",children:[(0,r.jsx)(g.Z,{className:"h-4 w-4"}),"加入採購車 (",_.size,")"]}),(0,r.jsxs)(Z.z,{variant:"destructive",size:"sm",onClick:()=>{if(0===_.size){w.Am.info("請至少選擇一個香精進行刪除。");return}eg(!0)},className:"flex items-center gap-2",children:[(0,r.jsx)(f.Z,{className:"h-4 w-4"}),"批量刪除 (",_.size,")"]})]})}),(0,r.jsx)("div",{className:"lg:hidden",children:(0,r.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden mb-6",children:[(0,r.jsx)("div",{className:"px-4 py-3 bg-gradient-to-r from-gray-50 to-pink-50 border-b border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"h-4 w-4 text-pink-600"}),(0,r.jsx)("h2",{className:"text-base font-semibold text-gray-800",children:"香精清單"})]}),(0,r.jsxs)("div",{className:"text-xs text-gray-600",children:["共 ",U.length," 項"]})]})}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsx)("div",{className:"min-w-full",children:O?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-10 h-10 border-4 border-pink-200 rounded-full animate-spin"}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-10 h-10 border-4 border-transparent border-t-pink-600 rounded-full animate-spin"})]}),(0,r.jsx)("span",{className:"mt-3 text-sm text-gray-600 font-medium",children:"載入中..."})]}):U.length>0?(0,r.jsx)("div",{className:"divide-y divide-gray-200",children:U.map(e=>{var t;let a="number"==typeof e.safetyStockLevel&&e.currentStock<e.safetyStockLevel;return(0,r.jsxs)("div",{className:"p-4 ".concat(a&&!B?"bg-red-50/50":""," hover:bg-pink-50/50 transition-colors duration-200"),onClick:()=>eS(e),children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-pink-500 to-rose-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)(j.Z,{className:"h-4 w-4 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-gray-900 text-sm",children:e.name}),(0,r.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:e.code})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(L.X,{checked:_.has(e.id),onCheckedChange:()=>ef(e.id),"aria-label":"選擇 ".concat(e.name),disabled:B,onClick:e=>e.stopPropagation()}),(0,r.jsxs)(z.h_,{children:[(0,r.jsx)(z.$F,{asChild:!0,onClick:e=>e.stopPropagation(),children:(0,r.jsx)(Z.z,{variant:"ghost",className:"h-8 w-8 p-0",disabled:B,children:(0,r.jsx)(y.Z,{className:"h-4 w-4"})})}),(0,r.jsxs)(z.AW,{align:"end",children:[(0,r.jsxs)(z.Xi,{onClick:()=>ej(e),children:[(0,r.jsx)(g.Z,{className:"mr-2 h-4 w-4"}),"加入採購車"]}),(0,r.jsxs)(z.Xi,{onClick:()=>eS(e),children:[(0,r.jsx)(v.Z,{className:"mr-2 h-4 w-4"}),"查看詳細"]}),(0,r.jsxs)(z.Xi,{onClick:()=>eN(e),children:[(0,r.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"編輯"]}),(0,r.jsx)(z.Xi,{onClick:()=>ek(e),className:"text-red-600",children:"刪除"})]})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[!B&&(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,r.jsx)(N.Z,{className:"h-3 w-3 text-blue-600"}),(0,r.jsx)("span",{className:"text-gray-500",children:"供應商"})]}),(0,r.jsx)("span",{className:"font-medium text-gray-700",children:e.supplierName})]}),!B&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center gap-1 mb-1",children:(0,r.jsx)("span",{className:"text-gray-500",children:"香精種類"})}),(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("棉芯"===e.fragranceType?"bg-blue-100 text-blue-800":"陶瓷芯"===e.fragranceType?"bg-green-100 text-green-800":"棉陶芯通用"===e.fragranceType?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:e.fragranceType||"未指定"})]}),!B&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center gap-1 mb-1",children:(0,r.jsx)("span",{className:"text-gray-500",children:"啟用狀態"})}),(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full ".concat("啟用"===e.fragranceStatus?"bg-green-100 text-green-800":"備用"===e.fragranceStatus?"bg-yellow-100 text-yellow-800":"棄用"===e.fragranceStatus?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.fragranceStatus||"未指定"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,r.jsx)(k.Z,{className:"h-3 w-3 text-gray-400"}),(0,r.jsx)("span",{className:"text-gray-500",children:B?"應有庫存:":"目前庫存:"})]}),B?(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsxs)("span",{className:"font-medium text-gray-700",children:[e.currentStock||0," KG"]})}):(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[a&&(0,r.jsx)(S.Z,{className:"h-3 w-3 text-red-600"}),(0,r.jsxs)("span",{className:"font-medium ".concat(a?"text-red-600":"text-green-600"),children:[e.currentStock," KG"]})]})]}),B&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center gap-1 mb-1",children:(0,r.jsx)("span",{className:"text-gray-500",children:"現有庫存:"})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(R.I,{type:"number",className:"w-20 h-7 text-sm border-pink-200 focus:border-pink-500 focus:ring-pink-500",value:null!==(t=Q[e.id])&&void 0!==t?t:e.currentStock,onChange:t=>eC(e.id,Number(t.target.value))}),(0,r.jsx)("span",{className:"text-xs text-gray-600",children:"KG"})]})]}),!B&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center gap-1 mb-1",children:(0,r.jsx)("span",{className:"text-gray-500",children:"安全庫存"})}),(0,r.jsxs)("span",{className:"font-medium text-gray-700",children:[e.safetyStockLevel||0," KG"]})]})]})]},e.id)})}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-muted rounded-full flex items-center justify-center mb-3",children:(0,r.jsx)(j.Z,{className:"h-6 w-6 text-muted-foreground"})}),(0,r.jsx)("h3",{className:"text-base font-medium text-foreground mb-1",children:"沒有香精資料"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4 text-center",children:"開始建立第一個香精來管理配方"}),(0,r.jsxs)(Z.z,{onClick:eb,variant:"outline",size:"sm",className:"border-pink-200 text-pink-600 hover:bg-pink-50",children:[(0,r.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"新增香精"]})]})})})]})}),(0,r.jsx)("div",{className:"hidden lg:block",children:(0,r.jsxs)("div",{className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden",children:[(0,r.jsx)("div",{className:"px-6 py-4 bg-gradient-to-r from-background to-accent/10 border-b border-border",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(j.Z,{className:"h-5 w-5 text-accent"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:B?"香精盤點中":"香精清單"})]}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["共 ",U.length," 項香精"]})]})}),(0,r.jsx)("div",{className:"table-responsive",children:(0,r.jsxs)(C.iA,{className:"table-enhanced",children:[(0,r.jsx)(C.xD,{children:(0,r.jsxs)(C.SC,{children:[(0,r.jsx)(C.ss,{className:"w-[60px] text-center",children:!B&&(0,r.jsxs)("div",{className:"flex items-center gap-2",title:"全選所有香精",children:[(0,r.jsx)(L.X,{checked:_.size===U.length&&U.length>0,onCheckedChange:e=>{e?$(new Set(U.map(e=>e.id))):$(new Set)}}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:"全選"})]})}),(0,r.jsx)(C.ss,{className:"text-left",children:"香精資訊"}),!B&&(0,r.jsx)(C.ss,{className:"text-left",children:"香精種類"}),!B&&(0,r.jsx)(C.ss,{className:"text-left",children:"啟用狀態"}),!B&&(0,r.jsx)(C.ss,{className:"text-left",children:"供應商"}),(0,r.jsx)(C.ss,{className:"text-right",children:B?"應有庫存":"目前庫存"}),B&&(0,r.jsx)(C.ss,{className:"text-right",children:"現有庫存"}),!B&&(0,r.jsx)(C.ss,{className:"text-right",children:"安全庫存"}),(0,r.jsx)(C.ss,{className:"text-right",children:"操作"})]})}),(0,r.jsx)(C.RM,{children:O?(0,r.jsx)(C.SC,{children:(0,r.jsx)(C.pj,{colSpan:7,className:"text-center py-16",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-pink-200 rounded-full animate-spin"}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-12 h-12 border-4 border-transparent border-t-pink-600 rounded-full animate-spin"})]}),(0,r.jsx)("span",{className:"mt-4 text-muted-foreground font-medium",children:"載入香精資料中..."})]})})}):U.length>0?U.map(t=>{var a;let s="number"==typeof t.safetyStockLevel&&t.currentStock<t.safetyStockLevel;return(0,r.jsxs)(C.SC,{className:"".concat(s&&!B?"bg-destructive/10":""," ").concat(B?"":"cursor-pointer hover:bg-accent/5"," transition-colors duration-200"),"data-state":_.has(t.id)?"selected":"",onClick:B?void 0:()=>e.push("/dashboard/fragrances/".concat(t.id)),children:[(0,r.jsx)(C.pj,{className:"text-center",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(L.X,{checked:_.has(t.id),onCheckedChange:()=>ef(t.id),"aria-label":"選擇 ".concat(t.name),disabled:B})}),(0,r.jsx)(C.pj,{children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-pink-600 to-rose-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)(j.Z,{className:"h-4 w-4 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-foreground",children:t.name}),(0,r.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,r.jsx)(T.C,{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full",children:t.code})})]})]})}),!B&&(0,r.jsx)(C.pj,{children:(0,r.jsx)(T.C,{className:"status-badge ".concat("棉芯"===t.fragranceType?"bg-blue-100 text-blue-800":"陶瓷芯"===t.fragranceType?"bg-green-100 text-green-800":"棉陶芯通用"===t.fragranceType?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:t.fragranceType||"未指定"})}),!B&&(0,r.jsx)(C.pj,{children:(0,r.jsx)(T.C,{className:"status-badge ".concat("啟用"===t.fragranceStatus?"bg-green-100 text-green-800":"備用"===t.fragranceStatus?"bg-yellow-100 text-yellow-800":"棄用"===t.fragranceStatus?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:t.fragranceStatus||"未指定"})}),!B&&(0,r.jsx)(C.pj,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(N.Z,{className:"h-4 w-4 text-primary"}),(0,r.jsx)("span",{className:"text-sm font-medium text-foreground",children:t.supplierName})]})}),(0,r.jsx)(C.pj,{className:"text-right",children:B?(0,r.jsx)("div",{className:"flex justify-end items-center gap-2",children:(0,r.jsxs)("span",{className:"number-display number-neutral",children:[t.currentStock||0," KG"]})}):(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[s&&(0,r.jsx)(S.Z,{className:"h-4 w-4 text-red-600"}),(0,r.jsxs)("span",{className:"text-lg font-bold ".concat(s?"text-red-600":"text-green-600"),children:[t.currentStock," KG"]})]})}),B&&(0,r.jsx)(C.pj,{className:"text-right",children:(0,r.jsxs)("div",{className:"flex justify-end items-center gap-2",children:[(0,r.jsx)(R.I,{type:"number",className:"w-24 h-8 text-right border-pink-200 focus:border-pink-500 focus:ring-pink-500",value:null!==(a=Q[t.id])&&void 0!==a?a:t.currentStock,onChange:e=>eC(t.id,Number(e.target.value))}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"KG"})]})}),!B&&(0,r.jsx)(C.pj,{className:"text-right",children:(0,r.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,r.jsxs)("span",{className:"number-display number-neutral",children:[t.safetyStockLevel||0," KG"]})})}),(0,r.jsx)(C.pj,{className:"text-right",onClick:e=>e.stopPropagation(),children:(0,r.jsxs)(z.h_,{children:[(0,r.jsx)(z.$F,{asChild:!0,children:(0,r.jsxs)(Z.z,{variant:"ghost",className:"h-8 w-8 p-0",disabled:B,children:[(0,r.jsx)("span",{className:"sr-only",children:"開啟選單"}),(0,r.jsx)(y.Z,{className:"h-4 w-4"})]})}),(0,r.jsxs)(z.AW,{align:"end",children:[(0,r.jsx)(z.Ju,{children:"操作"}),(0,r.jsxs)(z.Xi,{onClick:()=>ej(t),children:[(0,r.jsx)(g.Z,{className:"h-4 w-4 mr-2"}),"加入採購車"]}),(0,r.jsx)(z.VD,{}),(0,r.jsxs)(z.Xi,{onClick:()=>eS(t),children:[(0,r.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"查看詳細"]}),(0,r.jsxs)(z.Xi,{onClick:()=>eN(t),children:[(0,r.jsx)(b.Z,{className:"h-4 w-4 mr-2"}),"編輯香精"]}),(0,r.jsx)(z.VD,{}),(0,r.jsx)(z.Xi,{onClick:()=>ek(t),className:"text-red-600 focus:text-red-600",children:"刪除香精"})]})]})})]},t.id)}):(0,r.jsx)(C.SC,{children:(0,r.jsx)(C.pj,{colSpan:7,className:"text-center py-16",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4",children:(0,r.jsx)(j.Z,{className:"h-8 w-8 text-muted-foreground"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-foreground mb-2",children:"沒有香精資料"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:"開始建立第一個香精來管理配方"}),(0,r.jsxs)(Z.z,{onClick:eb,variant:"outline",className:"border-pink-200 text-pink-600 hover:bg-pink-50",children:[(0,r.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"新增香精"]})]})})})})]})})]})}),(0,r.jsx)(o.$,{isOpen:G,onOpenChange:I,onFragranceUpdate:ep,fragranceData:X}),X&&(0,r.jsx)(d.Q,{isOpen:V,onOpenChange:K,onConfirm:ew,title:"確認刪除香精",description:"您確定要永久刪除香精「".concat(X.name,"」嗎？此操作無法復原。")}),(0,r.jsx)(d.Q,{isOpen:em,onOpenChange:eg,onConfirm:ev,title:"確認批量刪除",description:"您確定要永久刪除選中的 ".concat(_.size," 個香精嗎？此操作無法復原。")}),(0,r.jsx)(P.Z,{isOpen:ee,onOpenChange:et,onImport:eR,onExport:eA,title:"香精資料",description:"匯入或匯出香精資料，支援 Excel 和 CSV 格式。匯入時會智能匹配香精代號：如果代號不存在則新增，如果代號已存在則更新覆蓋有填入的欄位。",color:"purple",showUpdateOption:!1,maxBatchSize:500,sampleData:[{code:"FRAG001",name:"示例香精",fragranceType:"棉芯",fragranceStatus:"啟用",supplierName:"示例供應商",safetyStockLevel:1e3,costPerUnit:15.5,percentage:5,currentStock:500,unit:"KG"}],fields:[{key:"code",label:"香精代號",required:!1,type:"string"},{key:"name",label:"香精名稱",required:!0,type:"string"},{key:"fragranceType",label:"香精種類",required:!1,type:"string"},{key:"fragranceStatus",label:"啟用狀態",required:!1,type:"string"},{key:"supplierName",label:"供應商",required:!1,type:"string"},{key:"safetyStockLevel",label:"安全庫存",required:!1,type:"number"},{key:"costPerUnit",label:"單位成本",required:!1,type:"number"},{key:"percentage",label:"香精比例",required:!1,type:"number"},{key:"pgRatio",label:"PG比例",required:!1,type:"number"},{key:"vgRatio",label:"VG比例",required:!1,type:"number"},{key:"currentStock",label:"目前庫存",required:!1,type:"number"},{key:"unit",label:"單位",required:!1,type:"string"}]}),ea&&(0,r.jsx)(E.O,{isOpen:es,onOpenChange:en,title:ea.name,subtitle:"代號: ".concat(ea.code),sections:[{title:"基本資訊",icon:(0,r.jsx)(j.Z,{className:"h-4 w-4"}),fields:[{label:"香精代號",value:ea.code},{label:"香精名稱",value:ea.name},{label:"供應商",value:ea.supplierName},{label:"香精種類",value:"cotton"===ea.fragranceType?"棉芯":"ceramic"===ea.fragranceType?"陶瓷芯":"universal"===ea.fragranceType?"棉陶芯通用":"未指定"}]},{title:"庫存資訊",icon:(0,r.jsx)(k.Z,{className:"h-4 w-4"}),fields:[{label:"目前庫存",value:ea.currentStock,type:"number"},{label:"安全庫存",value:ea.safetyStockLevel,type:"number"},{label:"單位成本",value:ea.costPerUnit,type:"currency"}]},{title:"配方資訊",icon:(0,r.jsx)(p.Z,{className:"h-4 w-4"}),fields:[{label:"濃度百分比",value:ea.percentage,type:"number"},{label:"PG比例",value:ea.pgRatio,type:"number"},{label:"VG比例",value:ea.vgRatio,type:"number"}]}],actions:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Z.z,{variant:"outline",onClick:()=>en(!1),children:"關閉"}),(0,r.jsxs)(Z.z,{onClick:()=>{en(!1),eN(ea)},children:[(0,r.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"編輯"]})]})})]})}function U(){return(0,r.jsx)(s.Suspense,{fallback:(0,r.jsx)("div",{children:"Loading..."}),children:(0,r.jsx)(M,{})})}}},function(e){e.O(0,[3609,9015,1425,3676,5569,4438,9436,3909,2696,4116,4200,6818,5184,5711,2365,2313,7613,9885,2971,2117,1744],function(){return e(e.s=49942)}),_N_E=e.O()}]);