(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1815],{11873:function(e,t,s){Promise.resolve().then(s.bind(s,23479))},13041:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},23479:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var r=s(57437),a=s(2265),n=s(99376),l=s(5978),c=s(46410),i=s(32660),d=s(15868),o=s(38220),m=s(62720),x=s(44794),u=s(60044),g=s(92369),h=s(13041),p=s(12381),f=s(79820),j=s(69174),b=s(74378),N=s(83112),y=s(48195);function v(){var e;let t=(0,n.useParams)(),s=(0,n.useRouter)(),[v,w]=(0,a.useState)(null),[k,S]=(0,a.useState)([]),[R,Z]=(0,a.useState)(!0),[C,D]=(0,a.useState)(null),[F,T]=(0,a.useState)(!1),[O,P]=(0,a.useState)(!1),[A,z]=(0,a.useState)(!1),[B,Q]=(0,a.useState)(null),U=(e,t,s)=>e<=0?{fragrance:0,pg:0,vg:0,total:0}:{fragrance:e,pg:t,vg:s,total:e+t+s};(0,a.useEffect)(()=>{(async()=>{if(!t.id||"string"!=typeof t.id){D("香精 ID 無效"),Z(!1);return}try{var e;if(!c.db)throw Error("Firebase 未初始化");let s=await (0,l.QT)((0,l.doc)(c.db,"fragrances",t.id));if(!s.exists()){D("香精不存在"),Z(!1);return}let r=s.data(),a="未指定";if(r.supplierRef)try{let e=await (0,l.QT)(r.supplierRef);if(e.exists()){let t=e.data();a=(null==t?void 0:t.name)||"未指定"}}catch(e){console.error("Failed to fetch supplier name:",e)}let n="未知";if(r.createdBy)try{let e=await (0,l.QT)((0,l.doc)(c.db,"users",r.createdBy));if(e.exists()){let t=e.data();n=(null==t?void 0:t.name)||(null==t?void 0:t.email)||"未知"}}catch(e){console.error("Failed to fetch creator name:",e)}let i=(0,l.query)((0,l.collection)(c.db,"products"),(0,l.where)("currentFragranceRef","==",(0,l.doc)(c.db,"fragrances",t.id))),d=(await (0,l.getDocs)(i)).docs.map(e=>{var t;let s=e.data();return{id:e.id,code:s.code,name:s.name,status:s.status||"啟用",createdAt:(null===(t=s.createdAt)||void 0===t?void 0:t.toDate())||new Date}});S(d),w({id:s.id,code:r.code,name:r.name,fragranceType:r.fragranceType||r.status||"",fragranceStatus:r.fragranceStatus||r.status||"",supplierRef:r.supplierRef,supplierName:a,costPerUnit:r.costPerUnit||0,percentage:r.percentage||0,pgRatio:r.pgRatio||0,vgRatio:r.vgRatio||0,description:r.description,notes:r.notes,status:r.status,createdAt:(null===(e=r.createdAt)||void 0===e?void 0:e.toDate())||new Date,createdBy:r.createdBy,createdByName:n,productCount:d.length,remarks:r.remarks||"",currentStock:r.currentStock||0,safetyStockLevel:r.safetyStockLevel||0})}catch(e){console.error("Failed to fetch fragrance:",e),D("讀取香精資料失敗")}finally{Z(!1)}})()},[t.id]);let E=async()=>{if(null==v?void 0:v.supplierRef)try{let t=await (0,l.QT)(v.supplierRef);if(t.exists()){var e;let s=t.data(),r="未指定";if(s.liaisonPersonId&&c.db)try{let e=await (0,l.QT)((0,l.doc)(c.db,"users",s.liaisonPersonId));e.exists()&&(r=e.data().name||"未指定")}catch(e){console.error("獲取對接人員資訊失敗:",e)}Q({id:t.id,name:s.name||"未指定",products:s.products||"未指定",contactWindow:s.contactWindow||"未指定",contactMethod:s.contactMethod||"未指定",liaisonPersonName:r,notes:s.notes||"",createdAt:(null===(e=s.createdAt)||void 0===e?void 0:e.toDate())||new Date}),z(!0)}}catch(e){console.error("Failed to fetch supplier data:",e)}},L=async()=>{Z(!0);try{var e;if(!t.id||"string"!=typeof t.id){D("香精 ID 無效");return}if(!c.db)throw Error("Firebase 未初始化");let s=await (0,l.QT)((0,l.doc)(c.db,"fragrances",t.id));if(!s.exists()){D("香精不存在");return}let r=s.data(),a="未指定";if(r.supplierRef)try{let e=await (0,l.QT)(r.supplierRef);if(e.exists()){let t=e.data();a=(null==t?void 0:t.name)||"未指定"}}catch(e){console.error("Failed to fetch supplier name:",e)}let n="未知";if(r.createdBy)try{let e=await (0,l.QT)((0,l.doc)(c.db,"users",r.createdBy));if(e.exists()){let t=e.data();n=(null==t?void 0:t.name)||(null==t?void 0:t.email)||"未知"}}catch(e){console.error("Failed to fetch creator name:",e)}let i=(0,l.query)((0,l.collection)(c.db,"products"),(0,l.where)("currentFragranceRef","==",(0,l.doc)(c.db,"fragrances",t.id))),d=await (0,l.getDocs)(i),o=await Promise.all(d.docs.map(async e=>{var t;let s=e.data(),r="未指定";if(s.seriesRef)try{let e=await (0,l.QT)(s.seriesRef);if(e.exists()){let t=e.data();r=(null==t?void 0:t.name)||"未指定"}}catch(e){console.error("Failed to fetch series name:",e)}return{id:e.id,code:s.code,name:s.name,status:s.status||"啟用",seriesName:r,createdAt:(null===(t=s.createdAt)||void 0===t?void 0:t.toDate())||new Date}}));S(o),w({id:s.id,code:r.code,name:r.name,fragranceType:r.fragranceType||r.status,fragranceStatus:r.fragranceStatus||r.status||"active",supplierRef:r.supplierRef,supplierName:a,costPerUnit:r.costPerUnit,percentage:r.percentage,pgRatio:r.pgRatio,vgRatio:r.vgRatio,description:r.description,notes:r.notes,status:r.status,createdAt:(null===(e=r.createdAt)||void 0===e?void 0:e.toDate())||new Date,createdBy:r.createdBy,createdByName:n,productCount:o.length,remarks:r.remarks,currentStock:r.currentStock||0,safetyStockLevel:r.safetyStockLevel||0})}catch(e){console.error("Failed to refresh fragrance data:",e),D("重新載入香精資料失敗")}finally{Z(!1)}};return R?(0,r.jsx)("div",{className:"container mx-auto py-10",children:(0,r.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-10 h-10 border-4 border-border rounded-full animate-spin border-t-primary mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"載入中..."})]})})}):C||!v?(0,r.jsx)("div",{className:"container mx-auto py-10",children:(0,r.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-red-600 mb-4",children:C||"香精不存在"}),(0,r.jsxs)(p.z,{onClick:()=>s.back(),children:[(0,r.jsx)(i.Z,{className:"mr-2 h-4 w-4"}),"返回"]})]})})}):(0,r.jsxs)("div",{className:"container mx-auto py-10",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,r.jsx)(p.z,{variant:"outline",size:"icon",onClick:()=>s.back(),className:"hover:bg-pink-50 hover:border-pink-200 hover:text-pink-600",children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{className:"flex-grow",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-pink-600 to-rose-600 bg-clip-text text-transparent",children:"香精詳情"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2 font-mono",children:v.code})]}),(0,r.jsxs)(p.z,{onClick:()=>{T(!0)},className:"bg-gradient-to-r from-pink-600 to-rose-600 hover:from-pink-700 hover:to-rose-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[(0,r.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"編輯香精"]})]}),(0,r.jsxs)(f.Zb,{className:"mb-6 border-0 shadow-lg bg-gradient-to-r from-background to-pink-50/50",children:[(0,r.jsx)(f.Ol,{children:(0,r.jsx)(f.ll,{className:"flex items-center gap-2 text-pink-600",children:"核心資訊"})}),(0,r.jsx)(f.aY,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-pink-50 to-rose-50 rounded-lg",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-pink-600 to-rose-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)(o.Z,{className:"h-5 w-5 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-pink-600 font-medium",children:"香精名稱"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-pink-700",children:v.name})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-lg",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)(m.Z,{className:"h-5 w-5 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-green-600 font-medium",children:"香精編號"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-green-800",children:v.code})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)(x.Z,{className:"h-5 w-5 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-purple-600 font-medium",children:"現有庫存"}),(0,r.jsxs)("p",{className:"text-lg font-semibold text-purple-800",children:[v.currentStock||0," KG"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg cursor-pointer hover:from-orange-100 hover:to-orange-200 transition-all duration-200",onClick:E,children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg flex items-center justify-center",children:(0,r.jsx)(u.Z,{className:"h-5 w-5 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-orange-600 font-medium",children:"供應商"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-orange-800",children:v.supplierName})]})]})]})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)(f.Zb,{className:"border-0 shadow-lg",children:[(0,r.jsx)(f.Ol,{children:(0,r.jsx)(f.ll,{className:"text-lg text-primary",children:"基本資訊"})}),(0,r.jsx)(f.aY,{className:"space-y-4",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"香精名稱"}),(0,r.jsx)("span",{className:"font-medium",children:v.name})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"香精編號"}),(0,r.jsx)("span",{className:"font-medium",children:v.code})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"香精種類"}),(0,r.jsx)(j.C,{className:(e=>{switch(e){case"棉芯":return"bg-blue-100 text-blue-800 border-blue-300";case"陶瓷芯":return"bg-green-100 text-green-800 border-green-300";case"棉陶芯通用":return"bg-purple-100 text-purple-800 border-purple-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}})(v.fragranceType||""),children:(e=>{switch(e){case"棉芯":return"棉芯";case"陶瓷芯":return"陶瓷芯";case"棉陶芯通用":return"棉陶芯通用";default:return e||"未指定"}})(v.fragranceType||"")})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"啟用狀態"}),(0,r.jsx)(j.C,{className:"啟用"===v.fragranceStatus?"bg-green-100 text-green-800 border-green-300":"備用"===v.fragranceStatus?"bg-yellow-100 text-yellow-800 border-yellow-300":"棄用"===v.fragranceStatus?"bg-red-100 text-red-800 border-red-300":"bg-gray-100 text-gray-800 border-gray-300",children:v.fragranceStatus||"未指定"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"單位成本"}),(0,r.jsxs)("span",{className:"font-medium text-green-600",children:["$",(null===(e=v.costPerUnit)||void 0===e?void 0:e.toFixed(2))||"0.00"," / KG"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"安全庫存"}),(0,r.jsxs)("span",{className:"font-medium text-orange-600",children:[v.safetyStockLevel||0," KG"]})]})]})})]}),(0,r.jsxs)(f.Zb,{className:"border-0 shadow-lg bg-gradient-to-r from-blue-50 to-indigo-50",children:[(0,r.jsx)(f.Ol,{children:(0,r.jsx)(f.ll,{className:"text-lg text-primary",children:"配方欄位 (計算後)"})}),(0,r.jsx)(f.aY,{className:"space-y-4",children:(0,r.jsx)("div",{className:"space-y-3",children:(()=>{let e=U(v.percentage||0,v.pgRatio||0,v.vgRatio||0);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"香精比例"}),(0,r.jsxs)("span",{className:"font-medium text-blue-600",children:[e.fragrance,"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"PG比例"}),(0,r.jsxs)("span",{className:"font-medium text-green-600",children:[e.pg,"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"VG比例"}),(0,r.jsxs)("span",{className:"font-medium text-purple-600",children:[e.vg,"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-blue-200",children:[(0,r.jsx)("span",{className:"text-muted-foreground",children:"總比例"}),(0,r.jsxs)("span",{className:"font-medium text-orange-600",children:[e.total,"%"]})]})]})})()})})]}),(0,r.jsxs)(f.Zb,{className:"border-0 shadow-lg bg-gradient-to-r from-purple-50 to-pink-50",children:[(0,r.jsx)(f.Ol,{children:(0,r.jsxs)(f.ll,{className:"text-lg text-primary",children:["使用產品 (",v.productCount,")"]})}),(0,r.jsx)(f.aY,{className:"space-y-4",children:k.length>0?(0,r.jsx)("div",{className:"space-y-2",children:k.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-purple-200 cursor-pointer hover:bg-purple-50 transition-colors duration-200",onClick:()=>s.push("/dashboard/products/".concat(e.id)),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-sm font-medium text-gray-800",children:e.name}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["代號: ",e.code]})]})]}),(0,r.jsx)(j.C,{className:"啟用"===e.status?"bg-green-100 text-green-800 border-green-300":"備用"===e.status?"bg-yellow-100 text-yellow-800 border-yellow-300":"棄用"===e.status?"bg-red-100 text-red-800 border-red-300":"bg-gray-100 text-gray-800 border-gray-300",children:e.status||"未指定"})]},e.id))}):(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"text-muted-foreground",children:"暫無產品使用此香精"}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground mt-1",children:"在產品管理中為產品分配此香精"})]})})]})]}),(0,r.jsxs)(f.Zb,{className:"mt-6 border-0 shadow-lg bg-gradient-to-r from-yellow-50 to-amber-50",children:[(0,r.jsx)(f.Ol,{children:(0,r.jsxs)(f.ll,{className:"flex items-center justify-between text-lg text-yellow-800",children:[(0,r.jsx)("span",{children:"備註"}),(0,r.jsxs)(p.z,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"flex items-center gap-2 border-yellow-300 text-yellow-700 hover:bg-yellow-100",children:[(0,r.jsx)(d.Z,{className:"h-3 w-3"}),"編輯"]})]})}),(0,r.jsx)(f.aY,{children:v.remarks?(0,r.jsx)("p",{className:"text-sm leading-relaxed whitespace-pre-wrap text-yellow-900",children:v.remarks}):(0,r.jsx)("p",{className:"text-sm text-yellow-600",children:"暫無備註"})})]}),(0,r.jsx)(y.B,{itemId:v.id,itemType:"fragrance",itemCode:v.code,itemName:v.name,currentStock:v.currentStock||0}),(v.description||v.notes)&&(0,r.jsxs)(f.Zb,{className:"mt-6 border-0 shadow-lg",children:[(0,r.jsx)(f.Ol,{children:(0,r.jsx)(f.ll,{className:"text-lg text-primary",children:"詳細資訊"})}),(0,r.jsxs)(f.aY,{className:"space-y-4",children:[v.description&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-muted-foreground mb-2",children:"香精描述"}),(0,r.jsx)("p",{className:"text-sm leading-relaxed",children:v.description})]}),v.notes&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-medium text-muted-foreground mb-2",children:"備註"}),(0,r.jsx)("p",{className:"text-sm leading-relaxed",children:v.notes})]})]})]}),v&&(0,r.jsx)(b.$,{isOpen:F,onOpenChange:T,onFragranceUpdate:L,fragranceData:{...v,currentStock:v.currentStock||0}}),v&&(0,r.jsx)(b.$,{isOpen:O,onOpenChange:P,onFragranceUpdate:L,fragranceData:{...v,currentStock:v.currentStock||0,remarks:v.remarks||""}}),(0,r.jsx)(N.O,{isOpen:A,onOpenChange:z,title:"供應商詳情",subtitle:B?"查看供應商「".concat(B.name,"」的詳細資訊"):"",sections:B?[{title:"基本資訊",icon:(0,r.jsx)(u.Z,{className:"h-4 w-4"}),color:"blue",fields:[{label:"供應商名稱",value:B.name||"-",icon:(0,r.jsx)(u.Z,{className:"h-3 w-3"})},{label:"供應商品",value:B.products||"未指定",icon:(0,r.jsx)(x.Z,{className:"h-3 w-3"})}]},{title:"聯絡資訊",icon:(0,r.jsx)(g.Z,{className:"h-4 w-4"}),color:"green",fields:[{label:"聯絡窗口",value:B.contactWindow||"未指定",icon:(0,r.jsx)(g.Z,{className:"h-3 w-3"})},{label:"對接人員",value:B.liaisonPersonName||"未指定",icon:(0,r.jsx)(g.Z,{className:"h-3 w-3"})},{label:"聯絡方式",value:B.contactMethod||"未指定",icon:(0,r.jsx)(h.Z,{className:"h-3 w-3"})}]}]:[],actions:(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)(p.z,{variant:"outline",onClick:()=>z(!1),children:"關閉"}),B&&(0,r.jsx)(p.z,{onClick:()=>{z(!1)},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"編輯供應商"})]})})]})}}},function(e){e.O(0,[3609,9015,3676,5569,4438,9436,3909,2696,4116,4200,6818,2365,5753,4899,9885,4233,2971,2117,1744],function(){return e(e.s=11873)}),_N_E=e.O()}]);