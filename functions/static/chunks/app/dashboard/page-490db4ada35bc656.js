(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7702],{83750:function(e,t,s){Promise.resolve().then(s.bind(s,57035))},46221:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]])},66927:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]])},39989:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]])},44794:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},16275:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},70525:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},76865:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},95805:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(79205).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},99376:function(e,t,s){"use strict";var r=s(35475);s.o(r,"useParams")&&s.d(t,{useParams:function(){return r.useParams}}),s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},57035:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var r=s(57437),a=s(71245),n=s(99376),l=s(2265),o=s(5978),i=s(46410),c=s(14438),d=s(76865),u=s(44794),m=s(66927),x=s(12381),h=s(69174),f=s(79820),p=s(74291);function g(){let[e,t]=(0,l.useState)([]),[s,a]=(0,l.useState)(!1),[n,g]=(0,l.useState)(!1),b=async()=>{g(!0);try{if(!i.db)throw Error("Firebase 未初始化");let e=[],s=(0,o.query)((0,o.collection)(i.db,"materials"),(0,o.where)("currentStock","<","safetyStockLevel"));(await (0,o.getDocs)(s)).forEach(t=>{let s=t.data();s.currentStock<s.safetyStockLevel&&e.push({id:t.id,name:s.name,code:s.code,currentStock:s.currentStock,safetyStockLevel:s.safetyStockLevel,unit:s.unit||"",type:"material"})});let r=(0,o.query)((0,o.collection)(i.db,"fragrances"),(0,o.where)("currentStock","<","safetyStockLevel"));(await (0,o.getDocs)(r)).forEach(t=>{let s=t.data();s.currentStock<s.safetyStockLevel&&e.push({id:t.id,name:s.name,code:s.code,currentStock:s.currentStock,safetyStockLevel:s.safetyStockLevel,unit:s.unit||"",type:"fragrance"})}),t(e),e.length>0&&c.Am.warning("發現 ".concat(e.length," 個低庫存項目"),{description:"點擊查看詳細資訊",action:{label:"查看",onClick:()=>a(!0)}})}catch(e){console.error("檢查低庫存失敗:",e),c.Am.error("檢查低庫存失敗")}finally{g(!1)}};return((0,l.useEffect)(()=>{b();let e=setInterval(b,18e5);return()=>clearInterval(e)},[]),0===e.length)?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(x.z,{variant:"outline",size:"sm",onClick:()=>a(!0),className:"relative",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"低庫存通知",(0,r.jsx)(h.C,{variant:"destructive",className:"ml-2",children:e.length})]}),(0,r.jsx)(p.Vq,{open:s,onOpenChange:a,children:(0,r.jsxs)(p.cZ,{className:"max-w-4xl max-h-[80vh] overflow-y-auto","aria-describedby":"low-stock-dialog-description",children:[(0,r.jsxs)(p.fK,{children:[(0,r.jsxs)(p.$N,{className:"flex items-center gap-2",children:[(0,r.jsx)(d.Z,{className:"h-5 w-5 text-orange-500"}),"低庫存通知"]}),(0,r.jsx)(p.Be,{id:"low-stock-dialog-description",children:"以下項目庫存低於安全庫存水平，建議及時補貨"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)(f.Zb,{children:[(0,r.jsx)(f.Ol,{className:"pb-2",children:(0,r.jsx)(f.ll,{className:"text-sm font-medium",children:"總計"})}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:e.length}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"低庫存項目"})]})]}),(0,r.jsxs)(f.Zb,{children:[(0,r.jsx)(f.Ol,{className:"pb-2",children:(0,r.jsx)(f.ll,{className:"text-sm font-medium",children:"物料"})}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:e.filter(e=>"material"===e.type).length}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"低庫存物料"})]})]}),(0,r.jsxs)(f.Zb,{children:[(0,r.jsx)(f.Ol,{className:"pb-2",children:(0,r.jsx)(f.ll,{className:"text-sm font-medium",children:"香精"})}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:e.filter(e=>"fragrance"===e.type).length}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"低庫存香精"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"font-medium",children:"低庫存項目列表"}),(0,r.jsx)("div",{className:"grid gap-2",children:e.map(e=>(0,r.jsx)(f.Zb,{className:"border-orange-200",children:(0,r.jsx)(f.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:["material"===e.type?(0,r.jsx)(u.Z,{className:"h-5 w-5 text-blue-500"}):(0,r.jsx)(m.Z,{className:"h-5 w-5 text-purple-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium",children:e.name}),(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:["代號: ",e.code," | 類型: ","material"===e.type?"物料":"香精"]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"text-sm font-medium text-red-600",children:[e.currentStock," ",e.unit]}),(0,r.jsxs)("div",{className:"text-xs text-muted-foreground",children:["安全庫存: ",e.safetyStockLevel," ",e.unit]}),(0,r.jsx)(h.C,{variant:"destructive",className:"mt-1",children:"庫存不足"})]})]})})},e.id))})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[(0,r.jsx)(x.z,{variant:"outline",onClick:()=>a(!1),children:"關閉"}),(0,r.jsx)(x.z,{onClick:b,disabled:n,children:n?"檢查中...":"重新檢查"})]})]})]})})]})}var b=s(39989),j=s(16275),y=s(95805),v=s(46221),N=s(70525);function w(){let{appUser:e,isLoading:t}=(0,a.a)();(0,n.useRouter)();let[s,d]=(0,l.useState)({totalMaterials:0,totalFragrances:0,activeWorkOrders:0,pendingPurchaseOrders:0,lowStockItems:0,totalPersonnel:0,todayTimeEntries:0,thisMonthWorkOrders:0}),[m,x]=(0,l.useState)([]),[h,p]=(0,l.useState)(!0);(0,l.useEffect)(()=>{!t&&e&&(w(),k())},[t,e]);let w=async()=>{try{if(!i.db)return;let e=[(0,o.getDocs)((0,o.collection)(i.db,"materials")),(0,o.getDocs)((0,o.collection)(i.db,"fragrances")),(0,o.getDocs)((0,o.query)((0,o.collection)(i.db,"work_orders"),(0,o.where)("status","!=","completed"))),(0,o.getDocs)((0,o.query)((0,o.collection)(i.db,"purchase_orders"),(0,o.where)("status","==","pending"))),(0,o.getDocs)((0,o.collection)(i.db,"users"))],[t,s,r,a,n]=await Promise.all(e),l=new Date;l.setHours(0,0,0,0);let c=await (0,o.getDocs)((0,o.query)((0,o.collection)(i.db,"timeEntries"),(0,o.where)("createdAt",">=",l))),u=new Date(l.getFullYear(),l.getMonth(),1),m=await (0,o.getDocs)((0,o.query)((0,o.collection)(i.db,"work_orders"),(0,o.where)("createdAt",">=",u))),x=0,h=t.docs.filter(e=>{let t=e.data();return t.minStock>0&&t.stock<t.minStock}),f=s.docs.filter(e=>{let t=e.data();return t.minStock>0&&t.stock<t.minStock});x=h.length+f.length,d({totalMaterials:t.size,totalFragrances:s.size,activeWorkOrders:r.size,pendingPurchaseOrders:a.size,lowStockItems:x,totalPersonnel:n.size,todayTimeEntries:c.size,thisMonthWorkOrders:m.size})}catch(e){console.error("載入統計數據失敗:",e),c.Am.error("載入統計數據失敗")}finally{p(!1)}},k=async()=>{try{if(!i.db)return;let e=await (0,o.getDocs)((0,o.query)((0,o.collection)(i.db,"work_orders"),(0,o.Xo)("createdAt","desc"),(0,o.b9)(3))),t=[];e.docs.forEach(e=>{let s=e.data();t.push({id:e.id,type:"work_order",title:"工單 ".concat(s.workOrderNumber),description:"產品: ".concat(s.productName),timestamp:s.createdAt,status:s.status})}),x(t)}catch(e){console.error("載入最近活動失敗:",e)}},Z=e=>{window.location.href=e};return(0,r.jsxs)("div",{className:"container mx-auto py-10",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"系統總覽"}),(0,r.jsxs)("p",{className:"text-muted-foreground mt-2",children:["歡迎回來, ",(null==e?void 0:e.name)||"使用者","!"]})]}),(0,r.jsx)(g,{})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[(0,r.jsxs)(f.Zb,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",onClick:()=>Z("/dashboard/work-orders"),children:[(0,r.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(f.ll,{className:"text-sm font-medium text-blue-700",children:"工單管理"}),(0,r.jsx)(b.Z,{className:"h-4 w-4 text-blue-600"})]}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-blue-900",children:"生產工單"}),(0,r.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"管理生產流程"})]})]}),(0,r.jsxs)(f.Zb,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",onClick:()=>Z("/dashboard/inventory"),children:[(0,r.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(f.ll,{className:"text-sm font-medium text-green-700",children:"庫存管理"}),(0,r.jsx)(u.Z,{className:"h-4 w-4 text-green-600"})]}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-900",children:"物料庫存"}),(0,r.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"監控庫存狀況"})]})]}),(0,r.jsxs)(f.Zb,{className:"bg-gradient-to-br from-purple-50 to-violet-50 border-purple-200 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",onClick:()=>Z("/dashboard/purchase-orders"),children:[(0,r.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(f.ll,{className:"text-sm font-medium text-purple-700",children:"採購管理"}),(0,r.jsx)(j.Z,{className:"h-4 w-4 text-purple-600"})]}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-purple-900",children:"採購訂單"}),(0,r.jsx)("p",{className:"text-xs text-purple-600 mt-1",children:"管理供應商訂單"})]})]}),(0,r.jsxs)(f.Zb,{className:"bg-gradient-to-br from-orange-50 to-amber-50 border-orange-200 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",onClick:()=>Z("/dashboard/personnel"),children:[(0,r.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(f.ll,{className:"text-sm font-medium text-orange-700",children:"人員管理"}),(0,r.jsx)(y.Z,{className:"h-4 w-4 text-orange-600"})]}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-orange-900",children:"員工資料"}),(0,r.jsx)("p",{className:"text-xs text-orange-600 mt-1",children:"管理人員資訊"})]})]}),(0,r.jsxs)(f.Zb,{className:"bg-gradient-to-br from-red-50 to-pink-50 border-red-200 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",onClick:()=>Z("/dashboard/reports"),children:[(0,r.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(f.ll,{className:"text-sm font-medium text-red-700",children:"報表分析"}),(0,r.jsx)(v.Z,{className:"h-4 w-4 text-red-600"})]}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-red-900",children:"數據分析"}),(0,r.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"查看統計報表"})]})]}),(0,r.jsxs)(f.Zb,{className:"bg-gradient-to-br from-teal-50 to-cyan-50 border-teal-200 hover:shadow-lg transition-all duration-200 cursor-pointer hover:scale-105",onClick:()=>Z("/dashboard/cost-management"),children:[(0,r.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(f.ll,{className:"text-sm font-medium text-teal-700",children:"成本管理"}),(0,r.jsx)(N.Z,{className:"h-4 w-4 text-teal-600"})]}),(0,r.jsxs)(f.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-teal-900",children:"成本分析"}),(0,r.jsx)("p",{className:"text-xs text-teal-600 mt-1",children:"監控成本狀況"})]})]})]}),(0,r.jsxs)(f.Zb,{className:"bg-gradient-to-r from-background to-muted/50 border-border",children:[(0,r.jsx)(f.Ol,{children:(0,r.jsx)(f.ll,{className:"text-lg font-semibold text-foreground",children:"快速操作"})}),(0,r.jsx)(f.aY,{children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"點擊上方卡片可快速訪問對應的管理功能。這裡是未來放置儀表板卡片和圖表的地方，您可以快速訪問常用功能。"})})]})]})}},69174:function(e,t,s){"use strict";s.d(t,{C:function(){return i}});var r=s(57437);s(2265);var a=s(37053),n=s(90535),l=s(93448);let o=(0,n.j)("inline-flex items-center justify-center rounded-full px-2 py-1 text-xs font-medium focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"bg-blue-100 text-blue-700",secondary:"bg-muted text-muted-foreground",destructive:"bg-red-100 text-red-700",outline:"text-foreground border border-border",success:"bg-green-100 text-green-700",warning:"bg-yellow-100 text-yellow-700",purple:"bg-purple-100 text-purple-700"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,asChild:n=!1,...i}=e,c=n?a.g7:"span";return(0,r.jsx)(c,{"data-slot":"badge",className:(0,l.cn)(o({variant:s}),t),...i})}},79820:function(e,t,s){"use strict";s.d(t,{Ol:function(){return l},SZ:function(){return i},Zb:function(){return n},aY:function(){return c},eW:function(){return d},ll:function(){return o}});var r=s(57437);s(2265);var a=s(93448);function n(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-lg border-2 p-6 shadow-md",t),...s})}function l(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 has-data-[slot=card-action]:grid-cols-[1fr_auto]",t),...s})}function o(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",t),...s})}function i(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",t),...s})}function c(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("",t),...s})}function d(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center",t),...s})}},74291:function(e,t,s){"use strict";s.d(t,{$N:function(){return h},Be:function(){return f},Vq:function(){return i},cN:function(){return x},cZ:function(){return u},fK:function(){return m}});var r=s(57437),a=s(2265),n=s(49027),l=s(32489),o=s(93448);let i=n.fC;n.xz;let c=n.h_;n.x8;let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.aV,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a})});d.displayName=n.aV.displayName;let u=a.forwardRef((e,t)=>{let{className:s,children:a,...i}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(d,{}),(0,r.jsxs)(n.VY,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-2xl translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-lg max-h-[90vh] overflow-y-auto","p-4 sm:p-6 mx-2 sm:mx-0","max-w-[calc(100vw-1rem)] sm:max-w-lg md:max-w-xl lg:max-w-2xl","max-h-[95vh] sm:max-h-[90vh]",s),...i,children:[a,(0,r.jsxs)(n.x8,{className:"absolute right-3 top-3 sm:right-4 sm:top-4 z-10 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground p-1",children:[(0,r.jsx)(l.Z,{className:"h-5 w-5 sm:h-4 sm:w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"關閉"})]})]})]})});u.displayName=n.VY.displayName;let m=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left pb-4 border-b border-border",t),...s})};m.displayName="DialogHeader";let x=e=>{let{className:t,...s}=e;return(0,r.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end gap-2 sm:gap-0 sm:space-x-2 pt-4 border-t border-border","[&>*]:w-full sm:[&>*]:w-auto",t),...s})};x.displayName="DialogFooter";let h=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.Dx,{ref:t,className:(0,o.cn)("text-xl sm:text-2xl font-bold flex items-center gap-2 sm:gap-3 leading-tight",s),...a})});h.displayName=n.Dx.displayName;let f=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(n.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...a})});f.displayName=n.dk.displayName},71245:function(e,t,s){"use strict";s.d(t,{H:function(){return u},a:function(){return m}});var r=s(57437),a=s(2265),n=s(82148),l=s(46410),o=s(5978),i=s(14438),c=s(47903);let d=(0,a.createContext)({user:null,appUser:null,isLoading:!0,login:async()=>!1,logout:async()=>{},hasPermission:()=>!1,hasAnyPermission:()=>!1,hasAllPermissions:()=>!1}),u=e=>{let{children:t}=e,[s,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(null),[h,f]=(0,a.useState)(!0),p=async e=>{(0,c.fF)("loadUserData 開始執行",{uid:e.uid});try{let t=(0,l.T)();if(!t){(0,c.vU)("Firestore 未初始化"),x(null);return}(0,c.fF)("獲取用戶文檔",{uid:e.uid});let s=await (0,o.QT)((0,o.doc)(t,"users",e.uid));if(s.exists()){(0,c.fF)("用戶文檔存在");let e=s.data();if((0,c.fF)("用戶資料",e),e.roleRef){(0,c.fF)("用戶有角色引用，獲取角色資料");try{let t=await (0,o.QT)(e.roleRef);if(t.exists()){let s=t.data();e.roleName=s.displayName||s.name,e.permissions=s.permissions||[],(0,c.fF)("角色資料載入成功",{role:e.roleName,permissions:e.permissions})}else(0,c.ZK)("角色文檔不存在")}catch(e){(0,c.vU)("載入角色資料失敗",e)}}else(0,c.ZK)("用戶沒有角色引用");(0,c.fF)("設置 appUser",e),x(e)}else(0,c.ZK)("用戶文檔不存在"),x(null)}catch(e){(0,c.vU)("載入用戶資料失敗",e),x(null)}},g=async(e,t)=>{try{let s=(0,l.E7)();if(!s)return i.Am.error("系統初始化失敗"),!1;let r=e.includes("@")?e:"".concat(e,"@deer-lab.local"),a=await (0,n.e5)(s,r,t);return await p(a.user),i.Am.success("登入成功！"),!0}catch(e){return(0,c.vU)("登入失敗",e),i.Am.error(e.message||"登入失敗"),!1}},b=async()=>{try{let e=(0,l.E7)();e&&(await (0,n.w7)(e),u(null),x(null),i.Am.success("已成功登出"),window.location.href="/")}catch(e){(0,c.vU)("登出失敗",e),i.Am.error("登出失敗")}};return(0,a.useEffect)(()=>{(0,c.fF)("AuthContext useEffect 開始執行");try{let e=(0,l.E7)();if(!e){(0,c.vU)("Auth 未初始化，設置 isLoading = false"),f(!1);return}(0,c.fF)("設置 onAuthStateChanged 監聽器");let t=(0,n.Aj)(e,async e=>{try{(0,c.fF)("onAuthStateChanged 觸發",{uid:(null==e?void 0:e.uid)||null}),e?(u(e),(0,c.fF)("開始載入用戶資料"),await p(e)):(u(null),x(null),(0,c.fF)("用戶已登出，清除狀態")),f(!1),(0,c.fF)("設置 isLoading = false")}catch(e){(0,c.vU)("onAuthStateChanged 回調執行失敗",e),f(!1)}});return()=>{(0,c.fF)("清理 onAuthStateChanged 監聽器"),"function"==typeof t&&t()}}catch(e){(0,c.vU)("AuthContext useEffect 執行失敗",e),f(!1)}},[]),(0,r.jsx)(d.Provider,{value:{user:s,appUser:m,isLoading:h,login:g,logout:b,hasPermission:e=>null!=m&&!!m.permissions&&m.permissions.includes(e),hasAnyPermission:e=>null!=m&&!!m.permissions&&e.some(e=>m.permissions.includes(e)),hasAllPermissions:e=>null!=m&&!!m.permissions&&e.every(e=>m.permissions.includes(e))},children:t})},m=()=>(0,a.useContext)(d)}},function(e){e.O(0,[3609,9015,3676,5569,4438,9436,4116,2365,2971,2117,1744],function(){return e(e.s=83750)}),_N_E=e.O()}]);