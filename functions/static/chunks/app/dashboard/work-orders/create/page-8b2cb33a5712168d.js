(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9069],{28871:function(e,t,a){Promise.resolve().then(a.bind(a,13493))},32660:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},73618:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},41671:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},51817:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},44794:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]])},99397:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},76865:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},11239:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(79205).Z)("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},99376:function(e,t,a){"use strict";var r=a(35475);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}}),a.o(r,"useSearchParams")&&a.d(t,{useSearchParams:function(){return r.useSearchParams}})},13493:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return S}});var r=a(57437),s=a(2265),n=a(99376),l=a(5978),i=a(46410),c=a(14438),o=a(32660),d=a(44794),m=a(41671);let u=(0,a(79205).Z)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);var f=a(73618),g=a(11239),x=a(76865),h=a(51817),p=a(99397),b=a(69958),N=a(12381),j=a(79820),y=a(40279),v=a(75060),w=a(15291),k=a(33804),M=a(69174);function S(){let e=(0,n.useRouter)(),[t,a]=(0,s.useState)([]),[S,C]=(0,s.useState)([]),[A,R]=(0,s.useState)([]),[Z,E]=(0,s.useState)(null),[_,I]=(0,s.useState)(1),[P,G]=(0,s.useState)(!0),[T,L]=(0,s.useState)(!1),[O,D]=(0,s.useState)(""),V=e=>e%1==0?e.toString():e.toFixed(3),Q=t.filter(e=>e.name.toLowerCase().includes(O.toLowerCase())||e.code.toLowerCase().includes(O.toLowerCase())||e.seriesName&&e.seriesName.toLowerCase().includes(O.toLowerCase())).sort((e,t)=>{let a=e.seriesName||"未指定",r=t.seriesName||"未指定";return a!==r?a.localeCompare(r,"zh-TW"):e.name.localeCompare(t.name,"zh-TW")});(0,s.useEffect)(()=>{(async()=>{G(!0);try{if(!i.db)throw Error("Firebase 未初始化");let e=await (0,l.getDocs)((0,l.collection)(i.db,"products")),t=await Promise.all(e.docs.map(async e=>{let t=e.data(),a="未指定";if(t.seriesRef)try{let e=await (0,l.QT)(t.seriesRef);e.exists()&&(a=e.data().name||"未指定")}catch(e){console.error("獲取產品系列失敗:",e)}let r="未指定",s="未指定",n={percentage:0,pgRatio:0,vgRatio:0};if(t.currentFragranceRef)try{let e=await (0,l.QT)(t.currentFragranceRef);if(e.exists()){let t=e.data();r=t.name||"未指定",s=t.code||"未指定",n={percentage:(null==t?void 0:t.percentage)||0,pgRatio:(null==t?void 0:t.pgRatio)||0,vgRatio:(null==t?void 0:t.vgRatio)||0}}}catch(e){console.error("獲取香精資訊失敗:",e)}let i=[];if(t.specificMaterials&&t.specificMaterials.length>0)try{i=(await Promise.all(t.specificMaterials.map(e=>(0,l.QT)(e)))).filter(e=>e.exists()).map(e=>{let t=e.data();return(null==t?void 0:t.name)||"未知材料"})}catch(e){console.error("獲取專屬材料失敗:",e)}let c=[],o=[];if(t.seriesRef)try{let e=await (0,l.QT)(t.seriesRef);if(e.exists()){let t=e.data();t.commonMaterials&&t.commonMaterials.length>0&&(o=t.commonMaterials,c=(await Promise.all(t.commonMaterials.map(e=>(0,l.QT)(e)))).filter(e=>e.exists()).map(e=>{let t=e.data();return(null==t?void 0:t.name)||"未知材料"}))}}catch(e){console.error("獲取通用材料失敗:",e)}return{id:e.id,name:t.name,code:t.code,seriesName:a,seriesRef:t.seriesRef,currentFragranceRef:t.currentFragranceRef,fragranceName:r,fragranceCode:s,fragranceFormula:n,nicotineMg:t.nicotineMg||0,specificMaterials:t.specificMaterials||[],specificMaterialNames:i,commonMaterials:o,commonMaterialNames:c}}));a(t);let r=(await (0,l.getDocs)((0,l.collection)(i.db,"materials"))).docs.map(e=>({id:e.id,...e.data()}));C(r);let s=(await (0,l.getDocs)((0,l.collection)(i.db,"fragrances"))).docs.map(e=>({id:e.id,...e.data()}));R(s),console.log("載入的物料列表:",r.length,"個"),console.log("載入的香精列表:",s.length,"個")}catch(e){console.error("載入資料失敗:",e),c.Am.error("載入資料失敗")}finally{G(!1)}})()},[]);let z=()=>{if(!Z||!S.length||!A.length)return console.log("缺少必要資料:",{hasSelectedProduct:!!Z,materialsCount:S.length,fragrancesCount:A.length,selectedProduct:Z,materials:S,fragrances:A}),[];console.log("計算物料需求:",{selectedProduct:{id:Z.id,name:Z.name,fragranceName:Z.fragranceName,fragranceCode:Z.fragranceCode,specificMaterialNames:Z.specificMaterialNames,commonMaterialNames:Z.commonMaterialNames},materialsCount:S.length,fragrancesCount:A.length,targetQuantity:_});let e=new Map;if(!Z.fragranceFormula)return console.error("錯誤：沒有香精配方資料"),c.Am.error("抓取錯誤：沒有香精配方資料"),[];let{percentage:t,pgRatio:a,vgRatio:r}=Z.fragranceFormula;if(console.log("香精配方資料:",{percentage:t,pgRatio:a,vgRatio:r}),!t||t<=0)return console.error("錯誤：香精比例為0或無效"),c.Am.error("抓取錯誤：香精比例為0或無效"),[];let s={fragrance:t,pg:a,vg:r};if(console.log("直接使用香精詳情中的配方比例（避免浮點數精度問題）:",{香精:t+"%",PG:a+"%",VG:r+"%",總計:t+a+r+"%"}),console.log("使用香精比例:",s),Z.fragranceName&&"未指定"!==Z.fragranceName){let t=s.fragrance/100*_,a=A.find(e=>e.code===Z.fragranceCode||e.name===Z.fragranceName||e.name.includes(Z.fragranceName)||Z.fragranceCode&&e.code.includes(Z.fragranceCode));console.log("香精匹配結果:",{fragranceCode:Z.fragranceCode,fragranceName:Z.fragranceName,foundFragrance:a?{id:a.id,code:a.code,name:a.name,currentStock:a.currentStock}:null,allFragrances:A.map(e=>({code:e.code,name:e.name,currentStock:e.currentStock}))});let r=a&&a.currentStock||0,n=r>=t;e.set("fragrance",{materialId:a?a.id:"fragrance",materialCode:Z.fragranceCode,materialName:Z.fragranceName,requiredQuantity:t,currentStock:r,unit:"KG",hasEnoughStock:n,category:"fragrance",ratio:s.fragrance}),console.log("添加香精:",Z.fragranceName,t,"比例:",s.fragrance,"庫存:",r,"充足:",n)}let n=(0,b.n)(S,"pg");if(n){let t=s.pg/100*_;e.set(n.id,{materialId:n.id,materialCode:n.code,materialName:n.name,requiredQuantity:t,currentStock:n.currentStock||0,unit:n.unit||"KG",hasEnoughStock:(n.currentStock||0)>=t,category:"pg",ratio:s.pg}),console.log("添加PG:",n.name,t,"比例:",s.pg)}else console.warn("找不到PG物料");let l=(0,b.n)(S,"vg");if(l){let t=s.vg/100*_;e.set(l.id,{materialId:l.id,materialCode:l.code,materialName:l.name,requiredQuantity:t,currentStock:l.currentStock||0,unit:l.unit||"KG",hasEnoughStock:(l.currentStock||0)>=t,category:"vg",ratio:s.vg}),console.log("添加VG:",l.name,t,"比例:",s.vg)}else console.warn("找不到VG物料");let i=(0,b.n)(S,"nicotine");if(i){let t=Z.nicotineMg&&Z.nicotineMg>0?_*Z.nicotineMg/250:0;e.set(i.id,{materialId:i.id,materialCode:i.code,materialName:i.name,requiredQuantity:t,currentStock:i.currentStock||0,unit:i.unit||"KG",hasEnoughStock:(i.currentStock||0)>=t,category:"nicotine",ratio:0}),console.log("添加尼古丁:",i.name,t,"濃度:",Z.nicotineMg)}console.log("專屬材料名稱:",Z.specificMaterialNames),Z.specificMaterialNames&&Z.specificMaterialNames.length>0&&Z.specificMaterialNames.forEach(t=>{let a=S.find(e=>e.name===t);if(console.log("專屬材料匹配:",{materialName:t,foundMaterial:a?{id:a.id,code:a.code,name:a.name}:null}),a){let t=0,r=a.unit||"個";a.name.includes("包裝")||a.name.includes("盒")||a.name.includes("貼紙")||a.name.includes("底座")||a.name.includes("空倉")||a.name.includes("小塞")?(t=_,r="個"):(t=_,r=a.unit||"個"),e.set(a.id,{materialId:a.id,materialCode:a.code,materialName:a.name,requiredQuantity:t,currentStock:a.currentStock||0,unit:r,hasEnoughStock:(a.currentStock||0)>=t,category:"specific",ratio:1}),console.log("添加專屬材料:",a.name,t,r)}else console.log("找不到專屬材料:",t)}),console.log("通用材料名稱:",Z.commonMaterialNames),Z.commonMaterialNames&&Z.commonMaterialNames.length>0&&Z.commonMaterialNames.forEach(t=>{let a=S.find(e=>e.name===t);if(a){let t=0,r=a.unit||"個";a.name.includes("包裝")||a.name.includes("盒")||a.name.includes("貼紙")||a.name.includes("底座")||a.name.includes("空倉")||a.name.includes("小塞")?(t=_,r="個"):(t=_,r=a.unit||"個"),e.set(a.id,{materialId:a.id,materialCode:a.code,materialName:a.name,requiredQuantity:t,currentStock:a.currentStock||0,unit:r,hasEnoughStock:(a.currentStock||0)>=t,category:"common",ratio:1}),console.log("添加通用材料:",a.name,t,r)}else console.log("找不到通用材料:",t)});let o=Array.from(e.values());return o.sort((e,t)=>{let a=["fragrance","pg","vg","nicotine","specific","common","other"],r=a.indexOf(e.category||"other"),s=a.indexOf(t.category||"other");return r!==s?r-s:(e.materialName||"").localeCompare(t.materialName||"")}),console.log("最終物料需求:",o),o},F=()=>{let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),s=Math.floor(1e3*Math.random()).toString().padStart(3,"0");return"WO-".concat(t).concat(a).concat(r,"-").concat(s)},q=async()=>{if(!Z){c.Am.error("請選擇產品");return}if(_<=0){c.Am.error("請輸入有效的目標產量");return}let t=z(),a=t.filter(e=>["fragrance","pg","vg","nicotine"].includes(e.category)&&!e.hasEnoughStock);if(a.length>0){c.Am.error("以下核心物料庫存不足：".concat(a.map(e=>e.materialName).join(", ")));return}L(!0);try{let a=F(),r={code:a,productRef:(0,l.doc)(i.db,"products",Z.id),productSnapshot:{code:Z.code,name:Z.name,seriesName:Z.seriesName,fragranceName:Z.fragranceName,fragranceCode:Z.fragranceCode,nicotineMg:Z.nicotineMg},billOfMaterials:t.map(e=>({id:e.materialId,name:e.materialName,code:e.materialCode,type:"fragrance"===e.category?"fragrance":"material",quantity:["fragrance","pg","vg","nicotine"].includes(e.category)?e.requiredQuantity:0,unit:e.unit,ratio:e.ratio||0,isCalculated:!0,category:e.category,usedQuantity:0})),targetQuantity:_,actualQuantity:0,status:"預報",qcStatus:"未檢驗",createdAt:new Date,createdByRef:null,updatedAt:new Date},s=await (0,l.addDoc)((0,l.collection)(i.db,"workOrders"),r);c.Am.success("工單 ".concat(a," 建立成功")),e.push("/dashboard/work-orders/".concat(s.id))}catch(e){console.error("建立工單失敗:",e),c.Am.error("建立工單失敗")}finally{L(!1)}},K=z(),Y=K.some(e=>["fragrance","pg","vg","nicotine"].includes(e.category)&&!e.hasEnoughStock);return P?(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"w-16 h-16 border-4 border-slate-200 rounded-full animate-spin"}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-16 h-16 border-4 border-transparent border-t-blue-600 rounded-full animate-spin"})]}),(0,r.jsx)("p",{className:"text-slate-600 mt-6 font-medium text-lg",children:"載入中..."}),(0,r.jsx)("p",{className:"text-slate-500 text-sm mt-2",children:"正在準備工單建立環境"})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50",children:(0,r.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,r.jsxs)(N.z,{variant:"ghost",size:"sm",onClick:()=>e.back(),className:"hover:bg-white/80 backdrop-blur-sm transition-all duration-200",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-2"}),"返回"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 bg-clip-text text-transparent",children:"建立新工單"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2 text-lg font-medium",children:"選擇產品並設定生產參數"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-8",children:[(0,r.jsxs)("div",{className:"xl:col-span-1 space-y-6",children:[(0,r.jsxs)(j.Zb,{className:"shadow-lg border-0 bg-white",children:[(0,r.jsxs)(j.Ol,{className:"bg-gradient-to-r from-blue-200 to-blue-300 text-blue-800 rounded-t-xl",children:[(0,r.jsxs)(j.ll,{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(d.Z,{className:"h-5 w-5 text-blue-600"})}),"產品選擇"]}),(0,r.jsx)(j.SZ,{className:"text-blue-700",children:"選擇要生產的產品"})]}),(0,r.jsxs)(j.aY,{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(v._,{htmlFor:"product",className:"text-sm font-semibold text-gray-700 mb-3 block",children:"產品"}),(0,r.jsxs)(w.Ph,{onValueChange:e=>{E(t.find(t=>t.id===e)||null)},children:[(0,r.jsx)(w.i4,{className:"h-12 border-2 border-gray-200 hover:border-blue-300 focus:border-blue-500 transition-all duration-200 bg-white",children:(0,r.jsx)(w.ki,{placeholder:"選擇要生產的產品"})}),(0,r.jsx)(w.Bw,{children:Q.map(e=>(0,r.jsx)(w.Ql,{value:e.id,children:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("span",{className:"font-medium",children:["[",e.seriesName||"未指定","] - ",e.name]}),(0,r.jsx)("span",{className:"text-xs text-slate-500",children:e.code})]})},e.id))})]})]}),Z&&(0,r.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4",children:[(0,r.jsxs)("h4",{className:"font-semibold mb-4 text-green-800 flex items-center gap-2",children:[(0,r.jsx)(m.Z,{className:"h-4 w-4"}),"產品資訊"]}),(0,r.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"產品系列："}),(0,r.jsx)("span",{className:"font-semibold text-gray-800",children:Z.seriesName})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"產品名稱："}),(0,r.jsx)("span",{className:"font-semibold text-gray-800",children:Z.name})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"產品代號："}),(0,r.jsx)("span",{className:"font-semibold text-gray-800",children:Z.code})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"香精："}),(0,r.jsx)("span",{className:"font-semibold text-gray-800",children:Z.fragranceName})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"尼古丁濃度："}),(0,r.jsxs)("span",{className:"font-semibold text-gray-800",children:[Z.nicotineMg," mg/ml"]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(v._,{htmlFor:"targetQuantity",className:"text-sm font-semibold text-gray-700 mb-3 block",children:"目標產量 (KG)"}),(0,r.jsx)(y.I,{type:"number",value:_,onChange:e=>I(Number(e.target.value)),placeholder:"1",min:"1",className:"h-12 border-2 border-gray-200 hover:border-blue-300 focus:border-blue-500 transition-all duration-200 bg-white"})]})]})]}),(0,r.jsxs)(j.Zb,{className:"shadow-lg border-0 bg-white",children:[(0,r.jsxs)(j.Ol,{className:"bg-gradient-to-r from-purple-200 to-purple-300 text-purple-800 rounded-t-xl",children:[(0,r.jsxs)(j.ll,{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(u,{className:"h-5 w-5 text-purple-600"})}),"工單資訊"]}),(0,r.jsx)(j.SZ,{className:"text-purple-700",children:"工單基本資訊"})]}),(0,r.jsx)(j.aY,{className:"p-6",children:(0,r.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border border-purple-200 rounded-xl p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"工單號碼："}),(0,r.jsx)("span",{className:"font-bold text-purple-700 text-lg font-mono",children:F()})]})})})]})]}),(0,r.jsx)("div",{className:"xl:col-span-2",children:(0,r.jsxs)(j.Zb,{className:"shadow-lg border-0 bg-white",children:[(0,r.jsxs)(j.Ol,{className:"bg-gradient-to-r from-orange-200 to-orange-300 text-orange-800 rounded-t-xl",children:[(0,r.jsxs)(j.ll,{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(f.Z,{className:"h-5 w-5 text-orange-600"})}),"物料需求分析"]}),(0,r.jsxs)(j.SZ,{className:"text-orange-700",children:["基於目標產量 ",_,"KG 的物料需求"]})]}),(0,r.jsx)(j.aY,{className:"p-6",children:Z?(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-bold text-xl mb-6 text-blue-700 border-b-2 border-blue-200 pb-4 flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded-full"}),(0,r.jsx)(g.Z,{className:"h-5 w-5"}),"核心液體 (按香精配方比例)"]}),(0,r.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-200 shadow-lg",children:(0,r.jsxs)(k.iA,{children:[(0,r.jsx)(k.xD,{children:(0,r.jsxs)(k.SC,{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:[(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"物料代號"}),(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"物料名稱"}),(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"需求量 (KG)"}),(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"當前庫存"}),(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"狀態"})]})}),(0,r.jsx)(k.RM,{children:K.filter(e=>["fragrance","pg","vg","nicotine"].includes(e.category)).map((e,t)=>(0,r.jsxs)(k.SC,{className:"hover:bg-gray-50/50 transition-all duration-200",children:[(0,r.jsx)(k.pj,{className:"font-semibold text-gray-800",children:e.materialCode}),(0,r.jsx)(k.pj,{className:"font-medium text-gray-700",children:e.materialName}),(0,r.jsxs)(k.pj,{className:"font-bold text-blue-600 text-lg",children:[V(e.requiredQuantity)," ",e.unit]}),(0,r.jsxs)(k.pj,{className:"text-gray-600",children:[e.currentStock," ",e.unit]}),(0,r.jsx)(k.pj,{children:e.hasEnoughStock?(0,r.jsxs)(M.C,{className:"bg-green-100 text-green-800 border border-green-300 font-semibold",children:[(0,r.jsx)(m.Z,{className:"h-3 w-3 mr-1"}),"庫存充足"]}):(0,r.jsxs)(M.C,{variant:"destructive",className:"font-semibold",children:[(0,r.jsx)(x.Z,{className:"h-3 w-3 mr-1"}),"庫存不足"]})})]},t))})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-bold text-xl mb-6 text-gray-700 border-b-2 border-gray-200 pb-4 flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-4 h-4 bg-gray-500 rounded-full"}),(0,r.jsx)(d.Z,{className:"h-5 w-5"}),"其他材料 (手動配置使用數量)"]}),(0,r.jsx)("div",{className:"overflow-hidden rounded-xl border border-gray-200 shadow-lg",children:(0,r.jsxs)(k.iA,{children:[(0,r.jsx)(k.xD,{children:(0,r.jsxs)(k.SC,{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:[(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"物料代號"}),(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"物料名稱"}),(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"當前庫存"}),(0,r.jsx)(k.ss,{className:"text-gray-700 font-bold",children:"狀態"})]})}),(0,r.jsx)(k.RM,{children:K.filter(e=>!["fragrance","pg","vg","nicotine"].includes(e.category)).map((e,t)=>(0,r.jsxs)(k.SC,{className:"hover:bg-gray-50/50 transition-all duration-200",children:[(0,r.jsx)(k.pj,{className:"font-semibold text-gray-800",children:e.materialCode}),(0,r.jsx)(k.pj,{className:"font-medium text-gray-700",children:e.materialName}),(0,r.jsxs)(k.pj,{className:"text-gray-600",children:[e.currentStock," ",e.unit]}),(0,r.jsx)(k.pj,{children:(0,r.jsxs)(M.C,{className:"bg-blue-100 text-blue-800 border border-blue-300 font-semibold",children:[(0,r.jsx)(d.Z,{className:"h-3 w-3 mr-1"}),"手動配置"]})})]},t))})]})})]}),(0,r.jsx)("div",{className:"pt-6",children:(0,r.jsx)(N.z,{onClick:q,disabled:!Z||Y||T,className:"w-full h-16 text-xl font-bold bg-gradient-to-r from-green-400 to-emerald-500 hover:from-green-500 hover:to-emerald-600 text-white shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",size:"lg",children:T?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.Z,{className:"mr-3 h-6 w-6 animate-spin"}),"建立中..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.Z,{className:"mr-3 h-6 w-6"}),"建立工單"]})})})]}):(0,r.jsxs)("div",{className:"text-center py-16",children:[(0,r.jsx)("div",{className:"w-32 h-32 mx-auto mb-8 bg-gradient-to-br from-blue-100 to-indigo-200 rounded-full flex items-center justify-center",children:(0,r.jsx)(d.Z,{className:"h-16 w-16 text-blue-600"})}),(0,r.jsx)("h3",{className:"text-2xl font-semibold text-gray-700 mb-4",children:"請選擇產品"}),(0,r.jsx)("p",{className:"text-gray-500 text-lg",children:"選擇產品後將顯示詳細的物料需求分析"})]})})]})})]})]})})}},69174:function(e,t,a){"use strict";a.d(t,{C:function(){return c}});var r=a(57437);a(2265);var s=a(37053),n=a(90535),l=a(93448);let i=(0,n.j)("inline-flex items-center justify-center rounded-full px-2 py-1 text-xs font-medium focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"bg-blue-100 text-blue-700",secondary:"bg-muted text-muted-foreground",destructive:"bg-red-100 text-red-700",outline:"text-foreground border border-border",success:"bg-green-100 text-green-700",warning:"bg-yellow-100 text-yellow-700",purple:"bg-purple-100 text-purple-700"}},defaultVariants:{variant:"default"}});function c(e){let{className:t,variant:a,asChild:n=!1,...c}=e,o=n?s.g7:"span";return(0,r.jsx)(o,{"data-slot":"badge",className:(0,l.cn)(i({variant:a}),t),...c})}},79820:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},SZ:function(){return c},Zb:function(){return n},aY:function(){return o},eW:function(){return d},ll:function(){return i}});var r=a(57437);a(2265);var s=a(93448);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-lg border-2 p-6 shadow-md",t),...a})}function l(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 has-data-[slot=card-action]:grid-cols-[1fr_auto]",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-footer",className:(0,s.cn)("flex items-center",t),...a})}},40279:function(e,t,a){"use strict";a.d(t,{I:function(){return l}});var r=a(57437),s=a(2265),n=a(93448);let l=s.forwardRef((e,t)=>{let{className:a,type:s,...l}=e;return(0,r.jsx)("input",{type:s,className:(0,n.cn)("flex w-full rounded-md border border-slate-200 bg-white px-3 text-sm ring-offset-white file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-slate-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-800 dark:bg-slate-950 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus-visible:ring-slate-300","h-11 sm:h-10 py-3 sm:py-2","text-base sm:text-sm","min-h-[44px]",a),ref:t,...l})});l.displayName="Input"},75060:function(e,t,a){"use strict";a.d(t,{_:function(){return l}});var r=a(57437);a(2265);var s=a(6394),n=a(93448);function l(e){let{className:t,...a}=e;return(0,r.jsx)(s.f,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}},15291:function(e,t,a){"use strict";a.d(t,{Bw:function(){return x},Ph:function(){return d},Ql:function(){return h},i4:function(){return u},ki:function(){return m}});var r=a(57437),s=a(2265),n=a(33911),l=a(40875),i=a(22135),c=a(30401),o=a(93448);let d=n.fC;n.ZA;let m=n.B4,u=s.forwardRef((e,t)=>{let{className:a,children:s,...i}=e;return(0,r.jsxs)(n.xz,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-slate-800 dark:bg-slate-950 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus:ring-slate-300",a),...i,children:[s,(0,r.jsx)(n.JO,{asChild:!0,children:(0,r.jsx)(l.Z,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=n.xz.displayName;let f=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.u_,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})});f.displayName=n.u_.displayName;let g=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.$G,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...s,children:(0,r.jsx)(l.Z,{className:"h-4 w-4"})})});g.displayName=n.$G.displayName;let x=s.forwardRef((e,t)=>{let{className:a,children:s,position:l="popper",...i}=e;return(0,r.jsx)(n.h_,{children:(0,r.jsxs)(n.VY,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 bg-white text-slate-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...i,children:[(0,r.jsx)(f,{}),(0,r.jsx)(n.l_,{className:(0,o.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),(0,r.jsx)(g,{})]})})});x.displayName=n.VY.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.__,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...s})}).displayName=n.__.displayName;let h=s.forwardRef((e,t)=>{let{className:a,children:s,...l}=e;return(0,r.jsxs)(n.ck,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",a),...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(n.wU,{children:(0,r.jsx)(c.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(n.eT,{children:s})]})});h.displayName=n.ck.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)(n.Z0,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-slate-100 dark:bg-slate-800",a),...s})}).displayName=n.Z0.displayName},33804:function(e,t,a){"use strict";a.d(t,{RM:function(){return i},SC:function(){return c},iA:function(){return n},pj:function(){return d},ss:function(){return o},xD:function(){return l}});var r=a(57437);a(2265);var s=a(93448);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,r.jsx)("table",{"data-slot":"table",className:(0,s.cn)("w-full caption-bottom text-sm",t),...a})})}function l(e){let{className:t,...a}=e;return(0,r.jsx)("thead",{"data-slot":"table-header",className:(0,s.cn)("",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("tbody",{"data-slot":"table-body",className:(0,s.cn)("[&_tr:last-child]:border-0",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("tr",{"data-slot":"table-row",className:(0,s.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b border-border transition-colors",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("th",{"data-slot":"table-head",className:(0,s.cn)("bg-muted text-foreground font-semibold border-b border-border p-3 text-left align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("td",{"data-slot":"table-cell",className:(0,s.cn)("p-3 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}},69958:function(e,t,a){"use strict";a.d(t,{n:function(){return s}});let r={PG_MATERIAL_CODES:["UV3404503","PG"],VG_MATERIAL_CODES:["UV3400698","VG"],NICOTINE_MATERIAL_CODES:["UV3405520","NIC","丁鹽","尼古丁"],PG_MATERIAL_NAMES:["PG丙二醇","PG","丙二醇"],VG_MATERIAL_NAMES:["VG甘油","VG","甘油"],NICOTINE_MATERIAL_NAMES:["丁鹽","尼古丁","NicSalt"]},s=(e,t)=>e.find(e=>{var a;let s=(null===(a=e.code)||void 0===a?void 0:a.toUpperCase())||"",n=e.name||"";switch(t){case"pg":return r.PG_MATERIAL_CODES.some(e=>s.includes(e))||r.PG_MATERIAL_NAMES.some(e=>n.includes(e));case"vg":return r.VG_MATERIAL_CODES.some(e=>s.includes(e))||r.VG_MATERIAL_NAMES.some(e=>n.includes(e));case"nicotine":return r.NICOTINE_MATERIAL_CODES.some(e=>s.includes(e))||r.NICOTINE_MATERIAL_NAMES.some(e=>n.includes(e));default:return!1}})},6394:function(e,t,a){"use strict";a.d(t,{f:function(){return i}});var r=a(2265),s=a(66840),n=a(57437),l=r.forwardRef((e,t)=>(0,n.jsx)(s.WV.label,{...e,ref:t,onMouseDown:t=>{var a;t.target.closest("button, input, select, textarea")||(null===(a=e.onMouseDown)||void 0===a||a.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var i=l}},function(e){e.O(0,[3609,9015,3676,5569,4438,9436,3909,2696,4200,2365,2971,2117,1744],function(){return e(e.s=28871)}),_N_E=e.O()}]);