(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4806],{42708:function(e,s,t){Promise.resolve().then(t.bind(t,40516))},60044:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(79205).Z)("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]])},83229:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(79205).Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},37683:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(79205).Z)("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]])},40516:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var a=t(57437),r=t(2265),l=t(99376),n=t(5978),c=t(46410),i=t(32660),d=t(15868),m=t(44794),o=t(37683),x=t(62720),h=t(60044),u=t(76865),p=t(32489),f=t(83229),j=t(12381),g=t(79820),N=t(23675),y=t(5960),b=t(14438),w=t(48195);function v(){let e=(0,l.useParams)(),s=(0,l.useRouter)(),[t,v]=(0,r.useState)(null),[k,S]=(0,r.useState)(!0),[Z,C]=(0,r.useState)(null),[M,z]=(0,r.useState)(!1),[O,L]=(0,r.useState)(!1),[A,B]=(0,r.useState)(""),[I,P]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(!e.id||"string"!=typeof e.id){C("物料 ID 無效"),S(!1);return}try{var s;if(!c.db)throw Error("Firebase 未初始化");let t=await (0,n.QT)((0,n.doc)(c.db,"materials",e.id));if(!t.exists()){C("物料不存在"),S(!1);return}let a=t.data(),r="未指定";if(a.supplierRef)try{let e=await (0,n.QT)(a.supplierRef);if(e.exists()){let s=e.data();r=(null==s?void 0:s.name)||"未指定"}}catch(e){console.error("Failed to fetch supplier name:",e)}let l="未知";if(a.createdBy)try{let e=await (0,n.QT)((0,n.doc)(c.db,"users",a.createdBy));if(e.exists()){let s=e.data();l=(null==s?void 0:s.name)||(null==s?void 0:s.email)||"未知"}}catch(e){console.error("Failed to fetch creator name:",e)}v({id:t.id,code:a.code,name:a.name,category:a.category,subCategory:a.subCategory,mainCategoryId:a.mainCategoryId,subCategoryId:a.subCategoryId,supplierRef:a.supplierRef,supplierName:r,safetyStockLevel:a.safetyStockLevel||0,costPerUnit:a.costPerUnit||0,unit:a.unit,currentStock:a.currentStock||0,notes:a.notes,createdAt:(null===(s=a.createdAt)||void 0===s?void 0:s.toDate())||new Date,createdBy:a.createdBy,createdByName:l})}catch(e){console.error("Failed to fetch material:",e),C("讀取物料資料失敗")}finally{S(!1)}})()},[e.id]);let _=async()=>{window.location.reload()},D=e=>null==e?"0":e%1==0?e.toString():e.toFixed(2),E=async()=>{if(t&&c.db){P(!0);try{await (0,n.r7)((0,n.doc)(c.db,"materials",t.id),{notes:A}),v(e=>e?{...e,notes:A}:null),L(!1),b.Am.success("備註已更新")}catch(e){console.error("更新備註失敗:",e),b.Am.error("更新備註失敗")}finally{P(!1)}}};return k?(0,a.jsx)("div",{className:"container mx-auto py-10",children:(0,a.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 border-4 border-border rounded-full animate-spin border-t-primary mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"載入中..."})]})})}):Z||!t?(0,a.jsx)("div",{className:"container mx-auto py-10",children:(0,a.jsx)("div",{className:"flex justify-center items-center py-20",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-red-600 mb-4",children:Z||"物料不存在"}),(0,a.jsxs)(j.z,{onClick:()=>s.back(),children:[(0,a.jsx)(i.Z,{className:"mr-2 h-4 w-4"}),"返回"]})]})})}):(0,a.jsxs)("div",{className:"container mx-auto py-4 px-4 sm:py-10 sm:px-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4 mb-6 sm:mb-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[(0,a.jsx)(j.z,{variant:"outline",size:"icon",onClick:()=>s.back(),className:"hover:bg-primary/10 hover:border-primary/20 flex-shrink-0",children:(0,a.jsx)(i.Z,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-grow sm:flex-grow-0",children:[(0,a.jsx)("h1",{className:"text-xl sm:text-3xl font-bold text-primary",children:"物料詳情"}),(0,a.jsx)("p",{className:"text-sm sm:text-lg text-muted-foreground font-mono",children:t.name})]})]}),(0,a.jsxs)(j.z,{onClick:()=>{z(!0)},className:"bg-primary hover:bg-primary/90 w-full sm:w-auto",children:[(0,a.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"編輯物料"]})]}),(0,a.jsxs)(g.Zb,{className:"mb-6 border-0 shadow-lg bg-gradient-to-r from-background to-primary/10",children:[(0,a.jsx)(g.Ol,{children:(0,a.jsx)(g.ll,{className:"flex items-center gap-2 text-primary",children:"核心資訊"})}),(0,a.jsx)(g.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 sm:p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg",children:[(0,a.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(m.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-blue-600 font-medium",children:"物料名稱"}),(0,a.jsx)("p",{className:"text-lg sm:text-xl font-bold text-blue-800 truncate",children:t.name}),(0,a.jsxs)("p",{className:"text-xs text-blue-600 mt-1 truncate",children:["代碼：",t.code]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 sm:p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-lg",children:[(0,a.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(o.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-green-600 font-medium",children:"分類資訊"}),(0,a.jsx)("p",{className:"text-lg sm:text-xl font-bold text-green-800 truncate",children:t.category||"未分類"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-green-700 truncate",children:t.subCategory||"未分類"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 sm:p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg",children:[(0,a.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(x.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-purple-600 font-medium",children:"現有庫存"}),(0,a.jsx)("p",{className:"text-lg sm:text-xl font-bold text-purple-800",children:t.currentStock}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-purple-700 truncate",children:t.unit||"未指定"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 sm:p-4 bg-gradient-to-r from-orange-50 to-orange-100 rounded-lg",children:[(0,a.jsx)("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(h.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-xs sm:text-sm text-orange-600 font-medium",children:"供應商"}),(0,a.jsx)("p",{className:"text-lg sm:text-xl font-bold text-orange-800 truncate",children:t.supplierName})]})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,a.jsxs)(g.Zb,{className:"border-0 shadow-lg",children:[(0,a.jsx)(g.Ol,{children:(0,a.jsx)(g.ll,{className:"text-lg text-primary",children:"基本資訊"})}),(0,a.jsx)(g.aY,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"供應商"}),(0,a.jsx)("span",{className:"font-medium",children:t.supplierName})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"建立人員"}),(0,a.jsx)("span",{className:"font-medium",children:t.createdByName})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"建立時間"}),(0,a.jsx)("span",{className:"font-medium",children:t.createdAt.toLocaleDateString("zh-TW")})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"單位"}),(0,a.jsx)("span",{className:"font-medium",children:t.unit||"未指定"})]})]})})]}),(0,a.jsxs)(g.Zb,{className:"border-0 shadow-lg",children:[(0,a.jsx)(g.Ol,{children:(0,a.jsx)(g.ll,{className:"text-lg text-primary",children:"庫存資訊"})}),(0,a.jsx)(g.aY,{className:"space-y-4",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"目前庫存"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"font-medium ".concat(t&&(t.currentStock||0)<(t.safetyStockLevel||0)?"text-red-600":""),children:[t.currentStock," ",t.unit]}),!!t&&(t.currentStock||0)<(t.safetyStockLevel||0)&&(0,a.jsx)(u.Z,{className:"h-4 w-4 text-red-600"})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"安全庫存"}),(0,a.jsxs)("span",{className:"font-medium text-green-600",children:[t.safetyStockLevel," ",t.unit]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"單位成本"}),(0,a.jsxs)("span",{className:"font-medium text-blue-600",children:["$",D(t.costPerUnit)]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"庫存價值"}),(0,a.jsxs)("span",{className:"font-medium text-purple-600",children:["$",D((t.currentStock||0)*(t.costPerUnit||0))]})]})]})})]})]}),(0,a.jsx)(w.B,{itemId:t.id,itemType:"material",itemCode:t.code,itemName:t.name,currentStock:t.currentStock||0}),(0,a.jsxs)(g.Zb,{className:"mt-6 border-0 shadow-lg",children:[(0,a.jsx)(g.Ol,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(g.ll,{className:"text-lg text-primary",children:"備註"}),!O&&(0,a.jsxs)(j.z,{variant:"outline",size:"sm",onClick:()=>{B((null==t?void 0:t.notes)||""),L(!0)},className:"h-8 px-3",children:[(0,a.jsx)(d.Z,{className:"mr-1 h-3 w-3"}),"編輯"]})]})}),(0,a.jsx)(g.aY,{children:O?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(N.g,{value:A,onChange:e=>B(e.target.value),placeholder:"輸入備註內容...",className:"min-h-[100px] resize-none"}),(0,a.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2",children:[(0,a.jsxs)(j.z,{variant:"outline",size:"sm",onClick:()=>{B((null==t?void 0:t.notes)||""),L(!1)},disabled:I,className:"w-full sm:w-auto",children:[(0,a.jsx)(p.Z,{className:"mr-1 h-3 w-3"}),"取消"]}),(0,a.jsxs)(j.z,{size:"sm",onClick:E,disabled:I,className:"w-full sm:w-auto",children:[(0,a.jsx)(f.Z,{className:"mr-1 h-3 w-3"}),I?"儲存中...":"儲存"]})]})]}):(0,a.jsx)("p",{className:"text-sm leading-relaxed text-muted-foreground",children:t.notes||"暫無備註"})})]}),!!t&&(t.currentStock||0)<(t.safetyStockLevel||0)&&(0,a.jsxs)(g.Zb,{className:"mt-6 border-0 shadow-lg bg-gradient-to-r from-red-50 to-red-100 border-red-200",children:[(0,a.jsx)(g.Ol,{children:(0,a.jsxs)(g.ll,{className:"flex items-center gap-2 text-red-700",children:[(0,a.jsx)(u.Z,{className:"h-5 w-5"}),"庫存警告"]})}),(0,a.jsx)(g.aY,{children:(0,a.jsxs)("p",{className:"text-red-700",children:["目前庫存 (",t.currentStock," ",t.unit,") 低於安全庫存 (",t.safetyStockLevel," ",t.unit,")， 建議及時補充庫存。"]})})]}),t&&(0,a.jsx)(y.Z,{isOpen:M,onOpenChange:z,materialData:t,onMaterialUpdate:_})]})}}},function(e){e.O(0,[3609,9015,3676,5569,4438,9436,3909,2696,4116,4200,6818,2365,5753,4899,195,4233,2971,2117,1744],function(){return e(e.s=42708)}),_N_E=e.O()}]);