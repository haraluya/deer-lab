"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7349],{38220:function(e,s,r){r.d(s,{Z:function(){return a}});let a=(0,r(79205).Z)("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]])},97349:function(e,s,r){r.d(s,{u:function(){return I}});var a=r(57437),t=r(2265),l=r(29501),n=r(13590),o=r(67119),c=r(1850),i=r(5978),d=r(46410),m=r(14438),x=r(12381),u=r(74291),g=r(80670),h=r(40279),p=r(15291),f=r(4317),b=r(44794),j=r(62720),v=r(38220),N=r(40875),y=r(73247),w=r(30401);let C=o.Ry({name:o.Z_().min(2,{message:"產品名稱至少需要 2 個字元"}),seriesId:o.Z_({required_error:"必須選擇一個產品系列"}),fragranceId:o.Z_({required_error:"必須選擇一個香精"}),nicotineMg:o.oQ.number().min(0,{message:"尼古丁濃度不能為負數"}).default(0),specificMaterialIds:o.IX(o.Z_()).optional().default([]),status:o.Km(["啟用","備用","棄用"]).default("啟用")});function I(e){let{isOpen:s,onOpenChange:r,onProductUpdate:o,productData:I}=e,[M,k]=(0,t.useState)(!1),[T,S]=(0,t.useState)({series:[],fragrances:[],materials:[]}),[R,L]=(0,t.useState)(null),[z,E]=(0,t.useState)({percentage:0,pgRatio:0,vgRatio:0}),[P,Z]=(0,t.useState)(""),[F,D]=(0,t.useState)(!1),[W,X]=(0,t.useState)(""),[J,_]=(0,t.useState)(""),[G,V]=(0,t.useState)([]),A=!!I,B=(0,l.cI)({resolver:(0,n.F)(C),defaultValues:{name:"",seriesId:void 0,fragranceId:void 0,nicotineMg:0,specificMaterialIds:[],status:"啟用"}});(0,t.useEffect)(()=>{s&&(async()=>{try{if(!d.db)throw Error("Firebase 未初始化");let e=(0,i.getDocs)((0,i.collection)(d.db,"productSeries")),s=(0,i.getDocs)((0,i.query)((0,i.collection)(d.db,"fragrances"),(0,i.where)("fragranceStatus","==","啟用"))),r=(0,i.getDocs)((0,i.collection)(d.db,"materials")),[a,t,l]=await Promise.all([e,s,r]);S({series:a.docs.map(e=>({value:e.id,label:e.data().name})),fragrances:t.docs.map(e=>({value:e.id,label:"".concat(e.data().code,"(").concat(e.data().name,")")})).sort((e,s)=>e.label.localeCompare(s.label,"zh-TW")),materials:l.docs.map(e=>{let s=e.data(),r=s.category||"未分類",a=s.subCategory||"未分類";return{value:e.id,label:"".concat(s.name," [").concat(r,"] [").concat(a,"]"),category:r,subCategory:a,materialName:s.name}}).sort((e,s)=>e.category!==s.category?e.category.localeCompare(s.category,"zh-TW"):e.subCategory!==s.subCategory?e.subCategory.localeCompare(s.subCategory,"zh-TW"):e.materialName.localeCompare(s.materialName,"zh-TW"))});let n=a.docs.map(e=>{let s=e.data();console.log("單個系列資料:",{id:e.id,data:s});let r=s.productType;r&&""!==r||(r="其他(ETC)");let a={"罐裝油(BOT)":"BOT","一代棉芯煙彈(OMP)":"OMP","一代陶瓷芯煙彈(OTP)":"OTP","五代陶瓷芯煙彈(FTP)":"FTP","其他(ETC)":"ETC"}[r]||"ETC";return{id:e.id,name:s.name,code:s.code,productType:a}});console.log("完整系列資訊:",n),V(n)}catch(e){console.error("讀取下拉選單資料失敗:",e),m.Am.error("讀取下拉選單資料失敗。")}})()},[s]);let O=async e=>{if(!e||!d.db){L(null),E({percentage:0,pgRatio:0,vgRatio:0});return}try{let s=await (0,i.QT)((0,i.doc)(d.db,"fragrances",e));if(s.exists()){let e=s.data();L(e),E({percentage:e.percentage||0,pgRatio:e.pgRatio||0,vgRatio:e.vgRatio||0})}}catch(e){console.error("獲取香精配方失敗:",e)}};async function Q(e){k(!0);let s=m.Am.loading(A?"正在更新產品...":"正在新增產品...");try{let a=(0,c.$C)(),t={...e};if(A&&I){let r=(0,c.V1)(a,"updateProduct");await r({productId:I.id,...t}),m.Am.success("產品 ".concat(e.name," 已更新。"),{id:s})}else{let r=(0,c.V1)(a,"createProduct");await r(t),m.Am.success("產品 ".concat(e.name," 已建立。"),{id:s})}o(),r(!1)}catch(r){let e=r instanceof Error?r.message:"發生未知錯誤。";m.Am.error(e,{id:s})}finally{k(!1)}}return(0,t.useEffect)(()=>{if(s&&I&&T.series.length>0&&T.fragrances.length>0&&T.materials.length>0){var e,r,a,t,l,n,o;console.log("重置表單資料:",{name:I.name,seriesId:null===(e=I.seriesRef)||void 0===e?void 0:e.id,fragranceId:null===(r=I.currentFragranceRef)||void 0===r?void 0:r.id,nicotineMg:I.nicotineMg,specificMaterialIds:null===(a=I.specificMaterials)||void 0===a?void 0:a.map(e=>e.id)}),B.reset({name:I.name||"",seriesId:(null===(t=I.seriesRef)||void 0===t?void 0:t.id)||void 0,fragranceId:(null===(l=I.currentFragranceRef)||void 0===l?void 0:l.id)||void 0,nicotineMg:I.nicotineMg||0,specificMaterialIds:(null===(n=I.specificMaterials)||void 0===n?void 0:n.map(e=>e.id))||[],status:I.status||"啟用"}),(null===(o=I.currentFragranceRef)||void 0===o?void 0:o.id)&&O(I.currentFragranceRef.id)}else s&&!I&&(B.reset({name:"",seriesId:void 0,fragranceId:void 0,nicotineMg:0,specificMaterialIds:[],status:"啟用"}),X(""),_(""))},[s,I,B,T.series.length,T.fragrances.length,T.materials.length]),(0,t.useEffect)(()=>{let e=e=>{e.target.closest(".fragrance-dropdown")||(D(!1),Z(""))};return F&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[F]),(0,t.useEffect)(()=>{let e=B.watch("seriesId");if(console.log("系列選擇改變:",{seriesId:e,isEditMode:A,seriesInfoLength:G.length}),e&&!A&&G.length>0){let s=G.find(s=>s.id===e);if(console.log("找到的系列信息:",s),s&&s.productType&&s.code){let e=Math.floor(1e3+9e3*Math.random());X(String(e));let r="".concat(s.productType,"-").concat(s.code,"-").concat(e);_(r),console.log("成功生成產品代碼:",{productType:s.productType,code:s.code,randomNumber:e,fullCode:r})}else X(""),_(""),console.log("未找到系列信息或產品類型:",{hasSelectedSeriesInfo:!!s,productType:null==s?void 0:s.productType,code:null==s?void 0:s.code})}else X(""),_(""),e&&!A&&0===G.length&&console.log("系列資訊尚未載入完成")},[B.watch("seriesId"),G,A]),(0,a.jsx)(u.Vq,{open:s,onOpenChange:r,children:(0,a.jsxs)(u.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-white",children:[(0,a.jsxs)(u.fK,{className:"pb-4 border-b border-gray-200",children:[(0,a.jsxs)(u.$N,{className:"flex items-center gap-3 text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center",children:(0,a.jsx)(b.Z,{className:"h-5 w-5 text-white"})}),A?"編輯產品":"新增產品"]}),(0,a.jsx)(u.Be,{className:"text-gray-600 mt-2",children:A?"修改產品詳細資訊":"建立新的產品資料"})]}),(0,a.jsx)(g.l0,{...B,children:(0,a.jsxs)("form",{onSubmit:B.handleSubmit(Q),className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm",children:[(0,a.jsxs)("h3",{className:"text-lg font-bold flex items-center gap-2 text-blue-800",children:[(0,a.jsx)("div",{className:"w-6 h-6 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(j.Z,{className:"h-3 w-3 text-blue-600"})}),"基本資料"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)(g.Wi,{control:B.control,name:"name",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.xJ,{className:"space-y-2",children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"產品名稱 *"}),(0,a.jsx)(g.NI,{children:(0,a.jsx)(h.I,{placeholder:"例如：茉莉綠茶香精",className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",...s})}),(0,a.jsx)(g.zG,{})]})}}),(0,a.jsx)(g.Wi,{control:B.control,name:"seriesId",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.xJ,{className:"space-y-2",children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"所屬系列 *"}),(0,a.jsxs)(p.Ph,{onValueChange:s.onChange,value:s.value,children:[(0,a.jsx)(g.NI,{children:(0,a.jsx)(p.i4,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:(0,a.jsx)(p.ki,{placeholder:"選擇一個產品系列"})})}),(0,a.jsx)(p.Bw,{children:T.series.map(e=>(0,a.jsx)(p.Ql,{value:e.value,children:e.label},e.value))})]}),(0,a.jsx)(g.zG,{})]})}}),(0,a.jsx)(g.Wi,{control:B.control,name:"nicotineMg",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.xJ,{className:"space-y-2",children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"丁鹽濃度 (MG)"}),(0,a.jsx)(g.NI,{children:(0,a.jsx)(h.I,{type:"number",placeholder:"0",className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",...s})}),(0,a.jsx)(g.zG,{})]})}}),(0,a.jsx)(g.Wi,{control:B.control,name:"status",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.xJ,{className:"space-y-2",children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"產品狀態"}),(0,a.jsxs)(p.Ph,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,a.jsx)(g.NI,{children:(0,a.jsx)(p.i4,{className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",children:(0,a.jsx)(p.ki,{placeholder:"選擇產品狀態"})})}),(0,a.jsxs)(p.Bw,{children:[(0,a.jsx)(p.Ql,{value:"啟用",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),"啟用"]})}),(0,a.jsx)(p.Ql,{value:"備用",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full"}),"備用"]})}),(0,a.jsx)(p.Ql,{value:"棄用",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-pink-500 rounded-full"}),"棄用"]})})]})]}),(0,a.jsx)(g.zG,{})]})}}),!A&&B.watch("seriesId")&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(g.xJ,{className:"space-y-2",children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"產品編號"}),(0,a.jsx)("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-md",children:(0,a.jsx)("span",{className:"text-sm font-mono text-gray-700",children:W||"載入中..."})}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"4位數隨機編號，系統自動生成"}),!W&&(0,a.jsx)("p",{className:"text-xs text-red-500",children:"如果持續載入中，請重新選擇系列"})]}),(0,a.jsxs)(g.xJ,{className:"space-y-2",children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"產品代碼預覽"}),(0,a.jsx)("div",{className:"px-3 py-2 bg-blue-50 border border-blue-300 rounded-md",children:(0,a.jsx)("span",{className:"text-sm font-mono text-blue-700",children:J||"載入中..."})}),(0,a.jsx)("p",{className:"text-xs text-blue-500",children:"格式：[系列類型]-[系列代號]-[隨機編號]"})]})]}),A&&I&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(g.xJ,{className:"space-y-2",children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"產品編號"}),(0,a.jsx)("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-md",children:(0,a.jsx)("span",{className:"text-sm font-mono text-gray-700",children:I.productNumber||"N/A"})}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"產品編號不可修改"})]}),(0,a.jsxs)(g.xJ,{className:"space-y-2",children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"產品代號"}),(0,a.jsx)("div",{className:"px-3 py-2 bg-gray-50 border border-gray-300 rounded-md",children:(0,a.jsx)("span",{className:"text-sm font-mono text-gray-700",children:I.code||"N/A"})}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"產品代號不可修改"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6 p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200 shadow-sm",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold flex items-center gap-3 text-green-800",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(v.Z,{className:"h-4 w-4 text-green-600"})}),"使用香精"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6",children:(0,a.jsx)(g.Wi,{control:B.control,name:"fragranceId",render:e=>{var s;let{field:r}=e;return(0,a.jsxs)(g.xJ,{children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"選擇香精 *"}),(0,a.jsxs)("div",{className:"relative fragrance-dropdown",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between w-full px-3 py-2 border border-gray-300 rounded-md bg-white cursor-pointer hover:border-green-500 focus-within:border-green-500 focus-within:ring-2 focus-within:ring-green-500",onClick:()=>D(!F),children:[(0,a.jsx)("span",{className:r.value?"text-gray-900":"text-gray-500",children:r.value&&(null===(s=T.fragrances.find(e=>e.value===r.value))||void 0===s?void 0:s.label)||"選擇一個香精"}),(0,a.jsx)(N.Z,{className:"h-4 w-4 text-gray-400 transition-transform ".concat(F?"rotate-180":"")})]}),F&&(0,a.jsxs)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-2 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(y.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(h.I,{type:"text",placeholder:"搜尋香精...",value:P,onChange:e=>Z(e.target.value),className:"pl-10 border-0 focus:ring-0 focus:border-0",onClick:e=>e.stopPropagation()})]})}),(0,a.jsxs)("div",{className:"max-h-48 overflow-y-auto",children:[T.fragrances.filter(e=>e.label.toLowerCase().includes(P.toLowerCase())).map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-green-50 ".concat(r.value===e.value?"bg-green-100":""),onClick:()=>{r.onChange(e.value),O(e.value),D(!1),Z("")},children:[(0,a.jsx)("span",{className:"text-sm",children:e.label}),r.value===e.value&&(0,a.jsx)(w.Z,{className:"h-4 w-4 text-green-600"})]},e.value)),0===T.fragrances.filter(e=>e.label.toLowerCase().includes(P.toLowerCase())).length&&(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-gray-500 text-center",children:"沒有找到符合的香精"})]})]})]}),(0,a.jsx)(g.zG,{})]})}})}),R&&(0,a.jsxs)("div",{className:"bg-white rounded-lg p-4 border border-green-200",children:[(0,a.jsx)("h4",{className:"font-semibold text-green-800 mb-3",children:"香精配方資訊"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"香精名稱："}),(0,a.jsx)("span",{className:"font-medium",children:R.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"香精代號："}),(0,a.jsx)("span",{className:"font-medium",children:R.code})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"香精比例："}),(0,a.jsxs)("span",{className:"font-medium text-green-600",children:[z.percentage,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"PG比例："}),(0,a.jsxs)("span",{className:"font-medium text-blue-600",children:[z.pgRatio,"%"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-gray-600",children:"VG比例："}),(0,a.jsxs)("span",{className:"font-medium text-purple-600",children:[z.vgRatio,"%"]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-6 p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200 shadow-sm",children:[(0,a.jsxs)("h3",{className:"text-xl font-bold flex items-center gap-3 text-purple-800",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)(b.Z,{className:"h-4 w-4 text-purple-600"})}),"專屬材料"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6",children:(0,a.jsx)(g.Wi,{control:B.control,name:"specificMaterialIds",render:e=>{let{field:s}=e;return(0,a.jsxs)(g.xJ,{children:[(0,a.jsx)(g.lX,{className:"text-sm font-semibold text-gray-700",children:"選擇專屬材料"}),(0,a.jsx)(f.N,{options:T.materials,selected:s.value||[],onChange:s.onChange,placeholder:"選擇該產品專屬使用的材料..."}),(0,a.jsx)(g.zG,{})]})}})})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-200",children:[(0,a.jsx)(x.z,{type:"button",variant:"outline",onClick:()=>r(!1),className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"取消"}),(0,a.jsx)(x.z,{type:"submit",disabled:M,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"處理中..."]}):A?"儲存更新":"確認新增"})]})]})})]})})}},4317:function(e,s,r){r.d(s,{N:function(){return o}});var a=r(57437),t=r(2265),l=r(32489),n=r(69174);function o(e){let{options:s,selected:r,onChange:o,onAddNew:c,placeholder:i="Select options...",className:d,allowCreate:m=!1}=e,[x,u]=t.useState(!1),[g,h]=t.useState(""),p=t.useRef(null),f=e=>{h(""),o([...r,e])},b=()=>{g.trim()&&c&&(c(g.trim()),h(""))},j=e=>{o(r.filter(s=>s!==e))},v=s.filter(e=>r.includes(e.value)),N=s.filter(e=>{if(r.includes(e.value))return!1;if(!g.trim())return!0;let s=g.trim().toLowerCase(),a=(e.materialName||e.label).toLowerCase(),t=(e.category||"").toLowerCase(),l=(e.subCategory||"").toLowerCase(),n=e.label.toLowerCase();return a.includes(s)||t.includes(s)||l.includes(s)||n.includes(s)}).sort((e,s)=>{let r=(e.materialName||e.label).toLowerCase(),a=(s.materialName||s.label).toLowerCase();return r.localeCompare(a,"zh-TW")});return(0,a.jsxs)("div",{className:"overflow-visible bg-transparent",children:[(0,a.jsx)("div",{className:"group border border-input px-3 py-2 text-sm ring-offset-background rounded-md focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2",children:(0,a.jsxs)("div",{className:"flex gap-1 flex-wrap",children:[v.map(e=>{let{value:s,label:r,category:t,subCategory:o,materialName:c}=e;return(0,a.jsxs)(n.C,{variant:"secondary",className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"font-medium",children:c||r}),t&&(0,a.jsx)("span",{className:"px-1 py-0.5 text-xs rounded bg-blue-100 text-blue-800 font-medium",children:t}),o&&(0,a.jsx)("span",{className:"px-1 py-0.5 text-xs rounded bg-green-100 text-green-800 font-medium",children:o}),(0,a.jsx)("button",{className:"ml-1 ring-offset-background rounded-full outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onKeyDown:e=>{"Enter"===e.key&&j(s)},onMouseDown:e=>e.preventDefault(),onClick:()=>j(s),children:(0,a.jsx)(l.Z,{className:"h-3 w-3 text-muted-foreground hover:text-foreground"})})]},s)}),(0,a.jsx)("input",{ref:p,type:"text",value:g,onChange:e=>{let s=e.target.value;h(s),s.trim()?u(!0):u(!1)},onKeyDown:e=>{"Backspace"===e.key&&""===g&&r.length>0&&j(r[r.length-1]),"Enter"===e.key&&g.trim()&&m&&c&&(e.preventDefault(),b())},onBlur:()=>{setTimeout(()=>u(!1),200)},onFocus:()=>{g.trim()&&u(!0)},placeholder:i,className:"ml-2 bg-transparent outline-none placeholder:text-muted-foreground flex-1"})]})}),(0,a.jsx)("div",{className:"relative mt-2",children:x&&(N.length>0||m&&g.trim())?(0,a.jsx)("div",{className:"absolute w-full z-10 top-0 rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in",children:(0,a.jsxs)("div",{className:"h-full overflow-auto",children:[N.map(e=>{let{value:s,label:r,category:t,subCategory:l,materialName:n}=e;return(0,a.jsx)("div",{onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>f(s),className:"cursor-pointer px-2 py-3 hover:bg-accent hover:text-accent-foreground",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full",children:[(0,a.jsx)("span",{className:"flex-1 font-medium",children:n||r}),t&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-md bg-blue-100 text-blue-800 font-medium",children:t}),l&&(0,a.jsx)("span",{className:"px-2 py-1 text-xs rounded-md bg-green-100 text-green-800 font-medium",children:l})]})},s)}),m&&g.trim()&&!N.find(e=>e.label.toLowerCase()===g.toLowerCase())&&(0,a.jsxs)("div",{onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:b,className:"cursor-pointer text-blue-600 px-2 py-3 hover:bg-accent hover:text-accent-foreground",children:['新增 "',g.trim(),'"']})]})}):null})]})}}}]);