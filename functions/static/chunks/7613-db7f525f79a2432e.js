(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7613],{20067:function(){},72061:function(){},64853:function(e,t,s){"use strict";s.d(t,{Z:function(){return b}});var r=s(57437),a=s(2265),l=s(14438),n=s(61649),c=s(17689),i=s(49322),d=s(92735),o=s(2093),u=s(15452),m=s.n(u),x=s(12381),h=s(74291),f=s(79820),p=s(69174);function b(e){let{isOpen:t,onOpenChange:s,onImport:u,onExport:b,title:g,description:j,sampleData:y,fields:N,color:w="blue",showUpdateOption:v=!1,maxBatchSize:k=100}=e,[S,C]=(0,a.useState)(!1),[Z,_]=(0,a.useState)(!1),[A,E]=(0,a.useState)([]),[R,z]=(0,a.useState)([]),[O,I]=(0,a.useState)(null),[V,F]=(0,a.useState)({success:0,failed:0,failedItems:[]}),L=async e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){if(!s.name.endsWith(".xlsx")&&!s.name.endsWith(".csv")){l.Am.error("請上傳 Excel (.xlsx) 或 CSV 檔案");return}try{let e=[];if(s.name.endsWith(".xlsx")){let t=await s.arrayBuffer(),r=o.ij(t,{type:"array"}),a=r.SheetNames[0],l=r.Sheets[a];if((e=o.P6.sheet_to_json(l,{header:1})).length>1){let t=e[0];e=e.slice(1).map(e=>{let s={};return t.forEach((t,r)=>{t&&void 0!==e[r]&&(s[t]=e[r])}),s})}}else if(s.name.endsWith(".csv")){let t=await s.text();e=m().parse(t,{header:!0,skipEmptyLines:!0}).data}e=(e=e.filter(e=>Object.values(e).some(e=>null!=e&&""!==e))).map((e,t)=>{let s={};return N.forEach(t=>{let r=e[t.key]||e[t.label];if(null==r||""===r){let s=Object.keys(e).find(e=>e.toLowerCase().includes(t.key.toLowerCase())||e.toLowerCase().includes(t.label.toLowerCase()));s&&(r=e[s])}null==r||""===r?s[t.key]="":"number"===t.type?s[t.key]=Number(r):"boolean"===t.type?s[t.key]=!!r:s[t.key]=String(r).trim()}),t<3&&console.log("第 ".concat(t+1," 筆資料解析結果:"),{originalRow:e,cleanedRow:s,supplierName:s.supplierName,hasSupplierName:!!s.supplierName,fragranceType:s.fragranceType,hasFragranceType:!!s.fragranceType,fragranceStatus:s.fragranceStatus,hasFragranceStatus:!!s.fragranceStatus,originalKeys:Object.keys(e)}),s}),E(e),T(e),l.Am.success("成功解析 ".concat(e.length," 筆資料"))}catch(e){console.error("檔案解析失敗:",e),l.Am.error("檔案解析失敗，請檢查檔案格式")}}},T=e=>{let t=[];e.forEach((e,s)=>{N.forEach(r=>{r.required&&(!e[r.key]||""===e[r.key])&&t.push("第 ".concat(s+1," 行：").concat(r.label," 為必填欄位")),"number"===r.type&&e[r.key]&&isNaN(Number(e[r.key]))&&t.push("第 ".concat(s+1," 行：").concat(r.label," 必須為數字"))})}),z(t)},B=async()=>{if(R.length>0){l.Am.error("請修正資料錯誤後再匯入");return}if(A.length>k){l.Am.error("資料量過大，建議一次匯入不超過 ".concat(k," 筆資料。目前有 ").concat(A.length," 筆資料。"));return}C(!0),I({current:0,total:A.length});let e={success:0,failed:0,failedItems:[]};try{await u(A,{},(e,t)=>{I({current:e,total:t})}),e.success=A.length,F(e),l.Am.success("資料匯入成功！共處理 ".concat(A.length," 筆資料"))}catch(s){console.error("匯入失敗:",s);let t=s instanceof Error?s.message:"未知錯誤";if(s.results){let t=s.results;e.success=t.success,e.failed=t.failed,e.failedItems=t.failedItems}else t.includes("匯入產品")?(e.failed=1,e.success=A.length-1,e.failedItems.push({item:A[(null==O?void 0:O.current)||0],error:t,row:((null==O?void 0:O.current)||0)+1})):(e.failed=A.length,e.success=0,e.failedItems.push({item:null,error:t,row:0}));F(e),e.success>0?l.Am.success("資料匯入完成！成功 ".concat(e.success," 筆，失敗 ").concat(e.failed," 筆")):l.Am.error("資料匯入失敗")}finally{C(!1),I(null)}},W=async()=>{_(!0);try{let e=await b(),t=N.map(e=>e.label).join(","),s=e.map(e=>N.map(t=>{let s=e[t.key]||"";return"percentage"===t.format&&"number"==typeof s&&(s=(s/100).toFixed(2)),'"'.concat(s,'"')}).join(",")).join("\n"),r="".concat(t,"\n").concat(s),a=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),c=URL.createObjectURL(a);n.setAttribute("href",c),n.setAttribute("download","".concat(g,"_").concat(new Date().toISOString().split("T")[0],".csv")),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n),l.Am.success("資料匯出成功")}catch(e){console.error("匯出失敗:",e),l.Am.error("資料匯出失敗")}finally{_(!1)}},Y=(e=>{switch(e){case"blue":default:return{header:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",title:"text-blue-800",icon:"text-blue-600",button:"bg-blue-600 hover:bg-blue-700 text-white"};case"green":return{header:"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200",title:"text-green-800",icon:"text-green-600",button:"bg-green-600 hover:bg-green-700 text-white"};case"purple":return{header:"bg-gradient-to-r from-purple-50 to-violet-50 border-purple-200",title:"text-purple-800",icon:"text-purple-600",button:"bg-purple-600 hover:bg-purple-700 text-white"};case"yellow":return{header:"bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200",title:"text-yellow-800",icon:"text-yellow-600",button:"bg-yellow-600 hover:bg-yellow-700 text-white"};case"red":return{header:"bg-gradient-to-r from-red-50 to-pink-50 border-red-200",title:"text-red-800",icon:"text-red-600",button:"bg-red-600 hover:bg-red-700 text-white"};case"gray":return{header:"bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200",title:"text-foreground",icon:"text-muted-foreground",button:"bg-gray-600 hover:bg-gray-700 text-white"}}})(w);return(0,r.jsx)(h.Vq,{open:t,onOpenChange:s,children:(0,r.jsxs)(h.cZ,{className:"max-w-4xl max-h-[90vh] overflow-y-auto bg-white","aria-describedby":"import-export-dialog-description",children:[(0,r.jsxs)(h.fK,{className:"pb-4 border-b ".concat(Y.header),children:[(0,r.jsxs)(h.$N,{className:"flex items-center gap-3 text-2xl font-bold ".concat(Y.title),children:[(0,r.jsx)("div",{className:"w-10 h-10 ".concat(Y.header," rounded-lg flex items-center justify-center"),children:(0,r.jsx)(n.Z,{className:"h-5 w-5 ".concat(Y.icon)})}),g," - 匯入/匯出"]}),(0,r.jsx)(h.Be,{className:"text-muted-foreground mt-2",id:"import-export-dialog-description",children:j})]}),(0,r.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg mb-6",children:[(0,r.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"匯入/匯出規則"}),(0,r.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"智能匹配模式"}),"：系統會根據物料代號自動判斷是新增還是更新"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"新增邏輯"}),"：如果物料代號不存在，系統會建立新的物料項目"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"更新邏輯"}),"：如果物料代號已存在，系統會更新覆蓋有填入的欄位"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"必填欄位"}),"：物料名稱為必填項目"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"物料代號"}),"：如果未提供，系統會自動生成"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"注意事項"}),"：供應商名稱如果不存在會自動建立"]}),(0,r.jsxs)("p",{children:["• ",(0,r.jsx)("strong",{children:"支援格式"}),"：Excel (.xlsx) 和 CSV 檔案格式"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(f.Zb,{className:"".concat(Y.header," border-2"),children:[(0,r.jsxs)(f.Ol,{children:[(0,r.jsxs)(f.ll,{className:"flex items-center gap-3 text-lg font-bold ".concat(Y.title),children:[(0,r.jsx)("div",{className:"w-8 h-8 ".concat(Y.header," rounded-lg flex items-center justify-center"),children:(0,r.jsx)(c.Z,{className:"h-4 w-4 ".concat(Y.icon)})}),"資料匯入"]}),(0,r.jsx)(f.SZ,{className:"text-muted-foreground",children:"上傳 Excel (.xlsx) 或 CSV 檔案來匯入資料"})]}),(0,r.jsxs)(f.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"選擇檔案"}),(0,r.jsx)("input",{type:"file",accept:".xlsx,.csv",onChange:L,className:"w-full p-2 border border-gray-300 rounded-md"})]}),v&&(0,r.jsx)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,r.jsxs)("div",{className:"text-sm text-blue-700",children:[(0,r.jsx)("strong",{children:"智能匹配模式："}),"系統會根據物料代號自動判斷是新增還是更新",(0,r.jsxs)("ul",{className:"mt-1 ml-4 space-y-1",children:[(0,r.jsx)("li",{children:"• 如果物料代號已存在 → 更新現有資料"}),(0,r.jsx)("li",{children:"• 如果物料代號不存在 → 新增新物料"}),(0,r.jsx)("li",{children:"• 如果未提供物料代號 → 自動生成新代號並新增"})]})]})}),A.length>0&&(0,r.jsx)("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,r.jsxs)("div",{className:"text-sm text-yellow-800",children:[(0,r.jsx)("strong",{children:"建議："}),"一次匯入不超過 ",k," 筆資料以確保穩定性。目前有 ",A.length," 筆資料。",A.length>k&&(0,r.jsx)("span",{className:"text-red-600 font-semibold",children:" 建議分批匯入！"})]})}),A.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("label",{className:"text-sm font-medium",children:["預覽資料 (",A.length," 筆)"]}),(0,r.jsx)(p.C,{variant:R.length>0?"destructive":"default",children:R.length>0?"".concat(R.length," 個錯誤"):"資料正確"})]}),(0,r.jsxs)("div",{className:"max-h-40 overflow-y-auto border rounded-md p-2",children:[(0,r.jsxs)("table",{className:"w-full text-xs",children:[(0,r.jsx)("thead",{children:(0,r.jsx)("tr",{className:"border-b",children:N.map(e=>(0,r.jsx)("th",{className:"text-left p-1",children:e.label},e.key))})}),(0,r.jsx)("tbody",{children:A.slice(0,5).map((e,t)=>(0,r.jsx)("tr",{className:"border-b",children:N.map(t=>(0,r.jsx)("td",{className:"p-1",children:e[t.key]||"-"},t.key))},t))})]}),A.length>5&&(0,r.jsxs)("div",{className:"text-xs text-muted-foreground text-center py-1",children:["顯示前 5 筆，共 ",A.length," 筆資料"]})]}),R.length>0&&(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("label",{className:"text-sm font-medium text-red-600 flex items-center gap-1",children:[(0,r.jsx)(i.Z,{className:"h-3 w-3"}),"驗證錯誤"]}),(0,r.jsx)("div",{className:"max-h-20 overflow-y-auto text-xs text-red-600 space-y-1",children:R.map((e,t)=>(0,r.jsx)("div",{children:e},t))})]}),(V.success>0||V.failed>0)&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,r.jsx)("h5",{className:"font-semibold text-blue-800 mb-2",children:"匯入結果"}),(0,r.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,r.jsxs)("p",{children:["✅ 成功匯入: ",V.success," 筆"]}),(0,r.jsxs)("p",{children:["❌ 失敗匯入: ",V.failed," 筆"]}),V.failedItems.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"font-semibold text-red-800 mt-2",children:"失敗項目詳情:"}),(0,r.jsx)("div",{className:"max-h-32 overflow-y-auto",children:(0,r.jsx)("ul",{className:"text-xs text-red-700 space-y-1",children:V.failedItems.map((e,t)=>(0,r.jsxs)("li",{className:"border-l-2 border-red-300 pl-2",children:[(0,r.jsxs)("span",{className:"font-medium",children:["第 ",e.row," 行:"]})," ",e.error]},t))})})]})]})]}),O&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{children:"處理進度"}),(0,r.jsxs)("span",{children:[O.current," / ",O.total]})]}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(O.current/O.total*100,"%")}})})]}),(0,r.jsx)(x.z,{onClick:B,disabled:S||R.length>0,className:"w-full ".concat(Y.button),children:S?"匯入中...":"確認匯入"}),(V.success>0||V.failed>0)&&(0,r.jsx)(x.z,{onClick:()=>s(!1),variant:"outline",className:"w-full",children:"關閉"})]})]})]}),(0,r.jsxs)(f.Zb,{className:"".concat(Y.header," border-2"),children:[(0,r.jsxs)(f.Ol,{children:[(0,r.jsxs)(f.ll,{className:"flex items-center gap-3 text-lg font-bold ".concat(Y.title),children:[(0,r.jsx)("div",{className:"w-8 h-8 ".concat(Y.header," rounded-lg flex items-center justify-center"),children:(0,r.jsx)(d.Z,{className:"h-4 w-4 ".concat(Y.icon)})}),"資料匯出"]}),(0,r.jsx)(f.SZ,{className:"text-muted-foreground",children:"將現有資料匯出為 CSV 格式"})]}),(0,r.jsxs)(f.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"匯出欄位"}),(0,r.jsx)("div",{className:"space-y-1",children:N.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)("span",{children:e.label}),e.required&&(0,r.jsx)(p.C,{variant:"secondary",className:"text-xs",children:"必填"})]},e.key))})]}),(0,r.jsx)(x.z,{onClick:W,disabled:Z,className:"w-full ".concat(Y.button),children:Z?"匯出中...":"匯出 CSV"})]})]})]})]})})}},79820:function(e,t,s){"use strict";s.d(t,{Ol:function(){return n},SZ:function(){return i},Zb:function(){return l},aY:function(){return d},eW:function(){return o},ll:function(){return c}});var r=s(57437);s(2265);var a=s(93448);function l(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-lg border-2 p-6 shadow-md",t),...s})}function n(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 has-data-[slot=card-action]:grid-cols-[1fr_auto]",t),...s})}function c(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",t),...s})}function i(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",t),...s})}function d(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("",t),...s})}function o(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center",t),...s})}},68245:function(e,t,s){"use strict";s.d(t,{X:function(){return c}});var r=s(57437);s(2265);var a=s(9270),l=s(30401),n=s(93448);function c(e){let{className:t,...s}=e;return(0,r.jsx)(a.fC,{"data-slot":"checkbox",className:(0,n.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,r.jsx)(a.z$,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,r.jsx)(l.Z,{className:"size-3.5"})})})}},15291:function(e,t,s){"use strict";s.d(t,{Bw:function(){return f},Ph:function(){return o},Ql:function(){return p},i4:function(){return m},ki:function(){return u}});var r=s(57437),a=s(2265),l=s(33911),n=s(40875),c=s(22135),i=s(30401),d=s(93448);let o=l.fC;l.ZA;let u=l.B4,m=a.forwardRef((e,t)=>{let{className:s,children:a,...c}=e;return(0,r.jsxs)(l.xz,{ref:t,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-white placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 dark:border-slate-800 dark:bg-slate-950 dark:ring-offset-slate-950 dark:placeholder:text-slate-400 dark:focus:ring-slate-300",s),...c,children:[a,(0,r.jsx)(l.JO,{asChild:!0,children:(0,r.jsx)(n.Z,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=l.xz.displayName;let x=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.u_,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(c.Z,{className:"h-4 w-4"})})});x.displayName=l.u_.displayName;let h=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.$G,{ref:t,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,r.jsx)(n.Z,{className:"h-4 w-4"})})});h.displayName=l.$G.displayName;let f=a.forwardRef((e,t)=>{let{className:s,children:a,position:n="popper",...c}=e;return(0,r.jsx)(l.h_,{children:(0,r.jsxs)(l.VY,{ref:t,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border border-slate-200 bg-white text-slate-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...c,children:[(0,r.jsx)(x,{}),(0,r.jsx)(l.l_,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:a}),(0,r.jsx)(h,{})]})})});f.displayName=l.VY.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.__,{ref:t,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...a})}).displayName=l.__.displayName;let p=a.forwardRef((e,t)=>{let{className:s,children:a,...n}=e;return(0,r.jsxs)(l.ck,{ref:t,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",s),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(l.wU,{children:(0,r.jsx)(i.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(l.eT,{children:a})]})});p.displayName=l.ck.displayName,a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)(l.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-slate-100 dark:bg-slate-800",s),...a})}).displayName=l.Z0.displayName},23675:function(e,t,s){"use strict";s.d(t,{g:function(){return n}});var r=s(57437),a=s(2265),l=s(93448);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...a})});n.displayName="Textarea"}}]);