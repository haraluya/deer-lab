exports.id=4108,exports.ids=[4108],exports.modules={97394:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,12994,23)),Promise.resolve().then(t.t.bind(t,96114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,79671,23)),Promise.resolve().then(t.t.bind(t,41868,23)),Promise.resolve().then(t.t.bind(t,84759,23))},85260:(e,r,t)=>{Promise.resolve().then(t.bind(t,48018))},48018:(e,r,t)=>{"use strict";t.d(r,{ClientProvider:()=>l});var s=t(10326),n=t(74690),i=t(14831),a=t(85999);let o=({...e})=>{let{theme:r="system"}=(0,i.F)();return s.jsx(a.x7,{theme:r,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},toastOptions:{style:{background:"rgb(var(--toast-bg, 255 255 255))",color:"rgb(var(--toast-text, 15 23 42))",border:"1px solid rgb(var(--toast-border, 226 232 240))",borderRadius:"var(--radius)",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"}},...e})};function l({children:e}){return(0,s.jsxs)(n.H,{children:[e,s.jsx(o,{})]})}},74690:(e,r,t)=>{"use strict";t.d(r,{H:()=>p,a:()=>d});var s=t(10326),n=t(17577),i=t(5779),a=t(90445),o=t(76),l=t(85999),u=t(33741);let c=(0,n.createContext)({user:null,appUser:null,isLoading:!0,login:async()=>!1,logout:async()=>{},hasPermission:()=>!1,hasAnyPermission:()=>!1,hasAllPermissions:()=>!1}),p=({children:e})=>{let[r,t]=(0,n.useState)(null),[p,d]=(0,n.useState)(null),[m,b]=(0,n.useState)(!0),g=async e=>{(0,u.fF)("loadUserData 開始執行",{uid:e.uid});try{let r=(0,a.T)();if(!r){(0,u.vU)("Firestore 未初始化"),d(null);return}(0,u.fF)("獲取用戶文檔",{uid:e.uid});let t=await (0,o.QT)((0,o.doc)(r,"users",e.uid));if(t.exists()){(0,u.fF)("用戶文檔存在");let e=t.data();if((0,u.fF)("用戶資料",e),e.roleRef){(0,u.fF)("用戶有角色引用，獲取角色資料");try{let r=await (0,o.QT)(e.roleRef);if(r.exists()){let t=r.data();e.roleName=t.displayName||t.name,e.permissions=t.permissions||[],(0,u.fF)("角色資料載入成功",{role:e.roleName,permissions:e.permissions})}else(0,u.ZK)("角色文檔不存在")}catch(e){(0,u.vU)("載入角色資料失敗",e)}}else(0,u.ZK)("用戶沒有角色引用");(0,u.fF)("設置 appUser",e),d(e)}else(0,u.ZK)("用戶文檔不存在"),d(null)}catch(e){(0,u.vU)("載入用戶資料失敗",e),d(null)}},f=async(e,r)=>{try{let t=(0,a.E7)();if(!t)return l.Am.error("系統初始化失敗"),!1;let s=e.includes("@")?e:`${e}@deer-lab.local`,n=await (0,i.e5)(t,s,r);return await g(n.user),l.Am.success("登入成功！"),!0}catch(e){return(0,u.vU)("登入失敗",e),l.Am.error(e.message||"登入失敗"),!1}},h=async()=>{try{let e=(0,a.E7)();e&&(await (0,i.w7)(e),t(null),d(null),l.Am.success("已成功登出"),window.location.href="/")}catch(e){(0,u.vU)("登出失敗",e),l.Am.error("登出失敗")}};return(0,n.useEffect)(()=>{(0,u.fF)("AuthContext useEffect 開始執行");try{let e=(0,a.E7)();if(!e){(0,u.vU)("Auth 未初始化，設置 isLoading = false"),b(!1);return}(0,u.fF)("設置 onAuthStateChanged 監聽器");let r=(0,i.Aj)(e,async e=>{try{(0,u.fF)("onAuthStateChanged 觸發",{uid:e?.uid||null}),e?(t(e),(0,u.fF)("開始載入用戶資料"),await g(e)):(t(null),d(null),(0,u.fF)("用戶已登出，清除狀態")),b(!1),(0,u.fF)("設置 isLoading = false")}catch(e){(0,u.vU)("onAuthStateChanged 回調執行失敗",e),b(!1)}});return()=>{(0,u.fF)("清理 onAuthStateChanged 監聽器"),"function"==typeof r&&r()}}catch(e){(0,u.vU)("AuthContext useEffect 執行失敗",e),b(!1)}},[]),s.jsx(c.Provider,{value:{user:r,appUser:p,isLoading:m,login:f,logout:h,hasPermission:e=>!!p?.permissions&&p.permissions.includes(e),hasAnyPermission:e=>!!p?.permissions&&e.some(e=>p.permissions.includes(e)),hasAllPermissions:e=>!!p?.permissions&&e.every(e=>p.permissions.includes(e))},children:e})},d=()=>(0,n.useContext)(c)},90445:(e,r,t)=>{"use strict";t.d(r,{E7:()=>f,KT:()=>x,T:()=>h,db:()=>w});var s=t(42585),n=t(5779),i=t(76),a=t(78880),o=t(11552),l=t(33741);(0,l.wC)("Firebase 模組載入...");let u=null,c=null,p=null,d=null,m=null,b=!1;function g(){return b?{app:u,auth:c,db:p,functions:d,storage:m}:function(){if(b)return(0,l.wC)("Firebase 已經初始化"),{app:u,auth:c,db:p,functions:d,storage:m};try{(0,l.wC)("開始初始化 Firebase...");let e=function(){let e={apiKey:"AIzaSyCMIAqNPsIyl3fJNllqNCuUJE2Rvcdf6fk",authDomain:"deer-lab.firebaseapp.com",projectId:"deer-lab",storageBucket:"deer-lab.firebasestorage.app",messagingSenderId:"554942047858",appId:"1:554942047858:web:607d3e27bb438c898644eb"};return(0,l.wC)("Firebase 配置檢查:"),(0,l.wC)(`  API Key: ${e.apiKey?"✅ 已設置":"❌ 未設置"}`),(0,l.wC)(`  Auth Domain: ${e.authDomain?"✅ 已設置":"❌ 未設置"}`),(0,l.wC)(`  Project ID: ${e.projectId?"✅ 已設置":"❌ 未設置"}`),(0,l.wC)(`  Storage Bucket: ${e.storageBucket?"✅ 已設置":"❌ 未設置"}`),(0,l.wC)(`  Messaging Sender ID: ${e.messagingSenderId?"✅ 已設置":"❌ 未設置"}`),(0,l.wC)(`  App ID: ${e.appId?"✅ 已設置":"❌ 未設置"}`),e}();if(!e.apiKey)throw Error("Missing NEXT_PUBLIC_FIREBASE_API_KEY environment variable");if(!e.authDomain)throw Error("Missing NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN environment variable");if(!e.projectId)throw Error("Missing NEXT_PUBLIC_FIREBASE_PROJECT_ID environment variable");return(0,l.wC)("正在初始化 Firebase App..."),u=(0,s.ZF)(e),(0,l.wC)("Firebase App 初始化成功"),(0,l.wC)("正在初始化 Firebase Auth..."),c=(0,n.v0)(u),(0,l.wC)("Firebase Auth 初始化成功"),(0,l.wC)("正在初始化 Firestore..."),p=(0,i.ad)(u),(0,l.wC)("Firestore 初始化成功"),(0,l.wC)("正在初始化 Firebase Functions..."),d=(0,a.$C)(u),(0,l.wC)("Firebase Functions 初始化成功"),(0,l.wC)("正在初始化 Firebase Storage..."),m=(0,o.getStorage)(u),(0,l.wC)("Firebase Storage 初始化成功"),b=!0,(0,l.wC)("Firebase 所有服務初始化完成！"),{app:u,auth:c,db:p,functions:d,storage:m}}catch(e){return console.error("❌ Firebase 初始化失敗:",e),{app:null,auth:null,db:null,functions:null,storage:null}}}()}function f(){return g().auth}function h(){return g().db}function x(){return g().storage}f();let w=h();g().functions,x()},33741:(e,r,t)=>{"use strict";t.d(r,{ZK:()=>i,fF:()=>o,kg:()=>n,vU:()=>a,wC:()=>l});class s{getColorCode(e){return({blue:"\x1b[34m",green:"\x1b[32m",yellow:"\x1b[33m",red:"\x1b[31m",purple:"\x1b[35m",cyan:"\x1b[36m"})[e]||""}formatMessage(e,r={}){let{prefix:t,color:s}=r,n=s?this.getColorCode(s):"",i=s?"\x1b[0m":"",a=t?`[${t}] `:"";return`${n}${a}${e}${i}`}log(e,...r){}info(e,r={}){}success(e,r={}){}warn(e,r={}){}error(e,r,t={}){this.formatMessage(`❌ ${e}`,{...t,color:"red"}),console.error("系統錯誤",r?.message||e)}debug(e,r,t={}){}firebase(e,r={}){}api(e,r,t){}performance(e,r){}}let n=new s;n.log.bind(n),n.info.bind(n),n.success.bind(n);let i=n.warn.bind(n),a=n.error.bind(n),o=n.debug.bind(n),l=n.firebase.bind(n);n.api.bind(n),n.performance.bind(n)},62510:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l,metadata:()=>o});var s=t(19510),n=t(25384),i=t.n(n);t(5023);let a=(0,t(68570).createProxy)(String.raw`D:\APP\deer-lab\src\app\client-provider.tsx#ClientProvider`),o={title:"德科斯特的實驗室",description:"專業的生產管理系統，提供完整的生產流程管理功能",icons:{icon:[{url:"/icon-32x32.png",sizes:"32x32",type:"image/png"},{url:"/icon-16x16.png",sizes:"16x16",type:"image/png"},{url:"/icon-192x192.png",sizes:"192x192",type:"image/png"},{url:"/icon-512x512.png",sizes:"512x512",type:"image/png"}],apple:[{url:"/apple-touch-icon.png",sizes:"180x180",type:"image/png"}]}};function l({children:e}){return(0,s.jsxs)("html",{lang:"zh-TW",children:[(0,s.jsxs)("head",{children:[s.jsx("link",{rel:"icon",href:"/icon-32x32.png",sizes:"32x32",type:"image/png"}),s.jsx("link",{rel:"icon",href:"/icon-16x16.png",sizes:"16x16",type:"image/png"}),s.jsx("link",{rel:"manifest",href:"/manifest.json"}),s.jsx("meta",{name:"theme-color",content:"#6366f1"}),s.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"}),s.jsx("meta",{name:"mobile-web-app-capable",content:"yes"}),s.jsx("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),s.jsx("meta",{name:"apple-mobile-web-app-status-bar-style",content:"default"}),s.jsx("meta",{name:"apple-mobile-web-app-title",content:"德科斯特的實驗室"}),s.jsx("link",{rel:"apple-touch-icon",href:"/apple-touch-icon.png"})]}),s.jsx("body",{className:i().className,children:s.jsx(a,{children:e})})]})}},5023:()=>{}};