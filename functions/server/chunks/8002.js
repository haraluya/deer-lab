"use strict";exports.id=8002,exports.ids=[8002],exports.modules={86333:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},12714:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},69508:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},40765:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]])},29163:(e,t,s)=>{s.d(t,{Z:()=>a});let a=(0,s(62881).Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]])},12925:(e,t,s)=>{s.d(t,{B:()=>f});var a=s(10326),r=s(17577),l=s(29752),n=s(38443),i=s(91664),d=s(41156),c=s(17069),o=s(29163),x=s(11019),m=s(48705),g=s(98258),h=s(21405),u=s(48998),b=s(12714),j=s(12859),y=s(71470);function f({itemId:e,itemType:t,itemCode:s,itemName:f,currentStock:N}){let[p,v]=(0,r.useState)([]),[k,w]=(0,r.useState)(!1),[C,Z]=(0,r.useState)(null),[q,D]=(0,r.useState)(!1),z=(0,r.useCallback)(async()=>{w(!0);try{let s=(await (0,j.hz)(e,t,20)).map(s=>{let a=(0,j.Q$)(s,e,t);return a?{id:s.id,changeDate:s.changeDate,changeReason:s.changeReason,quantityChange:a.quantityChange,quantityAfter:a.quantityAfter,operatorName:s.operatorName,remarks:s.remarks,relatedDocumentId:s.relatedDocumentId,relatedDocumentType:s.relatedDocumentType,originalRecord:s}:null}).filter(Boolean);v(s)}catch(e){console.error("載入庫存歷史失敗:",e)}finally{w(!1)}},[e,t]),R=e=>new Intl.DateTimeFormat("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e),$=e=>e>0?a.jsx(c.Z,{className:"h-4 w-4 text-green-600"}):e<0?a.jsx(o.Z,{className:"h-4 w-4 text-red-600"}):a.jsx(x.Z,{className:"h-4 w-4 text-gray-600"}),I=e=>e>0?"text-green-600":e<0?"text-red-600":"text-gray-600",M=e=>{Z(e.originalRecord),D(!0)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Zb,{className:"border-l-4 border-l-blue-500",children:[a.jsx(l.Ol,{className:"pb-3",children:(0,a.jsxs)(l.ll,{className:"text-lg text-gray-800 flex items-center gap-2",children:["material"===t?a.jsx(m.Z,{className:"h-5 w-5 text-blue-500"}):a.jsx(g.Z,{className:"h-5 w-5 text-purple-500"}),"庫存歷史"]})}),(0,a.jsxs)(l.aY,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[a.jsx("div",{className:"text-sm font-medium text-blue-700",children:"當前庫存"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900",children:N})]}),(0,a.jsxs)("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:[a.jsx("div",{className:"text-sm font-medium text-green-700",children:"總增加"}),a.jsx("div",{className:"text-2xl font-bold text-green-900",children:p.filter(e=>e.quantityChange>0).reduce((e,t)=>e+t.quantityChange,0)})]}),(0,a.jsxs)("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:[a.jsx("div",{className:"text-sm font-medium text-red-700",children:"總消耗"}),a.jsx("div",{className:"text-2xl font-bold text-red-900",children:Math.abs(p.filter(e=>e.quantityChange<0).reduce((e,t)=>e+t.quantityChange,0))})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["顯示最近 ",p.length," 筆庫存變動記錄"]}),(0,a.jsxs)(i.z,{variant:"outline",size:"sm",onClick:z,disabled:k,className:"hover:bg-blue-50 hover:text-blue-600 transition-all duration-200",children:[a.jsx(h.Z,{className:`h-4 w-4 mr-2 ${k?"animate-spin":""}`}),"重新整理"]})]}),k?a.jsx("div",{className:"flex items-center justify-center py-8",children:(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[a.jsx("div",{className:"w-8 h-8 border-4 border-gray-200 rounded-full animate-spin border-t-blue-500"}),a.jsx("span",{className:"text-sm text-gray-500",children:"載入中..."})]})}):p.length>0?a.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:(0,a.jsxs)(d.iA,{children:[a.jsx(d.xD,{children:(0,a.jsxs)(d.SC,{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:[a.jsx(d.ss,{className:"text-left font-semibold text-gray-700",children:"變動時間"}),a.jsx(d.ss,{className:"text-left font-semibold text-gray-700",children:"變動原因"}),a.jsx(d.ss,{className:"text-right font-semibold text-gray-700",children:"變動數量"}),a.jsx(d.ss,{className:"text-right font-semibold text-gray-700",children:"變動後數量"}),a.jsx(d.ss,{className:"text-left font-semibold text-gray-700",children:"操作人員"}),a.jsx(d.ss,{className:"text-left font-semibold text-gray-700",children:"備註"}),a.jsx(d.ss,{className:"text-center font-semibold text-gray-700",children:"操作"})]})}),a.jsx(d.RM,{children:p.map(e=>(0,a.jsxs)(d.SC,{className:"hover:bg-gray-50 transition-colors duration-200",children:[a.jsx(d.pj,{className:"text-sm text-gray-700",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(u.Z,{className:"h-4 w-4 text-gray-400"}),R(e.changeDate)]})}),a.jsx(d.pj,{children:a.jsx(n.C,{variant:"outline",className:`text-xs ${"purchase"===e.changeReason?"border-green-200 text-green-700 bg-green-50":"workorder"===e.changeReason?"border-orange-200 text-orange-700 bg-orange-50":"inventory_check"===e.changeReason?"border-blue-200 text-blue-700 bg-blue-50":"border-gray-200 text-gray-700 bg-gray-50"}`,children:(0,j.bU)(e.changeReason)})}),a.jsx(d.pj,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[$(e.quantityChange),(0,a.jsxs)("span",{className:`font-semibold ${I(e.quantityChange)}`,children:[e.quantityChange>0?"+":"",e.quantityChange]})]})}),a.jsx(d.pj,{className:"text-right",children:a.jsx("span",{className:"font-semibold text-gray-800",children:e.quantityAfter})}),a.jsx(d.pj,{className:"text-sm text-gray-700",children:e.operatorName}),a.jsx(d.pj,{className:"text-sm text-gray-600 max-w-xs truncate",title:e.remarks,children:e.remarks||"-"}),a.jsx(d.pj,{className:"text-center",children:a.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>M(e),className:"h-8 w-8 p-0 hover:bg-blue-50 hover:text-blue-600 transition-all duration-200",children:a.jsx(b.Z,{className:"h-4 w-4"})})})]},e.id))})]})}):(0,a.jsxs)("div",{className:"text-center py-12",children:[a.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"\uD83D\uDCCA"}),a.jsx("div",{className:"text-gray-500 font-medium text-lg mb-2",children:"尚無庫存變動記錄"}),(0,a.jsxs)("div",{className:"text-gray-400",children:["此","material"===t?"物料":"香精","尚未有任何庫存變動"]})]})]})]}),a.jsx(y.w,{record:C,isOpen:q,onClose:()=>{D(!1),Z(null)}})]})}},9969:(e,t,s)=>{s.d(t,{NI:()=>b,Wi:()=>x,l0:()=>c,lX:()=>u,xJ:()=>h,zG:()=>j});var a=s(10326),r=s(17577),l=s(34214),n=s(74723),i=s(51223),d=s(44794);let c=n.RV,o=r.createContext({}),x=({...e})=>a.jsx(o.Provider,{value:{name:e.name},children:a.jsx(n.Qr,{...e})}),m=()=>{let e=r.useContext(o),t=r.useContext(g),{getFieldState:s}=(0,n.Gc)(),a=(0,n.cl)({name:e.name}),l=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...l}},g=r.createContext({});function h({className:e,...t}){let s=r.useId();return a.jsx(g.Provider,{value:{id:s},children:a.jsx("div",{"data-slot":"form-item",className:(0,i.cn)("grid gap-2",e),...t})})}function u({className:e,...t}){let{error:s,formItemId:r}=m();return a.jsx(d._,{"data-slot":"form-label","data-error":!!s,className:(0,i.cn)("data-[error=true]:text-destructive",e),htmlFor:r,...t})}function b({...e}){let{error:t,formItemId:s,formDescriptionId:r,formMessageId:n}=m();return a.jsx(l.g7,{"data-slot":"form-control",id:s,"aria-describedby":t?`${r} ${n}`:`${r}`,"aria-invalid":!!t,...e})}function j({className:e,...t}){let{error:s,formMessageId:r}=m(),l=s?String(s?.message??""):t.children;return l?a.jsx("p",{"data-slot":"form-message",id:r,className:(0,i.cn)("text-destructive text-sm",e),...t,children:l}):null}},82015:(e,t,s)=>{s.d(t,{g:()=>n});var a=s(10326),r=s(17577),l=s(51223);let n=r.forwardRef(({className:e,...t},s)=>a.jsx("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));n.displayName="Textarea"}};