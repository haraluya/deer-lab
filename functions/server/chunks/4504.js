"use strict";exports.id=4504,exports.ids=[4504],exports.modules={10591:(e,r,s)=>{s.d(r,{Z:()=>l});let l=(0,s(62881).Z)("Droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]])},55686:(e,r,s)=>{s.d(r,{$:()=>N});var l=s(10326),t=s(17577),a=s(74723),n=s(74064),o=s(770),c=s(78880);s(76),s(90445);var d=s(85999),i=s(91664),m=s(24118),x=s(9969),g=s(41190),u=s(29280),p=s(82015),h=s(98258),j=s(40765),b=s(48705),f=s(10591);let y=o.Ry({code:o.Z_().min(1,{message:"香精代號為必填欄位"}),name:o.Z_().min(2,{message:"香精名稱至少需要 2 個字元"}),fragranceType:o.Z_({required_error:"必須選擇香精種類"}),fragranceStatus:o.Z_({required_error:"必須選擇香精狀態"}),supplierId:o.Z_().optional(),currentStock:o.oQ.number().min(0,{message:"現有庫存不能為負數"}).optional(),safetyStockLevel:o.oQ.number().min(0).optional(),costPerUnit:o.oQ.number().min(0).optional(),percentage:o.oQ.number().min(0).max(100,{message:"香精比例不能超過100%"}),pgRatio:o.oQ.number().min(0).max(100,{message:"PG比例不能超過100%"}),vgRatio:o.oQ.number().min(0).max(100,{message:"VG比例不能超過100%"}),remarks:o.Z_().optional()}).refine(e=>(e.percentage||0)+(e.pgRatio||0)+(e.vgRatio||0)<=100,{message:"香精、PG、VG比例總和不能超過100%",path:["percentage"]});function N({isOpen:e,onOpenChange:r,onFragranceUpdate:s,fragranceData:o}){let[N,w]=(0,t.useState)(!1),[v,G]=(0,t.useState)([]),[I,k]=(0,t.useState)([]),[S,z]=(0,t.useState)([]),V=!!o,R=(0,a.cI)({resolver:(0,n.F)(y),defaultValues:{code:"",name:"",fragranceType:"",fragranceStatus:"",supplierId:"",currentStock:0,safetyStockLevel:0,costPerUnit:0,percentage:0,pgRatio:0,vgRatio:0,remarks:""}});R.watch("percentage");let C=e=>{let r=0,s=0;return e<=60?(r=Math.round((60-e)*100)/100,s=40):(r=0,s=Math.round((100-e)*100)/100),{pgRatio:r,vgRatio:s}};async function Z(e){w(!0);let l=d.Am.loading(V?"正在更新香精...":"正在新增香精...");try{let t;let a=(0,c.$C)();if(t={...e,pgRatio:e.pgRatio||0,vgRatio:e.vgRatio||0,unit:"KG"},V){let r=(0,c.V1)(a,"updateFragrance");await r({fragranceId:o.id,...t}),d.Am.success(`香精 ${e.name} 的資料已更新。`,{id:l})}else{let r=(0,c.V1)(a,"createFragrance");await r(t),d.Am.success(`香精 ${e.name} 已成功建立。`,{id:l})}s(),r(!1)}catch(r){let e=r instanceof Error?r.message:"發生未知錯誤。";d.Am.error(e,{id:l})}finally{w(!1)}}return l.jsx(m.Vq,{open:e,onOpenChange:r,children:(0,l.jsxs)(m.cZ,{className:"max-w-4xl max-h-[95vh] overflow-y-auto bg-white sm:max-w-4xl max-w-[calc(100vw-1rem)]",children:[(0,l.jsxs)(m.fK,{className:"pb-4 border-b border-gray-200",children:[(0,l.jsxs)(m.$N,{className:"flex items-center gap-2 sm:gap-3 text-lg sm:text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:[l.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg flex items-center justify-center",children:l.jsx(h.Z,{className:"h-4 w-4 sm:h-5 sm:w-5 text-white"})}),V?"編輯香精":"新增香精"]}),l.jsx(m.Be,{className:"text-gray-600 mt-2",children:V?"修改香精詳細資訊":"建立新的香精資料"})]}),l.jsx(x.l0,{...R,children:(0,l.jsxs)("form",{onSubmit:R.handleSubmit(Z),className:"space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200 shadow-sm",children:[(0,l.jsxs)("h3",{className:"text-lg sm:text-xl font-bold flex items-center gap-2 sm:gap-3 text-purple-800",children:[l.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:l.jsx(j.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 text-purple-600"})}),"基本資料"]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6",children:[l.jsx(x.Wi,{control:R.control,name:"code",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"香精代號 *"}),l.jsx(x.NI,{children:l.jsx(g.I,{placeholder:"例如：HYH-0123M1",className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",...e})}),l.jsx(x.zG,{})]})}),l.jsx(x.Wi,{control:R.control,name:"name",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"香精名稱 *"}),l.jsx(x.NI,{children:l.jsx(g.I,{placeholder:"例如：茉莉綠茶",className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",...e})}),l.jsx(x.zG,{})]})}),l.jsx(x.Wi,{control:R.control,name:"fragranceType",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"香精種類 *"}),(0,l.jsxs)(u.Ph,{onValueChange:e.onChange,value:e.value,children:[l.jsx(x.NI,{children:l.jsx(u.i4,{className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",children:l.jsx(u.ki,{placeholder:"選擇香精種類"})})}),l.jsx(u.Bw,{children:I.map(e=>l.jsx(u.Ql,{value:e,children:e},e))})]}),l.jsx(x.zG,{})]})}),l.jsx(x.Wi,{control:R.control,name:"fragranceStatus",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"啟用狀態 *"}),(0,l.jsxs)(u.Ph,{onValueChange:e.onChange,value:e.value,children:[l.jsx(x.NI,{children:l.jsx(u.i4,{className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",children:l.jsx(u.ki,{placeholder:"選擇啟用狀態"})})}),l.jsx(u.Bw,{children:S.map(e=>l.jsx(u.Ql,{value:e,children:e},e))})]}),l.jsx(x.zG,{})]})}),l.jsx(x.Wi,{control:R.control,name:"supplierId",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"供應商"}),(0,l.jsxs)(u.Ph,{onValueChange:e.onChange,value:e.value,children:[l.jsx(x.NI,{children:l.jsx(u.i4,{className:"border-gray-300 focus:border-purple-500 focus:ring-purple-500",children:l.jsx(u.ki,{placeholder:"選擇供應商"})})}),l.jsx(u.Bw,{children:v.map(e=>l.jsx(u.Ql,{value:e.id,children:e.name},e.id))})]}),l.jsx(x.zG,{})]})})]})]}),(0,l.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200 shadow-sm",children:[(0,l.jsxs)("h3",{className:"text-lg sm:text-xl font-bold flex items-center gap-2 sm:gap-3 text-green-800",children:[l.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-green-100 rounded-lg flex items-center justify-center",children:l.jsx(b.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-600"})}),"庫存與成本"]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[l.jsx(x.Wi,{control:R.control,name:"currentStock",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"現有庫存 (KG)"}),l.jsx(x.NI,{children:l.jsx(g.I,{type:"number",step:"0.01",placeholder:"0",className:"border-gray-300 focus:border-green-500 focus:ring-green-500",...e})}),l.jsx(x.zG,{})]})}),l.jsx(x.Wi,{control:R.control,name:"safetyStockLevel",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"安全庫存 (KG)"}),l.jsx(x.NI,{children:l.jsx(g.I,{type:"number",placeholder:"0",className:"border-gray-300 focus:border-green-500 focus:ring-green-500",...e})}),l.jsx(x.zG,{})]})}),l.jsx(x.Wi,{control:R.control,name:"costPerUnit",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"單位成本 (元/KG)"}),l.jsx(x.NI,{children:l.jsx(g.I,{type:"number",placeholder:"0.00",className:"border-gray-300 focus:border-green-500 focus:ring-green-500",...e})}),l.jsx(x.zG,{})]})})]})]}),(0,l.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-sm",children:[(0,l.jsxs)("h3",{className:"text-lg sm:text-xl font-bold flex items-center gap-2 sm:gap-3 text-blue-800",children:[l.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:l.jsx(f.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-600"})}),"香精比例"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 sm:gap-0",children:[l.jsx("h4",{className:"text-base sm:text-lg font-semibold text-blue-700",children:"配方比例設定"}),V&&l.jsx(i.z,{type:"button",variant:"outline",size:"sm",onClick:()=>{let{pgRatio:e,vgRatio:r}=C(R.getValues("percentage")||0);R.setValue("pgRatio",e),R.setValue("vgRatio",r),d.Am.success("PG和VG比例已重新計算")},className:"text-blue-600 border-blue-300 hover:bg-blue-50 w-full sm:w-auto",children:"重新計算PG/VG"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6",children:[l.jsx(x.Wi,{control:R.control,name:"percentage",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"香精比例 (%)"}),l.jsx(x.NI,{children:l.jsx(g.I,{type:"number",placeholder:"輸入香精比例，PG和VG將自動計算",className:"border-gray-300 focus:border-blue-500 focus:ring-blue-500",...e,onChange:r=>{if(e.onChange(r),V){let{pgRatio:e,vgRatio:s}=C(parseFloat(r.target.value)||0);R.setValue("pgRatio",e),R.setValue("vgRatio",s)}}})}),l.jsx(x.zG,{})]})}),l.jsx(x.Wi,{control:R.control,name:"pgRatio",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"PG 比例 (%) - 自動計算"}),l.jsx(x.NI,{children:l.jsx(g.I,{type:"number",disabled:!0,placeholder:"根據香精比例自動計算",className:"border-gray-300 bg-gray-50",...e})}),l.jsx(x.zG,{})]})}),l.jsx(x.Wi,{control:R.control,name:"vgRatio",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.lX,{className:"text-sm font-semibold text-gray-700",children:"VG 比例 (%) - 自動計算"}),l.jsx(x.NI,{children:l.jsx(g.I,{type:"number",disabled:!0,placeholder:"根據香精比例自動計算",className:"border-gray-300 bg-gray-50",...e})}),l.jsx(x.zG,{})]})})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4 sm:space-y-6 p-4 sm:p-6 bg-gradient-to-r from-yellow-50 to-amber-50 rounded-xl border border-yellow-200 shadow-sm",children:[(0,l.jsxs)("h3",{className:"text-lg sm:text-xl font-bold flex items-center gap-2 sm:gap-3 text-yellow-800",children:[l.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-yellow-100 rounded-lg flex items-center justify-center",children:l.jsx(j.Z,{className:"h-3 w-3 sm:h-4 sm:w-4 text-yellow-600"})}),"備註"]}),l.jsx(x.Wi,{control:R.control,name:"remarks",render:({field:e})=>(0,l.jsxs)(x.xJ,{children:[l.jsx(x.NI,{children:l.jsx(p.g,{placeholder:"輸入香精備註 (選填)",className:"border-gray-300 focus:border-yellow-500 focus:ring-yellow-500",...e})}),l.jsx(x.zG,{})]})})]}),(0,l.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3 pt-4 sm:pt-6 border-t border-gray-200",children:[l.jsx(i.z,{type:"button",variant:"outline",onClick:()=>r(!1),className:"border-gray-300 text-gray-700 hover:bg-gray-50 w-full sm:w-auto",children:"取消"}),l.jsx(i.z,{type:"submit",disabled:N,className:"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white shadow-lg hover:shadow-xl transition-all duration-200 w-full sm:w-auto",children:N?(0,l.jsxs)(l.Fragment,{children:[l.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"處理中..."]}):V?"儲存更新":"確認新增"})]})]})})]})})}},58580:(e,r,s)=>{s.d(r,{O:()=>o});var l=s(10326),t=s(24118),a=s(38443),n=s(29752);function o({isOpen:e,onOpenChange:r,title:s,subtitle:o,sections:c,actions:d}){let i=(e,r="text")=>{if(null==e||""===e)return l.jsx("span",{className:"text-muted-foreground",children:"-"});switch(r){case"date":if(e?.toDate)return new Date(e.toDate()).toLocaleString("zh-TW");return new Date(e).toLocaleString("zh-TW");case"badge":return l.jsx(a.C,{variant:(e=>{switch(e.toLowerCase()){case"active":case"啟用":return"default";case"inactive":case"停用":return"secondary";case"discontinued":case"已下架":return"destructive";default:return"outline"}})(e),children:(e=>{switch(e.toLowerCase()){case"active":return"啟用";case"inactive":return"停用";case"discontinued":return"已下架";default:return e}})(e)});case"currency":return`NT$ ${Math.round(Number(e)).toLocaleString()}`;case"percentage":return`${e}%`;case"number":return Number(e).toLocaleString();default:return String(e)}};return l.jsx(t.Vq,{open:e,onOpenChange:r,children:(0,l.jsxs)(t.cZ,{className:"max-w-2xl max-h-[90vh] overflow-y-auto","aria-describedby":"detail-view-dialog-description",children:[(0,l.jsxs)(t.fK,{children:[l.jsx(t.$N,{className:"text-xl flex items-center gap-2",children:s}),o&&l.jsx("p",{className:"text-sm text-muted-foreground",id:"detail-view-dialog-description",children:o})]}),l.jsx("div",{className:"space-y-6",children:c.map((e,r)=>(0,l.jsxs)(n.Zb,{className:(e=>{switch(e){case"blue":return"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200";case"green":return"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200";case"purple":return"bg-gradient-to-r from-purple-50 to-violet-50 border-purple-200";case"yellow":return"bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200";case"red":return"bg-gradient-to-r from-red-50 to-pink-50 border-red-200";case"gray":return"bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200";default:return"bg-white border-gray-200"}})(e.color),children:[l.jsx(n.Ol,{className:"pb-3",children:(0,l.jsxs)(n.ll,{className:`text-lg font-bold flex items-center gap-3 ${(e=>{switch(e){case"blue":return"text-blue-800";case"green":return"text-green-800";case"purple":return"text-purple-800";case"yellow":return"text-yellow-800";case"red":return"text-red-800";default:return"text-foreground"}})(e.color)}`,children:[l.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${"blue"===e.color?"bg-blue-100":"green"===e.color?"bg-green-100":"purple"===e.color?"bg-purple-100":"yellow"===e.color?"bg-yellow-100":"red"===e.color?"bg-red-100":(e.color,"bg-gray-100")}`,children:l.jsx("div",{className:`${"blue"===e.color?"text-blue-600":"green"===e.color?"text-green-600":"purple"===e.color?"text-purple-600":"yellow"===e.color?"text-yellow-600":"red"===e.color?"text-red-600":(e.color,"text-gray-600")}`,children:e.icon})}),e.title]})}),l.jsx(n.aY,{children:l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.fields.map((e,r)=>(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[e.icon,l.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:e.label})]}),l.jsx("div",{className:"text-sm",children:i(e.value,e.type)})]},r))})})]},r))}),d&&l.jsx(l.Fragment,{children:l.jsx("div",{className:"border-t pt-4",children:l.jsx("div",{className:"flex justify-end gap-2",children:d})})})]})})}}};