(()=>{var e={};e.id=4439,e.ids=[4439],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},59647:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>x,tree:()=>o}),r(98034),r(22834),r(62510),r(35866);var s=r(23191),a=r(88716),n=r(37922),l=r.n(n),i=r(95231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);r.d(t,c);let o=["",{children:["dashboard",{children:["inventory",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,98034)),"D:\\APP\\deer-lab\\src\\app\\dashboard\\inventory\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,22834)),"D:\\APP\\deer-lab\\src\\app\\dashboard\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,62510)),"D:\\APP\\deer-lab\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["D:\\APP\\deer-lab\\src\\app\\dashboard\\inventory\\page.tsx"],u="/dashboard/inventory/page",m={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/inventory/page",pathname:"/dashboard/inventory",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},53212:(e,t,r)=>{Promise.resolve().then(r.bind(r,72721))},72257:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},30361:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("CircleCheckBig",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},71821:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},98258:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]])},77506:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},11019:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},83855:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},21405:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},88307:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},88378:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},29163:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]])},50949:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},94019:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},72721:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>tP});var s=r(10326),a=r(17577),n=r(78880),l=r(85999),i=r(76),c=r(90445);class o{set(e,t,r=this.defaultTTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:r})}get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}has(e){let t=this.cache.get(e);return!!t&&(!(Date.now()-t.timestamp>t.ttl)||(this.cache.delete(e),!1))}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}cleanup(){let e=Date.now();for(let[t,r]of this.cache.entries())e-r.timestamp>r.ttl&&this.cache.delete(t)}getStats(){return{size:this.cache.size,keys:Array.from(this.cache.keys())}}constructor(){this.cache=new Map,this.defaultTTL=3e5}}let d=new o;setInterval(()=>{d.cleanup()},6e4);var u=r(33741);class m{async execute(e,t){if(this.pendingRequests.has(e))return u.kg.info(`Request deduplication hit for key: ${e}`),this.pendingRequests.get(e);let r=t();this.pendingRequests.set(e,r);try{return await r}finally{this.pendingRequests.delete(e)}}cancel(e){this.pendingRequests.delete(e)}clear(){this.pendingRequests.clear()}getStats(){return{pendingCount:this.pendingRequests.size,pendingKeys:Array.from(this.pendingRequests.keys())}}constructor(){this.pendingRequests=new Map}}let x=new m;async function h(e,t=[],r={}){let{ttl:s=3e5,skipCache:a=!1,forceRefresh:n=!1}=r,l=JSON.stringify(t),o=`firestore:${e}:query:${btoa(l)}`;if(n&&d.delete(o),!a&&!n&&d.has(o)){let t=d.get(o);if(null!==t)return u.kg.info(`Cache hit for collection: ${e}`),t}try{let r=await x.execute(o,async()=>{if(!c.db)throw Error("Firebase 未初始化");u.kg.info(`Fetching collection: ${e}`);let r=(0,i.collection)(c.db,e),s=(0,i.query)(r,...t);return(await (0,i.getDocs)(s)).docs.map(e=>({id:e.id,...e.data()}))});return d.set(o,r,s),r}catch(r){let t=r instanceof Error?r:Error(String(r));throw u.kg.error(`Error fetching collection ${e}:`,t),t}}let p={medium:{ttl:9e5}},g={getMaterials:async e=>(await h("materials",[],{...p.medium,...e})).map(e=>({...e,type:"material"})),getFragrances:async e=>(await h("fragrances",[],{...p.medium,...e})).map(e=>({...e,type:"fragrance"}))};function f(e,t,r={}){let{enabled:s=!0,...n}=r,[l,i]=(0,a.useState)(null),[c,o]=(0,a.useState)(s),[d,m]=(0,a.useState)(null),x=(0,a.useRef)(e),h=(0,a.useRef)(!0),p=(0,a.useCallback)(async()=>{if(s){o(!0),m(null);try{let e=await x.current();h.current&&i(e)}catch(r){let e=r instanceof Error?r:Error(String(r));u.kg.error(`Firebase cache error for key ${t}:`,e),h.current&&m(r instanceof Error?r:Error("Unknown error"))}finally{h.current&&o(!1)}}},[t,s]);return{data:l,loading:c,error:d,refetch:(0,a.useCallback)(async()=>{await p()},[p]),clearCache:(0,a.useCallback)(()=>{u.kg.info(`清除快取: ${t}`)},[t])}}var v=r(21405),b=r(88378),j=r(50949),y=r(72257),N=r(48705),w=r(88307),k=r(98258),C=r(91664),S=r(29752),I=r(41190),E=r(99744),M=r(71821),A=r(38227);function O({overview:e,loading:t}){if(t||!e)return s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)(S.Zb,{children:[s.jsx(S.Ol,{className:"pb-2",children:s.jsx(A.O,{className:"h-4 w-20"})}),(0,s.jsxs)(S.aY,{children:[s.jsx(A.O,{className:"h-8 w-16 mb-2"}),s.jsx(A.O,{className:"h-3 w-24"})]})]},t))});let r=[{title:"總物料數",value:e.totalMaterials,description:`${e.lowStockMaterials} 項低庫存`,icon:N.Z,gradient:"from-blue-500 to-cyan-500",bgGradient:"from-blue-50 to-cyan-50",borderColor:"border-blue-200",iconColor:"text-blue-600"},{title:"總香精數",value:e.totalFragrances,description:`${e.lowStockFragrances} 項低庫存`,icon:k.Z,gradient:"from-purple-500 to-pink-500",bgGradient:"from-purple-50 to-pink-50",borderColor:"border-purple-200",iconColor:"text-purple-600"},{title:"總物料成本",value:`NT$ ${e.totalMaterialCost.toLocaleString()}`,description:"當前庫存價值",icon:M.Z,gradient:"from-green-500 to-emerald-500",bgGradient:"from-green-50 to-emerald-50",borderColor:"border-green-200",iconColor:"text-green-600"},{title:"總香精成本",value:`NT$ ${e.totalFragranceCost.toLocaleString()}`,description:"當前庫存價值",icon:M.Z,gradient:"from-orange-500 to-red-500",bgGradient:"from-orange-50 to-red-50",borderColor:"border-orange-200",iconColor:"text-orange-600"}];return s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:r.map((e,t)=>(0,s.jsxs)(S.Zb,{className:`${e.borderColor} bg-gradient-to-br ${e.bgGradient} hover:shadow-lg transition-all duration-200 hover:scale-105`,children:[(0,s.jsxs)(S.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[s.jsx(S.ll,{className:"text-sm font-medium text-gray-700",children:e.title}),s.jsx(e.icon,{className:`h-5 w-5 ${e.iconColor}`})]}),(0,s.jsxs)(S.aY,{children:[s.jsx("div",{className:`text-2xl font-bold bg-gradient-to-r ${e.gradient} bg-clip-text text-transparent`,children:e.value}),s.jsx("p",{className:`text-xs ${e.iconColor} mt-1 opacity-80`,children:e.description})]})]},t))})}var P=r(17069),R=r(29163),Z=r(41156),$=r(38443),z=r(9280);let q=e=>{let t;let r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,n={setState:s,getState:a,getInitialState:()=>l,subscribe:e=>(r.add(e),()=>r.delete(e))},l=t=e(s,a,n);return n},D=e=>e?q(e):q,L=e=>e,_=e=>{let t=D(e),r=e=>(function(e,t=L){let r=a.useSyncExternalStore(e.subscribe,a.useCallback(()=>t(e.getState()),[e,t]),a.useCallback(()=>t(e.getInitialState()),[e,t]));return a.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},F=e=>e?_(e):_;function V(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var s;let a=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),n=null!=(s=r.getItem(e))?s:null;return n instanceof Promise?n.then(a):a(n)},setItem:(e,s)=>r.setItem(e,JSON.stringify(s,null==t?void 0:t.replacer)),removeItem:e=>r.removeItem(e)}}let T=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>T(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>T(t)(e)}}},U=(e,t)=>(r,s,a)=>{let n,l={storage:V(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},i=!1,c=new Set,o=new Set,d=l.storage;if(!d)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${l.name}', the given storage is currently unavailable.`),r(...e)},s,a);let u=()=>{let e=l.partialize({...s()});return d.setItem(l.name,{state:e,version:l.version})},m=a.setState;a.setState=(e,t)=>(m(e,t),u());let x=e((...e)=>(r(...e),u()),s,a);a.getInitialState=()=>x;let h=()=>{var e,t;if(!d)return;i=!1,c.forEach(e=>{var t;return e(null!=(t=s())?t:x)});let a=(null==(t=l.onRehydrateStorage)?void 0:t.call(l,null!=(e=s())?e:x))||void 0;return T(d.getItem.bind(d))(l.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===l.version)return[!1,e.state];if(l.migrate){let t=l.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[a,i]=e;if(r(n=l.merge(i,null!=(t=s())?t:x),!0),a)return u()}).then(()=>{null==a||a(n,void 0),n=s(),i=!0,o.forEach(e=>e(n))}).catch(e=>{null==a||a(void 0,e)})};return a.persist={setOptions:e=>{l={...l,...e},e.storage&&(d=e.storage)},clearStorage:()=>{null==d||d.removeItem(l.name)},getOptions:()=>l,rehydrate:()=>h(),hasHydrated:()=>i,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(o.add(e),()=>{o.delete(e)})},l.skipHydration||h(),n||x},Q={getItem:e=>null,setItem:(e,t)=>{},removeItem:e=>{}},G=V(()=>Q),W={inventory:{name:"deer-lab-inventory-store",storage:G,partialize:e=>({filters:e.filters,selectedItems:e.selectedItems})},ui:{name:"deer-lab-ui-store",storage:G,partialize:e=>({sidebar:e.sidebar,quickActions:{recentActions:e.quickActions.recentActions.slice(0,10)}})}};function B(e,t,r,s,a){return async(...n)=>{t(!0),r(null);try{let t=await e(...n);return s&&s(t),t}catch(t){let e=t instanceof Error?t.message:"Unknown error";return r(e),a&&a(t instanceof Error?t:Error(e)),null}finally{t(!1)}}}let K={toggle:(e,t)=>{let r=e.indexOf(t);return -1===r?[...e,t]:e.filter((e,t)=>t!==r)},update:(e,t,r)=>e.map(e=>e.id===t?{...e,...r}:e)},H={materials:[],fragrances:[],loading:{materials:!1,fragrances:!1,updating:!1},selectedItems:{materials:[],fragrances:[]},filters:{searchTerm:"",category:"",lowStockOnly:!1,sortBy:"name",sortOrder:"asc"},batchOperations:{isEnabled:!1,pendingUpdates:{}}},Y=(e,t)=>{let r=e;if(t.searchTerm){let e=t.searchTerm.toLowerCase();r=r.filter(t=>t.name.toLowerCase().includes(e)||t.code.toLowerCase().includes(e)||"category"in t&&t.category?.toLowerCase().includes(e)||"series"in t&&t.series?.toLowerCase().includes(e))}return t.category&&"all"!==t.category&&(r=r.filter(e=>"category"in e&&e.category===t.category)),t.lowStockOnly&&(r=r.filter(e=>e.minStock>0&&e.currentStock<e.minStock)),r.sort((e,r)=>{let s,a;switch(t.sortBy){case"name":s=e.name.toLowerCase(),a=r.name.toLowerCase();break;case"code":s=e.code.toLowerCase(),a=r.code.toLowerCase();break;case"stock":s=e.currentStock,a=r.currentStock;break;case"cost":s=e.costPerUnit,a=r.costPerUnit;break;default:return 0}return s<a?"asc"===t.sortOrder?-1:1:s>a?"asc"===t.sortOrder?1:-1:0}),r},X=F()(U((e,t)=>({...H,setMaterials:t=>e({materials:t}),setFragrances:t=>e({fragrances:t}),updateMaterial:(t,r)=>e(e=>({materials:K.update(e.materials,t,r)})),updateFragrance:(t,r)=>e(e=>({fragrances:K.update(e.fragrances,t,r)})),setLoading:(t,r)=>e(e=>({loading:{...e.loading,[t]:r}})),toggleSelection:(t,r)=>e(e=>({selectedItems:{...e.selectedItems,[t]:K.toggle(e.selectedItems[t],r)}})),clearSelections:()=>e(e=>({selectedItems:{materials:[],fragrances:[]}})),selectAll:t=>e(e=>{let r="materials"===t?e.materials:e.fragrances;return{selectedItems:{...e.selectedItems,[t]:r.map(e=>e.id)}}}),selectNone:t=>e(e=>({selectedItems:{...e.selectedItems,[t]:[]}})),updateFilters:t=>e(e=>({filters:{...e.filters,...t}})),setSearchTerm:t=>e(e=>({filters:{...e.filters,searchTerm:t}})),setCategory:t=>e(e=>({filters:{...e.filters,category:t}})),toggleLowStockFilter:()=>e(e=>({filters:{...e.filters,lowStockOnly:!e.filters.lowStockOnly}})),setSortBy:t=>e(e=>({filters:{...e.filters,sortBy:t}})),toggleSortOrder:()=>e(e=>({filters:{...e.filters,sortOrder:"asc"===e.filters.sortOrder?"desc":"asc"}})),enableBatchMode:()=>e(e=>({batchOperations:{...e.batchOperations,isEnabled:!0}})),disableBatchMode:()=>e(e=>({batchOperations:{isEnabled:!1,pendingUpdates:{}},selectedItems:{materials:[],fragrances:[]}})),addBatchUpdate:(t,r,s)=>e(e=>({batchOperations:{...e.batchOperations,pendingUpdates:{...e.batchOperations.pendingUpdates,[t]:{quantity:r,reason:s}}}})),removeBatchUpdate:t=>e(e=>{let r={...e.batchOperations.pendingUpdates};return delete r[t],{batchOperations:{...e.batchOperations,pendingUpdates:r}}}),clearBatchUpdates:()=>e(e=>({batchOperations:{...e.batchOperations,pendingUpdates:{}}})),loadMaterials:B(async()=>{let e=await g.getMaterials();return t().setMaterials(e||[]),e},e=>t().setLoading("materials",e),e=>u.kg.error("載入物料失敗:",Error(e||"未知錯誤"))),loadFragrances:B(async()=>{let e=await g.getFragrances();return t().setFragrances(e||[]),e},e=>t().setLoading("fragrances",e),e=>u.kg.error("載入香精失敗:",Error(e||"未知錯誤"))),refreshAll:async()=>{await Promise.all([t().loadMaterials(),t().loadFragrances()])},applyBatchUpdates:B(async()=>{let{batchOperations:e}=t(),r=Object.entries(e.pendingUpdates);for(let[e,s]of r){let{quantity:r,reason:a}=s,n=t().materials.find(t=>t.id===e),l=t().fragrances.find(t=>t.id===e);n?t().updateMaterial(e,{currentStock:r}):l&&t().updateFragrance(e,{currentStock:r})}t().clearBatchUpdates(),u.kg.info(`批量更新完成，共更新 ${r.length} 個項目`)},e=>t().setLoading("updating",e),e=>u.kg.error("批量更新失敗:",Error(e||"未知錯誤"))),getFilteredMaterials:()=>{let{materials:e,filters:r}=t();return Y(e,r)},getFilteredFragrances:()=>{let{fragrances:e,filters:r}=t();return Y(e,r)},getLowStockItems:()=>{let{materials:e,fragrances:r}=t();return[...e,...r].filter(e=>e.minStock>0&&e.currentStock<e.minStock)},getSelectedItems:()=>{let{materials:e,fragrances:r,selectedItems:s}=t();return{materials:e.filter(e=>s.materials.includes(e.id)),fragrances:r.filter(e=>s.fragrances.includes(e.id))}},getTotalValue:()=>{let{materials:e,fragrances:r}=t();return{materials:e.reduce((e,t)=>e+t.currentStock*t.costPerUnit,0),fragrances:r.reduce((e,t)=>e+t.currentStock*t.costPerUnit,0)}}}),{name:W.inventory.name,storage:W.inventory.storage,partialize:W.inventory.partialize}));function J({items:e,loading:t,onQuickUpdate:r,type:a}){let{batchOperations:n,selectedItems:l,toggleSelection:i}=X();if(t)return s.jsx("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[s.jsx(A.O,{className:"h-4 w-16"}),s.jsx(A.O,{className:"h-4 w-32 flex-1"}),s.jsx(A.O,{className:"h-4 w-20"}),s.jsx(A.O,{className:"h-4 w-16"}),s.jsx(A.O,{className:"h-8 w-20"})]},t))});if(0===e.length)return(0,s.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[s.jsx("div",{className:"mb-4",children:"material"===a?s.jsx(N.Z,{className:"h-12 w-12 mx-auto text-gray-300"}):s.jsx(k.Z,{className:"h-12 w-12 mx-auto text-gray-300"})}),(0,s.jsxs)("p",{className:"text-lg font-medium",children:["沒有找到","material"===a?"物料":"香精","項目"]}),s.jsx("p",{className:"text-sm",children:"嘗試調整搜尋條件或新增項目"})]});let c=e=>e.currentStock<=e.minStock?{status:"low",text:"低庫存",badgeColor:"bg-red-100 text-red-800 border-red-200",icon:s.jsx(j.Z,{className:"h-3 w-3"})}:e.currentStock>=e.maxStock?{status:"high",text:"高庫存",badgeColor:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:s.jsx(P.Z,{className:"h-3 w-3"})}:{status:"normal",text:"正常",badgeColor:"bg-green-100 text-green-800 border-green-200",icon:s.jsx(R.Z,{className:"h-3 w-3"})};return(0,s.jsxs)("div",{children:[s.jsx("div",{className:"hidden md:block rounded-md border",children:(0,s.jsxs)(Z.iA,{children:[s.jsx(Z.xD,{children:(0,s.jsxs)(Z.SC,{className:"bg-gray-50",children:[n.isEnabled&&s.jsx(Z.ss,{className:"font-semibold w-12",children:s.jsx(z.X,{checked:e.every(e=>l["material"===a?"materials":"fragrances"].includes(e.id)),onCheckedChange:t=>{e.forEach(e=>{let r=l["material"===a?"materials":"fragrances"].includes(e.id);t&&!r?i("material"===a?"materials":"fragrances",e.id):!t&&r&&i("material"===a?"materials":"fragrances",e.id)})}})}),s.jsx(Z.ss,{className:"font-semibold",children:"代碼"}),s.jsx(Z.ss,{className:"font-semibold",children:"名稱"}),s.jsx(Z.ss,{className:"font-semibold",children:"分類"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"當前庫存"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"安全庫存"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"單價"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"庫存價值"}),s.jsx(Z.ss,{className:"font-semibold text-center",children:"狀態"}),s.jsx(Z.ss,{className:"font-semibold text-center",children:"操作"})]})}),s.jsx(Z.RM,{children:e.map(e=>{let t=c(e),o=e.currentStock*e.costPerUnit,d=l["material"===a?"materials":"fragrances"].includes(e.id);return(0,s.jsxs)(Z.SC,{className:`hover:bg-gray-50 transition-colors ${d&&n.isEnabled?"bg-blue-50 border-blue-200":""}`,children:[n.isEnabled&&s.jsx(Z.pj,{children:s.jsx(z.X,{checked:d,onCheckedChange:()=>i("material"===a?"materials":"fragrances",e.id)})}),s.jsx(Z.pj,{className:"font-mono text-sm font-medium",children:e.code}),s.jsx(Z.pj,{children:(0,s.jsxs)("div",{children:[s.jsx("div",{className:"font-medium text-gray-900",children:e.name}),e.series&&(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["系列: ",e.series]})]})}),s.jsx(Z.pj,{children:s.jsx("span",{className:"text-sm text-gray-600",children:e.category||"-"})}),s.jsx(Z.pj,{className:"text-right",children:s.jsx(C.z,{variant:"ghost",className:"h-auto p-2 font-semibold hover:bg-blue-50",onClick:()=>r(e),children:(0,s.jsxs)("span",{className:"text-blue-600",children:[e.currentStock," ",e.unit]})})}),(0,s.jsxs)(Z.pj,{className:"text-right text-sm text-gray-600",children:[e.minStock," ",e.unit]}),(0,s.jsxs)(Z.pj,{className:"text-right text-sm text-gray-600",children:["NT$ ",e.costPerUnit.toLocaleString()]}),(0,s.jsxs)(Z.pj,{className:"text-right font-medium text-gray-900",children:["NT$ ",o.toLocaleString()]}),s.jsx(Z.pj,{className:"text-center",children:(0,s.jsxs)($.C,{variant:"outline",className:`${t.badgeColor} text-xs flex items-center gap-1 w-fit mx-auto`,children:[t.icon,t.text]})}),s.jsx(Z.pj,{className:"text-center",children:s.jsx(C.z,{variant:"outline",size:"sm",onClick:()=>r(e),className:"text-xs",children:"快速調整"})})]},e.id)})})]})}),s.jsx("div",{className:"md:hidden space-y-4",children:e.map(e=>{let t=c(e),o=e.currentStock*e.costPerUnit,d=l["material"===a?"materials":"fragrances"].includes(e.id);return(0,s.jsxs)("div",{className:`bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow ${d&&n.isEnabled?"border-blue-300 bg-blue-50":"border-gray-200"}`,children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[n.isEnabled&&s.jsx(z.X,{checked:d,onCheckedChange:()=>i("material"===a?"materials":"fragrances",e.id),className:"mt-1"}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-900 text-lg mb-1",children:e.name}),(0,s.jsxs)("div",{className:"font-mono text-sm text-gray-600 mb-1",children:["代碼: ",e.code]}),e.series&&(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["系列: ",e.series]})]})]}),(0,s.jsxs)($.C,{variant:"outline",className:`${t.badgeColor} text-xs flex items-center gap-1 shrink-0 ml-2`,children:[t.icon,t.text]})]}),e.category&&s.jsx("div",{className:"mb-3 py-1 px-2 bg-gray-100 rounded text-sm text-gray-700 inline-block",children:e.category}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3",children:[s.jsx("div",{className:"text-xs text-blue-600 font-medium mb-1",children:"當前庫存"}),(0,s.jsxs)("button",{onClick:()=>r(e),className:"text-lg font-bold text-blue-700 hover:text-blue-800 transition-colors",children:[e.currentStock," ",e.unit]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[s.jsx("div",{className:"text-xs text-gray-600 font-medium mb-1",children:"安全庫存"}),(0,s.jsxs)("div",{className:"text-lg font-semibold text-gray-700",children:[e.minStock," ",e.unit]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,s.jsxs)("div",{className:"bg-green-50 rounded-lg p-3",children:[s.jsx("div",{className:"text-xs text-green-600 font-medium mb-1",children:"單價"}),(0,s.jsxs)("div",{className:"text-lg font-semibold text-green-700",children:["NT$ ",e.costPerUnit.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"bg-purple-50 rounded-lg p-3",children:[s.jsx("div",{className:"text-xs text-purple-600 font-medium mb-1",children:"庫存價值"}),(0,s.jsxs)("div",{className:"text-lg font-bold text-purple-700",children:["NT$ ",o.toLocaleString()]})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsx(C.z,{onClick:()=>r(e),className:"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-6 py-2 rounded-lg font-medium shadow-sm hover:shadow transition-all duration-200 min-h-[44px]",children:"快速調整"})})]},e.id)})})]})}var ee=r(24118);function et({isOpen:e,onClose:t}){let[r,i]=(0,a.useState)([]),[c,o]=(0,a.useState)(!0),d=async()=>{o(!0);try{let e=(0,n.$C)(),t=(0,n.V1)(e,"getLowStockItems"),r=(await t({})).data;r.success&&i(r.items)}catch(e){console.error("載入低庫存項目失敗:",e),l.Am.error("載入低庫存項目失敗")}finally{o(!1)}};return s.jsx(ee.Vq,{open:e,onOpenChange:t,children:(0,s.jsxs)(ee.cZ,{className:"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[(0,s.jsxs)(ee.fK,{children:[(0,s.jsxs)(ee.$N,{className:"flex items-center gap-2 text-red-600",children:[s.jsx(j.Z,{className:"h-5 w-5"}),"低庫存項目清單"]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx(ee.Be,{children:"以下項目的庫存已低於或等於安全庫存線，建議及時補貨"}),(0,s.jsxs)(C.z,{variant:"outline",size:"sm",onClick:d,disabled:c,className:"ml-4",children:[s.jsx(v.Z,{className:`h-4 w-4 mr-2 ${c?"animate-spin":""}`}),"重新整理"]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:c?s.jsx("div",{className:"space-y-3",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[s.jsx(A.O,{className:"h-4 w-16"}),s.jsx(A.O,{className:"h-4 w-32 flex-1"}),s.jsx(A.O,{className:"h-4 w-20"}),s.jsx(A.O,{className:"h-4 w-16"})]},t))}):0===r.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[s.jsx("div",{className:"text-green-600 mb-4",children:s.jsx(N.Z,{className:"h-12 w-12 mx-auto"})}),s.jsx("h3",{className:"text-lg font-medium text-green-800 mb-2",children:"太棒了！"}),s.jsx("p",{className:"text-green-600",children:"目前沒有低庫存項目"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"所有物料和香精庫存都在安全範圍內"})]}):(0,s.jsxs)("div",{className:"rounded-md border",children:[(0,s.jsxs)(Z.iA,{children:[s.jsx(Z.xD,{children:(0,s.jsxs)(Z.SC,{className:"bg-red-50",children:[s.jsx(Z.ss,{className:"font-semibold",children:"類型"}),s.jsx(Z.ss,{className:"font-semibold",children:"代碼"}),s.jsx(Z.ss,{className:"font-semibold",children:"名稱"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"當前庫存"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"安全庫存"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"短缺數量"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"單價"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"補貨成本"})]})}),s.jsx(Z.RM,{children:r.map(e=>{let t=e.shortage*e.costPerUnit;return(0,s.jsxs)(Z.SC,{className:"hover:bg-gray-50",children:[s.jsx(Z.pj,{children:s.jsx($.C,{variant:"outline",className:`${"material"===e.type?"text-blue-600 border-blue-200 bg-blue-50":"text-purple-600 border-purple-200 bg-purple-50"}`,children:"material"===e.type?(0,s.jsxs)(s.Fragment,{children:[s.jsx(N.Z,{className:"h-3 w-3 mr-1"}),"物料"]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(k.Z,{className:"h-3 w-3 mr-1"}),"香精"]})})}),s.jsx(Z.pj,{className:"font-mono text-sm font-medium",children:e.code}),s.jsx(Z.pj,{className:"font-medium",children:e.name}),s.jsx(Z.pj,{className:"text-right",children:(0,s.jsxs)("span",{className:"text-red-600 font-medium",children:[e.currentStock," ",e.unit]})}),(0,s.jsxs)(Z.pj,{className:"text-right text-gray-600",children:[e.minStock," ",e.unit]}),s.jsx(Z.pj,{className:"text-right",children:(0,s.jsxs)($.C,{variant:"destructive",className:"font-medium",children:[e.shortage," ",e.unit]})}),(0,s.jsxs)(Z.pj,{className:"text-right text-sm text-gray-600",children:["NT$ ",e.costPerUnit.toLocaleString()]}),(0,s.jsxs)(Z.pj,{className:"text-right font-medium text-red-600",children:["NT$ ",t.toLocaleString()]})]},`${e.type}-${e.id}`)})})]}),s.jsx("div",{className:"border-t bg-gray-50 p-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsxs)("span",{className:"font-medium text-gray-700",children:["共 ",r.length," 項低庫存項目"]}),(0,s.jsxs)("span",{className:"font-medium text-red-600",children:["總補貨成本: NT$ ",r.reduce((e,t)=>e+t.shortage*t.costPerUnit,0).toLocaleString()]})]})})]})})]})})}var er=r(83855),es=r(11019),ea=r(30361),en=r(62881);let el=(0,en.Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var ei=r(49527),ec=r(44794),eo=/[\\\/_+.#"@\[\(\{&]/,ed=/[\\\/_+.#"@\[\(\{&]/g,eu=/[\s-]/,em=/[\s-]/g;function ex(e){return e.toLowerCase().replace(em," ")}var eh=r(98958),ep=r(45226),eg=r(88957),ef=r(48051),ev='[cmdk-group=""]',eb='[cmdk-group-items=""]',ej='[cmdk-item=""]',ey=`${ej}:not([aria-disabled="true"])`,eN="cmdk-item-select",ew="data-value",ek=(e,t,r)=>(function(e,t,r){return function e(t,r,s,a,n,l,i){if(l===r.length)return n===t.length?1:.99;var c=`${n},${l}`;if(void 0!==i[c])return i[c];for(var o,d,u,m,x=a.charAt(l),h=s.indexOf(x,n),p=0;h>=0;)(o=e(t,r,s,a,h+1,l+1,i))>p&&(h===n?o*=1:eo.test(t.charAt(h-1))?(o*=.8,(u=t.slice(n,h-1).match(ed))&&n>0&&(o*=Math.pow(.999,u.length))):eu.test(t.charAt(h-1))?(o*=.9,(m=t.slice(n,h-1).match(em))&&n>0&&(o*=Math.pow(.999,m.length))):(o*=.17,n>0&&(o*=Math.pow(.999,h-n))),t.charAt(h)!==r.charAt(l)&&(o*=.9999)),(o<.1&&s.charAt(h-1)===a.charAt(l+1)||a.charAt(l+1)===a.charAt(l)&&s.charAt(h-1)!==a.charAt(l))&&.1*(d=e(t,r,s,a,h+1,l+2,i))>o&&(o=.1*d),o>p&&(p=o),h=s.indexOf(x,h+1);return i[c]=p,p}(e=r&&r.length>0?`${e+" "+r.join(" ")}`:e,t,ex(e),ex(t),0,0,{})})(e,t,r),eC=a.createContext(void 0),eS=()=>a.useContext(eC),eI=a.createContext(void 0),eE=()=>a.useContext(eI),eM=a.createContext(void 0),eA=a.forwardRef((e,t)=>{let r=e_(()=>{var t,r;return{search:"",value:null!=(r=null!=(t=e.value)?t:e.defaultValue)?r:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),s=e_(()=>new Set),n=e_(()=>new Map),l=e_(()=>new Map),i=e_(()=>new Set),c=eD(e),{label:o,children:d,value:u,onValueChange:m,filter:x,shouldFilter:h,loop:p,disablePointerSelection:g=!1,vimBindings:f=!0,...v}=e,b=(0,eg.M)(),j=(0,eg.M)(),y=(0,eg.M)(),N=a.useRef(null),w=eT();eL(()=>{if(void 0!==u){let e=u.trim();r.current.value=e,k.emit()}},[u]),eL(()=>{w(6,A)},[]);let k=a.useMemo(()=>({subscribe:e=>(i.current.add(e),()=>i.current.delete(e)),snapshot:()=>r.current,setState:(e,t,s)=>{var a,n,l,i;if(!Object.is(r.current[e],t)){if(r.current[e]=t,"search"===e)M(),I(),w(1,E);else if("value"===e){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let e=document.getElementById(y);e?e.focus():null==(a=document.getElementById(b))||a.focus()}if(w(7,()=>{var e;r.current.selectedItemId=null==(e=O())?void 0:e.id,k.emit()}),s||w(5,A),(null==(n=c.current)?void 0:n.value)!==void 0){null==(i=(l=c.current).onValueChange)||i.call(l,null!=t?t:"");return}}k.emit()}},emit:()=>{i.current.forEach(e=>e())}}),[]),C=a.useMemo(()=>({value:(e,t,s)=>{var a;t!==(null==(a=l.current.get(e))?void 0:a.value)&&(l.current.set(e,{value:t,keywords:s}),r.current.filtered.items.set(e,S(t,s)),w(2,()=>{I(),k.emit()}))},item:(e,t)=>(s.current.add(e),t&&(n.current.has(t)?n.current.get(t).add(e):n.current.set(t,new Set([e]))),w(3,()=>{M(),I(),r.current.value||E(),k.emit()}),()=>{l.current.delete(e),s.current.delete(e),r.current.filtered.items.delete(e);let t=O();w(4,()=>{M(),(null==t?void 0:t.getAttribute("id"))===e&&E(),k.emit()})}),group:e=>(n.current.has(e)||n.current.set(e,new Set),()=>{l.current.delete(e),n.current.delete(e)}),filter:()=>c.current.shouldFilter,label:o||e["aria-label"],getDisablePointerSelection:()=>c.current.disablePointerSelection,listId:b,inputId:y,labelId:j,listInnerRef:N}),[]);function S(e,t){var s,a;let n=null!=(a=null==(s=c.current)?void 0:s.filter)?a:ek;return e?n(e,r.current.search,t):0}function I(){if(!r.current.search||!1===c.current.shouldFilter)return;let e=r.current.filtered.items,t=[];r.current.filtered.groups.forEach(r=>{let s=n.current.get(r),a=0;s.forEach(t=>{a=Math.max(e.get(t),a)}),t.push([r,a])});let s=N.current;P().sort((t,r)=>{var s,a;let n=t.getAttribute("id"),l=r.getAttribute("id");return(null!=(s=e.get(l))?s:0)-(null!=(a=e.get(n))?a:0)}).forEach(e=>{let t=e.closest(eb);t?t.appendChild(e.parentElement===t?e:e.closest(`${eb} > *`)):s.appendChild(e.parentElement===s?e:e.closest(`${eb} > *`))}),t.sort((e,t)=>t[1]-e[1]).forEach(e=>{var t;let r=null==(t=N.current)?void 0:t.querySelector(`${ev}[${ew}="${encodeURIComponent(e[0])}"]`);null==r||r.parentElement.appendChild(r)})}function E(){let e=P().find(e=>"true"!==e.getAttribute("aria-disabled")),t=null==e?void 0:e.getAttribute(ew);k.setState("value",t||void 0)}function M(){var e,t,a,i;if(!r.current.search||!1===c.current.shouldFilter){r.current.filtered.count=s.current.size;return}r.current.filtered.groups=new Set;let o=0;for(let n of s.current){let s=S(null!=(t=null==(e=l.current.get(n))?void 0:e.value)?t:"",null!=(i=null==(a=l.current.get(n))?void 0:a.keywords)?i:[]);r.current.filtered.items.set(n,s),s>0&&o++}for(let[e,t]of n.current)for(let s of t)if(r.current.filtered.items.get(s)>0){r.current.filtered.groups.add(e);break}r.current.filtered.count=o}function A(){var e,t,r;let s=O();s&&((null==(e=s.parentElement)?void 0:e.firstChild)===s&&(null==(r=null==(t=s.closest(ev))?void 0:t.querySelector('[cmdk-group-heading=""]'))||r.scrollIntoView({block:"nearest"})),s.scrollIntoView({block:"nearest"}))}function O(){var e;return null==(e=N.current)?void 0:e.querySelector(`${ej}[aria-selected="true"]`)}function P(){var e;return Array.from((null==(e=N.current)?void 0:e.querySelectorAll(ey))||[])}function R(e){let t=P()[e];t&&k.setState("value",t.getAttribute(ew))}function Z(e){var t;let r=O(),s=P(),a=s.findIndex(e=>e===r),n=s[a+e];null!=(t=c.current)&&t.loop&&(n=a+e<0?s[s.length-1]:a+e===s.length?s[0]:s[a+e]),n&&k.setState("value",n.getAttribute(ew))}function $(e){let t=O(),r=null==t?void 0:t.closest(ev),s;for(;r&&!s;)s=null==(r=e>0?function(e,t){let r=e.nextElementSibling;for(;r;){if(r.matches(t))return r;r=r.nextElementSibling}}(r,ev):function(e,t){let r=e.previousElementSibling;for(;r;){if(r.matches(t))return r;r=r.previousElementSibling}}(r,ev))?void 0:r.querySelector(ey);s?k.setState("value",s.getAttribute(ew)):Z(e)}let z=()=>R(P().length-1),q=e=>{e.preventDefault(),e.metaKey?z():e.altKey?$(1):Z(1)},D=e=>{e.preventDefault(),e.metaKey?R(0):e.altKey?$(-1):Z(-1)};return a.createElement(ep.WV.div,{ref:t,tabIndex:-1,...v,"cmdk-root":"",onKeyDown:e=>{var t;null==(t=v.onKeyDown)||t.call(v,e);let r=e.nativeEvent.isComposing||229===e.keyCode;if(!(e.defaultPrevented||r))switch(e.key){case"n":case"j":f&&e.ctrlKey&&q(e);break;case"ArrowDown":q(e);break;case"p":case"k":f&&e.ctrlKey&&D(e);break;case"ArrowUp":D(e);break;case"Home":e.preventDefault(),R(0);break;case"End":e.preventDefault(),z();break;case"Enter":{e.preventDefault();let t=O();if(t){let e=new Event(eN);t.dispatchEvent(e)}}}}},a.createElement("label",{"cmdk-label":"",htmlFor:C.inputId,id:C.labelId,style:eQ},o),eU(e,e=>a.createElement(eI.Provider,{value:k},a.createElement(eC.Provider,{value:C},e))))}),eO=a.forwardRef((e,t)=>{var r,s;let n=(0,eg.M)(),l=a.useRef(null),i=a.useContext(eM),c=eS(),o=eD(e),d=null!=(s=null==(r=o.current)?void 0:r.forceMount)?s:null==i?void 0:i.forceMount;eL(()=>{if(!d)return c.item(n,null==i?void 0:i.id)},[d]);let u=eV(n,l,[e.value,e.children,l],e.keywords),m=eE(),x=eF(e=>e.value&&e.value===u.current),h=eF(e=>!!d||!1===c.filter()||!e.search||e.filtered.items.get(n)>0);function p(){var e,t;g(),null==(t=(e=o.current).onSelect)||t.call(e,u.current)}function g(){m.setState("value",u.current,!0)}if(a.useEffect(()=>{let t=l.current;if(!(!t||e.disabled))return t.addEventListener(eN,p),()=>t.removeEventListener(eN,p)},[h,e.onSelect,e.disabled]),!h)return null;let{disabled:f,value:v,onSelect:b,forceMount:j,keywords:y,...N}=e;return a.createElement(ep.WV.div,{ref:(0,ef.F)(l,t),...N,id:n,"cmdk-item":"",role:"option","aria-disabled":!!f,"aria-selected":!!x,"data-disabled":!!f,"data-selected":!!x,onPointerMove:f||c.getDisablePointerSelection()?void 0:g,onClick:f?void 0:p},e.children)}),eP=a.forwardRef((e,t)=>{let{heading:r,children:s,forceMount:n,...l}=e,i=(0,eg.M)(),c=a.useRef(null),o=a.useRef(null),d=(0,eg.M)(),u=eS(),m=eF(e=>!!n||!1===u.filter()||!e.search||e.filtered.groups.has(i));eL(()=>u.group(i),[]),eV(i,c,[e.value,e.heading,o]);let x=a.useMemo(()=>({id:i,forceMount:n}),[n]);return a.createElement(ep.WV.div,{ref:(0,ef.F)(c,t),...l,"cmdk-group":"",role:"presentation",hidden:!m||void 0},r&&a.createElement("div",{ref:o,"cmdk-group-heading":"","aria-hidden":!0,id:d},r),eU(e,e=>a.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?d:void 0},a.createElement(eM.Provider,{value:x},e))))}),eR=a.forwardRef((e,t)=>{let{alwaysRender:r,...s}=e,n=a.useRef(null),l=eF(e=>!e.search);return r||l?a.createElement(ep.WV.div,{ref:(0,ef.F)(n,t),...s,"cmdk-separator":"",role:"separator"}):null}),eZ=a.forwardRef((e,t)=>{let{onValueChange:r,...s}=e,n=null!=e.value,l=eE(),i=eF(e=>e.search),c=eF(e=>e.selectedItemId),o=eS();return a.useEffect(()=>{null!=e.value&&l.setState("search",e.value)},[e.value]),a.createElement(ep.WV.input,{ref:t,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":o.listId,"aria-labelledby":o.labelId,"aria-activedescendant":c,id:o.inputId,type:"text",value:n?e.value:i,onChange:e=>{n||l.setState("search",e.target.value),null==r||r(e.target.value)}})}),e$=a.forwardRef((e,t)=>{let{children:r,label:s="Suggestions",...n}=e,l=a.useRef(null),i=a.useRef(null),c=eF(e=>e.selectedItemId),o=eS();return a.useEffect(()=>{if(i.current&&l.current){let e=i.current,t=l.current,r,s=new ResizeObserver(()=>{r=requestAnimationFrame(()=>{let r=e.offsetHeight;t.style.setProperty("--cmdk-list-height",r.toFixed(1)+"px")})});return s.observe(e),()=>{cancelAnimationFrame(r),s.unobserve(e)}}},[]),a.createElement(ep.WV.div,{ref:(0,ef.F)(l,t),...n,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":c,"aria-label":s,id:o.listId},eU(e,e=>a.createElement("div",{ref:(0,ef.F)(i,o.listInnerRef),"cmdk-list-sizer":""},e)))}),ez=a.forwardRef((e,t)=>{let{open:r,onOpenChange:s,overlayClassName:n,contentClassName:l,container:i,...c}=e;return a.createElement(eh.fC,{open:r,onOpenChange:s},a.createElement(eh.h_,{container:i},a.createElement(eh.aV,{"cmdk-overlay":"",className:n}),a.createElement(eh.VY,{"aria-label":e.label,"cmdk-dialog":"",className:l},a.createElement(eA,{ref:t,...c}))))}),eq=Object.assign(eA,{List:e$,Item:eO,Input:eZ,Group:eP,Separator:eR,Dialog:ez,Empty:a.forwardRef((e,t)=>eF(e=>0===e.filtered.count)?a.createElement(ep.WV.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),Loading:a.forwardRef((e,t)=>{let{progress:r,children:s,label:n="Loading...",...l}=e;return a.createElement(ep.WV.div,{ref:t,...l,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":n},eU(e,e=>a.createElement("div",{"aria-hidden":!0},e)))})});function eD(e){let t=a.useRef(e);return eL(()=>{t.current=e}),t}var eL=a.useEffect;function e_(e){let t=a.useRef();return void 0===t.current&&(t.current=e()),t}function eF(e){let t=eE(),r=()=>e(t.snapshot());return a.useSyncExternalStore(t.subscribe,r,r)}function eV(e,t,r,s=[]){let n=a.useRef(),l=eS();return eL(()=>{var a;let i=(()=>{var e;for(let t of r){if("string"==typeof t)return t.trim();if("object"==typeof t&&"current"in t)return t.current?null==(e=t.current.textContent)?void 0:e.trim():n.current}})(),c=s.map(e=>e.trim());l.value(e,i,c),null==(a=t.current)||a.setAttribute(ew,i),n.current=i}),n}var eT=()=>{let[e,t]=a.useState(),r=e_(()=>new Map);return eL(()=>{r.current.forEach(e=>e()),r.current=new Map},[e]),(e,s)=>{r.current.set(e,s),t({})}};function eU({asChild:e,children:t},r){let s;return e&&a.isValidElement(t)?a.cloneElement("function"==typeof(s=t.type)?s(t.props):"render"in s?s.render(t.props):t,{ref:t.ref},r(t.props.children)):r(t)}var eQ={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"},eG=r(51223);function eW({className:e,...t}){return s.jsx(eq,{"data-slot":"command",className:(0,eG.cn)("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",e),...t})}function eB({className:e,...t}){return(0,s.jsxs)("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[s.jsx(w.Z,{className:"size-4 shrink-0 opacity-50"}),s.jsx(eq.Input,{"data-slot":"command-input",className:(0,eG.cn)("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",e),...t})]})}function eK({className:e,...t}){return s.jsx(eq.List,{"data-slot":"command-list",className:(0,eG.cn)("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",e),...t})}function eH({...e}){return s.jsx(eq.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...e})}function eY({className:e,...t}){return s.jsx(eq.Group,{"data-slot":"command-group",className:(0,eG.cn)("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",e),...t})}function eX({className:e,...t}){return s.jsx(eq.Item,{"data-slot":"command-item",className:(0,eG.cn)("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...t})}var eJ=r(78834);let e0=(0,en.Z)("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);var e1=r(32933);function e2({isOpen:e,onClose:t}){let[r,n]=(0,a.useState)([]),[i,c]=(0,a.useState)([]),[o,d]=(0,a.useState)([]),[u,m]=(0,a.useState)([]),[x,h]=(0,a.useState)([]),[p,g]=(0,a.useState)(!0),[f,v]=(0,a.useState)(!1),[b,w]=(0,a.useState)({}),[S,E]=(0,a.useState)({}),M=e=>e?r.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.code.toLowerCase().includes(e.toLowerCase())||t.seriesName&&t.seriesName.toLowerCase().includes(e.toLowerCase())).sort((e,t)=>{let r=e.seriesName||"未指定",s=t.seriesName||"未指定";return r!==s?r.localeCompare(s,"zh-TW"):e.name.localeCompare(t.name,"zh-TW")}):r,A=(e,t,s)=>{m(a=>{let n=[...a];if("productId"===t&&"string"==typeof s){let t=r.find(e=>e.id===s);n[e]={...n[e],productId:s,productName:t?.name||"",productCode:t?.code||""}}else n[e]={...n[e],[t]:s};return n})},O=e=>{m(t=>t.filter((t,r)=>r!==e))},P=e=>e%1==0?e.toString():e.toFixed(3),R=x.length>0&&x.every(e=>e.canProduce);return x.filter(e=>!e.canProduce).reduce((e,t)=>e+t.shortage,0),s.jsx(ee.Vq,{open:e,onOpenChange:t,children:(0,s.jsxs)(ee.cZ,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,s.jsxs)(ee.fK,{children:[(0,s.jsxs)(ee.$N,{className:"flex items-center gap-2 text-green-600",children:[s.jsx(y.Z,{className:"h-5 w-5"}),"生產能力評估工具"]}),s.jsx(ee.Be,{children:"選擇多個產品及其目標產量，系統會計算所需物料和香精，並評估是否有足夠庫存進行生產"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"生產計畫設定"}),(0,s.jsxs)(C.z,{onClick:()=>{m(e=>[...e,{productId:"",productName:"",productCode:"",targetQuantity:0}])},size:"sm",children:[s.jsx(er.Z,{className:"h-4 w-4 mr-2"}),"新增產品"]})]}),0===u.length?(0,s.jsxs)("div",{className:"text-center py-8 text-gray-500 border-2 border-dashed border-gray-200 rounded-lg",children:[s.jsx(y.Z,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),s.jsx("p",{className:"text-lg font-medium",children:"尚未新增生產計畫"}),s.jsx("p",{className:"text-sm",children:"點擊「新增產品」開始設定生產目標"})]}):s.jsx("div",{className:"space-y-3",children:u.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-4 p-4 border rounded-lg bg-gray-50",children:[(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx(ec._,{children:"產品選擇"}),(0,s.jsxs)(eJ.J2,{open:b[t]||!1,onOpenChange:e=>w(r=>({...r,[t]:e})),children:[s.jsx(eJ.xo,{asChild:!0,children:(0,s.jsxs)(C.z,{variant:"outline",role:"combobox","aria-expanded":b[t]||!1,className:"w-full justify-between",children:[e.productId?r.find(t=>t.id===e.productId)?.name||"產品未找到":"選擇產品...",s.jsx(e0,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),s.jsx(eJ.yk,{className:"w-full p-0",children:(0,s.jsxs)(eW,{children:[s.jsx(eB,{placeholder:"搜尋產品名稱或系列...",value:S[t]||"",onValueChange:e=>E(r=>({...r,[t]:e}))}),(0,s.jsxs)(eK,{children:[s.jsx(eH,{children:"找不到相符的產品。"}),s.jsx(eY,{children:M(S[t]||"").map(r=>(0,s.jsxs)(eX,{value:r.id,onSelect:r=>{A(t,"productId",r===e.productId?"":r),w(e=>({...e,[t]:!1})),E(e=>({...e,[t]:""}))},children:[s.jsx(e1.Z,{className:(0,eG.cn)("mr-2 h-4 w-4",e.productId===r.id?"opacity-100":"opacity-0")}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsxs)("span",{className:"font-medium",children:["[",r.seriesName||"未指定","] - ",r.name]}),s.jsx("span",{className:"text-xs text-muted-foreground",children:r.code})]})]},r.id))})]})]})})]})]}),(0,s.jsxs)("div",{className:"w-40",children:[s.jsx(ec._,{children:"目標產量"}),s.jsx(I.I,{type:"number",placeholder:"數量",value:e.targetQuantity||"",onChange:e=>A(t,"targetQuantity",parseFloat(e.target.value)||0)})]}),s.jsx(C.z,{variant:"ghost",size:"sm",onClick:()=>O(t),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:s.jsx(es.Z,{className:"h-4 w-4"})})]},t))}),u.length>0&&s.jsx(C.z,{onClick:()=>{v(!0),setTimeout(()=>{try{if(!u.length||!i.length||!o.length){console.log("缺少必要資料:",{productionPlansCount:u.length,materialsCount:i.length,fragrancesCount:o.length}),v(!1);return}let e=new Map;u.forEach(t=>{if(!t.productId||!t.targetQuantity)return;let s=r.find(e=>e.id===t.productId);if(!s)return;if(console.log("計算產品物料需求:",{productName:s.name,targetQuantity:t.targetQuantity,fragranceFormula:s.fragranceFormula}),!s.fragranceFormula){console.error("錯誤：沒有香精配方資料");return}let{percentage:a,pgRatio:n,vgRatio:l}=s.fragranceFormula;if(!a||a<=0){console.error("錯誤：香精比例為0或無效");return}let c={fragrance:a,pg:n,vg:l};if(s.fragranceName&&"未指定"!==s.fragranceName){let r=t.targetQuantity*(c.fragrance/100),a=o.find(e=>e.code===s.fragranceCode||e.name===s.fragranceName||e.name.includes(s.fragranceName)||s.fragranceCode&&e.code.includes(s.fragranceCode)),n=a&&a.currentStock||0,l=a?`fragrance-${a.id}`:`fragrance-${s.fragranceCode}`;if(e.has(l)){let t=e.get(l);e.set(l,{...t,requiredQuantity:t.requiredQuantity+r})}else e.set(l,{id:a?a.id:"fragrance",type:"fragrance",code:s.fragranceCode,name:s.fragranceName,requiredQuantity:r,currentStock:n,unit:"KG",shortage:0,canProduce:n>=r})}let d=(0,ei.n)(i,"pg");if(d){let r=t.targetQuantity*(c.pg/100),s=`material-${d.id}`;if(e.has(s)){let t=e.get(s);e.set(s,{...t,requiredQuantity:t.requiredQuantity+r})}else e.set(s,{id:d.id,type:"material",code:d.code,name:d.name,requiredQuantity:r,currentStock:d.currentStock||0,unit:d.unit||"KG",shortage:0,canProduce:(d.currentStock||0)>=r})}let u=(0,ei.n)(i,"vg");if(u){let r=t.targetQuantity*(c.vg/100),s=`material-${u.id}`;if(e.has(s)){let t=e.get(s);e.set(s,{...t,requiredQuantity:t.requiredQuantity+r})}else e.set(s,{id:u.id,type:"material",code:u.code,name:u.name,requiredQuantity:r,currentStock:u.currentStock||0,unit:u.unit||"KG",shortage:0,canProduce:(u.currentStock||0)>=r})}let m=(0,ei.n)(i,"nicotine");if(m&&s.nicotineMg&&s.nicotineMg>0){let r=t.targetQuantity*s.nicotineMg/250,a=`material-${m.id}`;if(e.has(a)){let t=e.get(a);e.set(a,{...t,requiredQuantity:t.requiredQuantity+r})}else e.set(a,{id:m.id,type:"material",code:m.code,name:m.name,requiredQuantity:r,currentStock:m.currentStock||0,unit:m.unit||"KG",shortage:0,canProduce:(m.currentStock||0)>=r})}s.specificMaterialNames&&s.specificMaterialNames.length>0&&s.specificMaterialNames.forEach(r=>{let s=i.find(e=>e.name===r);if(s){let r=t.targetQuantity,a=`material-${s.id}`;if(e.has(a)){let t=e.get(a);e.set(a,{...t,requiredQuantity:t.requiredQuantity+r})}else e.set(a,{id:s.id,type:"material",code:s.code,name:s.name,requiredQuantity:r,currentStock:s.currentStock||0,unit:s.unit||"個",shortage:0,canProduce:(s.currentStock||0)>=r})}}),s.commonMaterialNames&&s.commonMaterialNames.length>0&&s.commonMaterialNames.forEach(r=>{let s=i.find(e=>e.name===r);if(s){let r=t.targetQuantity,a=`material-${s.id}`;if(e.has(a)){let t=e.get(a);e.set(a,{...t,requiredQuantity:t.requiredQuantity+r})}else e.set(a,{id:s.id,type:"material",code:s.code,name:s.name,requiredQuantity:r,currentStock:s.currentStock||0,unit:s.unit||"個",shortage:0,canProduce:(s.currentStock||0)>=r})}})});let t=Array.from(e.values()).map(e=>({...e,shortage:Math.max(0,e.requiredQuantity-e.currentStock),canProduce:e.currentStock>=e.requiredQuantity}));t.sort((e,t)=>{let r=e=>"fragrance"===e.type?0:e.name.includes("PG")||e.name.includes("丙二醇")?1:e.name.includes("VG")||e.name.includes("甘油")?2:e.name.includes("尼古丁")||e.name.includes("丁鹽")?3:4,s=r(e),a=r(t);return s!==a?s-a:e.canProduce!==t.canProduce?e.canProduce?1:-1:e.name.localeCompare(t.name,"zh-TW")}),h(t),console.log("最終物料需求:",t)}catch(e){console.error("計算需求失敗:",e),l.Am.error("計算需求失敗")}finally{v(!1)}},500)},disabled:f,className:"w-full bg-green-600 hover:bg-green-700",children:f?s.jsx(s.Fragment,{children:"載入中..."}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(y.Z,{className:"mr-2 h-4 w-4"}),"計算物料需求"]})})]}),x.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx("h3",{className:"text-lg font-semibold",children:"需求分析結果"}),s.jsx($.C,{variant:R?"default":"destructive",className:"text-sm px-3 py-1",children:R?(0,s.jsxs)(s.Fragment,{children:[s.jsx(ea.Z,{className:"h-4 w-4 mr-1"}),"可以生產"]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(el,{className:"h-4 w-4 mr-1"}),"庫存不足"]})})]}),s.jsx("div",{className:"rounded-md border",children:(0,s.jsxs)(Z.iA,{children:[s.jsx(Z.xD,{children:(0,s.jsxs)(Z.SC,{className:R?"bg-green-50":"bg-red-50",children:[s.jsx(Z.ss,{className:"font-semibold",children:"類型"}),s.jsx(Z.ss,{className:"font-semibold",children:"代碼"}),s.jsx(Z.ss,{className:"font-semibold",children:"名稱"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"需要數量"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"當前庫存"}),s.jsx(Z.ss,{className:"font-semibold text-right",children:"短缺數量"}),s.jsx(Z.ss,{className:"font-semibold text-center",children:"狀態"})]})}),s.jsx(Z.RM,{children:x.map(e=>(0,s.jsxs)(Z.SC,{className:"hover:bg-gray-50",children:[s.jsx(Z.pj,{children:s.jsx($.C,{variant:"outline",className:`${"material"===e.type?"text-blue-600 border-blue-200 bg-blue-50":"text-purple-600 border-purple-200 bg-purple-50"}`,children:"material"===e.type?(0,s.jsxs)(s.Fragment,{children:[s.jsx(N.Z,{className:"h-3 w-3 mr-1"}),"物料"]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(k.Z,{className:"h-3 w-3 mr-1"}),"香精"]})})}),s.jsx(Z.pj,{className:"font-mono text-sm",children:e.code}),s.jsx(Z.pj,{className:"font-medium",children:e.name}),(0,s.jsxs)(Z.pj,{className:"text-right font-medium text-orange-600",children:[P(e.requiredQuantity)," ",e.unit]}),(0,s.jsxs)(Z.pj,{className:"text-right",children:[e.currentStock," ",e.unit]}),s.jsx(Z.pj,{className:"text-right",children:e.shortage>0?(0,s.jsxs)("span",{className:"text-red-600 font-medium",children:[e.shortage," ",e.unit]}):s.jsx("span",{className:"text-green-600",children:"-"})}),s.jsx(Z.pj,{className:"text-center",children:e.canProduce?(0,s.jsxs)($.C,{variant:"default",className:"bg-green-100 text-green-800",children:[s.jsx(ea.Z,{className:"h-3 w-3 mr-1"}),"充足"]}):(0,s.jsxs)($.C,{variant:"destructive",children:[s.jsx(el,{className:"h-3 w-3 mr-1"}),"不足"]})})]},`${e.type}-${e.id}`))})]})}),(0,s.jsxs)("div",{className:`p-4 rounded-lg border ${R?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800"}`,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[R?s.jsx(ea.Z,{className:"h-5 w-5"}):s.jsx(j.Z,{className:"h-5 w-5"}),s.jsx("span",{className:"font-semibold",children:R?"生產評估：可以生產":"生產評估：庫存不足"})]}),s.jsx("p",{className:"text-sm",children:R?"所有必需的物料和香精庫存充足，可以按計畫進行生產。":`有 ${x.filter(e=>!e.canProduce).length} 項物料/香精庫存不足，需要先補貨才能進行生產。`})]})]})]})]})})}var e5=r(77506),e4=r(82015);function e3({isOpen:e,onClose:t,item:r,onSuccess:i}){let[c,o]=(0,a.useState)(r.currentStock.toString()),[d,u]=(0,a.useState)(""),[m,x]=(0,a.useState)(!1),h=async()=>{let e=parseFloat(c);if(isNaN(e)||e<0){l.Am.error("請輸入有效的庫存數量");return}if(e===r.currentStock){l.Am.error("新庫存數量與當前相同，無需更新");return}x(!0);try{let s=(0,n.$C)(),a=(0,n.V1)(s,"quickUpdateInventory");await a({itemId:r.id,itemType:r.type,newStock:e,remarks:d.trim()||`快速更新${"material"===r.type?"物料":"香精"}庫存`}),l.Am.success(`${r.name} 庫存已更新為 ${e} ${r.unit}`),i(),t()}catch(t){console.error("快速更新庫存失敗:",t);let e=t instanceof Error?t.message:"更新失敗";l.Am.error(`更新失敗: ${e}`)}finally{x(!1)}},p=parseFloat(c)-r.currentStock,g=(()=>{let e=parseFloat(c);return isNaN(e)?null:e<=r.minStock?{type:"warning",message:"警告：新庫存低於安全庫存！",color:"text-red-600 bg-red-50 border-red-200"}:e>=r.maxStock?{type:"info",message:"提示：新庫存高於最大庫存",color:"text-yellow-600 bg-yellow-50 border-yellow-200"}:null})();return s.jsx(ee.Vq,{open:e,onOpenChange:t,children:(0,s.jsxs)(ee.cZ,{className:"max-w-md",children:[(0,s.jsxs)(ee.fK,{children:[(0,s.jsxs)(ee.$N,{className:"flex items-center gap-2",children:["material"===r.type?s.jsx(N.Z,{className:"h-5 w-5 text-blue-600"}):s.jsx(k.Z,{className:"h-5 w-5 text-purple-600"}),"快速更新庫存"]}),(0,s.jsxs)(ee.Be,{children:["快速調整 ",r.name," 的庫存數量，系統會自動記錄變更"]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"項目代碼:"}),s.jsx("span",{className:"font-mono text-sm font-medium",children:r.code})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"項目名稱:"}),s.jsx("span",{className:"text-sm font-medium",children:r.name})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"當前庫存:"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[r.currentStock," ",r.unit]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"安全庫存:"}),(0,s.jsxs)("span",{className:"text-sm",children:[r.minStock," ",r.unit]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(ec._,{htmlFor:"newStock",children:"新庫存數量"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(I.I,{id:"newStock",type:"number",step:"0.01",min:"0",value:c,onChange:e=>o(e.target.value),className:"flex-1"}),s.jsx("div",{className:"flex items-center px-3 bg-gray-100 rounded-md text-sm text-gray-600",children:r.unit})]}),!isNaN(p)&&0!==p&&(0,s.jsxs)("div",{className:`text-sm font-medium ${p>0?"text-green-600":p<0?"text-red-600":"text-gray-600"}`,children:["變化: ",p>0?"+":"",p," ",r.unit]})]}),g&&(0,s.jsxs)("div",{className:`p-3 rounded-lg border flex items-center gap-2 ${g.color}`,children:[s.jsx(j.Z,{className:"h-4 w-4 flex-shrink-0"}),s.jsx("span",{className:"text-sm",children:g.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(ec._,{htmlFor:"remarks",children:"備註 (選填)"}),s.jsx(e4.g,{id:"remarks",placeholder:"輸入更新原因或備註...",value:d,onChange:e=>u(e.target.value),rows:3})]})]}),(0,s.jsxs)(ee.cN,{children:[s.jsx(C.z,{variant:"outline",onClick:t,disabled:m,children:"取消"}),(0,s.jsxs)(C.z,{onClick:h,disabled:m,children:[m&&s.jsx(e5.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"確認更新"]})]})]})})}let e6={globalLoading:{isLoading:!1,message:"",progress:void 0},notifications:[],sidebar:{isOpen:!0,isCollapsed:!1,activeSection:"dashboard"},modals:{},quickActions:{isOpen:!1,recentActions:[]},progressIndicators:{}},e8=()=>Math.random().toString(36).substr(2,9),e7=F()(U((e,t)=>({...e6,setGlobalLoading:(t,r="",s)=>e(e=>({globalLoading:{isLoading:t,message:r,progress:s}})),addNotification:t=>e(e=>({notifications:[{...t,id:e8(),timestamp:new Date,read:!1},...e.notifications].slice(0,50)})),markNotificationAsRead:t=>e(e=>({notifications:e.notifications.map(e=>e.id===t?{...e,read:!0}:e)})),clearNotifications:()=>e({notifications:[]}),setSidebarOpen:t=>e(e=>({sidebar:{...e.sidebar,isOpen:t}})),setSidebarCollapsed:t=>e(e=>({sidebar:{...e.sidebar,isCollapsed:t}})),setActiveSection:t=>e(e=>({sidebar:{...e.sidebar,activeSection:t}})),openModal:(t,r)=>e(e=>({modals:{...e.modals,[t]:{isOpen:!0,data:r}}})),closeModal:t=>e(e=>({modals:{...e.modals,[t]:{...e.modals[t],isOpen:!1}}})),toggleQuickActions:()=>e(e=>({quickActions:{...e.quickActions,isOpen:!e.quickActions.isOpen}})),addRecentAction:t=>e(e=>({quickActions:{...e.quickActions,recentActions:[{...t,timestamp:new Date},...e.quickActions.recentActions].slice(0,10)}})),setProgressIndicator:(t,r,s,a="determinate")=>e(e=>({progressIndicators:{...e.progressIndicators,[t]:{isVisible:!0,progress:r,message:s,type:a}}})),addProgressIndicator:(t,r)=>e(e=>({progressIndicators:{...e.progressIndicators,[t]:r}})),updateProgressIndicator:(t,r)=>e(e=>({progressIndicators:{...e.progressIndicators,[t]:{...e.progressIndicators[t],...r}}})),removeProgressIndicator:t=>e(e=>{let r={...e.progressIndicators};return delete r[t],{progressIndicators:r}}),hideProgressIndicator:t=>e(e=>({progressIndicators:{...e.progressIndicators,[t]:{...e.progressIndicators[t],isVisible:!1}}})),showSuccessNotification:(e,r="")=>{t().addNotification({type:"success",title:e,message:r})},showErrorNotification:(e,r="")=>{t().addNotification({type:"error",title:e,message:r})},showWarningNotification:(e,r="")=>{t().addNotification({type:"warning",title:e,message:r})},showInfoNotification:(e,r="")=>{t().addNotification({type:"info",title:e,message:r})},toggleSidebar:()=>e(e=>({sidebar:{...e.sidebar,isOpen:!e.sidebar.isOpen}})),closeSidebar:()=>e(e=>({sidebar:{...e.sidebar,isOpen:!1}})),openSidebar:()=>e(e=>({sidebar:{...e.sidebar,isOpen:!0}})),closeAllModals:()=>e(e=>{let t={};return Object.keys(e.modals).forEach(r=>{t[r]={...e.modals[r],isOpen:!1}}),{modals:t}}),clearOldNotifications:t=>e(e=>{let r=new Date(Date.now()-t);return{notifications:e.notifications.filter(e=>e.timestamp>r)}})}),{name:W.ui.name,storage:W.ui.storage,partialize:W.ui.partialize})),e9=()=>e7(e=>e.globalLoading),te=()=>e7(e=>Object.entries(e.progressIndicators).filter(([e,t])=>t.isVisible).reduce((e,[t,r])=>(e[t]=r,e),{}));var tt="horizontal",tr=["horizontal","vertical"],ts=a.forwardRef((e,t)=>{let{decorative:r,orientation:a=tt,...n}=e,l=tr.includes(a)?a:tt;return(0,s.jsx)(ep.WV.div,{"data-orientation":l,...r?{role:"none"}:{"aria-orientation":"vertical"===l?l:void 0,role:"separator"},...n,ref:t})});ts.displayName="Separator";let ta=a.forwardRef(({className:e,orientation:t="horizontal",decorative:r=!0,...a},n)=>s.jsx(ts,{ref:n,decorative:r,orientation:t,className:(0,eG.cn)("shrink-0 bg-border","horizontal"===t?"h-[1px] w-full":"h-full w-[1px]",e),...a}));ta.displayName=ts.displayName;var tn=r(93095),tl="Progress",[ti,tc]=(0,tn.b)(tl),[to,td]=ti(tl),tu=a.forwardRef((e,t)=>{var r,a;let{__scopeProgress:n,value:l=null,max:i,getValueLabel:c=th,...o}=e;(i||0===i)&&!tf(i)&&console.error((r=`${i}`,`Invalid prop \`max\` of value \`${r}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let d=tf(i)?i:100;null===l||tv(l,d)||console.error((a=`${l}`,`Invalid prop \`value\` of value \`${a}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let u=tv(l,d)?l:null,m=tg(u)?c(u,d):void 0;return(0,s.jsx)(to,{scope:n,value:u,max:d,children:(0,s.jsx)(ep.WV.div,{"aria-valuemax":d,"aria-valuemin":0,"aria-valuenow":tg(u)?u:void 0,"aria-valuetext":m,role:"progressbar","data-state":tp(u,d),"data-value":u??void 0,"data-max":d,...o,ref:t})})});tu.displayName=tl;var tm="ProgressIndicator",tx=a.forwardRef((e,t)=>{let{__scopeProgress:r,...a}=e,n=td(tm,r);return(0,s.jsx)(ep.WV.div,{"data-state":tp(n.value,n.max),"data-value":n.value??void 0,"data-max":n.max,...a,ref:t})});function th(e,t){return`${Math.round(e/t*100)}%`}function tp(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function tg(e){return"number"==typeof e}function tf(e){return tg(e)&&!isNaN(e)&&e>0}function tv(e,t){return tg(e)&&!isNaN(e)&&e<=t&&e>=0}tx.displayName=tm;let tb=a.forwardRef(({className:e,value:t,showPercentage:r=!1,size:a="md",variant:n="default",...l},i)=>(0,s.jsxs)("div",{className:"relative w-full",children:[s.jsx(tu,{ref:i,className:(0,eG.cn)("relative overflow-hidden rounded-full bg-secondary","sm"===a&&"h-2","md"===a&&"h-3","lg"===a&&"h-4",e),...l,children:s.jsx(tx,{className:(0,eG.cn)("h-full w-full flex-1 transition-all duration-300 ease-in-out","default"===n&&"bg-gradient-to-r from-blue-500 to-blue-600","success"===n&&"bg-gradient-to-r from-green-500 to-green-600","warning"===n&&"bg-gradient-to-r from-yellow-500 to-orange-500","error"===n&&"bg-gradient-to-r from-red-500 to-red-600"),style:{transform:`translateX(-${100-(t||0)}%)`}})}),r&&(0,s.jsxs)("div",{className:(0,eG.cn)("absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xs font-medium text-white drop-shadow-sm","sm"===a&&"text-[10px]","lg"===a&&"text-sm"),children:[Math.round(t||0),"%"]})]}));tb.displayName=tu.displayName;let tj=a.forwardRef(({className:e,value:t,size:r=40,strokeWidth:a=4,showPercentage:n=!0,variant:l="default",...i},c)=>{let o=(r-a)/2,d=2*Math.PI*o;return(0,s.jsxs)("div",{ref:c,className:(0,eG.cn)("relative inline-flex items-center justify-center",e),style:{width:r,height:r},...i,children:[(0,s.jsxs)("svg",{className:"transform -rotate-90",width:r,height:r,viewBox:`0 0 ${r} ${r}`,children:[s.jsx("circle",{className:"text-gray-200",strokeWidth:a,stroke:"currentColor",fill:"transparent",r:o,cx:r/2,cy:r/2}),s.jsx("circle",{className:(0,eG.cn)("transition-all duration-300 ease-in-out",(()=>{switch(l){case"success":return"text-green-500";case"warning":return"text-yellow-500";case"error":return"text-red-500";default:return"text-blue-500"}})()),strokeWidth:a,strokeDasharray:d,strokeDashoffset:d-t/100*d,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:o,cx:r/2,cy:r/2})]}),n&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsxs)("span",{className:"text-xs font-medium text-gray-700",children:[Math.round(t),"%"]})})]})});function ty(){let e=e9(),t=te();return e.isLoading||0!==Object.keys(t).length?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm",children:s.jsx(S.Zb,{className:"w-full max-w-md mx-4 shadow-xl",children:s.jsx(S.aY,{className:"p-6",children:e.isLoading&&(0,s.jsxs)("div",{className:"text-center space-y-4",children:[s.jsx("div",{className:"flex items-center justify-center",children:"number"==typeof e.progress?s.jsx(tj,{value:e.progress,size:60,strokeWidth:4,showPercentage:!0}):s.jsx(e5.Z,{className:"h-12 w-12 animate-spin text-blue-500"})}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"載入中..."}),e.message&&s.jsx("p",{className:"text-sm text-gray-600",children:e.message}),"number"==typeof e.progress&&(0,s.jsxs)("div",{className:"space-y-1",children:[s.jsx(tb,{value:e.progress,variant:"default",size:"md"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[Math.round(e.progress),"% 完成"]})]})]})]})})})}):null}function tN(){let e=te();return 0===Object.keys(e).length?null:s.jsx("div",{className:"fixed bottom-4 right-4 z-40 space-y-2 max-w-sm",children:Object.entries(e).map(([e,t])=>s.jsx(tw,{indicator:t,onClose:()=>{}},e))})}function tw({indicator:e,onClose:t}){return e.isVisible?s.jsx(S.Zb,{className:"shadow-lg border-l-4 border-l-blue-500 bg-white/95 backdrop-blur-sm",children:(0,s.jsxs)(S.aY,{className:"p-3 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e.progress>=100?s.jsx(ea.Z,{className:"h-4 w-4 text-green-500"}):e.progress<0?s.jsx(el,{className:"h-4 w-4 text-red-500"}):"indeterminate"===e.type?s.jsx(e5.Z,{className:"h-4 w-4 animate-spin text-blue-500"}):s.jsx(j.Z,{className:"h-4 w-4 text-orange-500"}),s.jsx("span",{className:"text-sm font-medium text-gray-900 flex-1",children:e.message}),t&&s.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-xs",children:"\xd7"})]}),"determinate"===e.type&&(0,s.jsxs)("div",{className:"space-y-1",children:[s.jsx(tb,{value:Math.max(0,Math.min(100,e.progress)),variant:e.progress>=100?"success":e.progress<0?"error":"default",size:"sm"}),(0,s.jsxs)("div",{className:"flex justify-between text-xs text-gray-500",children:[(0,s.jsxs)("span",{children:[Math.round(e.progress),"%"]}),s.jsx("span",{children:e.progress>=100?"完成":e.progress<0?"失敗":"進行中"})]})]})]})}):null}function tk({total:e,completed:t,failed:r,currentOperation:a,onCancel:n}){let l=t/(t+r)*100||0;return s.jsx(S.Zb,{className:"w-full max-w-md",children:(0,s.jsxs)(S.aY,{className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"批量操作進度"}),n&&s.jsx("button",{onClick:n,className:"text-sm text-gray-500 hover:text-gray-700",children:"取消"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-600",children:[s.jsx("span",{children:"整體進度"}),(0,s.jsxs)("span",{children:[t+r," / ",e]})]}),s.jsx(tb,{value:(t+r)/e*100,variant:"default",size:"md"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{className:"text-green-600",children:[s.jsx("span",{className:"font-medium",children:"成功: "}),s.jsx("span",{children:t})]}),(0,s.jsxs)("div",{className:"text-red-600",children:[s.jsx("span",{className:"font-medium",children:"失敗: "}),s.jsx("span",{children:r})]})]}),t>0&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["成功率: ",Math.round(l),"%"]}),a&&(0,s.jsxs)("div",{className:"text-sm text-blue-600 flex items-center gap-2",children:[s.jsx(e5.Z,{className:"h-3 w-3 animate-spin"}),s.jsx("span",{children:a})]})]})})}tj.displayName="CircularProgress";let tC=(0,en.Z)("SquareCheckBig",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);var tS=r(94019);let tI=(0,en.Z)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),tE=(0,en.Z)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),tM=(0,en.Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);function tA({onClose:e}){let{batchOperations:t,selectedItems:r,getSelectedItems:n,enableBatchMode:i,disableBatchMode:c,addBatchUpdate:o,removeBatchUpdate:d,clearBatchUpdates:u,applyBatchUpdates:m,selectAll:x,selectNone:h,clearSelections:p}=X(),{addProgressIndicator:g,updateProgressIndicator:f,removeProgressIndicator:v}=e7(),[b,j]=(0,a.useState)(""),[y,w]=(0,a.useState)(""),[E,M]=(0,a.useState)(!1),A=n(),O=A.materials.length+A.fragrances.length,P=Object.keys(t.pendingUpdates).length,R=(0,a.useCallback)(()=>{i(),l.Am.success("已啟用批量操作模式")},[i]),Z=(0,a.useCallback)(()=>{c(),e(),l.Am.info("已停用批量操作模式")},[c,e]),z=async()=>{if(0===P){l.Am.warning("沒有待應用的更新");return}M(!0);let e="batch-operations";g(e,{isVisible:!0,progress:0,message:`準備批量更新 ${P} 個項目...`,type:"determinate"});try{let r=Object.entries(t.pendingUpdates),s=0;for(let[t,a]of r)f(e,{progress:s/r.length*100,message:`更新項目 ${s+1}/${r.length}...`}),await new Promise(e=>setTimeout(e,200)),s++;await m(),f(e,{progress:100,message:"批量更新完成"}),setTimeout(()=>{v(e)},1e3),l.Am.success(`成功更新 ${P} 個項目`),p()}catch(t){f(e,{progress:-1,message:"批量更新失敗"}),setTimeout(()=>{v(e)},2e3),l.Am.error("批量更新失敗")}finally{M(!1)}};return(0,s.jsxs)(S.Zb,{className:"w-full max-w-2xl mx-auto",children:[s.jsx(S.Ol,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(S.ll,{className:"flex items-center gap-2 text-purple-700",children:[s.jsx(tC,{className:"h-5 w-5"}),"批量操作面板"]}),s.jsx(C.z,{onClick:Z,variant:"ghost",size:"sm",children:s.jsx(tS.Z,{className:"h-4 w-4"})})]})}),s.jsx(S.aY,{className:"space-y-6",children:t.isEnabled?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"選擇控制"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsxs)(C.z,{onClick:()=>{x("materials"),l.Am.success("已選擇所有物料")},variant:"outline",size:"sm",children:[s.jsx(N.Z,{className:"mr-2 h-3 w-3"}),"全選物料"]}),(0,s.jsxs)(C.z,{onClick:()=>{x("fragrances"),l.Am.success("已選擇所有香精")},variant:"outline",size:"sm",children:[s.jsx(k.Z,{className:"mr-2 h-3 w-3"}),"全選香精"]}),(0,s.jsxs)(C.z,{onClick:()=>{h("materials"),h("fragrances"),l.Am.info("已清空選擇")},variant:"outline",size:"sm",children:[s.jsx(tE,{className:"mr-2 h-3 w-3"}),"清空選擇"]})]}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-4 text-sm text-gray-600",children:[(0,s.jsxs)("span",{children:["已選擇: ",O," 個項目"]}),(0,s.jsxs)("span",{children:["待更新: ",P," 個項目"]})]})]}),s.jsx(ta,{}),(0,s.jsxs)("div",{children:[s.jsx("h4",{className:"font-medium mb-3",children:"批量更新設定"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"新庫存量"}),s.jsx(I.I,{type:"number",placeholder:"輸入新的庫存數量",value:b,onChange:e=>j(e.target.value)})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"更新原因"}),s.jsx(I.I,{placeholder:"輸入更新原因",value:y,onChange:e=>w(e.target.value)})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,s.jsxs)(C.z,{onClick:()=>{if(!b||!y){l.Am.error("請輸入數量和原因");return}let e=parseFloat(b);if(isNaN(e)){l.Am.error("請輸入有效的數量");return}let t=[...A.materials,...A.fragrances];t.forEach(t=>{o(t.id,e,y)}),j(""),w(""),l.Am.success(`已為 ${t.length} 個項目添加批量更新`)},disabled:0===O,className:"flex-1",variant:"outline",children:[s.jsx(er.Z,{className:"mr-2 h-4 w-4"}),"為選中項目添加更新"]}),s.jsx(C.z,{onClick:u,disabled:0===P,variant:"ghost",size:"sm",children:s.jsx(tM,{className:"h-4 w-4"})})]})]}),s.jsx(ta,{}),P>0&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"font-medium mb-3",children:["待更新項目 (",P,")"]}),s.jsx("div",{className:"max-h-32 overflow-y-auto space-y-2",children:Object.entries(t.pendingUpdates).map(([e,t])=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[s.jsx("span",{className:"text-sm font-mono",children:e}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx($.C,{variant:"secondary",children:t.quantity}),s.jsx("span",{className:"text-xs text-gray-500",children:t.reason}),s.jsx(C.z,{onClick:()=>d(e),variant:"ghost",size:"sm",children:s.jsx(tS.Z,{className:"h-3 w-3"})})]})]},e))})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(C.z,{onClick:z,disabled:0===P||E,className:"flex-1 bg-green-600 hover:bg-green-700",children:E?(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:"mr-2 h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent"}),"執行中..."]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(tI,{className:"mr-2 h-4 w-4"}),"應用批量更新"]})}),s.jsx(C.z,{onClick:Z,variant:"outline",children:"取消"})]}),E&&P>0&&s.jsx(tk,{total:P,completed:0,failed:0,currentOperation:"正在更新庫存...",onCancel:()=>M(!1)})]}):(0,s.jsxs)("div",{className:"text-center py-6",children:[(0,s.jsxs)("div",{className:"mb-4",children:[s.jsx(tC,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"批量操作模式"}),s.jsx("p",{className:"text-gray-500",children:"啟用後可以批量選擇和修改庫存項目"})]}),(0,s.jsxs)(C.z,{onClick:R,className:"bg-purple-600 hover:bg-purple-700",children:[s.jsx(tI,{className:"mr-2 h-4 w-4"}),"啟用批量操作"]})]})})]})}var tO=r(74690);function tP(){var e,t;let{appUser:r}=(0,tO.a)(),{setGlobalLoading:i,addProgressIndicator:c,updateProgressIndicator:o,removeProgressIndicator:d}=e7(),[u,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(!0),[p,M]=(0,a.useState)("materials"),[A,P]=(0,a.useState)(""),{data:R,loading:Z,refetch:$}=f(()=>g.getMaterials(void 0),"materials-all",e),{data:z,loading:q,refetch:D}=f(()=>g.getFragrances(void 0),"fragrances-all",t),L=Z||q,[_,F]=(0,a.useState)(!1),[V,T]=(0,a.useState)(!1),[U,Q]=(0,a.useState)(!1),[G,W]=(0,a.useState)(!1),[B,K]=(0,a.useState)(null),[H,Y]=(0,a.useState)(!1),X=(0,a.useCallback)(async()=>{if(!x){h(!0),i(!0,"載入庫存統計中...");try{let e=(0,n.$C)(),t=(0,n.V1)(e,"getInventoryOverview"),r=(await t({})).data;r.success&&(m(r.overview),l.Am.success("庫存統計載入完成"))}catch(e){console.error("載入庫存總覽失敗:",e),l.Am.error("載入庫存總覽失敗")}finally{h(!1),i(!1)}}},[i]),ee=(0,a.useCallback)(async()=>{let e="inventory-reload";c(e,{isVisible:!0,progress:0,message:"載入庫存資料...",type:"determinate"});try{o(e,{progress:30,message:"載入物料清單..."}),await $(),o(e,{progress:70,message:"載入香精清單..."}),await D(),o(e,{progress:100,message:"載入完成"}),setTimeout(()=>{d(e)},1e3),l.Am.success("庫存資料重新載入完成")}catch(t){o(e,{progress:-1,message:"載入失敗"}),setTimeout(()=>{d(e)},2e3),l.Am.error("重新載入失敗")}},[$,D,c,o,d]),er=(0,a.useCallback)(async()=>{i(!0,"正在刷新所有資料...");try{await Promise.all([(async()=>{let e=(0,n.$C)(),t=(0,n.V1)(e,"getInventoryOverview"),r=(await t({})).data;r.success&&m(r.overview)})(),ee()])}finally{i(!1)}},[ee,i]),es=(0,a.useCallback)(e=>{K(e),Q(!0)},[]),ea=(0,a.useCallback)(()=>{let e="materials"===p?R||[]:z||[];if(!A.trim())return e;let t=A.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)||e.category?.toLowerCase().includes(t)||e.series?.toLowerCase().includes(t))},[p,R,z,A])();return(0,s.jsxs)("div",{className:"container mx-auto py-8 space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"庫存管理中心"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"全方位庫存監控與管理系統"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(C.z,{onClick:ee,variant:"outline",className:"flex items-center gap-2",children:[s.jsx(v.Z,{className:"h-4 w-4"}),"重新載入資料"]}),(0,s.jsxs)(C.z,{onClick:er,className:"flex items-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:[s.jsx(v.Z,{className:"h-4 w-4"}),"完整刷新"]})]})]}),s.jsx(O,{overview:u,loading:x}),(0,s.jsxs)(S.Zb,{className:"border-orange-200 bg-gradient-to-r from-orange-50 to-amber-50",children:[(0,s.jsxs)(S.Ol,{children:[(0,s.jsxs)(S.ll,{className:"flex items-center gap-2 text-orange-800",children:[s.jsx(b.Z,{className:"h-5 w-5"}),"快速操作"]}),s.jsx(S.SZ,{children:"一鍵執行常用的庫存管理操作"})]}),s.jsx(S.aY,{children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsxs)(C.z,{onClick:()=>F(!0),className:"bg-red-600 hover:bg-red-700 text-white",children:[s.jsx(j.Z,{className:"mr-2 h-4 w-4"}),"查看低庫存項目"]}),(0,s.jsxs)(C.z,{onClick:()=>T(!0),className:"bg-green-600 hover:bg-green-700 text-white",children:[s.jsx(y.Z,{className:"mr-2 h-4 w-4"}),"生產能力評估"]}),(0,s.jsxs)(C.z,{onClick:()=>W(!0),className:"bg-purple-600 hover:bg-purple-700 text-white",children:[s.jsx(N.Z,{className:"mr-2 h-4 w-4"}),"批量操作"]})]})})]}),(0,s.jsxs)(S.Zb,{children:[(0,s.jsxs)(S.Ol,{children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,s.jsxs)(S.ll,{className:"flex items-center gap-2",children:[s.jsx(N.Z,{className:"h-5 w-5 text-blue-600"}),"庫存清單"]}),(0,s.jsxs)("div",{className:"relative w-full sm:w-80",children:[s.jsx(w.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),s.jsx(I.I,{placeholder:`搜尋${"materials"===p?"物料":"香精"}名稱、代碼、分類...`,value:A,onChange:e=>P(e.target.value),className:"pl-10"})]})]}),s.jsx(S.SZ,{children:"點擊庫存數量可快速修改，系統會自動記錄變更"})]}),s.jsx(S.aY,{children:(0,s.jsxs)(E.mQ,{value:p,onValueChange:e=>M(e),children:[(0,s.jsxs)(E.dr,{className:"grid w-full grid-cols-2 mb-6",children:[(0,s.jsxs)(E.SP,{value:"materials",className:"flex items-center gap-2",children:[s.jsx(N.Z,{className:"h-4 w-4"}),"物料 (",R?.length||0,")"]}),(0,s.jsxs)(E.SP,{value:"fragrances",className:"flex items-center gap-2",children:[s.jsx(k.Z,{className:"h-4 w-4"}),"香精 (",z?.length||0,")"]})]}),s.jsx(E.nU,{value:"materials",children:s.jsx(J,{items:ea,loading:L,onQuickUpdate:es,type:"material"})}),s.jsx(E.nU,{value:"fragrances",children:s.jsx(J,{items:ea,loading:L,onQuickUpdate:es,type:"fragrance"})})]})})]}),s.jsx(et,{isOpen:_,onClose:()=>F(!1)}),s.jsx(e2,{isOpen:V,onClose:()=>T(!1)}),B&&s.jsx(e3,{isOpen:U,onClose:()=>{Q(!1),K(null)},item:B,onSuccess:async()=>{await ee(),await X()}}),G&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:s.jsx(tA,{onClose:()=>W(!1)})}),s.jsx(ty,{}),s.jsx(tN,{})]})}},9280:(e,t,r)=>{"use strict";r.d(t,{X:()=>i});var s=r(10326);r(17577);var a=r(13635),n=r(32933),l=r(51223);function i({className:e,...t}){return s.jsx(a.fC,{"data-slot":"checkbox",className:(0,l.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...t,children:s.jsx(a.z$,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:s.jsx(n.Z,{className:"size-3.5"})})})}},24118:(e,t,r)=>{"use strict";r.d(t,{$N:()=>h,Be:()=>p,Vq:()=>c,cN:()=>x,cZ:()=>u,fK:()=>m});var s=r(10326),a=r(17577),n=r(98958),l=r(94019),i=r(51223);let c=n.fC;n.xz;let o=n.h_;n.x8;let d=a.forwardRef(({className:e,...t},r)=>s.jsx(n.aV,{ref:r,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t}));d.displayName=n.aV.displayName;let u=a.forwardRef(({className:e,children:t,...r},a)=>(0,s.jsxs)(o,{children:[s.jsx(d,{}),(0,s.jsxs)(n.VY,{ref:a,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-2xl translate-x-[-50%] translate-y-[-50%] gap-4 border-2 border-border bg-background shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-lg max-h-[90vh] overflow-y-auto","p-4 sm:p-6 mx-2 sm:mx-0","max-w-[calc(100vw-1rem)] sm:max-w-lg md:max-w-xl lg:max-w-2xl","max-h-[95vh] sm:max-h-[90vh]",e),...r,children:[t,(0,s.jsxs)(n.x8,{className:"absolute right-3 top-3 sm:right-4 sm:top-4 z-10 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground p-1",children:[s.jsx(l.Z,{className:"h-5 w-5 sm:h-4 sm:w-4"}),s.jsx("span",{className:"sr-only",children:"關閉"})]})]})]}));u.displayName=n.VY.displayName;let m=({className:e,...t})=>s.jsx("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left pb-4 border-b border-border",e),...t});m.displayName="DialogHeader";let x=({className:e,...t})=>s.jsx("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end gap-2 sm:gap-0 sm:space-x-2 pt-4 border-t border-border","[&>*]:w-full sm:[&>*]:w-auto",e),...t});x.displayName="DialogFooter";let h=a.forwardRef(({className:e,...t},r)=>s.jsx(n.Dx,{ref:r,className:(0,i.cn)("text-xl sm:text-2xl font-bold flex items-center gap-2 sm:gap-3 leading-tight",e),...t}));h.displayName=n.Dx.displayName;let p=a.forwardRef(({className:e,...t},r)=>s.jsx(n.dk,{ref:r,className:(0,i.cn)("text-sm text-muted-foreground",e),...t}));p.displayName=n.dk.displayName},44794:(e,t,r)=>{"use strict";r.d(t,{_:()=>l});var s=r(10326);r(17577);var a=r(34478),n=r(51223);function l({className:e,...t}){return s.jsx(a.f,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...t})}},38227:(e,t,r)=>{"use strict";r.d(t,{O:()=>n});var s=r(10326);r(17577);var a=r(51223);function n({className:e,...t}){return s.jsx("div",{className:(0,a.cn)("animate-pulse rounded-md bg-muted",e),...t})}},41156:(e,t,r)=>{"use strict";r.d(t,{RM:()=>i,SC:()=>c,iA:()=>n,pj:()=>d,ss:()=>o,xD:()=>l});var s=r(10326);r(17577);var a=r(51223);function n({className:e,...t}){return s.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:s.jsx("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...t})})}function l({className:e,...t}){return s.jsx("thead",{"data-slot":"table-header",className:(0,a.cn)("",e),...t})}function i({className:e,...t}){return s.jsx("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...t})}function c({className:e,...t}){return s.jsx("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b border-border transition-colors",e),...t})}function o({className:e,...t}){return s.jsx("th",{"data-slot":"table-head",className:(0,a.cn)("bg-muted text-foreground font-semibold border-b border-border p-3 text-left align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function d({className:e,...t}){return s.jsx("td",{"data-slot":"table-cell",className:(0,a.cn)("p-3 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}},82015:(e,t,r)=>{"use strict";r.d(t,{g:()=>l});var s=r(10326),a=r(17577),n=r(51223);let l=a.forwardRef(({className:e,...t},r)=>s.jsx("textarea",{className:(0,n.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));l.displayName="Textarea"},49527:(e,t,r)=>{"use strict";r.d(t,{n:()=>a});let s={PG_MATERIAL_CODES:["UV3404503","PG"],VG_MATERIAL_CODES:["UV3400698","VG"],NICOTINE_MATERIAL_CODES:["UV3405520","NIC","丁鹽","尼古丁"],PG_MATERIAL_NAMES:["PG丙二醇","PG","丙二醇"],VG_MATERIAL_NAMES:["VG甘油","VG","甘油"],NICOTINE_MATERIAL_NAMES:["丁鹽","尼古丁","NicSalt"]},a=(e,t)=>e.find(e=>{let r=e.code?.toUpperCase()||"",a=e.name||"";switch(t){case"pg":return s.PG_MATERIAL_CODES.some(e=>r.includes(e))||s.PG_MATERIAL_NAMES.some(e=>a.includes(e));case"vg":return s.VG_MATERIAL_CODES.some(e=>r.includes(e))||s.VG_MATERIAL_NAMES.some(e=>a.includes(e));case"nicotine":return s.NICOTINE_MATERIAL_CODES.some(e=>r.includes(e))||s.NICOTINE_MATERIAL_NAMES.some(e=>a.includes(e));default:return!1}})},98034:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`D:\APP\deer-lab\src\app\dashboard\inventory\page.tsx#default`)},13635:(e,t,r)=>{"use strict";r.d(t,{fC:()=>y,z$:()=>w});var s=r(17577),a=r(48051),n=r(93095),l=r(82561),i=r(52067),c=r(53405),o=r(2566),d=r(9815),u=r(45226),m=r(10326),x="Checkbox",[h,p]=(0,n.b)(x),[g,f]=h(x);function v(e){let{__scopeCheckbox:t,checked:r,children:a,defaultChecked:n,disabled:l,form:c,name:o,onCheckedChange:d,required:u,value:h="on",internal_do_not_use_render:p}=e,[f,v]=(0,i.T)({prop:r,defaultProp:n??!1,onChange:d,caller:x}),[b,j]=s.useState(null),[y,N]=s.useState(null),w=s.useRef(!1),k=!b||!!c||!!b.closest("form"),C={checked:f,disabled:l,setChecked:v,control:b,setControl:j,name:o,form:c,value:h,hasConsumerStoppedPropagationRef:w,required:u,defaultChecked:!S(n)&&n,isFormControl:k,bubbleInput:y,setBubbleInput:N};return(0,m.jsx)(g,{scope:t,...C,children:"function"==typeof p?p(C):a})}var b="CheckboxTrigger",j=s.forwardRef(({__scopeCheckbox:e,onKeyDown:t,onClick:r,...n},i)=>{let{control:c,value:o,disabled:d,checked:x,required:h,setControl:p,setChecked:g,hasConsumerStoppedPropagationRef:v,isFormControl:j,bubbleInput:y}=f(b,e),N=(0,a.e)(i,p),w=s.useRef(x);return s.useEffect(()=>{let e=c?.form;if(e){let t=()=>g(w.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[c,g]),(0,m.jsx)(u.WV.button,{type:"button",role:"checkbox","aria-checked":S(x)?"mixed":x,"aria-required":h,"data-state":I(x),"data-disabled":d?"":void 0,disabled:d,value:o,...n,ref:N,onKeyDown:(0,l.Mj)(t,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,l.Mj)(r,e=>{g(e=>!!S(e)||!e),y&&j&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})})});j.displayName=b;var y=s.forwardRef((e,t)=>{let{__scopeCheckbox:r,name:s,checked:a,defaultChecked:n,required:l,disabled:i,value:c,onCheckedChange:o,form:d,...u}=e;return(0,m.jsx)(v,{__scopeCheckbox:r,checked:a,defaultChecked:n,disabled:i,required:l,onCheckedChange:o,name:s,form:d,value:c,internal_do_not_use_render:({isFormControl:e})=>(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(j,{...u,ref:t,__scopeCheckbox:r}),e&&(0,m.jsx)(C,{__scopeCheckbox:r})]})})});y.displayName=x;var N="CheckboxIndicator",w=s.forwardRef((e,t)=>{let{__scopeCheckbox:r,forceMount:s,...a}=e,n=f(N,r);return(0,m.jsx)(d.z,{present:s||S(n.checked)||!0===n.checked,children:(0,m.jsx)(u.WV.span,{"data-state":I(n.checked),"data-disabled":n.disabled?"":void 0,...a,ref:t,style:{pointerEvents:"none",...e.style}})})});w.displayName=N;var k="CheckboxBubbleInput",C=s.forwardRef(({__scopeCheckbox:e,...t},r)=>{let{control:n,hasConsumerStoppedPropagationRef:l,checked:i,defaultChecked:d,required:x,disabled:h,name:p,value:g,form:v,bubbleInput:b,setBubbleInput:j}=f(k,e),y=(0,a.e)(r,j),N=(0,c.D)(i),w=(0,o.t)(n);s.useEffect(()=>{if(!b)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!l.current;if(N!==i&&e){let r=new Event("click",{bubbles:t});b.indeterminate=S(i),e.call(b,!S(i)&&i),b.dispatchEvent(r)}},[b,N,i,l]);let C=s.useRef(!S(i)&&i);return(0,m.jsx)(u.WV.input,{type:"checkbox","aria-hidden":!0,defaultChecked:d??C.current,required:x,disabled:h,name:p,value:g,form:v,...t,tabIndex:-1,ref:y,style:{...t.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function S(e){return"indeterminate"===e}function I(e){return S(e)?"indeterminate":e?"checked":"unchecked"}C.displayName=k},98958:(e,t,r)=>{"use strict";r.d(t,{Dx:()=>es,VY:()=>er,aV:()=>et,dk:()=>ea,fC:()=>X,h_:()=>ee,jm:()=>B,p8:()=>y,x8:()=>en,xz:()=>J});var s=r(17577),a=r(82561),n=r(48051),l=r(93095),i=r(88957),c=r(52067),o=r(825),d=r(10441),u=r(83078),m=r(9815),x=r(45226),h=r(80699),p=r(58260),g=r(35664),f=r(34214),v=r(10326),b="Dialog",[j,y]=(0,l.b)(b),[N,w]=j(b),k=e=>{let{__scopeDialog:t,children:r,open:a,defaultOpen:n,onOpenChange:l,modal:o=!0}=e,d=s.useRef(null),u=s.useRef(null),[m,x]=(0,c.T)({prop:a,defaultProp:n??!1,onChange:l,caller:b});return(0,v.jsx)(N,{scope:t,triggerRef:d,contentRef:u,contentId:(0,i.M)(),titleId:(0,i.M)(),descriptionId:(0,i.M)(),open:m,onOpenChange:x,onOpenToggle:s.useCallback(()=>x(e=>!e),[x]),modal:o,children:r})};k.displayName=b;var C="DialogTrigger",S=s.forwardRef((e,t)=>{let{__scopeDialog:r,...s}=e,l=w(C,r),i=(0,n.e)(t,l.triggerRef);return(0,v.jsx)(x.WV.button,{type:"button","aria-haspopup":"dialog","aria-expanded":l.open,"aria-controls":l.contentId,"data-state":G(l.open),...s,ref:i,onClick:(0,a.Mj)(e.onClick,l.onOpenToggle)})});S.displayName=C;var I="DialogPortal",[E,M]=j(I,{forceMount:void 0}),A=e=>{let{__scopeDialog:t,forceMount:r,children:a,container:n}=e,l=w(I,t);return(0,v.jsx)(E,{scope:t,forceMount:r,children:s.Children.map(a,e=>(0,v.jsx)(m.z,{present:r||l.open,children:(0,v.jsx)(u.h,{asChild:!0,container:n,children:e})}))})};A.displayName=I;var O="DialogOverlay",P=s.forwardRef((e,t)=>{let r=M(O,e.__scopeDialog),{forceMount:s=r.forceMount,...a}=e,n=w(O,e.__scopeDialog);return n.modal?(0,v.jsx)(m.z,{present:s||n.open,children:(0,v.jsx)(Z,{...a,ref:t})}):null});P.displayName=O;var R=(0,f.Z8)("DialogOverlay.RemoveScroll"),Z=s.forwardRef((e,t)=>{let{__scopeDialog:r,...s}=e,a=w(O,r);return(0,v.jsx)(p.Z,{as:R,allowPinchZoom:!0,shards:[a.contentRef],children:(0,v.jsx)(x.WV.div,{"data-state":G(a.open),...s,ref:t,style:{pointerEvents:"auto",...s.style}})})}),$="DialogContent",z=s.forwardRef((e,t)=>{let r=M($,e.__scopeDialog),{forceMount:s=r.forceMount,...a}=e,n=w($,e.__scopeDialog);return(0,v.jsx)(m.z,{present:s||n.open,children:n.modal?(0,v.jsx)(q,{...a,ref:t}):(0,v.jsx)(D,{...a,ref:t})})});z.displayName=$;var q=s.forwardRef((e,t)=>{let r=w($,e.__scopeDialog),l=s.useRef(null),i=(0,n.e)(t,r.contentRef,l);return s.useEffect(()=>{let e=l.current;if(e)return(0,g.Ry)(e)},[]),(0,v.jsx)(L,{...e,ref:i,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,a.Mj)(e.onCloseAutoFocus,e=>{e.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:(0,a.Mj)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey;(2===t.button||r)&&e.preventDefault()}),onFocusOutside:(0,a.Mj)(e.onFocusOutside,e=>e.preventDefault())})}),D=s.forwardRef((e,t)=>{let r=w($,e.__scopeDialog),a=s.useRef(!1),n=s.useRef(!1);return(0,v.jsx)(L,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(a.current||r.triggerRef.current?.focus(),t.preventDefault()),a.current=!1,n.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(a.current=!0,"pointerdown"!==t.detail.originalEvent.type||(n.current=!0));let s=t.target;r.triggerRef.current?.contains(s)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&n.current&&t.preventDefault()}})}),L=s.forwardRef((e,t)=>{let{__scopeDialog:r,trapFocus:a,onOpenAutoFocus:l,onCloseAutoFocus:i,...c}=e,u=w($,r),m=s.useRef(null),x=(0,n.e)(t,m);return(0,h.EW)(),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(d.M,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:l,onUnmountAutoFocus:i,children:(0,v.jsx)(o.XB,{role:"dialog",id:u.contentId,"aria-describedby":u.descriptionId,"aria-labelledby":u.titleId,"data-state":G(u.open),...c,ref:x,onDismiss:()=>u.onOpenChange(!1)})}),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(H,{titleId:u.titleId}),(0,v.jsx)(Y,{contentRef:m,descriptionId:u.descriptionId})]})]})}),_="DialogTitle",F=s.forwardRef((e,t)=>{let{__scopeDialog:r,...s}=e,a=w(_,r);return(0,v.jsx)(x.WV.h2,{id:a.titleId,...s,ref:t})});F.displayName=_;var V="DialogDescription",T=s.forwardRef((e,t)=>{let{__scopeDialog:r,...s}=e,a=w(V,r);return(0,v.jsx)(x.WV.p,{id:a.descriptionId,...s,ref:t})});T.displayName=V;var U="DialogClose",Q=s.forwardRef((e,t)=>{let{__scopeDialog:r,...s}=e,n=w(U,r);return(0,v.jsx)(x.WV.button,{type:"button",...s,ref:t,onClick:(0,a.Mj)(e.onClick,()=>n.onOpenChange(!1))})});function G(e){return e?"open":"closed"}Q.displayName=U;var W="DialogTitleWarning",[B,K]=(0,l.k)(W,{contentName:$,titleName:_,docsSlug:"dialog"}),H=({titleId:e})=>{let t=K(W),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return s.useEffect(()=>{e&&!document.getElementById(e)&&console.error(r)},[r,e]),null},Y=({contentRef:e,descriptionId:t})=>{let r=K("DialogDescriptionWarning"),a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${r.contentName}}.`;return s.useEffect(()=>{let r=e.current?.getAttribute("aria-describedby");t&&r&&!document.getElementById(t)&&console.warn(a)},[a,e,t]),null},X=k,J=S,ee=A,et=P,er=z,es=F,ea=T,en=Q},34478:(e,t,r)=>{"use strict";r.d(t,{f:()=>i});var s=r(17577),a=r(45226),n=r(10326),l=s.forwardRef((e,t)=>(0,n.jsx)(a.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var i=l},53405:(e,t,r)=>{"use strict";r.d(t,{D:()=>a});var s=r(17577);function a(e){let t=s.useRef({value:e,previous:e});return s.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,9654,5540,8693,4108,4334,6572],()=>r(59647));module.exports=s})();