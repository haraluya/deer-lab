(()=>{var e={};e.id=4746,e.ids=[4746],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},42784:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c}),s(73181),s(22834),s(62510),s(35866);var r=s(23191),a=s(88716),l=s(37922),n=s.n(l),i=s(95231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let c=["",{children:["dashboard",{children:["inventory-old",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,73181)),"D:\\APP\\deer-lab\\src\\app\\dashboard\\inventory-old\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,22834)),"D:\\APP\\deer-lab\\src\\app\\dashboard\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,62510)),"D:\\APP\\deer-lab\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],o=["D:\\APP\\deer-lab\\src\\app\\dashboard\\inventory-old\\page.tsx"],x="/dashboard/inventory-old/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/inventory-old/page",pathname:"/dashboard/inventory-old",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},99008:(e,t,s)=>{Promise.resolve().then(s.bind(s,53782))},83855:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},88307:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},29163:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]])},50949:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},66050:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]])},94019:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(62881).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},53782:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var r=s(10326),a=s(17577),l=s(76),n=s(90445),i=s(85999),d=s(21405),c=s(48705),o=s(50949),x=s(66050),m=s(88307),u=s(83855),h=s(37358),p=s(17069),j=s(29163),g=s(11019),f=s(91664),v=s(29752),b=s(41190),N=s(41156),y=s(38443),w=s(24118),k=s(44794),S=s(29280),C=s(82015),Z=s(98258),_=s(78880),D=s(74690);function P({itemId:e,itemType:t,itemCode:s,itemName:l,currentStock:n,onAdjustmentComplete:d,onCancel:x}){let{appUser:m}=(0,D.a)(),[u,h]=(0,a.useState)("increase"),[g,N]=(0,a.useState)(""),[w,P]=(0,a.useState)(""),[A,q]=(0,a.useState)(!1),R=async s=>{if(s.preventDefault(),!g||0>=parseFloat(g)){i.Am.error("請輸入有效的數量");return}if(!m){i.Am.error("用戶未認證");return}q(!0);try{let s=parseFloat(g),r="increase"===u?s:-s,a=n+r;if(a<0){i.Am.error("調整後庫存不能為負數");return}let l=(0,_.$C)(),c=(0,_.V1)(l,"adjustInventory"),o={itemId:e,itemType:t,quantityChange:r,remarks:w||"手動庫存調整"};console.log("呼叫 adjustInventory 函數，資料:",o),await c(o),i.Am.success("庫存調整成功"),d(a,w)}catch(e){console.error("庫存調整失敗:",e),i.Am.error("庫存調整失敗")}finally{q(!1)}},M=()=>{if(!g||0>=parseFloat(g))return n;let e=parseFloat(g);return n+("increase"===u?e:-e)},F=0>M();return(0,r.jsxs)(v.Zb,{className:"border-l-4 border-l-orange-500",children:[r.jsx(v.Ol,{children:(0,r.jsxs)(v.ll,{className:"text-lg text-gray-800 flex items-center gap-2",children:["material"===t?r.jsx(c.Z,{className:"h-5 w-5 text-blue-500"}):r.jsx(Z.Z,{className:"h-5 w-5 text-purple-500"}),"手動調整庫存"]})}),r.jsx(v.aY,{children:(0,r.jsxs)("form",{onSubmit:R,className:"space-y-6",children:[r.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-gray-600",children:"物料類型"}),r.jsx("div",{className:"mt-1",children:r.jsx(y.C,{variant:"outline",className:"text-sm",children:"material"===t?"物料":"香精"})})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-gray-600",children:"物料編號"}),r.jsx("div",{className:"mt-1 font-mono text-sm bg-white px-3 py-2 rounded-md border",children:s})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-gray-600",children:"物料名稱"}),r.jsx("div",{className:"mt-1 text-sm bg-white px-3 py-2 rounded-md border",children:l})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx(k._,{htmlFor:"adjustmentType",className:"text-sm font-medium text-gray-700",children:"調整類型"}),(0,r.jsxs)(S.Ph,{value:u,onValueChange:e=>h(e),children:[r.jsx(S.i4,{className:"mt-1",children:r.jsx(S.ki,{})}),(0,r.jsxs)(S.Bw,{children:[r.jsx(S.Ql,{value:"increase",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(p.Z,{className:"h-4 w-4 text-green-600"}),"增加庫存"]})}),r.jsx(S.Ql,{value:"decrease",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx(j.Z,{className:"h-4 w-4 text-red-600"}),"減少庫存"]})})]})]})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{htmlFor:"quantity",className:"text-sm font-medium text-gray-700",children:"調整數量"}),r.jsx(b.I,{id:"quantity",type:"number",step:"0.01",min:"0.01",value:g,onChange:e=>N(e.target.value),placeholder:"輸入數量",className:"mt-1",required:!0})]})]}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 border border-blue-200",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-blue-700",children:"當前庫存"}),r.jsx("div",{className:"mt-1 text-2xl font-bold text-blue-900",children:n})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-blue-700",children:"調整變化"}),(0,r.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:["increase"===u?r.jsx(p.Z,{className:"h-5 w-5 text-green-600"}):r.jsx(j.Z,{className:"h-5 w-5 text-red-600"}),(0,r.jsxs)("span",{className:`text-lg font-bold ${"increase"===u?"text-green-600":"text-red-600"}`,children:["increase"===u?"+":"-",g||"0"]})]})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-blue-700",children:"調整後庫存"}),r.jsx("div",{className:`mt-1 text-2xl font-bold ${F?"text-red-600":"text-blue-900"}`,children:M()})]})]}),F&&(0,r.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-red-600 bg-red-50 px-3 py-2 rounded-md border border-red-200",children:[r.jsx(o.Z,{className:"h-4 w-4"}),r.jsx("span",{className:"text-sm font-medium",children:"警告：調整後庫存將為負數"})]})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{htmlFor:"remarks",className:"text-sm font-medium text-gray-700",children:"備註（可選）"}),r.jsx(C.g,{id:"remarks",value:w,onChange:e=>P(e.target.value),placeholder:"請說明調整原因...",className:"mt-1",rows:3})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[r.jsx(f.z,{type:"button",variant:"outline",onClick:x,disabled:A,children:"取消"}),r.jsx(f.z,{type:"submit",disabled:A||F,className:"bg-orange-600 hover:bg-orange-700 text-white",children:A?"調整中...":"確認調整"})]})]})})]})}var A=s(12859);function q(){let{appUser:e}=(0,D.a)(),[t,s]=(0,a.useState)([]),[C,Z]=(0,a.useState)([]),[q,R]=(0,a.useState)([]),[M,F]=(0,a.useState)([]),[I,O]=(0,a.useState)(!0),[z,E]=(0,a.useState)(""),[V,$]=(0,a.useState)("all"),[T,W]=(0,a.useState)("all"),[B,L]=(0,a.useState)(!1),[Q,Y]=(0,a.useState)(!1),[G,X]=(0,a.useState)(null),[K,H]=(0,a.useState)("material"),[U,J]=(0,a.useState)(null),ee=(0,a.useCallback)(async()=>{O(!0);try{if(!n.db)throw Error("Firebase 未初始化");let e=(0,l.query)((0,l.collection)(n.db,"materials"),(0,l.Xo)("name")),t=(await (0,l.getDocs)(e)).docs.map(e=>({id:e.id,...e.data()})),r=(0,l.query)((0,l.collection)(n.db,"fragrances"),(0,l.Xo)("name")),a=(await (0,l.getDocs)(r)).docs.map(e=>({id:e.id,...e.data()}));s(t),Z(a),R(t),F(a)}catch(e){console.error("讀取庫存資料失敗:",e),i.Am.error("讀取庫存資料失敗")}finally{O(!1)}},[]),et=async(s,r,a,d)=>{try{if(!e){i.Am.error("用戶未認證");return}let c="material"===r?t.find(e=>e.id===s):C.find(e=>e.id===s);if(!c){i.Am.error("找不到指定項目");return}let o=a-c.currentStock;await (0,A.jK)("manual_adjustment",{operatorId:e.uid,operatorName:e.name||"未知用戶",remarks:d||void 0,details:[{itemId:c.id,itemType:r,itemCode:c.code,itemName:c.name,quantityChange:o,quantityAfter:a}]});let x=(0,l.doc)(n.db,"material"===r?"materials":"fragrances",s);await (0,l.r7)(x,{currentStock:a,lastUpdated:new Date}),i.Am.success("庫存調整成功"),L(!1),X(null),ee()}catch(e){console.error("庫存調整失敗:",e),i.Am.error("庫存調整失敗")}},es=async()=>{if(!U||!e){i.Am.error("用戶未認證或資料不完整");return}try{let{itemId:e,itemType:t,itemCode:s,itemName:r,oldStock:a,newStock:l,remarks:n}=U,d=l-a;console.log("開始盤點，資料:",{itemId:e,itemType:t,itemCode:s,itemName:r,oldStock:a,newStock:l,quantityChange:d,remarks:n});let c=(0,_.$C)(),o=(0,_.V1)(c,"performStocktake"),x={items:[{itemRefPath:`${"material"===t?"materials":"fragrances"}/${e}`,currentStock:a,newStock:l}]};console.log("呼叫 performStocktake 函數，資料:",x);let m=await o(x);console.log("performStocktake 結果:",m),i.Am.success("庫存盤點完成"),Y(!1),J(null),ee()}catch(t){console.error("庫存盤點失敗:",t);let e=t instanceof Error?t.message:"未知錯誤";i.Am.error(`庫存盤點失敗: ${e}`)}},er=(e,t)=>{X(e),H(t),L(!0)},ea=(e,t)=>{J({itemId:e.id,itemType:t,itemCode:e.code,itemName:e.name,oldStock:e.currentStock,newStock:e.currentStock,remarks:""}),Y(!0)},el=e=>e.currentStock<=e.minStock?{status:"low",text:"低庫存",color:"text-red-600 bg-red-50"}:e.currentStock>=e.maxStock?{status:"high",text:"高庫存",color:"text-yellow-600 bg-yellow-50"}:{status:"normal",text:"正常",color:"text-green-600 bg-green-50"},en=t.length+C.length,ei=t.filter(e=>e.currentStock<=e.minStock).length+C.filter(e=>e.currentStock<=e.minStock).length,ed=t.reduce((e,t)=>e+t.currentStock,0)+C.reduce((e,t)=>e+t.currentStock,0);return(0,r.jsxs)("div",{className:"container mx-auto py-10",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-emerald-600 to-green-600 bg-clip-text text-transparent",children:"庫存管理"}),r.jsx("p",{className:"text-gray-600 mt-2",children:"監控物料和香精庫存與調整"})]}),(0,r.jsxs)(f.z,{onClick:ee,variant:"outline",className:"flex items-center gap-2",children:[r.jsx(d.Z,{className:"h-4 w-4"}),"重新整理"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,r.jsxs)(v.Zb,{className:"bg-gradient-to-br from-emerald-50 to-green-50 border-emerald-200",children:[(0,r.jsxs)(v.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(v.ll,{className:"text-sm font-medium text-emerald-700",children:"總項目數"}),r.jsx(c.Z,{className:"h-4 w-4 text-emerald-600"})]}),(0,r.jsxs)(v.aY,{children:[r.jsx("div",{className:"text-2xl font-bold text-emerald-900",children:en}),(0,r.jsxs)("p",{className:"text-xs text-emerald-600 mt-1",children:["物料: ",t.length," | 香精: ",C.length]})]})]}),(0,r.jsxs)(v.Zb,{className:"bg-gradient-to-br from-red-50 to-pink-50 border-red-200",children:[(0,r.jsxs)(v.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(v.ll,{className:"text-sm font-medium text-red-700",children:"低庫存項目"}),r.jsx(o.Z,{className:"h-4 w-4 text-red-600"})]}),(0,r.jsxs)(v.aY,{children:[r.jsx("div",{className:"text-2xl font-bold text-red-900",children:ei}),r.jsx("p",{className:"text-xs text-red-600 mt-1",children:"需要補貨"})]})]}),(0,r.jsxs)(v.Zb,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:[(0,r.jsxs)(v.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[r.jsx(v.ll,{className:"text-sm font-medium text-blue-700",children:"總庫存數量"}),r.jsx(x.Z,{className:"h-4 w-4 text-blue-600"})]}),(0,r.jsxs)(v.aY,{children:[r.jsx("div",{className:"text-2xl font-bold text-blue-900",children:ed.toLocaleString()}),r.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"當前庫存總量"})]})]})]}),(0,r.jsxs)(v.Zb,{className:"mb-6",children:[r.jsx(v.Ol,{children:r.jsx(v.ll,{className:"text-lg",children:"篩選與搜尋"})}),r.jsx(v.aY,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx(k._,{htmlFor:"search",children:"搜尋項目"}),(0,r.jsxs)("div",{className:"relative mt-1",children:[r.jsx(m.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),r.jsx(b.I,{id:"search",placeholder:"搜尋編號或名稱...",value:z,onChange:e=>E(e.target.value),className:"pl-10"})]})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{htmlFor:"status",children:"狀態篩選"}),(0,r.jsxs)(S.Ph,{value:V,onValueChange:$,children:[r.jsx(S.i4,{className:"mt-1",children:r.jsx(S.ki,{placeholder:"選擇狀態"})}),(0,r.jsxs)(S.Bw,{children:[r.jsx(S.Ql,{value:"all",children:"全部狀態"}),r.jsx(S.Ql,{value:"active",children:"啟用"}),r.jsx(S.Ql,{value:"inactive",children:"停用"})]})]})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{htmlFor:"type",children:"類型篩選"}),(0,r.jsxs)(S.Ph,{value:T,onValueChange:e=>W(e),children:[r.jsx(S.i4,{className:"mt-1",children:r.jsx(S.ki,{placeholder:"選擇類型"})}),(0,r.jsxs)(S.Bw,{children:[r.jsx(S.Ql,{value:"all",children:"全部類型"}),r.jsx(S.Ql,{value:"materials",children:"物料"}),r.jsx(S.Ql,{value:"fragrances",children:"香精"})]})]})]})]})})]}),("all"===T||"materials"===T)&&(0,r.jsxs)(v.Zb,{className:"mb-6",children:[(0,r.jsxs)(v.Ol,{children:[(0,r.jsxs)(v.ll,{className:"text-lg flex items-center gap-2",children:[r.jsx(c.Z,{className:"h-5 w-5 text-blue-500"}),"物料庫存"]}),r.jsx(v.SZ,{children:"管理物料庫存和調整"})]}),r.jsx(v.aY,{children:I?(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600 mx-auto"}),r.jsx("p",{className:"text-gray-500 mt-2",children:"載入中..."})]}):0===q.length?r.jsx("div",{className:"text-center py-8 text-gray-500",children:"沒有找到符合條件的物料"}):r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)(N.iA,{children:[r.jsx(N.xD,{children:(0,r.jsxs)(N.SC,{children:[r.jsx(N.ss,{children:"編號"}),r.jsx(N.ss,{children:"名稱"}),r.jsx(N.ss,{children:"當前庫存"}),r.jsx(N.ss,{children:"單位"}),r.jsx(N.ss,{children:"最低庫存"}),r.jsx(N.ss,{children:"最高庫存"}),r.jsx(N.ss,{children:"狀態"}),r.jsx(N.ss,{children:"操作"})]})}),r.jsx(N.RM,{children:q.map(e=>{let t=el(e);return(0,r.jsxs)(N.SC,{children:[r.jsx(N.pj,{className:"font-mono text-sm",children:e.code}),r.jsx(N.pj,{className:"font-medium",children:e.name}),r.jsx(N.pj,{children:r.jsx("span",{className:`font-semibold ${t.color} px-2 py-1 rounded-full text-xs`,children:e.currentStock.toLocaleString()})}),r.jsx(N.pj,{children:e.unit}),r.jsx(N.pj,{children:e.minStock.toLocaleString()}),r.jsx(N.pj,{children:e.maxStock.toLocaleString()}),r.jsx(N.pj,{children:r.jsx(y.C,{variant:"active"===e.status?"default":"secondary",children:"active"===e.status?"啟用":"停用"})}),r.jsx(N.pj,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(f.z,{size:"sm",variant:"outline",onClick:()=>er(e,"material"),className:"text-blue-600 hover:text-blue-700",children:[r.jsx(u.Z,{className:"h-4 w-4 mr-1"}),"調整"]}),(0,r.jsxs)(f.z,{size:"sm",variant:"outline",onClick:()=>ea(e,"material"),className:"text-green-600 hover:text-green-700",children:[r.jsx(h.Z,{className:"h-4 w-4 mr-1"}),"盤點"]})]})})]},e.id)})})]})})})]}),("all"===T||"fragrances"===T)&&(0,r.jsxs)(v.Zb,{className:"mb-6",children:[(0,r.jsxs)(v.Ol,{children:[(0,r.jsxs)(v.ll,{className:"text-lg flex items-center gap-2",children:[r.jsx(p.Z,{className:"h-5 w-5 text-purple-500"}),"香精庫存"]}),r.jsx(v.SZ,{children:"管理香精庫存和調整"})]}),r.jsx(v.aY,{children:I?(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mx-auto"}),r.jsx("p",{className:"text-gray-500 mt-2",children:"載入中..."})]}):0===M.length?r.jsx("div",{className:"text-center py-8 text-gray-500",children:"沒有找到符合條件的香精"}):r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)(N.iA,{children:[r.jsx(N.xD,{children:(0,r.jsxs)(N.SC,{children:[r.jsx(N.ss,{children:"編號"}),r.jsx(N.ss,{children:"名稱"}),r.jsx(N.ss,{children:"當前庫存"}),r.jsx(N.ss,{children:"單位"}),r.jsx(N.ss,{children:"最低庫存"}),r.jsx(N.ss,{children:"最高庫存"}),r.jsx(N.ss,{children:"狀態"}),r.jsx(N.ss,{children:"操作"})]})}),r.jsx(N.RM,{children:M.map(e=>{let t=el(e);return(0,r.jsxs)(N.SC,{children:[r.jsx(N.pj,{className:"font-mono text-sm",children:e.code}),r.jsx(N.pj,{className:"font-medium",children:e.name}),r.jsx(N.pj,{children:r.jsx("span",{className:`font-semibold ${t.color} px-2 py-1 rounded-full text-xs`,children:e.currentStock.toLocaleString()})}),r.jsx(N.pj,{children:e.unit}),r.jsx(N.pj,{children:e.minStock.toLocaleString()}),r.jsx(N.pj,{children:e.maxStock.toLocaleString()}),r.jsx(N.pj,{children:r.jsx(y.C,{variant:"active"===e.status?"default":"secondary",children:"active"===e.status?"啟用":"停用"})}),r.jsx(N.pj,{children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(f.z,{size:"sm",variant:"outline",onClick:()=>er(e,"fragrance"),className:"text-purple-600 hover:text-purple-700",children:[r.jsx(u.Z,{className:"h-4 w-4 mr-1"}),"調整"]}),(0,r.jsxs)(f.z,{size:"sm",variant:"outline",onClick:()=>ea(e,"fragrance"),className:"text-green-600 hover:text-green-700",children:[r.jsx(h.Z,{className:"h-4 w-4 mr-1"}),"盤點"]})]})})]},e.id)})})]})})})]}),r.jsx(w.Vq,{open:B,onOpenChange:L,children:(0,r.jsxs)(w.cZ,{className:"max-w-2xl",children:[(0,r.jsxs)(w.fK,{children:[r.jsx(w.$N,{children:"調整庫存"}),(0,r.jsxs)(w.Be,{children:["調整 ",G?.name," 的庫存數量"]})]}),G&&r.jsx(P,{itemId:G.id,itemType:K,itemCode:G.code,itemName:G.name,currentStock:G.currentStock,onAdjustmentComplete:(e,t)=>{et(G.id,K,e,t)},onCancel:()=>{L(!1),X(null)}})]})}),r.jsx(w.Vq,{open:Q,onOpenChange:Y,children:(0,r.jsxs)(w.cZ,{className:"max-w-2xl",children:[(0,r.jsxs)(w.fK,{children:[r.jsx(w.$N,{children:"庫存盤點"}),(0,r.jsxs)(w.Be,{children:["盤點 ",U?.itemName," 的實際庫存數量"]})]}),U&&(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-gray-600",children:"物料編號"}),r.jsx("div",{className:"mt-1 font-mono text-sm bg-white px-3 py-2 rounded-md border",children:U.itemCode})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-gray-600",children:"物料名稱"}),r.jsx("div",{className:"mt-1 text-sm bg-white px-3 py-2 rounded-md border",children:U.itemName})]})]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx(k._,{htmlFor:"newStock",className:"text-sm font-medium text-gray-700",children:"盤點後數量"}),r.jsx(b.I,{id:"newStock",type:"number",step:"0.01",min:"0",value:U.newStock,onChange:e=>J(t=>t?{...t,newStock:parseFloat(e.target.value)||0}:null),placeholder:"輸入盤點後的實際數量",className:"mt-1",required:!0})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{htmlFor:"remarks",className:"text-sm font-medium text-gray-700",children:"盤點備註（可選）"}),r.jsx("textarea",{id:"remarks",value:U.remarks,onChange:e=>J(t=>t?{...t,remarks:e.target.value}:null),placeholder:"請說明盤點情況...",className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",rows:3})]})]}),r.jsx("div",{className:"bg-green-50 rounded-lg p-4 border border-green-200",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-green-700",children:"系統庫存"}),r.jsx("div",{className:"mt-1 text-2xl font-bold text-green-900",children:U.oldStock})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-green-700",children:"盤點變化"}),(0,r.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[U.newStock>U.oldStock?r.jsx(p.Z,{className:"h-5 w-5 text-green-600"}):U.newStock<U.oldStock?r.jsx(j.Z,{className:"h-5 w-5 text-red-600"}):r.jsx(g.Z,{className:"h-5 w-5 text-gray-600"}),(0,r.jsxs)("span",{className:`text-lg font-bold ${U.newStock>U.oldStock?"text-green-600":U.newStock<U.oldStock?"text-red-600":"text-gray-600"}`,children:[U.newStock>U.oldStock?"+":"",U.newStock-U.oldStock]})]})]}),(0,r.jsxs)("div",{children:[r.jsx(k._,{className:"text-sm font-medium text-green-700",children:"盤點後庫存"}),r.jsx("div",{className:"mt-1 text-2xl font-bold text-green-900",children:U.newStock})]})]})}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[r.jsx(f.z,{type:"button",variant:"outline",onClick:()=>{Y(!1),J(null)},children:"取消"}),r.jsx(f.z,{type:"button",onClick:es,className:"bg-green-600 hover:bg-green-700 text-white",children:"確認盤點"})]})]})]})})]})}function R(){return r.jsx(q,{})}},82015:(e,t,s)=>{"use strict";s.d(t,{g:()=>n});var r=s(10326),a=s(17577),l=s(51223);let n=a.forwardRef(({className:e,...t},s)=>r.jsx("textarea",{className:(0,l.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...t}));n.displayName="Textarea"},73181:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(68570).createProxy)(String.raw`D:\APP\deer-lab\src\app\dashboard\inventory-old\page.tsx#default`)},98958:(e,t,s)=>{"use strict";s.d(t,{Dx:()=>er,VY:()=>es,aV:()=>et,dk:()=>ea,fC:()=>U,h_:()=>ee,jm:()=>G,p8:()=>N,x8:()=>el,xz:()=>J});var r=s(17577),a=s(82561),l=s(48051),n=s(93095),i=s(88957),d=s(52067),c=s(825),o=s(10441),x=s(83078),m=s(9815),u=s(45226),h=s(80699),p=s(58260),j=s(35664),g=s(34214),f=s(10326),v="Dialog",[b,N]=(0,n.b)(v),[y,w]=b(v),k=e=>{let{__scopeDialog:t,children:s,open:a,defaultOpen:l,onOpenChange:n,modal:c=!0}=e,o=r.useRef(null),x=r.useRef(null),[m,u]=(0,d.T)({prop:a,defaultProp:l??!1,onChange:n,caller:v});return(0,f.jsx)(y,{scope:t,triggerRef:o,contentRef:x,contentId:(0,i.M)(),titleId:(0,i.M)(),descriptionId:(0,i.M)(),open:m,onOpenChange:u,onOpenToggle:r.useCallback(()=>u(e=>!e),[u]),modal:c,children:s})};k.displayName=v;var S="DialogTrigger",C=r.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,n=w(S,s),i=(0,l.e)(t,n.triggerRef);return(0,f.jsx)(u.WV.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":Q(n.open),...r,ref:i,onClick:(0,a.Mj)(e.onClick,n.onOpenToggle)})});C.displayName=S;var Z="DialogPortal",[_,D]=b(Z,{forceMount:void 0}),P=e=>{let{__scopeDialog:t,forceMount:s,children:a,container:l}=e,n=w(Z,t);return(0,f.jsx)(_,{scope:t,forceMount:s,children:r.Children.map(a,e=>(0,f.jsx)(m.z,{present:s||n.open,children:(0,f.jsx)(x.h,{asChild:!0,container:l,children:e})}))})};P.displayName=Z;var A="DialogOverlay",q=r.forwardRef((e,t)=>{let s=D(A,e.__scopeDialog),{forceMount:r=s.forceMount,...a}=e,l=w(A,e.__scopeDialog);return l.modal?(0,f.jsx)(m.z,{present:r||l.open,children:(0,f.jsx)(M,{...a,ref:t})}):null});q.displayName=A;var R=(0,g.Z8)("DialogOverlay.RemoveScroll"),M=r.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,a=w(A,s);return(0,f.jsx)(p.Z,{as:R,allowPinchZoom:!0,shards:[a.contentRef],children:(0,f.jsx)(u.WV.div,{"data-state":Q(a.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),F="DialogContent",I=r.forwardRef((e,t)=>{let s=D(F,e.__scopeDialog),{forceMount:r=s.forceMount,...a}=e,l=w(F,e.__scopeDialog);return(0,f.jsx)(m.z,{present:r||l.open,children:l.modal?(0,f.jsx)(O,{...a,ref:t}):(0,f.jsx)(z,{...a,ref:t})})});I.displayName=F;var O=r.forwardRef((e,t)=>{let s=w(F,e.__scopeDialog),n=r.useRef(null),i=(0,l.e)(t,s.contentRef,n);return r.useEffect(()=>{let e=n.current;if(e)return(0,j.Ry)(e)},[]),(0,f.jsx)(E,{...e,ref:i,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,a.Mj)(e.onCloseAutoFocus,e=>{e.preventDefault(),s.triggerRef.current?.focus()}),onPointerDownOutside:(0,a.Mj)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,s=0===t.button&&!0===t.ctrlKey;(2===t.button||s)&&e.preventDefault()}),onFocusOutside:(0,a.Mj)(e.onFocusOutside,e=>e.preventDefault())})}),z=r.forwardRef((e,t)=>{let s=w(F,e.__scopeDialog),a=r.useRef(!1),l=r.useRef(!1);return(0,f.jsx)(E,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(a.current||s.triggerRef.current?.focus(),t.preventDefault()),a.current=!1,l.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(a.current=!0,"pointerdown"!==t.detail.originalEvent.type||(l.current=!0));let r=t.target;s.triggerRef.current?.contains(r)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&l.current&&t.preventDefault()}})}),E=r.forwardRef((e,t)=>{let{__scopeDialog:s,trapFocus:a,onOpenAutoFocus:n,onCloseAutoFocus:i,...d}=e,x=w(F,s),m=r.useRef(null),u=(0,l.e)(t,m);return(0,h.EW)(),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(o.M,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:n,onUnmountAutoFocus:i,children:(0,f.jsx)(c.XB,{role:"dialog",id:x.contentId,"aria-describedby":x.descriptionId,"aria-labelledby":x.titleId,"data-state":Q(x.open),...d,ref:u,onDismiss:()=>x.onOpenChange(!1)})}),(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(K,{titleId:x.titleId}),(0,f.jsx)(H,{contentRef:m,descriptionId:x.descriptionId})]})]})}),V="DialogTitle",$=r.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,a=w(V,s);return(0,f.jsx)(u.WV.h2,{id:a.titleId,...r,ref:t})});$.displayName=V;var T="DialogDescription",W=r.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,a=w(T,s);return(0,f.jsx)(u.WV.p,{id:a.descriptionId,...r,ref:t})});W.displayName=T;var B="DialogClose",L=r.forwardRef((e,t)=>{let{__scopeDialog:s,...r}=e,l=w(B,s);return(0,f.jsx)(u.WV.button,{type:"button",...r,ref:t,onClick:(0,a.Mj)(e.onClick,()=>l.onOpenChange(!1))})});function Q(e){return e?"open":"closed"}L.displayName=B;var Y="DialogTitleWarning",[G,X]=(0,n.k)(Y,{contentName:F,titleName:V,docsSlug:"dialog"}),K=({titleId:e})=>{let t=X(Y),s=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return r.useEffect(()=>{e&&!document.getElementById(e)&&console.error(s)},[s,e]),null},H=({contentRef:e,descriptionId:t})=>{let s=X("DialogDescriptionWarning"),a=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${s.contentName}}.`;return r.useEffect(()=>{let s=e.current?.getAttribute("aria-describedby");t&&s&&!document.getElementById(t)&&console.warn(a)},[a,e,t]),null},U=k,J=C,ee=P,et=q,es=I,er=$,ea=W,el=L},34478:(e,t,s)=>{"use strict";s.d(t,{f:()=>i});var r=s(17577),a=s(45226),l=s(10326),n=r.forwardRef((e,t)=>(0,l.jsx)(a.WV.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));n.displayName="Label";var i=n}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,9654,5540,8693,692,4108,4334,9562],()=>s(42784));module.exports=r})();