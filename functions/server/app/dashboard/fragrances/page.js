(()=>{var e={};e.id=881,e.ids=[881],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},84770:e=>{"use strict";e.exports=require("crypto")},80665:e=>{"use strict";e.exports=require("dns")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},32694:e=>{"use strict";e.exports=require("http2")},98216:e=>{"use strict";e.exports=require("net")},19801:e=>{"use strict";e.exports=require("os")},55315:e=>{"use strict";e.exports=require("path")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},12354:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>p,tree:()=>o}),r(96533),r(22834),r(62510),r(35866);var s=r(23191),a=r(88716),n=r(37922),l=r.n(n),i=r(95231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);r.d(t,c);let o=["",{children:["dashboard",{children:["fragrances",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,96533)),"D:\\APP\\deer-lab\\src\\app\\dashboard\\fragrances\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,22834)),"D:\\APP\\deer-lab\\src\\app\\dashboard\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,62510)),"D:\\APP\\deer-lab\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],d=["D:\\APP\\deer-lab\\src\\app\\dashboard\\fragrances\\page.tsx"],m="/dashboard/fragrances/page",u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/fragrances/page",pathname:"/dashboard/fragrances",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},63016:(e,t,r)=>{Promise.resolve().then(r.bind(r,38128))},72257:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]])},98258:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("FlaskConical",[["path",{d:"M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2",key:"pzvekw"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M7 16h10",key:"wp8him"}]])},50949:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},66050:(e,t,r)=>{"use strict";r.d(t,{Z:()=>s});let s=(0,r(62881).Z)("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]])},38128:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>M});var s=r(10326),a=r(17577),n=r(35047),l=r(76),i=r(78880),c=r(90445),o=r(55686),d=r(13898),m=r(48705),u=r(99102),p=r(57671),x=r(72257),g=r(83855),h=r(88307),f=r(94019),j=r(10591),b=r(15919),y=r(12714),v=r(69508),N=r(38787),k=r(66050),w=r(50949),S=r(85999),C=r(41156),P=r(91664),Z=r(10143),$=r(38443),A=r(9280),z=r(41190),T=r(29752),R=r(25889),q=r(58580);function L(){let e=(0,n.useRouter)();(0,n.useSearchParams)();let[t,r]=(0,a.useState)([]),[L,M]=(0,a.useState)([]),[G,U]=(0,a.useState)(!0),[E,F]=(0,a.useState)(!1),[O,_]=(0,a.useState)(!1),[I,D]=(0,a.useState)(null),[V,K]=(0,a.useState)(new Set),[X,J]=(0,a.useState)(""),[W,B]=(0,a.useState)(!1),[Q,H]=(0,a.useState)({}),[Y,ee]=(0,a.useState)(!1),[et,er]=(0,a.useState)(null),[es,ea]=(0,a.useState)(!1),[en,el]=(0,a.useState)(new Set),[ei,ec]=(0,a.useState)(new Set),[eo,ed]=(0,a.useState)(!1),[em,eu]=(0,a.useState)(!1),ep=(0,a.useCallback)(async()=>{U(!0);try{if(!c.db)throw Error("Firebase 未初始化");let e=await (0,l.getDocs)((0,l.collection)(c.db,"suppliers")),t=new Map;e.docs.forEach(e=>{t.set(e.id,e.data().name)});let s=(await (0,l.getDocs)((0,l.collection)(c.db,"fragrances"))).docs.map(e=>{let r=e.data(),s=r.supplierRef,a=s?t.get(s.id)||"N/A":"未指定";console.log(`=== 香精 ${r.name} (${r.code}) 的詳細資料 ===`),console.log("原始資料庫資料:",r),console.log("fragranceType 原始值:",r.fragranceType,"類型:",typeof r.fragranceType),console.log("fragranceStatus 原始值:",r.fragranceStatus,"類型:",typeof r.fragranceStatus),console.log("status 原始值:",r.status,"類型:",typeof r.status),console.log("所有欄位名稱:",Object.keys(r));let n=r.fragranceType||"未指定",l=r.fragranceStatus||"未指定";return console.log("處理後的 fragranceType:",n),console.log("處理後的 fragranceStatus:",l),console.log("====================================="),{id:e.id,code:r.code,name:r.name,status:r.status,fragranceType:n,fragranceStatus:l,supplierRef:r.supplierRef,safetyStockLevel:r.safetyStockLevel,costPerUnit:r.costPerUnit,percentage:r.percentage,pgRatio:r.pgRatio,vgRatio:r.vgRatio,currentStock:r.currentStock,supplierName:a,createdAt:r.createdAt,updatedAt:r.updatedAt}});r(s),M(s)}catch(e){console.error("讀取香精資料失敗:",e),S.Am.error("讀取香精資料失敗。")}finally{U(!1)}},[]),{availableSuppliers:ex,availableFragranceTypes:eg}=(0,a.useMemo)(()=>{let e=t;if(X.trim()){let r=X.toLowerCase();e=t.filter(e=>e.code?.toLowerCase().includes(r)||e.name?.toLowerCase().includes(r)||e.supplierName?.toLowerCase().includes(r)||e.fragranceType?.toLowerCase().includes(r)||e.currentStock?.toString().includes(r)||e.costPerUnit?.toString().includes(r)||e.percentage?.toString().includes(r))}let r=new Set,s=new Set;e.forEach(e=>{e.supplierName&&r.add(e.supplierName),e.fragranceType&&s.add(e.fragranceType)});let a=new Set,n=new Set;return en.size>0&&ei.size>0?(a=new Set(en),n=new Set(ei)):en.size>0?(a=new Set(en),e.forEach(e=>{en.has(e.supplierName||"")&&e.fragranceType&&n.add(e.fragranceType)})):ei.size>0?(n=new Set(ei),e.forEach(e=>{ei.has(e.fragranceType||"")&&e.supplierName&&a.add(e.supplierName)})):(a=r,n=s),{availableSuppliers:Array.from(a).sort(),availableFragranceTypes:Array.from(n).sort()}},[t,X,en,ei]),eh=e=>{K(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},ef=e=>{try{let t={id:e.id,name:e.name,code:e.code,type:"fragrance",supplierId:e.supplierRef?.id||"",supplierName:e.supplierName||"未指定",unit:e.unit||"KG",quantity:1,costPerUnit:e.costPerUnit||0},r=localStorage.getItem("purchaseCart"),s=[];if(r)try{s=JSON.parse(r)}catch(e){console.error("解析採購車資料失敗:",e)}let a=s.findIndex(t=>t.id===e.id&&"fragrance"===t.type);a>=0?(s[a].quantity+=1,S.Am.success(`已增加 ${e.name} 的數量`)):(s.push(t),S.Am.success(`已將 ${e.name} 加入採購車`)),localStorage.setItem("purchaseCart",JSON.stringify(s))}catch(e){console.error("添加到採購車失敗:",e),S.Am.error("添加到採購車失敗")}},ej=()=>{if(0===V.size){S.Am.info("請至少選擇一個香精加入採購車。");return}try{let e=localStorage.getItem("purchaseCart"),r=e?JSON.parse(e):[],s=t.filter(e=>V.has(e.id));s.forEach(e=>{let t=r.find(t=>t.id===e.id&&"fragrance"===t.type);t?t.quantity+=1:r.push({id:e.id,name:e.name,code:e.code,type:"fragrance",supplierId:e.supplierRef?.id||"",supplierName:e.supplierName,unit:"KG",quantity:1,costPerUnit:e.costPerUnit||0})}),localStorage.setItem("purchaseCart",JSON.stringify(r)),window.dispatchEvent(new CustomEvent("purchaseCartUpdated")),S.Am.success(`已將 ${s.length} 個香精加入採購車`),K(new Set)}catch(e){console.error("加入採購車失敗:",e),S.Am.error("加入採購車失敗")}},eb=async()=>{let e=Array.from(V);if(0===e.length)return;let t=S.Am.loading(`正在刪除 ${e.length} 個香精...`);try{let r=(0,i.$C)(),s=(0,i.V1)(r,"deleteFragrance");for(let t of e)await s({fragranceId:t});S.Am.success(`成功刪除 ${e.length} 個香精。`,{id:t}),K(new Set),ep()}catch(r){console.error("批量刪除香精失敗:",r);let e="批量刪除香精時發生錯誤。";r instanceof Error&&(e=r.message),S.Am.error(e,{id:t})}finally{eu(!1)}},ey=()=>{D(null),F(!0)},ev=e=>{D(e),F(!0)},eN=e=>{D(e),_(!0)},ek=e=>{er(e),ea(!0)},ew=async()=>{if(!I)return;let e=S.Am.loading("正在刪除香精...");try{let t=(0,i.$C)(),r=(0,i.V1)(t,"deleteFragrance");await r({fragranceId:I.id}),S.Am.success(`香精 ${I.name} 已成功刪除。`,{id:e}),ep()}catch(r){console.error("刪除香精失敗:",r);let t="刪除香精時發生錯誤。";r instanceof Error&&(t=r.message),S.Am.error(t,{id:e})}finally{_(!1),D(null)}},eS=(e,t)=>{H(r=>({...r,[e]:t}))},eC=async()=>{let e=t.filter(e=>void 0!==Q[e.id]&&Q[e.id]!==e.currentStock).map(e=>({itemRefPath:`fragrances/${e.id}`,currentStock:e.currentStock,newStock:Q[e.id]}));if(0===e.length){S.Am.info("庫存數量沒有變更，無需儲存。"),B(!1),H({});return}let r=S.Am.loading("正在儲存盤點結果...");try{let t=(0,i.$C)(),s=(0,i.V1)(t,"performStocktake");await s({items:e}),S.Am.success("盤點結果儲存成功，庫存已更新。",{id:r}),H({}),B(!1),ep()}catch(t){let e=t instanceof Error?t.message:"儲存盤點失敗";S.Am.error(e,{id:r})}},eP=()=>{H({}),B(!1)},eZ=e=>Math.round(100*e)/100,e$=e=>{let t=100-e;return{pgRatio:eZ(.7*t),vgRatio:eZ(.3*t)}},eA=async(e,t,r)=>{let s=(0,i.$C)();try{console.log("開始匯入香精資料:",{totalRecords:e.length,sampleData:e.slice(0,3).map(e=>({name:e.name,code:e.code,supplierName:e.supplierName,fragranceType:e.fragranceType,fragranceStatus:e.fragranceStatus,currentStock:e.currentStock,safetyStockLevel:e.safetyStockLevel,costPerUnit:e.costPerUnit,percentage:e.percentage,hasSupplierName:!!e.supplierName}))});let t=new Map;if(!c.db)throw Error("Firebase 未初始化");(await (0,l.getDocs)((0,l.collection)(c.db,"suppliers"))).forEach(e=>{let r=e.data();t.set(r.name,e.id),console.log(`供應商映射: ${r.name} -> ${e.id}`)}),console.log("供應商映射表:",Array.from(t.entries()));let a=new Map;(await (0,l.getDocs)((0,l.collection)(c.db,"fragrances"))).forEach(e=>{let t=e.data();t.code&&a.set(t.code,e.id)});let n=Math.ceil(e.length/20),o=0,d=0,m=0;for(let l=0;l<n;l++){let c=20*l,u=Math.min(c+20,e.length),p=e.slice(c,u);for(let e of p)try{let r;if(e.supplierName&&""!==e.supplierName.trim()){let s=e.supplierName.trim();r=t.get(s),console.log(`尋找供應商: "${s}" -> ${r||"未找到"}`),r||console.warn(`找不到供應商: "${s}"`)}let n=e.fragranceType;if(null!=n&&""!==n)switch(n){case"cotton":n="棉芯";break;case"ceramic":n="陶瓷芯";break;case"universal":n="棉陶芯通用"}else n="";let l=e.fragranceStatus;if(null!=l&&""!==l)switch(l){case"active":l="啟用";break;case"standby":l="備用";break;case"discontinued":l="棄用"}else l="";let c=void 0!==e.percentage&&null!==e.percentage&&""!==e.percentage?eZ(Number(e.percentage)):0,o=void 0!==e.pgRatio&&null!==e.pgRatio&&""!==e.pgRatio?eZ(Number(e.pgRatio)):0,u=void 0!==e.vgRatio&&null!==e.vgRatio&&""!==e.vgRatio?eZ(Number(e.vgRatio)):0,p=void 0!==e.currentStock&&null!==e.currentStock&&""!==e.currentStock?Number(e.currentStock):0,x=void 0!==e.safetyStockLevel&&null!==e.safetyStockLevel&&""!==e.safetyStockLevel?Number(e.safetyStockLevel):0,g=void 0!==e.costPerUnit&&null!==e.costPerUnit&&""!==e.costPerUnit?Number(e.costPerUnit):0;if(c>0&&(0===o||0===u)){let t=e$(c);o=t.pgRatio,u=t.vgRatio,console.log(`自動計算香精 ${e.name} 的比例:`,{fragrancePercentage:c,calculatedPgRatio:o,calculatedVgRatio:u})}let h={code:e.code,name:e.name,supplierId:r,percentage:c,pgRatio:o,vgRatio:u,currentStock:p,safetyStockLevel:x,costPerUnit:g,unit:"KG"};if(h.fragranceType=n,h.fragranceStatus=l,console.log(`處理香精 ${e.name} 的完整資料:`,{code:h.code,name:h.name,supplierId:h.supplierId,fragranceType:h.fragranceType,fragranceStatus:h.fragranceStatus,percentage:h.percentage,pgRatio:h.pgRatio,vgRatio:h.vgRatio,currentStock:h.currentStock,safetyStockLevel:h.safetyStockLevel,costPerUnit:h.costPerUnit,unit:h.unit}),console.log(`處理香精 ${e.name} 的資料對比:`,{originalFragranceType:e.fragranceType,processedFragranceType:n,originalFragranceStatus:e.fragranceStatus,processedFragranceStatus:l,originalSupplierName:e.supplierName,processedSupplierId:r,hasSupplierId:!!r,originalCurrentStock:e.currentStock,processedCurrentStock:p,originalPercentage:e.percentage,processedPercentage:c,fragranceTypeExists:!!e.fragranceType,fragranceStatusExists:!!e.fragranceStatus,fragranceTypeLength:e.fragranceType?.length||0,fragranceStatusLength:e.fragranceStatus?.length||0}),a.get(e.code)){console.log(`香精代號 ${e.code} 已存在，執行更新操作`);let t=(0,i.V1)(s,"updateFragranceByCode");await t(h),m++}else{console.log(`香精代號 ${e.code} 不存在，執行新增操作`);let t=(0,i.V1)(s,"createFragrance");await t(h),d++}}catch(e){throw console.error("處理香精資料失敗:",e),e}o+=p.length,r?.(o,e.length),l<n-1&&await new Promise(e=>setTimeout(e,500))}console.log("香精匯入結果:",`成功處理 ${o} 筆資料 (新增: ${d}, 更新: ${m})`),ep()}catch(e){throw console.error("匯入香精失敗:",e),e}},ez=async()=>t.map(e=>({code:e.code,name:e.name,fragranceType:(e=>{switch(e){case"cotton":return"棉芯";case"ceramic":return"陶瓷芯";case"universal":return"棉陶芯通用";default:return e}})(e.fragranceType||e.status),fragranceStatus:(e=>{switch(e){case"active":return"啟用";case"standby":return"備用";case"discontinued":return"棄用";default:return e}})(e.fragranceStatus||e.status||"active"),supplierName:e.supplierName,safetyStockLevel:e.safetyStockLevel,costPerUnit:e.costPerUnit,percentage:e.percentage,pgRatio:e.pgRatio,vgRatio:e.vgRatio,currentStock:e.currentStock,unit:"KG"}));return(0,s.jsxs)("div",{className:"container mx-auto py-10 fragrances-page",children:[s.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-pink-600 to-rose-600 bg-clip-text text-transparent",children:"香精管理"}),s.jsx("p",{className:"text-gray-600 mt-2",children:"管理香精配方與庫存"})]})}),s.jsx("div",{className:"lg:hidden mb-6",children:s.jsx("div",{className:"grid grid-cols-2 gap-3",children:W?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(P.z,{onClick:eC,className:"w-full",children:[s.jsx(m.Z,{className:"mr-2 h-4 w-4"}),"儲存盤點"]}),s.jsx(P.z,{variant:"outline",onClick:eP,className:"w-full",children:"取消"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(P.z,{variant:"outline",onClick:()=>ee(!0),className:"w-full",children:[s.jsx(u.Z,{className:"mr-2 h-4 w-4"}),"匯入/匯出"]}),(0,s.jsxs)(P.z,{onClick:ej,disabled:0===V.size,variant:"outline",className:"w-full",children:[s.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"加入採購車 (",V.size,")"]}),(0,s.jsxs)(P.z,{variant:"outline",onClick:()=>B(!0),className:"w-full",children:[s.jsx(x.Z,{className:"mr-2 h-4 w-4"}),"盤點模式"]}),(0,s.jsxs)(P.z,{onClick:ey,className:"w-full bg-gradient-to-r from-pink-600 to-rose-600 hover:from-pink-700 hover:to-rose-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[s.jsx(g.Z,{className:"mr-2 h-4 w-4"}),"新增香精"]})]})})}),s.jsx("div",{className:"hidden lg:block mb-6",children:s.jsx("div",{className:"flex flex-wrap items-center gap-2 justify-end",children:W?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(P.z,{onClick:eC,children:[s.jsx(m.Z,{className:"mr-2 h-4 w-4"}),"儲存盤點"]}),s.jsx(P.z,{variant:"outline",onClick:eP,children:"取消"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(P.z,{variant:"outline",onClick:()=>ee(!0),children:[s.jsx(u.Z,{className:"mr-2 h-4 w-4"}),"匯入/匯出"]}),(0,s.jsxs)(P.z,{onClick:ej,disabled:0===V.size,variant:"outline",children:[s.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"加入採購車 (",V.size,")"]}),(0,s.jsxs)(P.z,{variant:"outline",onClick:()=>B(!0),children:[s.jsx(x.Z,{className:"mr-2 h-4 w-4"}),"盤點模式"]}),(0,s.jsxs)(P.z,{onClick:ey,className:"bg-gradient-to-r from-pink-600 to-rose-600 hover:from-pink-700 hover:to-rose-700 text-white shadow-lg hover:shadow-xl transition-all duration-200",children:[s.jsx(g.Z,{className:"mr-2 h-4 w-4"}),"新增香精"]})]})})}),s.jsx(T.Zb,{className:"mb-6 border-0 shadow-lg bg-gradient-to-r from-gray-50 to-pink-50",children:s.jsx(T.aY,{className:"pt-6",children:(0,s.jsxs)("div",{className:"relative",children:[s.jsx(h.Z,{className:"absolute left-3 top-3 h-4 w-4 text-pink-600"}),s.jsx(z.I,{placeholder:"搜尋香精代號、名稱、供應商、香精種類、庫存等...",value:X,onChange:e=>J(e.target.value),className:"pl-10 border-pink-200 focus:border-pink-500 focus:ring-pink-500"})]})})}),s.jsx("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[t.filter(e=>"number"==typeof e.safetyStockLevel&&e.currentStock<e.safetyStockLevel).length>0&&(0,s.jsxs)($.C,{variant:eo?"default":"secondary",className:`cursor-pointer transition-colors ${eo?"bg-red-600 hover:bg-red-700 text-white":"bg-red-100 hover:bg-red-200 text-red-800 border-red-300"}`,onClick:()=>ed(!eo),children:["安全庫存 (",t.filter(e=>"number"==typeof e.safetyStockLevel&&e.currentStock<e.safetyStockLevel).length,")"]}),ex.map(e=>s.jsx($.C,{variant:en.has(e)?"default":"secondary",className:`cursor-pointer transition-colors ${en.has(e)?"bg-orange-600 hover:bg-orange-700 text-white":"bg-orange-100 hover:bg-orange-200 text-orange-800 border-orange-300"}`,onClick:()=>{el(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},children:e},e)),eg.map(e=>{let t=ei.has(e);return s.jsx($.C,{variant:t?"default":"secondary",className:`cursor-pointer transition-colors ${(e=>{switch(e){case"棉芯":return t?"bg-blue-600 hover:bg-blue-700 text-white":"bg-blue-100 hover:bg-blue-200 text-blue-800 border-blue-300";case"陶瓷芯":return t?"bg-green-600 hover:bg-green-700 text-white":"bg-green-100 hover:bg-green-200 text-green-800 border-green-300";case"棉陶芯通用":return t?"bg-purple-600 hover:bg-purple-700 text-white":"bg-purple-100 hover:bg-purple-200 text-purple-800 border-purple-300";default:return t?"bg-gray-600 hover:bg-gray-700 text-white":"bg-gray-100 hover:bg-gray-200 text-gray-800 border-gray-300"}})(e)}`,onClick:()=>{ec(t=>{let r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})},children:e},e)})]})}),V.size>0&&!W&&s.jsx("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(P.z,{variant:"outline",size:"sm",onClick:ej,className:"flex items-center gap-2",children:[s.jsx(p.Z,{className:"h-4 w-4"}),"加入採購車 (",V.size,")"]}),(0,s.jsxs)(P.z,{variant:"destructive",size:"sm",onClick:()=>{if(0===V.size){S.Am.info("請至少選擇一個香精進行刪除。");return}eu(!0)},className:"flex items-center gap-2",children:[s.jsx(f.Z,{className:"h-4 w-4"}),"批量刪除 (",V.size,")"]})]})}),s.jsx("div",{className:"lg:hidden",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden mb-6",children:[s.jsx("div",{className:"px-4 py-3 bg-gradient-to-r from-gray-50 to-pink-50 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(j.Z,{className:"h-4 w-4 text-pink-600"}),s.jsx("h2",{className:"text-base font-semibold text-gray-800",children:"香精清單"})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-600",children:["共 ",L.length," 項"]})]})}),s.jsx("div",{className:"overflow-x-auto",children:s.jsx("div",{className:"min-w-full",children:G?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:"w-10 h-10 border-4 border-pink-200 rounded-full animate-spin"}),s.jsx("div",{className:"absolute top-0 left-0 w-10 h-10 border-4 border-transparent border-t-pink-600 rounded-full animate-spin"})]}),s.jsx("span",{className:"mt-3 text-sm text-gray-600 font-medium",children:"載入中..."})]}):L.length>0?s.jsx("div",{className:"divide-y divide-gray-200",children:L.map(e=>{let t="number"==typeof e.safetyStockLevel&&e.currentStock<e.safetyStockLevel;return(0,s.jsxs)("div",{className:`p-4 ${t&&!W?"bg-red-50/50":""} hover:bg-pink-50/50 transition-colors duration-200`,onClick:()=>ek(e),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-pink-500 to-rose-600 rounded-lg flex items-center justify-center",children:s.jsx(j.Z,{className:"h-4 w-4 text-white"})}),(0,s.jsxs)("div",{children:[s.jsx("div",{className:"font-medium text-gray-900 text-sm",children:e.name}),s.jsx("div",{className:"flex items-center gap-2 mt-1",children:s.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:e.code})})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(A.X,{checked:V.has(e.id),onCheckedChange:()=>eh(e.id),"aria-label":`選擇 ${e.name}`,disabled:W,onClick:e=>e.stopPropagation()}),(0,s.jsxs)(Z.h_,{children:[s.jsx(Z.$F,{asChild:!0,onClick:e=>e.stopPropagation(),children:s.jsx(P.z,{variant:"ghost",className:"h-8 w-8 p-0",disabled:W,children:s.jsx(b.Z,{className:"h-4 w-4"})})}),(0,s.jsxs)(Z.AW,{align:"end",children:[(0,s.jsxs)(Z.Xi,{onClick:()=>ef(e),children:[s.jsx(p.Z,{className:"mr-2 h-4 w-4"}),"加入採購車"]}),(0,s.jsxs)(Z.Xi,{onClick:()=>ek(e),children:[s.jsx(y.Z,{className:"mr-2 h-4 w-4"}),"查看詳細"]}),(0,s.jsxs)(Z.Xi,{onClick:()=>ev(e),children:[s.jsx(v.Z,{className:"mr-2 h-4 w-4"}),"編輯"]}),s.jsx(Z.Xi,{onClick:()=>eN(e),className:"text-red-600",children:"刪除"})]})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[!W&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[s.jsx(N.Z,{className:"h-3 w-3 text-blue-600"}),s.jsx("span",{className:"text-gray-500",children:"供應商"})]}),s.jsx("span",{className:"font-medium text-gray-700",children:e.supplierName})]}),!W&&(0,s.jsxs)("div",{children:[s.jsx("div",{className:"flex items-center gap-1 mb-1",children:s.jsx("span",{className:"text-gray-500",children:"香精種類"})}),s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${"棉芯"===e.fragranceType?"bg-blue-100 text-blue-800":"陶瓷芯"===e.fragranceType?"bg-green-100 text-green-800":"棉陶芯通用"===e.fragranceType?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:e.fragranceType||"未指定"})]}),!W&&(0,s.jsxs)("div",{children:[s.jsx("div",{className:"flex items-center gap-1 mb-1",children:s.jsx("span",{className:"text-gray-500",children:"啟用狀態"})}),s.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded-full ${"啟用"===e.fragranceStatus?"bg-green-100 text-green-800":"備用"===e.fragranceStatus?"bg-yellow-100 text-yellow-800":"棄用"===e.fragranceStatus?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:e.fragranceStatus||"未指定"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[s.jsx(k.Z,{className:"h-3 w-3 text-gray-400"}),s.jsx("span",{className:"text-gray-500",children:W?"應有庫存:":"目前庫存:"})]}),W?s.jsx("div",{className:"flex items-center gap-2",children:(0,s.jsxs)("span",{className:"font-medium text-gray-700",children:[e.currentStock||0," KG"]})}):(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[t&&s.jsx(w.Z,{className:"h-3 w-3 text-red-600"}),(0,s.jsxs)("span",{className:`font-medium ${t?"text-red-600":"text-green-600"}`,children:[e.currentStock," KG"]})]})]}),W&&(0,s.jsxs)("div",{children:[s.jsx("div",{className:"flex items-center gap-1 mb-1",children:s.jsx("span",{className:"text-gray-500",children:"現有庫存:"})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(z.I,{type:"number",className:"w-20 h-7 text-sm border-pink-200 focus:border-pink-500 focus:ring-pink-500",value:Q[e.id]??e.currentStock,onChange:t=>eS(e.id,Number(t.target.value))}),s.jsx("span",{className:"text-xs text-gray-600",children:"KG"})]})]}),!W&&(0,s.jsxs)("div",{children:[s.jsx("div",{className:"flex items-center gap-1 mb-1",children:s.jsx("span",{className:"text-gray-500",children:"安全庫存"})}),(0,s.jsxs)("span",{className:"font-medium text-gray-700",children:[e.safetyStockLevel||0," KG"]})]})]})]},e.id)})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[s.jsx("div",{className:"w-12 h-12 bg-muted rounded-full flex items-center justify-center mb-3",children:s.jsx(j.Z,{className:"h-6 w-6 text-muted-foreground"})}),s.jsx("h3",{className:"text-base font-medium text-foreground mb-1",children:"沒有香精資料"}),s.jsx("p",{className:"text-sm text-muted-foreground mb-4 text-center",children:"開始建立第一個香精來管理配方"}),(0,s.jsxs)(P.z,{onClick:ey,variant:"outline",size:"sm",className:"border-pink-200 text-pink-600 hover:bg-pink-50",children:[s.jsx(g.Z,{className:"mr-2 h-4 w-4"}),"新增香精"]})]})})})]})}),s.jsx("div",{className:"hidden lg:block",children:(0,s.jsxs)("div",{className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden",children:[s.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-background to-accent/10 border-b border-border",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(j.Z,{className:"h-5 w-5 text-accent"}),s.jsx("h2",{className:"text-lg font-semibold text-foreground",children:W?"香精盤點中":"香精清單"})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["共 ",L.length," 項香精"]})]})}),s.jsx("div",{className:"table-responsive",children:(0,s.jsxs)(C.iA,{className:"table-enhanced",children:[s.jsx(C.xD,{children:(0,s.jsxs)(C.SC,{children:[s.jsx(C.ss,{className:"w-[60px] text-center",children:!W&&(0,s.jsxs)("div",{className:"flex items-center gap-2",title:"全選所有香精",children:[s.jsx(A.X,{checked:V.size===L.length&&L.length>0,onCheckedChange:e=>{e?K(new Set(L.map(e=>e.id))):K(new Set)}}),s.jsx("span",{className:"text-xs text-muted-foreground",children:"全選"})]})}),s.jsx(C.ss,{className:"text-left",children:"香精資訊"}),!W&&s.jsx(C.ss,{className:"text-left",children:"香精種類"}),!W&&s.jsx(C.ss,{className:"text-left",children:"啟用狀態"}),!W&&s.jsx(C.ss,{className:"text-left",children:"供應商"}),s.jsx(C.ss,{className:"text-right",children:W?"應有庫存":"目前庫存"}),W&&s.jsx(C.ss,{className:"text-right",children:"現有庫存"}),!W&&s.jsx(C.ss,{className:"text-right",children:"安全庫存"}),s.jsx(C.ss,{className:"text-right",children:"操作"})]})}),s.jsx(C.RM,{children:G?s.jsx(C.SC,{children:s.jsx(C.pj,{colSpan:7,className:"text-center py-16",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,s.jsxs)("div",{className:"relative",children:[s.jsx("div",{className:"w-12 h-12 border-4 border-pink-200 rounded-full animate-spin"}),s.jsx("div",{className:"absolute top-0 left-0 w-12 h-12 border-4 border-transparent border-t-pink-600 rounded-full animate-spin"})]}),s.jsx("span",{className:"mt-4 text-muted-foreground font-medium",children:"載入香精資料中..."})]})})}):L.length>0?L.map(t=>{let r="number"==typeof t.safetyStockLevel&&t.currentStock<t.safetyStockLevel;return(0,s.jsxs)(C.SC,{className:`${r&&!W?"bg-destructive/10":""} ${W?"":"cursor-pointer hover:bg-accent/5"} transition-colors duration-200`,"data-state":V.has(t.id)?"selected":"",onClick:W?void 0:()=>e.push(`/dashboard/fragrances/${t.id}`),children:[s.jsx(C.pj,{className:"text-center",onClick:e=>e.stopPropagation(),children:s.jsx(A.X,{checked:V.has(t.id),onCheckedChange:()=>eh(t.id),"aria-label":`選擇 ${t.name}`,disabled:W})}),s.jsx(C.pj,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-pink-600 to-rose-600 rounded-lg flex items-center justify-center",children:s.jsx(j.Z,{className:"h-4 w-4 text-white"})}),(0,s.jsxs)("div",{children:[s.jsx("div",{className:"font-medium text-foreground",children:t.name}),s.jsx("div",{className:"flex items-center gap-2 mt-1",children:s.jsx($.C,{className:"bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full",children:t.code})})]})]})}),!W&&s.jsx(C.pj,{children:s.jsx($.C,{className:`status-badge ${"棉芯"===t.fragranceType?"bg-blue-100 text-blue-800":"陶瓷芯"===t.fragranceType?"bg-green-100 text-green-800":"棉陶芯通用"===t.fragranceType?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:t.fragranceType||"未指定"})}),!W&&s.jsx(C.pj,{children:s.jsx($.C,{className:`status-badge ${"啟用"===t.fragranceStatus?"bg-green-100 text-green-800":"備用"===t.fragranceStatus?"bg-yellow-100 text-yellow-800":"棄用"===t.fragranceStatus?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.fragranceStatus||"未指定"})}),!W&&s.jsx(C.pj,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(N.Z,{className:"h-4 w-4 text-primary"}),s.jsx("span",{className:"text-sm font-medium text-foreground",children:t.supplierName})]})}),s.jsx(C.pj,{className:"text-right",children:W?s.jsx("div",{className:"flex justify-end items-center gap-2",children:(0,s.jsxs)("span",{className:"number-display number-neutral",children:[t.currentStock||0," KG"]})}):(0,s.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[r&&s.jsx(w.Z,{className:"h-4 w-4 text-red-600"}),(0,s.jsxs)("span",{className:`text-lg font-bold ${r?"text-red-600":"text-green-600"}`,children:[t.currentStock," KG"]})]})}),W&&s.jsx(C.pj,{className:"text-right",children:(0,s.jsxs)("div",{className:"flex justify-end items-center gap-2",children:[s.jsx(z.I,{type:"number",className:"w-24 h-8 text-right border-pink-200 focus:border-pink-500 focus:ring-pink-500",value:Q[t.id]??t.currentStock,onChange:e=>eS(t.id,Number(e.target.value))}),s.jsx("span",{className:"text-sm text-gray-600",children:"KG"})]})}),!W&&s.jsx(C.pj,{className:"text-right",children:s.jsx("div",{className:"flex items-center justify-end gap-2",children:(0,s.jsxs)("span",{className:"number-display number-neutral",children:[t.safetyStockLevel||0," KG"]})})}),s.jsx(C.pj,{className:"text-right",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)(Z.h_,{children:[s.jsx(Z.$F,{asChild:!0,children:(0,s.jsxs)(P.z,{variant:"ghost",className:"h-8 w-8 p-0",disabled:W,children:[s.jsx("span",{className:"sr-only",children:"開啟選單"}),s.jsx(b.Z,{className:"h-4 w-4"})]})}),(0,s.jsxs)(Z.AW,{align:"end",children:[s.jsx(Z.Ju,{children:"操作"}),(0,s.jsxs)(Z.Xi,{onClick:()=>ef(t),children:[s.jsx(p.Z,{className:"h-4 w-4 mr-2"}),"加入採購車"]}),s.jsx(Z.VD,{}),(0,s.jsxs)(Z.Xi,{onClick:()=>ek(t),children:[s.jsx(y.Z,{className:"h-4 w-4 mr-2"}),"查看詳細"]}),(0,s.jsxs)(Z.Xi,{onClick:()=>ev(t),children:[s.jsx(v.Z,{className:"h-4 w-4 mr-2"}),"編輯香精"]}),s.jsx(Z.VD,{}),s.jsx(Z.Xi,{onClick:()=>eN(t),className:"text-red-600 focus:text-red-600",children:"刪除香精"})]})]})})]},t.id)}):s.jsx(C.SC,{children:s.jsx(C.pj,{colSpan:7,className:"text-center py-16",children:(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[s.jsx("div",{className:"w-16 h-16 bg-muted rounded-full flex items-center justify-center mb-4",children:s.jsx(j.Z,{className:"h-8 w-8 text-muted-foreground"})}),s.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"沒有香精資料"}),s.jsx("p",{className:"text-muted-foreground mb-4",children:"開始建立第一個香精來管理配方"}),(0,s.jsxs)(P.z,{onClick:ey,variant:"outline",className:"border-pink-200 text-pink-600 hover:bg-pink-50",children:[s.jsx(g.Z,{className:"mr-2 h-4 w-4"}),"新增香精"]})]})})})})]})})]})}),s.jsx(o.$,{isOpen:E,onOpenChange:F,onFragranceUpdate:ep,fragranceData:I}),I&&s.jsx(d.Q,{isOpen:O,onOpenChange:_,onConfirm:ew,title:`確認刪除香精`,description:`您確定要永久刪除香精「${I.name}」嗎？此操作無法復原。`}),s.jsx(d.Q,{isOpen:em,onOpenChange:eu,onConfirm:eb,title:"確認批量刪除",description:`您確定要永久刪除選中的 ${V.size} 個香精嗎？此操作無法復原。`}),s.jsx(R.Z,{isOpen:Y,onOpenChange:ee,onImport:eA,onExport:ez,title:"香精資料",description:"匯入或匯出香精資料，支援 Excel 和 CSV 格式。匯入時會智能匹配香精代號：如果代號不存在則新增，如果代號已存在則更新覆蓋有填入的欄位。",color:"purple",showUpdateOption:!1,maxBatchSize:500,sampleData:[{code:"FRAG001",name:"示例香精",fragranceType:"棉芯",fragranceStatus:"啟用",supplierName:"示例供應商",safetyStockLevel:1e3,costPerUnit:15.5,percentage:5,currentStock:500,unit:"KG"}],fields:[{key:"code",label:"香精代號",required:!1,type:"string"},{key:"name",label:"香精名稱",required:!0,type:"string"},{key:"fragranceType",label:"香精種類",required:!1,type:"string"},{key:"fragranceStatus",label:"啟用狀態",required:!1,type:"string"},{key:"supplierName",label:"供應商",required:!1,type:"string"},{key:"safetyStockLevel",label:"安全庫存",required:!1,type:"number"},{key:"costPerUnit",label:"單位成本",required:!1,type:"number"},{key:"percentage",label:"香精比例",required:!1,type:"number"},{key:"pgRatio",label:"PG比例",required:!1,type:"number"},{key:"vgRatio",label:"VG比例",required:!1,type:"number"},{key:"currentStock",label:"目前庫存",required:!1,type:"number"},{key:"unit",label:"單位",required:!1,type:"string"}]}),et&&s.jsx(q.O,{isOpen:es,onOpenChange:ea,title:et.name,subtitle:`代號: ${et.code}`,sections:[{title:"基本資訊",icon:s.jsx(j.Z,{className:"h-4 w-4"}),fields:[{label:"香精代號",value:et.code},{label:"香精名稱",value:et.name},{label:"供應商",value:et.supplierName},{label:"香精種類",value:"cotton"===et.fragranceType?"棉芯":"ceramic"===et.fragranceType?"陶瓷芯":"universal"===et.fragranceType?"棉陶芯通用":"未指定"}]},{title:"庫存資訊",icon:s.jsx(k.Z,{className:"h-4 w-4"}),fields:[{label:"目前庫存",value:et.currentStock,type:"number"},{label:"安全庫存",value:et.safetyStockLevel,type:"number"},{label:"單位成本",value:et.costPerUnit,type:"currency"}]},{title:"配方資訊",icon:s.jsx(x.Z,{className:"h-4 w-4"}),fields:[{label:"濃度百分比",value:et.percentage,type:"number"},{label:"PG比例",value:et.pgRatio,type:"number"},{label:"VG比例",value:et.vgRatio,type:"number"}]}],actions:(0,s.jsxs)(s.Fragment,{children:[s.jsx(P.z,{variant:"outline",onClick:()=>ea(!1),children:"關閉"}),(0,s.jsxs)(P.z,{onClick:()=>{ea(!1),ev(et)},children:[s.jsx(v.Z,{className:"mr-2 h-4 w-4"}),"編輯"]})]})})]})}function M(){return s.jsx(a.Suspense,{fallback:s.jsx("div",{children:"Loading..."}),children:s.jsx(L,{})})}},96533:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`D:\APP\deer-lab\src\app\dashboard\fragrances\page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,9654,5540,8693,692,9516,3128,4108,4334,9536,4504],()=>r(12354));module.exports=s})();